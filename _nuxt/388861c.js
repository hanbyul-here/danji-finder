/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{151:function(t,e,n){!function(t){"use strict";function e(t){var i,e,n,r;for(e=1,n=arguments.length;e<n;e++)for(i in r=arguments[e])t[i]=r[i];return t}var n=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function r(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var r=n.call(arguments,2);return function(){return t.apply(e,r.length?r.concat(n.call(arguments)):arguments)}}var o=0;function l(t){return t._leaflet_id=t._leaflet_id||++o,t._leaflet_id}function h(t,time,e){var n,r,o,l;return l=function(){n=!1,r&&(o.apply(e,r),r=!1)},o=function(){n?r=arguments:(t.apply(e,arguments),setTimeout(l,time),n=!0)}}function c(t,e,n){var r=e[1],o=e[0],l=r-o;return t===r&&n?t:((t-o)%l+l)%l+o}function f(){return!1}function d(t,e){var n=Math.pow(10,void 0===e?6:e);return Math.round(t*n)/n}function _(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function m(t){return _(t).split(/\s+/)}function v(t,e){for(var i in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?n(t.options):{}),e)t.options[i]=e[i];return t.options}function y(t,e,n){var r=[];for(var i in t)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(t[i]));return(e&&-1!==e.indexOf("?")?"&":"?")+r.join("&")}var x=/\{ *([\w_-]+) *\}/g;function template(t,data){return t.replace(x,(function(t,e){var n=data[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(data)),n}))}var w=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function T(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var A="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function E(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var k=0;function S(t){var time=+new Date,e=Math.max(0,16-(time-k));return k=time+e,window.setTimeout(t,e)}var P=window.requestAnimationFrame||E("RequestAnimationFrame")||S,M=window.cancelAnimationFrame||E("CancelAnimationFrame")||E("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function z(t,e,n){if(!n||P!==S)return P.call(window,r(t,e));t.call(e)}function R(t){t&&M.call(window,t)}var C={extend:e,create:n,bind:r,lastId:o,stamp:l,throttle:h,wrapNum:c,falseFn:f,formatNum:d,trim:_,splitWords:m,setOptions:v,getParamString:y,template:template,isArray:w,indexOf:T,emptyImageUrl:A,requestFn:P,cancelFn:M,requestAnimFrame:z,cancelAnimFrame:R};function O(){}O.extend=function(t){var r=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=r.__super__=this.prototype,l=n(o);for(var i in l.constructor=r,r.prototype=l,this)Object.prototype.hasOwnProperty.call(this,i)&&"prototype"!==i&&"__super__"!==i&&(r[i]=this[i]);return t.statics&&(e(r,t.statics),delete t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=w(t)?t:[t];for(var i=0;i<t.length;i++)t[i]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),e.apply(null,[l].concat(t.includes)),delete t.includes),l.options&&(t.options=e(n(l.options),t.options)),e(l,t),l._initHooks=[],l.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var i=0,t=l._initHooks.length;i<t;i++)l._initHooks[i].call(this)}},r},O.include=function(t){return e(this.prototype,t),this},O.mergeOptions=function(t){return e(this.prototype.options,t),this},O.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var N={on:function(t,e,n){if("object"==typeof t)for(var r in t)this._on(r,t[r],e);else for(var i=0,o=(t=m(t)).length;i<o;i++)this._on(t[i],e,n);return this},off:function(t,e,n){if(t)if("object"==typeof t)for(var r in t)this._off(r,t[r],e);else for(var i=0,o=(t=m(t)).length;i<o;i++)this._off(t[i],e,n);else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var r=this._events[t];r||(r=[],this._events[t]=r),n===this&&(n=void 0);for(var o={fn:e,ctx:n},l=r,i=0,h=l.length;i<h;i++)if(l[i].fn===e&&l[i].ctx===n)return;l.push(o)},_off:function(t,e,n){var r,i,o;if(this._events&&(r=this._events[t]))if(e){if(n===this&&(n=void 0),r)for(i=0,o=r.length;i<o;i++){var l=r[i];if(l.ctx===n&&l.fn===e)return l.fn=f,this._firingCount&&(this._events[t]=r=r.slice()),void r.splice(i,1)}}else{for(i=0,o=r.length;i<o;i++)r[i].fn=f;delete this._events[t]}},fire:function(t,data,n){if(!this.listens(t,n))return this;var r=e({},data,{type:t,target:this,sourceTarget:data&&data.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var i=0,l=o.length;i<l;i++){var h=o[i];h.fn.call(h.ctx||this,r)}this._firingCount--}}return n&&this._propagateEvent(r),this},listens:function(t,e){var n=this._events&&this._events[t];if(n&&n.length)return!0;if(e)for(var r in this._eventParents)if(this._eventParents[r].listens(t,e))return!0;return!1},once:function(t,e,n){if("object"==typeof t){for(var o in t)this.once(o,t[o],e);return this}var l=r((function(){this.off(t,e,n).off(t,l,n)}),this);return this.on(t,e,n).on(t,l,n)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[l(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[l(t)],this},_propagateEvent:function(t){for(var n in this._eventParents)this._eventParents[n].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};N.addEventListener=N.on,N.removeEventListener=N.clearAllEventListeners=N.off,N.addOneTimeEventListener=N.once,N.fireEvent=N.fire,N.hasEventListeners=N.listens;var I=O.extend(N);function F(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var D=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function B(t,e,n){return t instanceof F?t:w(t)?new F(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new F(t.x,t.y):new F(t,e,n)}function j(a,b){if(a)for(var t=b?[a,b]:a,i=0,e=t.length;i<e;i++)this.extend(t[i])}function U(a,b){return!a||a instanceof j?a:new j(a,b)}function G(t,e){if(t)for(var n=e?[t,e]:t,i=0,r=n.length;i<r;i++)this.extend(n[i])}function Z(a,b){return a instanceof G?a:new G(a,b)}function V(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}function W(a,b,t){return a instanceof V?a:w(a)&&"object"!=typeof a[0]?3===a.length?new V(a[0],a[1],a[2]):2===a.length?new V(a[0],a[1]):null:null==a?a:"object"==typeof a&&"lat"in a?new V(a.lat,"lng"in a?a.lng:a.lon,a.alt):void 0===b?null:new V(a,b,t)}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(t){return this.clone()._add(B(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(B(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new F(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new F(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=D(this.x),this.y=D(this.y),this},distanceTo:function(t){var e=(t=B(t)).x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return(t=B(t)).x===this.x&&t.y===this.y},contains:function(t){return t=B(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+d(this.x)+", "+d(this.y)+")"}},j.prototype={extend:function(t){return t=B(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new F(this.min.x,this.max.y)},getTopRight:function(){return new F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return(t="number"==typeof t[0]||t instanceof F?B(t):U(t))instanceof j?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=U(t);var e=this.min,n=this.max,r=t.min,o=t.max,l=o.x>=e.x&&r.x<=n.x,h=o.y>=e.y&&r.y<=n.y;return l&&h},overlaps:function(t){t=U(t);var e=this.min,n=this.max,r=t.min,o=t.max,l=o.x>e.x&&r.x<n.x,h=o.y>e.y&&r.y<n.y;return l&&h},isValid:function(){return!(!this.min||!this.max)}},G.prototype={extend:function(t){var e,n,r=this._southWest,o=this._northEast;if(t instanceof V)e=t,n=t;else{if(!(t instanceof G))return t?this.extend(W(t)||Z(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return r||o?(r.lat=Math.min(e.lat,r.lat),r.lng=Math.min(e.lng,r.lng),o.lat=Math.max(n.lat,o.lat),o.lng=Math.max(n.lng,o.lng)):(this._southWest=new V(e.lat,e.lng),this._northEast=new V(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,r=Math.abs(e.lat-n.lat)*t,o=Math.abs(e.lng-n.lng)*t;return new G(new V(e.lat-r,e.lng-o),new V(n.lat+r,n.lng+o))},getCenter:function(){return new V((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new V(this.getNorth(),this.getWest())},getSouthEast:function(){return new V(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof V||"lat"in t?W(t):Z(t);var e,n,r=this._southWest,o=this._northEast;return t instanceof G?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=r.lat&&n.lat<=o.lat&&e.lng>=r.lng&&n.lng<=o.lng},intersects:function(t){t=Z(t);var e=this._southWest,n=this._northEast,r=t.getSouthWest(),o=t.getNorthEast(),l=o.lat>=e.lat&&r.lat<=n.lat,h=o.lng>=e.lng&&r.lng<=n.lng;return l&&h},overlaps:function(t){t=Z(t);var e=this._southWest,n=this._northEast,r=t.getSouthWest(),o=t.getNorthEast(),l=o.lat>e.lat&&r.lat<n.lat,h=o.lng>e.lng&&r.lng<n.lng;return l&&h},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=Z(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},V.prototype={equals:function(t,e){return!!t&&(t=W(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+d(this.lat,t)+", "+d(this.lng,t)+")"},distanceTo:function(t){return X.distance(this,W(t))},wrap:function(){return X.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return Z([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new V(this.lat,this.lng,this.alt)}};var H,Y={latLngToPoint:function(t,e){var n=this.projection.project(t),r=this.scale(e);return this.transformation._transform(n,r)},pointToLatLng:function(t,e){var n=this.scale(e),r=this.transformation.untransform(t,n);return this.projection.unproject(r)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var b=this.projection.bounds,s=this.scale(t);return new j(this.transformation.transform(b.min,s),this.transformation.transform(b.max,s))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?c(t.lng,this.wrapLng,!0):t.lng;return new V(this.wrapLat?c(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),r=e.lat-n.lat,o=e.lng-n.lng;if(0===r&&0===o)return t;var l=t.getSouthWest(),h=t.getNorthEast();return new G(new V(l.lat-r,l.lng-o),new V(h.lat-r,h.lng-o))}},X=e({},Y,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,r=t.lat*n,o=e.lat*n,l=Math.sin((e.lat-t.lat)*n/2),h=Math.sin((e.lng-t.lng)*n/2),a=l*l+Math.cos(r)*Math.cos(o)*h*h,c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*c}}),$={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,t.lat),-n),o=Math.sin(r*e);return new F(this.R*t.lng*e,this.R*Math.log((1+o)/(1-o))/2)},unproject:function(t){var e=180/Math.PI;return new V((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(H=6378137*Math.PI,new j([-H,-H],[H,H]))};function J(a,b,t,e){if(w(a))return this._a=a[0],this._b=a[1],this._c=a[2],void(this._d=a[3]);this._a=a,this._b=b,this._c=t,this._d=e}function K(a,b,t,e){return new J(a,b,t,e)}J.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new F((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Q=e({},X,{code:"EPSG:3857",projection:$,transformation:function(){var t=.5/(Math.PI*$.R);return K(t,.5,-t,.5)}()}),tt=e({},Q,{code:"EPSG:900913"});function et(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function it(t,e){var i,n,r,o,l,p,h="";for(i=0,r=t.length;i<r;i++){for(n=0,o=(l=t[i]).length;n<o;n++)h+=(n?"L":"M")+(p=l[n]).x+" "+p.y;h+=e?svg?"z":"x":""}return h||"M0 0"}var nt=document.documentElement.style,ot="ActiveXObject"in window,st=ot&&!document.addEventListener,at="msLaunchUri"in navigator&&!("documentMode"in document),lt=It("webkit"),ut=It("android"),ht=It("android 2")||It("android 3"),ct=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ft=ut&&It("Google")&&ct<537&&!("AudioNode"in window),pt=!!window.opera,_t=!at&&It("chrome"),mt=It("gecko")&&!lt&&!pt&&!ot,gt=!_t&&It("safari"),vt=It("phantom"),yt="OTransition"in nt,bt=0===navigator.platform.indexOf("Win"),xt=ot&&"transition"in nt,wt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ht,Tt="MozPerspective"in nt,At=!window.L_DISABLE_3D&&(xt||wt||Tt)&&!yt&&!vt,Et="undefined"!=typeof orientation||It("mobile"),kt=Et&&lt,St=Et&&wt,Pt=!window.PointerEvent&&window.MSPointerEvent,Mt=!(!window.PointerEvent&&!Pt),zt=!window.L_NO_TOUCH&&(Mt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Rt=Et&&pt,Lt=Et&&mt,Ct=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ot=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",f,e),window.removeEventListener("testPassiveEventSupport",f,e)}catch(t){}return t}(),canvas=!!document.createElement("canvas").getContext,svg=!(!document.createElementNS||!et("svg").createSVGRect),Nt=!svg&&function(){try{var div=document.createElement("div");div.innerHTML='<v:shape adj="1"/>';var t=div.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"==typeof t.adj}catch(t){return!1}}();function It(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Ft={ie:ot,ielt9:st,edge:at,webkit:lt,android:ut,android23:ht,androidStock:ft,opera:pt,chrome:_t,gecko:mt,safari:gt,phantom:vt,opera12:yt,win:bt,ie3d:xt,webkit3d:wt,gecko3d:Tt,any3d:At,mobile:Et,mobileWebkit:kt,mobileWebkit3d:St,msPointer:Pt,pointer:Mt,touch:zt,mobileOpera:Rt,mobileGecko:Lt,retina:Ct,passiveEvents:Ot,canvas:canvas,svg:svg,vml:Nt},Dt=Pt?"MSPointerDown":"pointerdown",Bt=Pt?"MSPointerMove":"pointermove",jt=Pt?"MSPointerUp":"pointerup",Ut=Pt?"MSPointerCancel":"pointercancel",Gt={},Zt=!1;function Vt(t,e,n,o){return"touchstart"===e?function(t,e,n){var o=r((function(t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Ue(t),Yt(t,e)}));t["_leaflet_touchstart"+n]=o,t.addEventListener(Dt,o,!1),Zt||(document.addEventListener(Dt,qt,!0),document.addEventListener(Bt,Wt,!0),document.addEventListener(jt,Ht,!0),document.addEventListener(Ut,Ht,!0),Zt=!0)}(t,n,o):"touchmove"===e?function(t,e,n){var r=function(t){t.pointerType===(t.MSPOINTER_TYPE_MOUSE||"mouse")&&0===t.buttons||Yt(t,e)};t["_leaflet_touchmove"+n]=r,t.addEventListener(Bt,r,!1)}(t,n,o):"touchend"===e&&function(t,e,n){var r=function(t){Yt(t,e)};t["_leaflet_touchend"+n]=r,t.addEventListener(jt,r,!1),t.addEventListener(Ut,r,!1)}(t,n,o),this}function qt(t){Gt[t.pointerId]=t}function Wt(t){Gt[t.pointerId]&&(Gt[t.pointerId]=t)}function Ht(t){delete Gt[t.pointerId]}function Yt(t,e){for(var i in t.touches=[],Gt)t.touches.push(Gt[i]);t.changedTouches=[t],e(t)}var Xt,$t,Jt,Kt,Qt,te=Pt?"MSPointerDown":Mt?"pointerdown":"touchstart",ee=Pt?"MSPointerUp":Mt?"pointerup":"touchend",ie="_leaflet_",ne=ye(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),re=ye(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),oe="webkitTransition"===re||"OTransition"===re?re+"End":"transitionend";function se(t){return"string"==typeof t?document.getElementById(t):t}function ae(t,style){var e=t.style[style]||t.currentStyle&&t.currentStyle[style];if((!e||"auto"===e)&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);e=n?n[style]:null}return"auto"===e?null:e}function le(t,e,n){var r=document.createElement(t);return r.className=e||"",n&&n.appendChild(r),r}function ue(t){var e=t.parentNode;e&&e.removeChild(t)}function he(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function ce(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function fe(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function de(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=ge(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function pe(t,e){if(void 0!==t.classList)for(var n=m(e),i=0,r=n.length;i<r;i++)t.classList.add(n[i]);else if(!de(t,e)){var o=ge(t);me(t,(o?o+" ":"")+e)}}function _e(t,e){void 0!==t.classList?t.classList.remove(e):me(t,_((" "+ge(t)+" ").replace(" "+e+" "," ")))}function me(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function ge(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function ve(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var filter=!1,n="DXImageTransform.Microsoft.Alpha";try{filter=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),filter?(filter.Enabled=100!==e,filter.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}(t,e)}function ye(t){for(var style=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in style)return t[i];return!1}function be(t,e,n){var r=e||new F(0,0);t.style[ne]=(xt?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(n?" scale("+n+")":"")}function xe(t,e){t._leaflet_pos=e,At?be(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function we(t){return t._leaflet_pos||new F(0,0)}if("onselectstart"in document)Xt=function(){Re(window,"selectstart",Ue)},$t=function(){Ce(window,"selectstart",Ue)};else{var Te=ye(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Xt=function(){if(Te){var style=document.documentElement.style;Jt=style[Te],style[Te]="none"}},$t=function(){Te&&(document.documentElement.style[Te]=Jt,Jt=void 0)}}function Ae(){Re(window,"dragstart",Ue)}function Ee(){Ce(window,"dragstart",Ue)}function ke(element){for(;-1===element.tabIndex;)element=element.parentNode;element.style&&(Se(),Kt=element,Qt=element.style.outline,element.style.outline="none",Re(window,"keydown",Se))}function Se(){Kt&&(Kt.style.outline=Qt,Kt=void 0,Qt=void 0,Ce(window,"keydown",Se))}function Pe(element){do{element=element.parentNode}while(!(element.offsetWidth&&element.offsetHeight||element===document.body));return element}function Me(element){var rect=element.getBoundingClientRect();return{x:rect.width/element.offsetWidth||1,y:rect.height/element.offsetHeight||1,boundingClientRect:rect}}var ze={TRANSFORM:ne,TRANSITION:re,TRANSITION_END:oe,get:se,getStyle:ae,create:le,remove:ue,empty:he,toFront:ce,toBack:fe,hasClass:de,addClass:pe,removeClass:_e,setClass:me,getClass:ge,setOpacity:ve,testProp:ye,setTransform:be,setPosition:xe,getPosition:we,disableTextSelection:Xt,enableTextSelection:$t,disableImageDrag:Ae,enableImageDrag:Ee,preventOutline:ke,restoreOutline:Se,getSizedParentNode:Pe,getScale:Me};function Re(t,e,n,r){if("object"==typeof e)for(var o in e)Ie(t,o,e[o],n);else for(var i=0,l=(e=m(e)).length;i<l;i++)Ie(t,e[i],n,r);return this}var Le="_leaflet_events";function Ce(t,e,n,r){if("object"==typeof e)for(var o in e)Fe(t,o,e[o],n);else if(e)for(var i=0,l=(e=m(e)).length;i<l;i++)Fe(t,e[i],n,r);else{for(var h in t[Le])Fe(t,h,t[Le][h]);delete t[Le]}return this}function Oe(){if(Mt)return!(at||gt)}var Ne={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ie(t,e,n,r){var o=e+l(n)+(r?"_"+l(r):"");if(t[Le]&&t[Le][o])return this;var h=function(e){return n.call(r||t,e||window.event)},c=h;Mt&&0===e.indexOf("touch")?Vt(t,e,h,o):zt&&"dblclick"===e&&!Oe()?function(t,e,n){var r,o,l=!1;function h(t){if(Mt){if(!t.isPrimary)return;if("mouse"===t.pointerType)return}else if(t.touches.length>1)return;var e=Date.now(),n=e-(r||e);o=t.touches?t.touches[0]:t,l=n>0&&n<=250,r=e}function c(t){if(l&&!o.cancelBubble){if(Mt){if("mouse"===t.pointerType)return;var n,i,h={};for(i in o)n=o[i],h[i]=n&&n.bind?n.bind(o):n;o=h}o.type="dblclick",o.button=0,e(o),r=null}}t[ie+te+n]=h,t[ie+ee+n]=c,t[ie+"dblclick"+n]=e,t.addEventListener(te,h,!!Ot&&{passive:!1}),t.addEventListener(ee,c,!!Ot&&{passive:!1}),t.addEventListener("dblclick",e,!1)}(t,h,o):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(Ne[e]||e,h,!!Ot&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(h=function(e){e=e||window.event,Xe(t,e)&&c(e)},t.addEventListener(Ne[e],h,!1)):t.addEventListener(e,c,!1):"attachEvent"in t&&t.attachEvent("on"+e,h),t[Le]=t[Le]||{},t[Le][o]=h}function Fe(t,e,n,r){var o=e+l(n)+(r?"_"+l(r):""),h=t[Le]&&t[Le][o];if(!h)return this;Mt&&0===e.indexOf("touch")?function(t,e,n){var r=t["_leaflet_"+e+n];"touchstart"===e?t.removeEventListener(Dt,r,!1):"touchmove"===e?t.removeEventListener(Bt,r,!1):"touchend"===e&&(t.removeEventListener(jt,r,!1),t.removeEventListener(Ut,r,!1))}(t,e,o):zt&&"dblclick"===e&&!Oe()?function(t,e){var n=t[ie+te+e],r=t[ie+ee+e],o=t[ie+"dblclick"+e];t.removeEventListener(te,n,!!Ot&&{passive:!1}),t.removeEventListener(ee,r,!!Ot&&{passive:!1}),t.removeEventListener("dblclick",o,!1)}(t,o):"removeEventListener"in t?t.removeEventListener(Ne[e]||e,h,!1):"detachEvent"in t&&t.detachEvent("on"+e,h),t[Le][o]=null}function De(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,Ye(t),this}function Be(t){return Ie(t,"wheel",De),this}function je(t){return Re(t,"mousedown touchstart dblclick",De),Ie(t,"click",He),this}function Ue(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Ge(t){return Ue(t),De(t),this}function Ze(t,e){if(!e)return new F(t.clientX,t.clientY);var n=Me(e),r=n.boundingClientRect;return new F((t.clientX-r.left)/n.x-e.clientLeft,(t.clientY-r.top)/n.y-e.clientTop)}var Ve=bt&&_t?2*window.devicePixelRatio:mt?window.devicePixelRatio:1;function qe(t){return at?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Ve:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var We={};function He(t){We[t.type]=!0}function Ye(t){var e=We[t.type];return We[t.type]=!1,e}function Xe(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(t){return!1}return n!==t}var $e={on:Re,off:Ce,stopPropagation:De,disableScrollPropagation:Be,disableClickPropagation:je,preventDefault:Ue,stop:Ge,getMousePosition:Ze,getWheelDelta:qe,fakeStop:He,skipped:Ye,isExternalTarget:Xe,addListener:Re,removeListener:Ce},Je=I.extend({run:function(t,e,n,r){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=we(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=z(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(progress,t){var e=this._startPos.add(this._offset.multiplyBy(progress));t&&e._round(),xe(this._el,e),this.fire("step")},_complete:function(){R(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Ke=I.extend({options:{crs:Q,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=v(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(W(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=re&&At&&!Rt&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Re(this._proxy,oe,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,n,r){return n=void 0===n?this._zoom:this._limitZoom(n),t=this._limitCenter(W(t),n,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=e({animate:r.animate},r.zoom),r.pan=e({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==n?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,n,r.zoom):this._tryAnimatedPan(t,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,n),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(At?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(At?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var r=this.getZoomScale(e),o=this.getSize().divideBy(2),l=(t instanceof F?t:this.latLngToContainerPoint(t)).subtract(o).multiplyBy(1-1/r),h=this.containerPointToLatLng(o.add(l));return this.setView(h,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():Z(t);var n=B(e.paddingTopLeft||e.padding||[0,0]),r=B(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,n.add(r));if((o="number"==typeof e.maxZoom?Math.min(e.maxZoom,o):o)===1/0)return{center:t.getCenter(),zoom:o};var l=r.subtract(n).divideBy(2),h=this.project(t.getSouthWest(),o),c=this.project(t.getNorthEast(),o);return{center:this.unproject(h.add(c).divideBy(2).add(l),o),zoom:o}},fitBounds:function(t,e){if(!(t=Z(t)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=B(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Je,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){pe(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(!1===(n=n||{}).animate||!At)return this.setView(t,e,n);this._stop();var r=this.project(this.getCenter()),o=this.project(t),l=this.getSize(),h=this._zoom;t=W(t),e=void 0===e?h:e;var c=Math.max(l.x,l.y),f=c*this.getZoomScale(h,e),d=o.distanceTo(r)||1;function _(i){var b=(f*f-c*c+2.0164*(i?-1:1)*2.0164*d*d)/(2*(i?f:c)*2.0164*d),t=Math.sqrt(b*b+1)-b;return t<1e-9?-18:Math.log(t)}function m(t){return(Math.exp(t)-Math.exp(-t))/2}function v(t){return(Math.exp(t)+Math.exp(-t))/2}var y=_(0);function u(s){return c*(v(y)*(m(t=y+1.42*s)/v(t))-m(y))/2.0164;var t}var x=Date.now(),w=(_(1)-y)/1.42,T=n.duration?1e3*n.duration:1e3*w*.8;return this._moveStart(!0,n.noMoveStart),function n(){var l=(Date.now()-x)/T,s=function(t){return 1-Math.pow(1-t,1.5)}(l)*w;l<=1?(this._flyToFrame=z(n,this),this._move(this.unproject(r.add(o.subtract(r).multiplyBy(u(s)/d)),h),this.getScaleZoom(c/function(s){return c*(v(y)/v(y+1.42*s))}(s),h),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return(t=Z(t)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),r=this._limitCenter(n,this._zoom,Z(t));return n.equals(r)||this.panTo(r,e),this._enforcingBounds=!1,this},panInside:function(t,e){var n=B((e=e||{}).paddingTopLeft||e.padding||[0,0]),r=B(e.paddingBottomRight||e.padding||[0,0]),o=this.getCenter(),l=this.project(o),h=this.project(t),c=this.getPixelBounds(),f=c.getSize().divideBy(2),d=U([c.min.add(n),c.max.subtract(r)]);if(!d.contains(h)){this._enforcingBounds=!0;var _=l.subtract(h),m=B(h.x+_.x,h.y+_.y);(h.x<d.min.x||h.x>d.max.x)&&(m.x=l.x-_.x,_.x>0?m.x+=f.x-n.x:m.x-=f.x-r.x),(h.y<d.min.y||h.y>d.max.y)&&(m.y=l.y-_.y,_.y>0?m.y+=f.y-n.y:m.y-=f.y-r.y),this.panTo(this.unproject(m),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},!0===t?{animate:!0}:t);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),l=n.divideBy(2).round(),h=o.divideBy(2).round(),c=l.subtract(h);return c.x||c.y?(t.animate&&t.pan?this.panBy(c):(t.pan&&this._rawPanBy(c),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:o})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=r(this._handleGeolocationResponse,this),o=r(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,o,t):navigator.geolocation.getCurrentPosition(n,o,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(t){var e=new V(t.coords.latitude,t.coords.longitude),n=e.toBounds(2*t.coords.accuracy),r=this._locateOptions;if(r.setView){var o=this.getBoundsZoom(n);this.setView(e,r.maxZoom?Math.min(o,r.maxZoom):o)}var data={latlng:e,bounds:n,timestamp:t.timestamp};for(var i in t.coords)"number"==typeof t.coords[i]&&(data[i]=t.coords[i]);this.fire("locationfound",data)},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var i;for(i in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),ue(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(R(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[i].remove();for(i in this._panes)ue(this._panes[i]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n=le("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new G(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=Z(t),n=B(n||[0,0]);var r=this.getZoom()||0,o=this.getMinZoom(),l=this.getMaxZoom(),h=t.getNorthWest(),c=t.getSouthEast(),f=this.getSize().subtract(n),d=U(this.project(c,r),this.project(h,r)).getSize(),_=At?this.options.zoomSnap:1,m=f.x/d.x,v=f.y/d.y,y=e?Math.max(m,v):Math.min(m,v);return r=this.getScaleZoom(y,r),_&&(r=Math.round(r/(_/100))*(_/100),r=e?Math.ceil(r/_)*_:Math.floor(r/_)*_),Math.max(o,Math.min(l,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new F(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new j(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=void 0===e?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=void 0===e?this._zoom:e;var r=n.zoom(t*n.scale(e));return isNaN(r)?1/0:r},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(W(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(B(t),e)},layerPointToLatLng:function(t){var e=B(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(W(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(W(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(Z(t))},distance:function(t,e){return this.options.crs.distance(W(t),W(e))},containerPointToLayerPoint:function(t){return B(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return B(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(B(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(W(t)))},mouseEventToContainerPoint:function(t){return Ze(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=se(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");Re(e,"scroll",this._onScroll,this),this._containerId=l(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&At,pe(t,"leaflet-container"+(zt?" leaflet-touch":"")+(Ct?" leaflet-retina":"")+(st?" leaflet-oldie":"")+(gt?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=ae(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),xe(this._mapPane,new F(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(pe(t.markerPane,"leaflet-zoom-hide"),pe(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){xe(this._mapPane,new F(0,0));var n=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var r=this._zoom!==e;this._moveStart(r,!1)._move(t,e)._moveEnd(r),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,data){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(n||data&&data.pinch)&&this.fire("zoom",data),this.fire("move",data)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return R(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){xe(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[l(this._container)]=this;var e=t?Ce:Re;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),At&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){R(this._resizeRequest),this._resizeRequest=z((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,r=[],o="mouseout"===e||"mouseover"===e,h=t.target||t.srcElement,c=!1;h;){if((n=this._targets[l(h)])&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(n)){c=!0;break}if(n&&n.listens(e,!0)){if(o&&!Xe(h,t))break;if(r.push(n),o)break}if(h===this._container)break;h=h.parentNode}return r.length||c||o||!Xe(h,t)||(r=[this]),r},_handleDOMEvent:function(t){if(this._loaded&&!Ye(t)){var e=t.type;"mousedown"!==e&&"keypress"!==e&&"keyup"!==e&&"keydown"!==e||ke(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,n,r){if("click"===t.type){var o=e({},t);o.type="preclick",this._fireDOMEvent(o,o.type,r)}if(!t._stopped&&(r=(r||[]).concat(this._findEventTargets(t,n))).length){var l=r[0];"contextmenu"===n&&l.listens(n,!0)&&Ue(t);var data={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var h=l.getLatLng&&(!l._radius||l._radius<=10);data.containerPoint=h?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(t),data.layerPoint=this.containerPointToLayerPoint(data.containerPoint),data.latlng=h?l.getLatLng():this.layerPointToLatLng(data.layerPoint)}for(var i=0;i<r.length;i++)if(r[i].fire(n,data,!0),data.originalEvent._stopped||!1===r[i].options.bubblingMouseEvents&&-1!==T(this._mouseEvents,n))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var i=0,t=this._handlers.length;i<t;i++)this._handlers[i].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return we(this._mapPane)||new F(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var r=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(r)},_latLngBoundsToNewLayerBounds:function(t,e,n){var r=this._getNewPixelOrigin(n,e);return U([this.project(t.getSouthWest(),e)._subtract(r),this.project(t.getNorthWest(),e)._subtract(r),this.project(t.getSouthEast(),e)._subtract(r),this.project(t.getNorthEast(),e)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var r=this.project(t,e),o=this.getSize().divideBy(2),l=new j(r.subtract(o),r.add(o)),h=this._getBoundsOffset(l,n,e);return h.round().equals([0,0])?t:this.unproject(r.add(h),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),r=new j(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(r,e))},_getBoundsOffset:function(t,e,n){var r=U(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),o=r.min.subtract(t.min),l=r.max.subtract(t.max);return new F(this._rebound(o.x,-l.x),this._rebound(o.y,-l.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),r=At?this.options.zoomSnap:1;return r&&(t=Math.round(t/r)*r),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){_e(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(n)||(this.panBy(n,e),0))},_createAnimProxy:function(){var t=this._proxy=le("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",(function(t){var e=ne,n=this._proxy.style[e];be(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),n===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ue(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();be(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/r);return!(!0!==n.animate&&!this.getSize().contains(o)||(z((function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)}),this),0))},_animateZoom:function(t,e,n,o){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,pe(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:o}),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&_e(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),z((function(){this._moveEnd(!0)}),this))}}),Qe=O.extend({options:{position:"topright"},initialize:function(t){v(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var map=this._map;return map&&map.removeControl(this),this.options.position=t,map&&map.addControl(this),this},getContainer:function(){return this._container},addTo:function(map){this.remove(),this._map=map;var t=this._container=this.onAdd(map),e=this.getPosition(),n=map._controlCorners[e];return pe(t,"leaflet-control"),-1!==e.indexOf("bottom")?n.insertBefore(t,n.firstChild):n.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ue(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),ti=function(t){return new Qe(t)};Ke.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=le("div",e+"control-container",this._container);function r(r,o){var l=e+r+" "+e+o;t[r+o]=le("div",l,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var i in this._controlCorners)ue(this._controlCorners[i]);ue(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ei=Qe.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,r){return n<r?-1:r<n?1:0}},initialize:function(t,e,n){for(var i in v(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(map){this._initLayout(),this._update(),this._map=map,map.on("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(map){return Qe.prototype.addTo.call(this,map),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(l(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){pe(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(pe(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):_e(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return _e(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=le("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),je(e),Be(e);var section=this._section=le("section",t+"-list");n&&(this._map.on("click",this.collapse,this),ut||Re(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var link=this._layersLink=le("a",t+"-toggle",e);link.href="#",link.title="Layers",zt?(Re(link,"click",Ge),Re(link,"click",this.expand,this)):Re(link,"focus",this.expand,this),n||this.expand(),this._baseLayersList=le("div",t+"-base",section),this._separator=le("div",t+"-separator",section),this._overlaysList=le("div",t+"-overlays",section),e.appendChild(section)},_getLayer:function(t){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&l(this._layers[i].layer)===t)return this._layers[i]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(r((function(a,b){return this.options.sortFunction(a.layer,b.layer,a.name,b.name)}),this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;he(this._baseLayersList),he(this._overlaysList),this._layerControlInputs=[];var t,e,i,n,r=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,r+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&r>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(l(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(t){var input,label=document.createElement("label"),e=this._map.hasLayer(t.layer);t.overlay?((input=document.createElement("input")).type="checkbox",input.className="leaflet-control-layers-selector",input.defaultChecked=e):input=this._createRadioElement("leaflet-base-layers_"+l(this),e),this._layerControlInputs.push(input),input.layerId=l(t.layer),Re(input,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var r=document.createElement("div");return label.appendChild(r),r.appendChild(input),r.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(label),this._checkDisabledLayers(),label},_onInputClick:function(){var input,t,e=this._layerControlInputs,n=[],r=[];this._handlingClick=!0;for(var i=e.length-1;i>=0;i--)input=e[i],t=this._getLayer(input.layerId).layer,input.checked?n.push(t):input.checked||r.push(t);for(i=0;i<r.length;i++)this._map.hasLayer(r[i])&&this._map.removeLayer(r[i]);for(i=0;i<n.length;i++)this._map.hasLayer(n[i])||this._map.addLayer(n[i]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var input,t,e=this._layerControlInputs,n=this._map.getZoom(),i=e.length-1;i>=0;i--)input=e[i],t=this._getLayer(input.layerId).layer,input.disabled=void 0!==t.options.minZoom&&n<t.options.minZoom||void 0!==t.options.maxZoom&&n>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),ii=Qe.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(map){var t="leaflet-control-zoom",e=le("div",t+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,t+"-in",e,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,t+"-out",e,this._zoomOut),this._updateDisabled(),map.on("zoomend zoomlevelschange",this._updateDisabled,this),e},onRemove:function(map){map.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(html,title,t,e,n){var link=le("a",t,e);return link.innerHTML=html,link.href="#",link.title=title,link.setAttribute("role","button"),link.setAttribute("aria-label",title),je(link),Re(link,"click",Ge),Re(link,"click",n,this),Re(link,"click",this._refocusOnMap,this),link},_updateDisabled:function(){var map=this._map,t="leaflet-disabled";_e(this._zoomInButton,t),_e(this._zoomOutButton,t),(this._disabled||map._zoom===map.getMinZoom())&&pe(this._zoomOutButton,t),(this._disabled||map._zoom===map.getMaxZoom())&&pe(this._zoomInButton,t)}});Ke.mergeOptions({zoomControl:!0}),Ke.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new ii,this.addControl(this.zoomControl))}));var ni=Qe.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(map){var t=le("div","leaflet-control-scale"),e=this.options;return this._addScales(e,"leaflet-control-scale-line",t),map.on(e.updateWhenIdle?"moveend":"move",this._update,this),map.whenReady(this._update,this),t},onRemove:function(map){map.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=le("div",e,n)),t.imperial&&(this._iScale=le("div",e,n))},_update:function(){var map=this._map,t=map.getSize().y/2,e=map.distance(map.containerPointToLatLng([0,t]),map.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(e)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),label=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,label,e/t)},_updateImperial:function(t){var e,n,r,o=3.2808399*t;o>5280?(e=o/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(r=this._getRoundNum(o),this._updateScale(this._iScale,r+" ft",r/o))},_updateScale:function(t,text,e){t.style.width=Math.round(this.options.maxWidth*e)+"px",t.innerHTML=text},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),ri=Qe.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){v(this,t),this._attributions={}},onAdd:function(map){for(var i in map.attributionControl=this,this._container=le("div","leaflet-control-attribution"),je(this._container),map._layers)map._layers[i].getAttribution&&this.addAttribution(map._layers[i].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(text){return text?(this._attributions[text]||(this._attributions[text]=0),this._attributions[text]++,this._update(),this):this},removeAttribution:function(text){return text?(this._attributions[text]&&(this._attributions[text]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var i in this._attributions)this._attributions[i]&&t.push(i);var e=[];this.options.prefix&&e.push(this.options.prefix),t.length&&e.push(t.join(", ")),this._container.innerHTML=e.join(" | ")}}});Ke.mergeOptions({attributionControl:!0}),Ke.addInitHook((function(){this.options.attributionControl&&(new ri).addTo(this)})),Qe.Layers=ei,Qe.Zoom=ii,Qe.Scale=ni,Qe.Attribution=ri,ti.layers=function(t,e,n){return new ei(t,e,n)},ti.zoom=function(t){return new ii(t)},ti.scale=function(t){return new ni(t)},ti.attribution=function(t){return new ri(t)};var oi=O.extend({initialize:function(map){this._map=map},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});oi.addTo=function(map,t){return map.addHandler(t,this),this};var si,ai={Events:N},ui=zt?"touchstart mousedown":"mousedown",hi={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},ci={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},fi=I.extend({options:{clickTolerance:3},initialize:function(element,t,e,n){v(this,n),this._element=element,this._dragStartTarget=t||element,this._preventOutline=e},enable:function(){this._enabled||(Re(this._dragStartTarget,ui,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(fi._dragging===this&&this.finishDrag(),Ce(this._dragStartTarget,ui,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!de(this._element,"leaflet-zoom-anim")&&!(fi._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(fi._dragging=this,this._preventOutline&&ke(this._element),Ae(),Xt(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t,n=Pe(this._element);this._startPoint=new F(e.clientX,e.clientY),this._parentScale=Me(n),Re(document,ci[t.type],this._onMove,this),Re(document,hi[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new F(e.clientX,e.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Ue(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=we(this._element).subtract(n),pe(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),pe(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,R(this._animRequest),this._lastEvent=t,this._animRequest=z(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),xe(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var i in _e(document.body,"leaflet-dragging"),this._lastTarget&&(_e(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ci)Ce(document,ci[i],this._onMove,this),Ce(document,hi[i],this._onUp,this);Ee(),$t(),this._moved&&this._moving&&(R(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,fi._dragging=!1}});function di(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=function(t,e){var n=t.length,r=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(n);r[0]=r[n-1]=1,function t(e,n,r,o,l){var h,i,c,f=0;for(i=o+1;i<=l-1;i++)(c=vi(e[i],e[o],e[l],!0))>f&&(h=i,f=c);f>r&&(n[h]=1,t(e,n,r,o,h),t(e,n,r,h,l))}(t,r,e,0,n-1);var i,o=[];for(i=0;i<n;i++)r[i]&&o.push(t[i]);return o}(t=function(t,e){for(var n=[t[0]],i=1,r=0,o=t.length;i<o;i++)l=t[i],h=t[r],c=void 0,f=void 0,c=h.x-l.x,f=h.y-l.y,c*c+f*f>e&&(n.push(t[i]),r=i);var l,h,c,f;return r<o-1&&n.push(t[o-1]),n}(t,n),n)}function pi(p,t,e){return Math.sqrt(vi(p,t,e,!0))}function _i(a,b,t,e,n){var r,p,o,l=e?si:gi(a,t),h=gi(b,t);for(si=h;;){if(!(l|h))return[a,b];if(l&h)return!1;o=gi(p=mi(a,b,r=l||h,t,n),t),r===l?(a=p,l=o):(b=p,h=o)}}function mi(a,b,code,t,e){var n,r,o=b.x-a.x,l=b.y-a.y,h=t.min,c=t.max;return 8&code?(n=a.x+o*(c.y-a.y)/l,r=c.y):4&code?(n=a.x+o*(h.y-a.y)/l,r=h.y):2&code?(n=c.x,r=a.y+l*(c.x-a.x)/o):1&code&&(n=h.x,r=a.y+l*(h.x-a.x)/o),new F(n,r,e)}function gi(p,t){var code=0;return p.x<t.min.x?code|=1:p.x>t.max.x&&(code|=2),p.y<t.min.y?code|=4:p.y>t.max.y&&(code|=8),code}function vi(p,t,e,n){var r,o=t.x,l=t.y,h=e.x-o,c=e.y-l,f=h*h+c*c;return f>0&&((r=((p.x-o)*h+(p.y-l)*c)/f)>1?(o=e.x,l=e.y):r>0&&(o+=h*r,l+=c*r)),h=p.x-o,c=p.y-l,n?h*h+c*c:new F(o,l)}function yi(t){return!w(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function bi(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),yi(t)}var xi={simplify:di,pointToSegmentDistance:pi,closestPointOnSegment:function(p,t,e){return vi(p,t,e)},clipSegment:_i,_getEdgeIntersection:mi,_getBitCode:gi,_sqClosestPointOnSegment:vi,isFlat:yi,_flat:bi};function wi(t,e,n){var r,i,o,l,a,b,h,c,p,f=[1,4,2,8];for(i=0,h=t.length;i<h;i++)t[i]._code=gi(t[i],e);for(l=0;l<4;l++){for(c=f[l],r=[],i=0,o=(h=t.length)-1;i<h;o=i++)a=t[i],b=t[o],a._code&c?b._code&c||((p=mi(b,a,c,e,n))._code=gi(p,e),r.push(p)):(b._code&c&&((p=mi(b,a,c,e,n))._code=gi(p,e),r.push(p)),r.push(a));t=r}return t}var Ti={clipPolygon:wi},Ai={project:function(t){return new F(t.lng,t.lat)},unproject:function(t){return new V(t.y,t.x)},bounds:new j([-180,-90],[180,90])},Ei={R:6378137,R_MINOR:6356752.314245179,bounds:new j([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,r=t.lat*e,o=this.R_MINOR/n,l=Math.sqrt(1-o*o),h=l*Math.sin(r),c=Math.tan(Math.PI/4-r/2)/Math.pow((1-h)/(1+h),l/2);return r=-n*Math.log(Math.max(c,1e-10)),new F(t.lng*e*n,r)},unproject:function(t){for(var e,n=180/Math.PI,r=this.R,o=this.R_MINOR/r,l=Math.sqrt(1-o*o),h=Math.exp(-t.y/r),c=Math.PI/2-2*Math.atan(h),i=0,f=.1;i<15&&Math.abs(f)>1e-7;i++)e=l*Math.sin(c),e=Math.pow((1-e)/(1+e),l/2),c+=f=Math.PI/2-2*Math.atan(h*e)-c;return new V(c*n,t.x*n/r)}},ki={LonLat:Ai,Mercator:Ei,SphericalMercator:$},Si=e({},X,{code:"EPSG:3395",projection:Ei,transformation:function(){var t=.5/(Math.PI*Ei.R);return K(t,.5,-t,.5)}()}),Pi=e({},X,{code:"EPSG:4326",projection:Ai,transformation:K(1/180,1,-1/180,.5)}),Mi=e({},Y,{projection:Ai,transformation:K(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,r=e.lat-t.lat;return Math.sqrt(n*n+r*r)},infinite:!0});Y.Earth=X,Y.EPSG3395=Si,Y.EPSG3857=Q,Y.EPSG900913=tt,Y.EPSG4326=Pi,Y.Simple=Mi;var zi=I.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(map){return map.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[l(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[l(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var map=t.target;if(map.hasLayer(this)){if(this._map=map,this._zoomAnimated=map._zoomAnimated,this.getEvents){var e=this.getEvents();map.on(e,this),this.once("remove",(function(){map.off(e,this)}),this)}this.onAdd(map),this.getAttribution&&map.attributionControl&&map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),map.fire("layeradd",{layer:this})}}});Ke.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=l(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=l(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&l(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var i=0,e=(t=t?w(t)?t:[t]:[]).length;i<e;i++)this.addLayer(t[i])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[l(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=l(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;t=void 0===r.minZoom?t:Math.min(t,r.minZoom),e=void 0===r.maxZoom?e:Math.max(e,r.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ri=zi.extend({initialize:function(t,e){var i,n;if(v(this,e),this._layers={},t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var i,e,n=Array.prototype.slice.call(arguments,1);for(i in this._layers)(e=this._layers[i])[t]&&e[t].apply(e,n);return this},onAdd:function(map){this.eachLayer(map.addLayer,map)},onRemove:function(map){this.eachLayer(map.removeLayer,map)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return l(t)}}),Li=Ri.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ri.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ri.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(style){return this.invoke("setStyle",style)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new G;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),Ci=O.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){v(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var img=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(img,t),img},_setIconStyles:function(img,t){var e=this.options,n=e[t+"Size"];"number"==typeof n&&(n=[n,n]);var r=B(n),o=B("shadow"===t&&e.shadowAnchor||e.iconAnchor||r&&r.divideBy(2,!0));img.className="leaflet-marker-"+t+" "+(e.className||""),o&&(img.style.marginLeft=-o.x+"px",img.style.marginTop=-o.y+"px"),r&&(img.style.width=r.x+"px",img.style.height=r.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Ct&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),Oi=Ci.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return Oi.imagePath||(Oi.imagePath=this._detectIconPath()),(this.options.imagePath||Oi.imagePath)+Ci.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=le("div","leaflet-default-icon-path",document.body),path=ae(t,"background-image")||ae(t,"backgroundImage");return document.body.removeChild(t),path=null===path||0!==path.indexOf("url")?"":path.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),Ni=oi.extend({initialize:function(marker){this._marker=marker},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new fi(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),pe(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&_e(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var marker=this._marker,map=marker._map,e=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,r=we(marker._icon),o=map.getPixelBounds(),l=map.getPixelOrigin(),h=U(o.min._subtract(l).add(n),o.max._subtract(l).subtract(n));if(!h.contains(r)){var c=B((Math.max(h.max.x,r.x)-h.max.x)/(o.max.x-h.max.x)-(Math.min(h.min.x,r.x)-h.min.x)/(o.min.x-h.min.x),(Math.max(h.max.y,r.y)-h.max.y)/(o.max.y-h.max.y)-(Math.min(h.min.y,r.y)-h.min.y)/(o.min.y-h.min.y)).multiplyBy(e);map.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),xe(marker._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=z(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(R(this._panRequest),this._panRequest=z(this._adjustPan.bind(this,t)))},_onDrag:function(t){var marker=this._marker,shadow=marker._shadow,e=we(marker._icon),n=marker._map.layerPointToLatLng(e);shadow&&xe(shadow,e),marker._latlng=n,t.latlng=n,t.oldLatLng=this._oldLatLng,marker.fire("move",t).fire("drag",t)},_onDragEnd:function(t){R(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Ii=zi.extend({options:{icon:new Oi,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){v(this,e),this._latlng=W(t)},onAdd:function(map){this._zoomAnimated=this._zoomAnimated&&map.options.markerZoomAnimation,this._zoomAnimated&&map.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(map){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&map.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=W(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),r=!1;n!==this._icon&&(this._icon&&this._removeIcon(),r=!0,t.title&&(n.title=t.title),"IMG"===n.tagName&&(n.alt=t.alt||"")),pe(n,e),t.keyboard&&(n.tabIndex="0"),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var o=t.icon.createShadow(this._shadow),l=!1;o!==this._shadow&&(this._removeShadow(),l=!0),o&&(pe(o,e),o.alt=""),this._shadow=o,t.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),o&&l&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),ue(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ue(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&xe(this._icon,t),this._shadow&&xe(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(pe(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ni)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ni(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&ve(this._icon,t),this._shadow&&ve(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Fi=zi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(map){this._renderer=map.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(style){return v(this,style),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&style&&Object.prototype.hasOwnProperty.call(style,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),Di=Fi.extend({options:{fill:!0,radius:10},initialize:function(t,e){v(this,e),this._latlng=W(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=W(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Fi.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),p=[t+n,e+n];this._pxBounds=new j(this._point.subtract(p),this._point.add(p))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(p){return p.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Bi=Di.extend({initialize:function(t,n,r){if("number"==typeof n&&(n=e({},r,{radius:n})),v(this,n),this._latlng=W(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new G(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Fi.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,map=this._map,n=map.options.crs;if(n.distance===X.distance){var r=Math.PI/180,o=this._mRadius/X.R/r,l=map.project([e+o,t]),h=map.project([e-o,t]),p=l.add(h).divideBy(2),c=map.unproject(p).lat,f=Math.acos((Math.cos(o*r)-Math.sin(e*r)*Math.sin(c*r))/(Math.cos(e*r)*Math.cos(c*r)))/r;(isNaN(f)||0===f)&&(f=o/Math.cos(Math.PI/180*e)),this._point=p.subtract(map.getPixelOrigin()),this._radius=isNaN(f)?0:p.x-map.project([c,t-f]).x,this._radiusY=p.y-l.y}else{var d=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=map.latLngToLayerPoint(this._latlng),this._radius=this._point.x-map.latLngToLayerPoint(d).x}this._updateBounds()}}),ji=Fi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){v(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(p){for(var t,e,n=1/0,r=null,o=vi,l=0,h=this._parts.length;l<h;l++)for(var c=this._parts[l],i=1,f=c.length;i<f;i++){var d=o(p,t=c[i-1],e=c[i],!0);d<n&&(n=d,r=o(p,t,e))}return r&&(r.distance=Math.sqrt(n)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var i,t,e,n,r,o,l,h=this._rings[0],c=h.length;if(!c)return null;for(i=0,t=0;i<c-1;i++)t+=h[i].distanceTo(h[i+1])/2;if(0===t)return this._map.layerPointToLatLng(h[0]);for(i=0,n=0;i<c-1;i++)if(r=h[i],o=h[i+1],(n+=e=r.distanceTo(o))>t)return l=(n-t)/e,this._map.layerPointToLatLng([o.x-l*(o.x-r.x),o.y-l*(o.y-r.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=W(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new G,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return yi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=yi(t),i=0,r=t.length;i<r;i++)n?(e[i]=W(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new j;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),p=new F(t,t);this._pxBounds=new j([this._rawPxBounds.min.subtract(p),this._rawPxBounds.max.add(p)])},_projectLatlngs:function(t,e,n){var i,r,o=t[0]instanceof V,l=t.length;if(o){for(r=[],i=0;i<l;i++)r[i]=this._map.latLngToLayerPoint(t[i]),n.extend(r[i]);e.push(r)}else for(i=0;i<l;i++)this._projectLatlngs(t[i],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var i,e,n,r,o,l,h,c=this._parts;for(i=0,n=0,r=this._rings.length;i<r;i++)for(e=0,o=(h=this._rings[i]).length;e<o-1;e++)(l=_i(h[e],h[e+1],t,e,!0))&&(c[n]=c[n]||[],c[n].push(l[0]),l[1]===h[e+1]&&e!==o-2||(c[n].push(l[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=di(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(p,t){var i,e,n,r,o,l,h=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(p))return!1;for(i=0,r=this._parts.length;i<r;i++)for(e=0,n=(o=(l=this._parts[i]).length)-1;e<o;n=e++)if((t||0!==e)&&pi(p,l[n],l[e])<=h)return!0;return!1}});ji._flat=bi;var Ui=ji.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var i,t,e,n,r,area,o,l,h,c=this._rings[0],f=c.length;if(!f)return null;for(area=o=l=0,i=0,t=f-1;i<f;t=i++)e=c[i],n=c[t],r=e.y*n.x-n.y*e.x,o+=(e.x+n.x)*r,l+=(e.y+n.y)*r,area+=3*r;return h=0===area?c[0]:[o/area,l/area],this._map.layerPointToLatLng(h)},_convertLatLngs:function(t){var e=ji.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof V&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){ji.prototype._setLatLngs.call(this,t),yi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return yi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,p=new F(e,e);if(t=new j(t.min.subtract(p),t.max.add(p)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var n,i=0,r=this._rings.length;i<r;i++)(n=wi(this._rings[i],t,!0)).length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(p){var t,e,n,i,r,o,l,h,c=!1;if(!this._pxBounds||!this._pxBounds.contains(p))return!1;for(i=0,l=this._parts.length;i<l;i++)for(r=0,o=(h=(t=this._parts[i]).length)-1;r<h;o=r++)e=t[r],n=t[o],e.y>p.y!=n.y>p.y&&p.x<(n.x-e.x)*(p.y-e.y)/(n.y-e.y)+e.x&&(c=!c);return c||ji.prototype._containsPoint.call(this,p,!0)}}),Gi=Li.extend({initialize:function(t,e){v(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var i,e,n,r=w(t)?t:t.features;if(r){for(i=0,e=r.length;i<e;i++)((n=r[i]).geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var l=Zi(t,o);return l?(l.feature=$i(t),l.defaultOptions=l.options,this.resetStyle(l),o.onEachFeature&&o.onEachFeature(t,l),this.addLayer(l)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(style){return this.eachLayer((function(t){this._setLayerStyle(t,style)}),this)},_setLayerStyle:function(t,style){t.setStyle&&("function"==typeof style&&(style=style(t.feature)),t.setStyle(style))}});function Zi(t,e){var n,r,i,o,l="Feature"===t.type?t.geometry:t,h=l?l.coordinates:null,c=[],f=e&&e.pointToLayer,d=e&&e.coordsToLatLng||qi;if(!h&&!l)return null;switch(l.type){case"Point":return Vi(f,t,n=d(h),e);case"MultiPoint":for(i=0,o=h.length;i<o;i++)n=d(h[i]),c.push(Vi(f,t,n,e));return new Li(c);case"LineString":case"MultiLineString":return r=Wi(h,"LineString"===l.type?0:1,d),new ji(r,e);case"Polygon":case"MultiPolygon":return r=Wi(h,"Polygon"===l.type?1:2,d),new Ui(r,e);case"GeometryCollection":for(i=0,o=l.geometries.length;i<o;i++){var _=Zi({geometry:l.geometries[i],type:"Feature",properties:t.properties},e);_&&c.push(_)}return new Li(c);default:throw new Error("Invalid GeoJSON object.")}}function Vi(t,e,n,r){return t?t(e,n):new Ii(n,r&&r.markersInheritOptions&&r)}function qi(t){return new V(t[1],t[0],t[2])}function Wi(t,e,n){for(var r,o=[],i=0,l=t.length;i<l;i++)r=e?Wi(t[i],e-1,n):(n||qi)(t[i]),o.push(r);return o}function Hi(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[d(t.lng,e),d(t.lat,e),d(t.alt,e)]:[d(t.lng,e),d(t.lat,e)]}function Yi(t,e,n,r){for(var o=[],i=0,l=t.length;i<l;i++)o.push(e?Yi(t[i],e-1,n,r):Hi(t[i],r));return!e&&n&&o.push(o[0]),o}function Xi(t,n){return t.feature?e({},t.feature,{geometry:n}):$i(n)}function $i(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Ji={toGeoJSON:function(t){return Xi(this,{type:"Point",coordinates:Hi(this.getLatLng(),t)})}};function Ki(t,e){return new Gi(t,e)}Ii.include(Ji),Bi.include(Ji),Di.include(Ji),ji.include({toGeoJSON:function(t){var e=!yi(this._latlngs);return Xi(this,{type:(e?"Multi":"")+"LineString",coordinates:Yi(this._latlngs,e?1:0,!1,t)})}}),Ui.include({toGeoJSON:function(t){var e=!yi(this._latlngs),n=e&&!yi(this._latlngs[0]),r=Yi(this._latlngs,n?2:e?1:0,!0,t);return e||(r=[r]),Xi(this,{type:(n?"Multi":"")+"Polygon",coordinates:r})}}),Ri.include({toMultiPoint:function(t){var e=[];return this.eachLayer((function(n){e.push(n.toGeoJSON(t).geometry.coordinates)})),Xi(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var n="GeometryCollection"===e,r=[];return this.eachLayer((function(e){if(e.toGeoJSON){var o=e.toGeoJSON(t);if(n)r.push(o.geometry);else{var l=$i(o);"FeatureCollection"===l.type?r.push.apply(r,l.features):r.push(l)}}})),n?Xi(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var Qi=Ki,tn=zi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=Z(e),v(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(pe(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ue(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&ce(this._image),this},bringToBack:function(){return this._map&&fe(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=Z(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,img=this._image=t?this._url:le("img");pe(img,"leaflet-image-layer"),this._zoomAnimated&&pe(img,"leaflet-zoom-animated"),this.options.className&&pe(img,this.options.className),img.onselectstart=f,img.onmousemove=f,img.onload=r(this.fire,this,"load"),img.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(img.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=img.src:(img.src=this._url,img.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;be(this._image,n,e)},_reset:function(){var image=this._image,t=new j(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),e=t.getSize();xe(image,t.min),image.style.width=e.x+"px",image.style.height=e.y+"px"},_updateOpacity:function(){ve(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),en=tn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:le("video");if(pe(e,"leaflet-image-layer"),this._zoomAnimated&&pe(e,"leaflet-zoom-animated"),this.options.className&&pe(e,this.options.className),e.onselectstart=f,e.onmousemove=f,e.onloadeddata=r(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),o=[],l=0;l<n.length;l++)o.push(n[l].src);this._url=n.length>0?o:[e.src]}else{w(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted;for(var i=0;i<this._url.length;i++){var source=le("source");source.src=this._url[i],e.appendChild(source)}}}}),nn=tn.extend({_initImage:function(){var t=this._image=this._url;pe(t,"leaflet-image-layer"),this._zoomAnimated&&pe(t,"leaflet-zoom-animated"),this.options.className&&pe(t,this.options.className),t.onselectstart=f,t.onmousemove=f}}),rn=zi.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,source){v(this,t),this._source=source},onAdd:function(map){this._zoomAnimated=map._zoomAnimated,this._container||this._initLayout(),map._fadeAnimated&&ve(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),map._fadeAnimated&&ve(this._container,1),this.bringToFront()},onRemove:function(map){map._fadeAnimated?(ve(this._container,0),this._removeTimeout=setTimeout(r(ue,void 0,this._container),200)):ue(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=W(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(content){return this._content=content,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ce(this._container),this},bringToBack:function(){return this._map&&fe(this._container),this},_prepareOpen:function(t,e,n){if(e instanceof zi||(n=e,e=t),e instanceof Li)for(var r in t._layers){e=t._layers[r];break}if(!n)if(e.getCenter)n=e.getCenter();else{if(!e.getLatLng)throw new Error("Unable to get source layer LatLng.");n=e.getLatLng()}return this._source=e,this.update(),n},_updateContent:function(){if(this._content){var t=this._contentNode,content="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof content)t.innerHTML=content;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(content)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=B(this.options.offset),n=this._getAnchor();this._zoomAnimated?xe(this._container,t.add(n)):e=e.add(t).add(n);var r=this._containerBottom=-e.y,o=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=r+"px",this._container.style.left=o+"px"}},_getAnchor:function(){return[0,0]}}),on=rn.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(map){return map.openPopup(this),this},onAdd:function(map){rn.prototype.onAdd.call(this,map),map.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Fi||this._source.on("preclick",De))},onRemove:function(map){rn.prototype.onRemove.call(this,map),map.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Fi||this._source.off("preclick",De))},getEvents:function(){var t=rn.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=le("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=le("div",t+"-content-wrapper",e);if(this._contentNode=le("div",t+"-content",n),je(e),Be(this._contentNode),Re(e,"contextmenu",De),this._tipContainer=le("div",t+"-tip-container",e),this._tip=le("div",t+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=le("a",t+"-close-button",e);r.href="#close",r.innerHTML="&#215;",Re(r,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,style=t.style;style.width="",style.whiteSpace="nowrap";var e=t.offsetWidth;e=Math.min(e,this.options.maxWidth),e=Math.max(e,this.options.minWidth),style.width=e+1+"px",style.whiteSpace="",style.height="";var n=t.offsetHeight,r=this.options.maxHeight;r&&n>r?(style.height=r+"px",pe(t,"leaflet-popup-scrolled")):_e(t,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();xe(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var map=this._map,t=parseInt(ae(this._container,"marginBottom"),10)||0,e=this._container.offsetHeight+t,n=this._containerWidth,r=new F(this._containerLeft,-e-this._containerBottom);r._add(we(this._container));var o=map.layerPointToContainerPoint(r),l=B(this.options.autoPanPadding),h=B(this.options.autoPanPaddingTopLeft||l),c=B(this.options.autoPanPaddingBottomRight||l),f=map.getSize(),d=0,_=0;o.x+n+c.x>f.x&&(d=o.x+n-f.x+c.x),o.x-d-h.x<0&&(d=o.x-h.x),o.y+e+c.y>f.y&&(_=o.y+e-f.y+c.y),o.y-_-h.y<0&&(_=o.y-h.y),(d||_)&&map.fire("autopanstart").panBy([d,_])}},_onCloseButtonClick:function(t){this._close(),Ge(t)},_getAnchor:function(){return B(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Ke.mergeOptions({closePopupOnClick:!0}),Ke.include({openPopup:function(t,e,n){return t instanceof on||(t=new on(n).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),zi.include({bindPopup:function(content,t){return content instanceof on?(v(content,t),this._popup=content,content._source=this):(this._popup&&!t||(this._popup=new on(t,this)),this._popup.setContent(content)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){return this._popup&&this._map&&(e=this._popup._prepareOpen(this,t,e),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(content){return this._popup&&this._popup.setContent(content),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;this._popup&&this._map&&(Ge(t),e instanceof Fi?this.openPopup(t.layer||t.target,t.latlng):this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var sn=rn.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(map){rn.prototype.onAdd.call(this,map),this.setOpacity(this.options.opacity),map.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(map){rn.prototype.onRemove.call(this,map),map.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=rn.prototype.getEvents.call(this);return zt&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=le("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,n,map=this._map,r=this._container,o=map.latLngToContainerPoint(map.getCenter()),l=map.layerPointToContainerPoint(t),h=this.options.direction,c=r.offsetWidth,f=r.offsetHeight,d=B(this.options.offset),_=this._getAnchor();"top"===h?(e=c/2,n=f):"bottom"===h?(e=c/2,n=0):"center"===h?(e=c/2,n=f/2):"right"===h?(e=0,n=f/2):"left"===h?(e=c,n=f/2):l.x<o.x?(h="right",e=0,n=f/2):(h="left",e=c+2*(d.x+_.x),n=f/2),t=t.subtract(B(e,n,!0)).add(d).add(_),_e(r,"leaflet-tooltip-right"),_e(r,"leaflet-tooltip-left"),_e(r,"leaflet-tooltip-top"),_e(r,"leaflet-tooltip-bottom"),pe(r,"leaflet-tooltip-"+h),xe(r,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&ve(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return B(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Ke.include({openTooltip:function(t,e,n){return t instanceof sn||(t=new sn(n).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),zi.include({bindTooltip:function(content,t){return content instanceof sn?(v(content,t),this._tooltip=content,content._source=this):(this._tooltip&&!t||(this._tooltip=new sn(t,this)),this._tooltip.setContent(content)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),zt&&(n.click=this._openTooltip)),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){return this._tooltip&&this._map&&(e=this._tooltip._prepareOpen(this,t,e),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(pe(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(_e(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(content){return this._tooltip&&this._tooltip.setContent(content),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,n,r=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),r=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(r)}});var an=Ci.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var div=t&&"DIV"===t.tagName?t:document.createElement("div"),e=this.options;if(e.html instanceof Element?(he(div),div.appendChild(e.html)):div.innerHTML=!1!==e.html?e.html:"",e.bgPos){var n=B(e.bgPos);div.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(div,"icon"),div},createShadow:function(){return null}});Ci.Default=Oi;var ln=zi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Et,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){v(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(map){map._addZoomLimit(this)},onRemove:function(map){this._removeAllTiles(),ue(this._container),map._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ce(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(fe(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=h(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof F?s:new F(s,s)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,r=-t(-1/0,1/0),i=0,o=n.length;i<o;i++)e=n[i].style.zIndex,n[i]!==this._container&&e&&(r=t(r,+e));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!st){ve(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var r in this._tiles){var o=this._tiles[r];if(o.current&&o.loaded){var l=Math.min(1,(t-o.loaded)/200);ve(o.el,l),l<1?e=!0:(o.active?n=!0:this._onOpaqueTile(o),o.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(R(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this))}},_onOpaqueTile:f,_initContainer:function(){this._container||(this._container=le("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(ue(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var r=this._levels[t],map=this._map;return r||((r=this._levels[t]={}).el=le("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=e,r.origin=map.project(map.unproject(map.getPixelOrigin()),t).round(),r.zoom=t,this._setZoomTransform(r,map.getCenter(),map.getZoom()),r.el.offsetWidth,this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:f,_onRemoveLevel:f,_onCreateLevel:f,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var r=e.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)ue(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,r){var o=Math.floor(t/2),l=Math.floor(e/2),h=n-1,c=new F(+o,+l);c.z=+h;var f=this._tileCoordsToKey(c),d=this._tiles[f];return d&&d.active?(d.retain=!0,!0):(d&&d.loaded&&(d.retain=!0),h>r&&this._retainParent(o,l,h,r))},_retainChildren:function(t,e,n,r){for(var i=2*t;i<2*t+2;i++)for(var o=2*e;o<2*e+2;o++){var l=new F(i,o);l.z=n+1;var h=this._tileCoordsToKey(l),c=this._tiles[h];c&&c.active?c.retain=!0:(c&&c.loaded&&(c.retain=!0),n+1<r&&this._retainChildren(i,o,n+1,r))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,r){var o=Math.round(e);o=void 0!==this.options.maxZoom&&o>this.options.maxZoom||void 0!==this.options.minZoom&&o<this.options.minZoom?void 0:this._clampZoom(o);var l=this.options.updateWhenZooming&&o!==this._tileZoom;r&&!l||(this._tileZoom=o,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==o&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,n){var r=this._map.getZoomScale(n,t.zoom),o=t.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(e,n)).round();At?be(t.el,o,r):xe(t.el,o)},_resetGrid:function(){var map=this._map,t=map.options.crs,e=this._tileSize=this.getTileSize(),n=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(map.project([0,t.wrapLng[0]],n).x/e.x),Math.ceil(map.project([0,t.wrapLng[1]],n).x/e.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(map.project([t.wrapLat[0],0],n).y/e.x),Math.ceil(map.project([t.wrapLat[1],0],n).y/e.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var map=this._map,e=map._animatingZoom?Math.max(map._animateToZoom,map.getZoom()):map.getZoom(),n=map.getZoomScale(e,this._tileZoom),r=map.project(t,this._tileZoom).floor(),o=map.getSize().divideBy(2*n);return new j(r.subtract(o),r.add(o))},_update:function(t){var map=this._map;if(map){var e=this._clampZoom(map.getZoom());if(void 0===t&&(t=map.getCenter()),void 0!==this._tileZoom){var n=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(n),o=r.getCenter(),l=[],h=this.options.keepBuffer,c=new j(r.getBottomLeft().subtract([h,-h]),r.getTopRight().add([h,-h]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var f in this._tiles){var d=this._tiles[f].coords;d.z===this._tileZoom&&c.contains(new F(d.x,d.y))||(this._tiles[f].current=!1)}if(Math.abs(e-this._tileZoom)>1)this._setView(t,e);else{for(var _=r.min.y;_<=r.max.y;_++)for(var i=r.min.x;i<=r.max.x;i++){var m=new F(i,_);if(m.z=this._tileZoom,this._isValidTile(m)){var v=this._tiles[this._tileCoordsToKey(m)];v?v.current=!0:l.push(m)}}if(l.sort((function(a,b){return a.distanceTo(o)-b.distanceTo(o)})),0!==l.length){this._loading||(this._loading=!0,this.fire("loading"));var y=document.createDocumentFragment();for(i=0;i<l.length;i++)this._addTile(l[i],y);this._level.el.appendChild(y)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(t);return Z(this.options.bounds).overlaps(r)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var map=this._map,e=this.getTileSize(),n=t.scaleBy(e),r=n.add(e);return[map.unproject(n,t.z),map.unproject(r,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new G(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new F(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(ue(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){pe(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=f,t.onmousemove=f,st&&this.options.opacity<1&&ve(t,this.options.opacity),ut&&!ht&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var n=this._getTilePos(t),o=this._tileCoordsToKey(t),l=this.createTile(this._wrapCoords(t),r(this._tileReady,this,t));this._initTile(l),this.createTile.length<2&&z(r(this._tileReady,this,t,null,l)),xe(l,n),this._tiles[o]={el:l,coords:t,current:!0},e.appendChild(l),this.fire("tileloadstart",{tile:l,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var o=this._tileCoordsToKey(t);(n=this._tiles[o])&&(n.loaded=+new Date,this._map._fadeAnimated?(ve(n.el,0),R(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(pe(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),st||!this._map._fadeAnimated?z(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new F(this._wrapX?c(t.x,this._wrapX):t.x,this._wrapY?c(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new j(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),un=ln.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,(e=v(this,e)).detectRetina&&Ct&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),ut||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return Re(n,"load",r(this._tileOnLoad,this,e,n)),Re(n,"error",r(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var data={r:Ct?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(data.y=n),data["-y"]=n}return template(this._url,e(data,this.options))},_tileOnLoad:function(t,e){st?setTimeout(r(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var r=this.options.errorTileUrl;r&&e.getAttribute("src")!==r&&(e.src=r),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var i,t;for(i in this._tiles)this._tiles[i].coords.z!==this._tileZoom&&((t=this._tiles[i].el).onload=f,t.onerror=f,t.complete||(t.src=A,ue(t),delete this._tiles[i]))},_removeTile:function(t){var e=this._tiles[t];if(e)return ft||e.el.setAttribute("src",A),ln.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(this._map&&(!n||n.getAttribute("src")!==A))return ln.prototype._tileReady.call(this,t,e,n)}});function hn(t,e){return new un(t,e)}var cn=un.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,n){this._url=t;var r=e({},this.defaultWmsParams);for(var i in n)i in this.options||(r[i]=n[i]);var o=(n=v(this,n)).detectRetina&&Ct?2:1,l=this.getTileSize();r.width=l.x*o,r.height=l.y*o,this.wmsParams=r},onAdd:function(map){this._crs=this.options.crs||map.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,un.prototype.onAdd.call(this,map)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,r=U(n.project(e[0]),n.project(e[1])),o=r.min,l=r.max,h=(this._wmsVersion>=1.3&&this._crs===Pi?[o.y,o.x,l.y,l.x]:[o.x,o.y,l.x,l.y]).join(","),c=un.prototype.getTileUrl.call(this,t);return c+y(this.wmsParams,c,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},setParams:function(t,n){return e(this.wmsParams,t),n||this.redraw(),this}});un.WMS=cn,hn.wms=function(t,e){return new cn(t,e)};var fn=zi.extend({options:{padding:.1,tolerance:0},initialize:function(t){v(this,t),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&pe(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),r=we(this._container),o=this._map.getSize().multiplyBy(.5+this.options.padding),l=this._map.project(this._center,e),h=this._map.project(t,e).subtract(l),c=o.multiplyBy(-n).add(r).add(o).subtract(h);At?be(this._container,c,n):xe(this._container,c)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var p=this.options.padding,t=this._map.getSize(),e=this._map.containerPointToLayerPoint(t.multiplyBy(-p)).round();this._bounds=new j(e,e.add(t.multiplyBy(1+2*p)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),dn=fn.extend({getEvents:function(){var t=fn.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){fn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Re(t,"mousemove",this._onMouseMove,this),Re(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Re(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){R(this._redrawRequest),delete this._ctx,ue(this._container),Ce(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){fn.prototype._update.call(this);var b=this._bounds,t=this._container,e=b.getSize(),n=Ct?2:1;xe(t,b.min),t.width=n*e.x,t.height=n*e.y,t.style.width=e.x+"px",t.style.height=e.y+"px",Ct&&this._ctx.scale(2,2),this._ctx.translate(-b.min.x,-b.min.y),this.fire("update")}},_reset:function(){fn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[l(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,r=e.prev;n?n.prev=r:this._drawLast=r,r?r.next=n:this._drawFirst=n,delete t._order,delete this._layers[l(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,n=t.options.dashArray.split(/[, ]+/),r=[];for(i=0;i<n.length;i++){if(e=Number(n[i]),isNaN(e))return;r.push(e)}t.options._dashArray=r}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||z(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new j,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)t=r.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,r,p,o=t._parts,l=o.length,h=this._ctx;if(l){for(h.beginPath(),i=0;i<l;i++){for(n=0,r=o[i].length;n<r;n++)p=o[i][n],h[n?"lineTo":"moveTo"](p.x,p.y);e&&h.closePath()}this._fillStroke(h,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var p=t._point,e=this._ctx,n=Math.max(Math.round(t._radius),1),s=(Math.max(Math.round(t._radiusY),1)||n)/n;1!==s&&(e.save(),e.scale(1,s)),e.beginPath(),e.arc(p.x,p.y/s,n,0,2*Math.PI,!1),1!==s&&e.restore(),this._fillStroke(e,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,r=this._map.mouseEventToLayerPoint(t),o=this._drawFirst;o;o=o.next)(e=o.layer).options.interactive&&e._containsPoint(r)&&("click"!==t.type&&"preclick"===t.type||!this._map._draggableMoved(e))&&(n=e);n&&(He(t),this._fireEvent([n],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(_e(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var n,o,l=this._drawFirst;l;l=l.next)(n=l.layer).options.interactive&&n._containsPoint(e)&&(o=n);o!==this._hoveredLayer&&(this._handleMouseOut(t),o&&(pe(this._container,"leaflet-interactive"),this._fireEvent([o],t,"mouseover"),this._hoveredLayer=o)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(r((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,r=e.prev;n&&(n.prev=r,r?r.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,r=e.prev;r&&(r.next=n,n?n.prev=r:r&&(this._drawLast=r),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function pn(t){return canvas?new dn(t):null}var _n=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),mn={_initContainer:function(){this._container=le("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(fn.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=_n("shape");pe(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=_n("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[l(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;ue(e),t.removeInteractiveTarget(e),delete this._layers[l(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,r=t.options,o=t._container;o.stroked=!!r.stroke,o.filled=!!r.fill,r.stroke?(e||(e=t._stroke=_n("stroke")),o.appendChild(e),e.weight=r.weight+"px",e.color=r.color,e.opacity=r.opacity,r.dashArray?e.dashStyle=w(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=r.lineCap.replace("butt","flat"),e.joinstyle=r.lineJoin):e&&(o.removeChild(e),t._stroke=null),r.fill?(n||(n=t._fill=_n("fill")),o.appendChild(n),n.color=r.fillColor||r.color,n.opacity=r.fillOpacity):n&&(o.removeChild(n),t._fill=null)},_updateCircle:function(t){var p=t._point.round(),e=Math.round(t._radius),n=Math.round(t._radiusY||e);this._setPath(t,t._empty()?"M0 0":"AL "+p.x+","+p.y+" "+e+","+n+" 0,23592600")},_setPath:function(t,path){t._path.v=path},_bringToFront:function(t){ce(t._container)},_bringToBack:function(t){fe(t._container)}},gn=Nt?_n:et,vn=fn.extend({getEvents:function(){var t=fn.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=gn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=gn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ue(this._container),Ce(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){fn.prototype._update.call(this);var b=this._bounds,t=b.getSize(),e=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,e.setAttribute("width",t.x),e.setAttribute("height",t.y)),xe(e,b.min),e.setAttribute("viewBox",[b.min.x,b.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(t){var path=t._path=gn("path");t.options.className&&pe(path,t.options.className),t.options.interactive&&pe(path,"leaflet-interactive"),this._updateStyle(t),this._layers[l(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){ue(t._path),t.removeInteractiveTarget(t._path),delete this._layers[l(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var path=t._path,e=t.options;path&&(e.stroke?(path.setAttribute("stroke",e.color),path.setAttribute("stroke-opacity",e.opacity),path.setAttribute("stroke-width",e.weight),path.setAttribute("stroke-linecap",e.lineCap),path.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?path.setAttribute("stroke-dasharray",e.dashArray):path.removeAttribute("stroke-dasharray"),e.dashOffset?path.setAttribute("stroke-dashoffset",e.dashOffset):path.removeAttribute("stroke-dashoffset")):path.setAttribute("stroke","none"),e.fill?(path.setAttribute("fill",e.fillColor||e.color),path.setAttribute("fill-opacity",e.fillOpacity),path.setAttribute("fill-rule",e.fillRule||"evenodd")):path.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,it(t._parts,e))},_updateCircle:function(t){var p=t._point,e=Math.max(Math.round(t._radius),1),n="a"+e+","+(Math.max(Math.round(t._radiusY),1)||e)+" 0 1,0 ",r=t._empty()?"M0 0":"M"+(p.x-e)+","+p.y+n+2*e+",0 "+n+2*-e+",0 ";this._setPath(t,r)},_setPath:function(t,path){t._path.setAttribute("d",path)},_bringToFront:function(t){ce(t._path)},_bringToBack:function(t){fe(t._path)}});function yn(t){return svg||Nt?new vn(t):null}Nt&&vn.include(mn),Ke.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&pn(t)||yn(t)}});var bn=Ui.extend({initialize:function(t,e){Ui.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=Z(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});vn.create=gn,vn.pointsToPath=it,Gi.geometryToLayer=Zi,Gi.coordsToLatLng=qi,Gi.coordsToLatLngs=Wi,Gi.latLngToCoords=Hi,Gi.latLngsToCoords=Yi,Gi.getFeature=Xi,Gi.asFeature=$i,Ke.mergeOptions({boxZoom:!0});var xn=oi.extend({initialize:function(map){this._map=map,this._container=map._container,this._pane=map._panes.overlayPane,this._resetStateTimeout=0,map.on("unload",this._destroy,this)},addHooks:function(){Re(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ce(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ue(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Xt(),Ae(),this._startPoint=this._map.mouseEventToContainerPoint(t),Re(document,{contextmenu:Ge,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=le("div","leaflet-zoom-box",this._container),pe(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new j(this._point,this._startPoint),n=e.getSize();xe(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(ue(this._box),_e(this._container,"leaflet-crosshair")),$t(),Ee(),Ce(document,{contextmenu:Ge,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var e=new G(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});Ke.addInitHook("addHandler","boxZoom",xn),Ke.mergeOptions({doubleClickZoom:!0});var wn=oi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var map=this._map,e=map.getZoom(),n=map.options.zoomDelta,r=t.originalEvent.shiftKey?e-n:e+n;"center"===map.options.doubleClickZoom?map.setZoom(r):map.setZoomAround(t.containerPoint,r)}});Ke.addInitHook("addHandler","doubleClickZoom",wn),Ke.mergeOptions({dragging:!0,inertia:!ht,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Tn=oi.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new fi(map._mapPane,map._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),map.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),map.on("zoomend",this._onZoomEnd,this),map.whenReady(this._onZoomEnd,this))}pe(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){_e(this._map._container,"leaflet-grab"),_e(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var map=this._map;if(map._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=Z(this._map.options.maxBounds);this._offsetLimit=U(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;map.fire("movestart").fire("dragstart"),map.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var time=this._lastTime=+new Date,e=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(e),this._times.push(time),this._prunePositions(time)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(time){for(;this._positions.length>1&&time-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,o=(r-e+n)%t+e-n,l=(r+e+n)%t-e-n,h=Math.abs(o+n)<Math.abs(l+n)?o:l;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=h},_onDragEnd:function(t){var map=this._map,e=map.options,n=!e.inertia||this._times.length<2;if(map.fire("dragend",t),n)map.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,l=e.easeLinearity,h=r.multiplyBy(l/o),c=h.distanceTo([0,0]),f=Math.min(e.inertiaMaxSpeed,c),d=h.multiplyBy(f/c),_=f/(e.inertiaDeceleration*l),m=d.multiplyBy(-_/2).round();m.x||m.y?(m=map._limitOffset(m,map.options.maxBounds),z((function(){map.panBy(m,{duration:_,easeLinearity:l,noMoveStart:!0,animate:!0})}))):map.fire("moveend")}}});Ke.addInitHook("addHandler","dragging",Tn),Ke.mergeOptions({keyboard:!0,keyboardPanDelta:80});var An=oi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(map){this._map=map,this._setPanDelta(map.options.keyboardPanDelta),this._setZoomDelta(map.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Re(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ce(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var body=document.body,t=document.documentElement,e=body.scrollTop||t.scrollTop,n=body.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(n,e)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var i,e,n=this._panKeys={},r=this.keyCodes;for(i=0,e=r.left.length;i<e;i++)n[r.left[i]]=[-1*t,0];for(i=0,e=r.right.length;i<e;i++)n[r.right[i]]=[t,0];for(i=0,e=r.down.length;i<e;i++)n[r.down[i]]=[0,t];for(i=0,e=r.up.length;i<e;i++)n[r.up[i]]=[0,-1*t]},_setZoomDelta:function(t){var i,e,n=this._zoomKeys={},r=this.keyCodes;for(i=0,e=r.zoomIn.length;i<e;i++)n[r.zoomIn[i]]=t;for(i=0,e=r.zoomOut.length;i<e;i++)n[r.zoomOut[i]]=-t},_addHooks:function(){Re(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ce(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,map=this._map;if(n in this._panKeys)map._panAnim&&map._panAnim._inProgress||(e=this._panKeys[n],t.shiftKey&&(e=B(e).multiplyBy(3)),map.panBy(e),map.options.maxBounds&&map.panInsideBounds(map.options.maxBounds));else if(n in this._zoomKeys)map.setZoom(map.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!map._popup||!map._popup.options.closeOnEscapeKey)return;map.closePopup()}Ge(t)}}});Ke.addInitHook("addHandler","keyboard",An),Ke.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var En=oi.extend({addHooks:function(){Re(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ce(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=qe(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var o=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),o),Ge(t)},_performZoom:function(){var map=this._map,t=map.getZoom(),e=this._map.options.zoomSnap||0;map._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,o=e?Math.ceil(r/e)*e:r,l=map._limitZoom(t+(this._delta>0?o:-o))-t;this._delta=0,this._startTime=null,l&&("center"===map.options.scrollWheelZoom?map.setZoom(t+l):map.setZoomAround(this._lastMousePos,t+l))}});Ke.addInitHook("addHandler","scrollWheelZoom",En),Ke.mergeOptions({tap:!0,tapTolerance:15});var kn=oi.extend({addHooks:function(){Re(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ce(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(Ue(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],n=e.target;this._startPos=this._newPos=new F(e.clientX,e.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&pe(n,"leaflet-active"),this._holdTimeout=setTimeout(r((function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))}),this),1e3),this._simulateEvent("mousedown",e),Re(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),Ce(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],n=e.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&_e(n,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new F(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var n=document.createEvent("MouseEvents");n._simulated=!0,e.target._simulatedClick=!0,n.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}});!zt||Mt&&!gt||Ke.addInitHook("addHandler","tap",kn),Ke.mergeOptions({touchZoom:zt&&!ht,bounceAtZoomLimits:!0});var Sn=oi.extend({addHooks:function(){pe(this._map._container,"leaflet-touch-zoom"),Re(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){_e(this._map._container,"leaflet-touch-zoom"),Ce(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var map=this._map;if(t.touches&&2===t.touches.length&&!map._animatingZoom&&!this._zooming){var e=map.mouseEventToContainerPoint(t.touches[0]),n=map.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=map.getSize()._divideBy(2),this._startLatLng=map.containerPointToLatLng(this._centerPoint),"center"!==map.options.touchZoom&&(this._pinchStartLatLng=map.containerPointToLatLng(e.add(n)._divideBy(2))),this._startDist=e.distanceTo(n),this._startZoom=map.getZoom(),this._moved=!1,this._zooming=!0,map._stop(),Re(document,"touchmove",this._onTouchMove,this),Re(document,"touchend",this._onTouchEnd,this),Ue(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var map=this._map,e=map.mouseEventToContainerPoint(t.touches[0]),n=map.mouseEventToContainerPoint(t.touches[1]),o=e.distanceTo(n)/this._startDist;if(this._zoom=map.getScaleZoom(o,this._startZoom),!map.options.bounceAtZoomLimits&&(this._zoom<map.getMinZoom()&&o<1||this._zoom>map.getMaxZoom()&&o>1)&&(this._zoom=map._limitZoom(this._zoom)),"center"===map.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var l=e._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===l.x&&0===l.y)return;this._center=map.unproject(map.project(this._pinchStartLatLng,this._zoom).subtract(l),this._zoom)}this._moved||(map._moveStart(!0,!1),this._moved=!0),R(this._animRequest);var h=r(map._move,map,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=z(h,this,!0),Ue(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,R(this._animRequest),Ce(document,"touchmove",this._onTouchMove,this),Ce(document,"touchend",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Ke.addInitHook("addHandler","touchZoom",Sn),Ke.BoxZoom=xn,Ke.DoubleClickZoom=wn,Ke.Drag=Tn,Ke.Keyboard=An,Ke.ScrollWheelZoom=En,Ke.Tap=kn,Ke.TouchZoom=Sn,t.version="1.7.1",t.Control=Qe,t.control=ti,t.Browser=Ft,t.Evented=I,t.Mixin=ai,t.Util=C,t.Class=O,t.Handler=oi,t.extend=e,t.bind=r,t.stamp=l,t.setOptions=v,t.DomEvent=$e,t.DomUtil=ze,t.PosAnimation=Je,t.Draggable=fi,t.LineUtil=xi,t.PolyUtil=Ti,t.Point=F,t.point=B,t.Bounds=j,t.bounds=U,t.Transformation=J,t.transformation=K,t.Projection=ki,t.LatLng=V,t.latLng=W,t.LatLngBounds=G,t.latLngBounds=Z,t.CRS=Y,t.GeoJSON=Gi,t.geoJSON=Ki,t.geoJson=Qi,t.Layer=zi,t.LayerGroup=Ri,t.layerGroup=function(t,e){return new Ri(t,e)},t.FeatureGroup=Li,t.featureGroup=function(t,e){return new Li(t,e)},t.ImageOverlay=tn,t.imageOverlay=function(t,e,n){return new tn(t,e,n)},t.VideoOverlay=en,t.videoOverlay=function(video,t,e){return new en(video,t,e)},t.SVGOverlay=nn,t.svgOverlay=function(t,e,n){return new nn(t,e,n)},t.DivOverlay=rn,t.Popup=on,t.popup=function(t,source){return new on(t,source)},t.Tooltip=sn,t.tooltip=function(t,source){return new sn(t,source)},t.Icon=Ci,t.icon=function(t){return new Ci(t)},t.DivIcon=an,t.divIcon=function(t){return new an(t)},t.Marker=Ii,t.marker=function(t,e){return new Ii(t,e)},t.TileLayer=un,t.tileLayer=hn,t.GridLayer=ln,t.gridLayer=function(t){return new ln(t)},t.SVG=vn,t.svg=yn,t.Renderer=fn,t.Canvas=dn,t.canvas=pn,t.Path=Fi,t.CircleMarker=Di,t.circleMarker=function(t,e){return new Di(t,e)},t.Circle=Bi,t.circle=function(t,e,n){return new Bi(t,e,n)},t.Polyline=ji,t.polyline=function(t,e){return new ji(t,e)},t.Polygon=Ui,t.polygon=function(t,e){return new Ui(t,e)},t.Rectangle=bn,t.rectangle=function(t,e){return new bn(t,e)},t.Map=Ke,t.map=function(t,e){return new Ke(t,e)};var Pn=window.L;t.noConflict=function(){return window.L=Pn,this},window.L=t}(e)},152:function(t,e,n){(function(e){var n;n=function(){"use strict";var t,n,r={};function o(e,o){if(t)if(n){var l="var shared_chunk = {}; ("+t+")(shared_chunk); ("+n+")(shared_chunk);",h={};t(h),(r=o(h)).workerURL=window.URL.createObjectURL(new Blob([l],{type:"text/javascript"}))}else n=o;else t=o}o(0,(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=e((function(t){var e=t.exports={version:"2.6.3"};"number"==typeof __e&&(__e=e)})),r=(n.version,e((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}))),i=e((function(t){var e=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:n.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),o=0,s=Math.random(),a=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++o+s).toString(36))},l=e((function(t){var e=i("wks"),n=r.Symbol,o="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=o&&n[t]||(o?n:a)("Symbol."+t))}).store=e})),u=function(t){return"object"==typeof t?null!==t:"function"==typeof t},h=function(t){if(!u(t))throw TypeError(t+" is not an object!");return t},c=function(t){try{return!!t()}catch(t){return!0}},f=!c((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),d=r.document,_=u(d)&&u(d.createElement),p=function(t){return _?d.createElement(t):{}},m=!f&&!c((function(){return 7!=Object.defineProperty(p("div"),"a",{get:function(){return 7}}).a})),v=function(t,e){if(!u(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!u(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!u(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!u(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},g=Object.defineProperty,y={f:f?Object.defineProperty:function(t,e,n){if(h(t),e=v(e,!0),h(n),m)try{return g(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},x=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},b=f?function(t,e,n){return y.f(t,e,x(1,n))}:function(t,e,n){return t[e]=n,t},w=l("unscopables"),T=Array.prototype;null==T[w]&&b(T,w,{});var A=function(t){T[w][t]=!0},E=function(t,e){return{value:e,done:!!t}},k={},S={}.toString,P=function(t){return S.call(t).slice(8,-1)},M=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==P(t)?t.split(""):Object(t)},z=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},R=function(t){return M(z(t))},L={}.hasOwnProperty,C=function(t,e){return L.call(t,e)},O=e((function(t){var e=a("src"),i=Function.toString,o=(""+i).split("toString");n.inspectSource=function(t){return i.call(t)},(t.exports=function(t,n,i,s){var a="function"==typeof i;a&&(C(i,"name")||b(i,"name",n)),t[n]!==i&&(a&&(C(i,e)||b(i,e,t[n]?""+t[n]:o.join(String(n)))),t===r?t[n]=i:s?t[n]?t[n]=i:b(t,n,i):(delete t[n],b(t,n,i)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[e]||i.call(this)}))})),N=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},I=function(t,e,n){if(N(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},F=function(t,e,i){var o,s,a,l,u=t&F.F,h=t&F.G,c=t&F.S,f=t&F.P,d=t&F.B,_=h?r:c?r[e]||(r[e]={}):(r[e]||{}).prototype,p=h?n:n[e]||(n[e]={}),m=p.prototype||(p.prototype={});for(o in h&&(i=e),i)a=((s=!u&&_&&void 0!==_[o])?_:i)[o],l=d&&s?I(a,r):f&&"function"==typeof a?I(Function.call,a):a,_&&O(_,o,a,t&F.U),p[o]!=a&&b(p,o,l),f&&m[o]!=a&&(m[o]=a)};r.core=n,F.F=1,F.G=2,F.S=4,F.P=8,F.B=16,F.W=32,F.U=64,F.R=128;var D=F,B=Math.ceil,j=Math.floor,U=function(t){return isNaN(t=+t)?0:(t>0?j:B)(t)},G=Math.min,Z=function(t){return t>0?G(U(t),9007199254740991):0},q=Math.max,V=Math.min,W=function(t,e){return(t=U(t))<0?q(t+e,0):V(t,e)},H=function(t){return function(e,n,r){var i,o=R(e),s=Z(o.length),a=W(r,s);if(t&&n!=n){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((t||a in o)&&o[a]===n)return t||a||0;return!t&&-1}},Y=i("keys"),X=function(t){return Y[t]||(Y[t]=a(t))},$=H(!1),J=X("IE_PROTO"),K=function(t,e){var n,r=R(t),i=0,o=[];for(n in r)n!=J&&C(r,n)&&o.push(n);for(;e.length>i;)C(r,n=e[i++])&&(~$(o,n)||o.push(n));return o},Q="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),tt=Object.keys||function(t){return K(t,Q)},et=f?Object.defineProperties:function(t,e){h(t);for(var n,r=tt(e),i=r.length,o=0;i>o;)y.f(t,n=r[o++],e[n]);return t},it=r.document,nt=it&&it.documentElement,ot=X("IE_PROTO"),st=function(){},at=function(){var t,e=p("iframe"),n=Q.length;for(e.style.display="none",nt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),at=t.F;n--;)delete at.prototype[Q[n]];return at()},lt=Object.create||function(t,e){var n;return null!==t?(st.prototype=h(t),n=new st,st.prototype=null,n[ot]=t):n=at(),void 0===e?n:et(n,e)},ut=y.f,ht=l("toStringTag"),ct=function(t,e,n){t&&!C(t=n?t:t.prototype,ht)&&ut(t,ht,{configurable:!0,value:e})},ft={};b(ft,l("iterator"),(function(){return this}));var pt=function(t){return Object(z(t))},_t=X("IE_PROTO"),mt=Object.prototype,gt=Object.getPrototypeOf||function(t){return t=pt(t),C(t,_t)?t[_t]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?mt:null},vt=l("iterator"),yt=!([].keys&&"next"in[].keys()),bt=function(){return this},xt=function(t,e,n,r,i,o,s){!function(t,e,n){t.prototype=lt(ft,{next:x(1,n)}),ct(t,e+" Iterator")}(n,e,r);var a,l,u,h=function(t){if(!yt&&t in _)return _[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},c=e+" Iterator",f="values"==i,d=!1,_=t.prototype,p=_[vt]||_["@@iterator"]||i&&_[i],m=p||h(i),v=i?f?h("entries"):m:void 0,g="Array"==e&&_.entries||p;if(g&&(u=gt(g.call(new t)))!==Object.prototype&&u.next&&(ct(u,c,!0),"function"!=typeof u[vt]&&b(u,vt,bt)),f&&p&&"values"!==p.name&&(d=!0,m=function(){return p.call(this)}),(yt||d||!_[vt])&&b(_,vt,m),k[e]=m,k[c]=bt,i)if(a={values:f?m:h("values"),keys:o?m:h("keys"),entries:v},s)for(l in a)l in _||O(_,l,a[l]);else D(D.P+D.F*(yt||d),e,a);return a},wt=xt(Array,"Array",(function(t,e){this._t=R(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,E(1)):E(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])}),"values");k.Arguments=k.Array,A("keys"),A("values"),A("entries");var Tt={f:{}.propertyIsEnumerable},At=Tt.f,Et=function(t){return function(e){for(var n,r=R(e),i=tt(r),o=i.length,s=0,a=[];o>s;)At.call(r,n=i[s++])&&a.push(t?[n,r[n]]:r[n]);return a}},kt=Et(!0);D(D.S,"Object",{entries:function(t){return kt(t)}});for(var St=l("iterator"),Pt=l("toStringTag"),Mt=k.Array,zt={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Rt=tt(zt),Lt=0;Lt<Rt.length;Lt++){var Ct,Ot=Rt[Lt],Nt=zt[Ot],It=r[Ot],Ft=It&&It.prototype;if(Ft&&(Ft[St]||b(Ft,St,Mt),Ft[Pt]||b(Ft,Pt,Ot),k[Ot]=Mt,Nt))for(Ct in wt)Ft[Ct]||O(Ft,Ct,wt[Ct],!0)}var Dt={f:Object.getOwnPropertySymbols},Bt=Object.assign,jt=!Bt||c((function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=Bt({},t)[n]||Object.keys(Bt({},e)).join("")!=r}))?function(t,e){for(var n=pt(t),r=arguments.length,i=1,o=Dt.f,s=Tt.f;r>i;)for(var a,l=M(arguments[i++]),u=o?tt(l).concat(o(l)):tt(l),h=u.length,c=0;h>c;)s.call(l,a=u[c++])&&(n[a]=l[a]);return n}:Bt;D(D.S+D.F,"Object",{assign:jt});var Ut={};try{window instanceof Window&&window.document instanceof HTMLDocument&&(Ut.is_worker=!1,Ut.is_main=!0)}catch(t){Ut.is_worker=!0,Ut.is_main=!1,self.window={document:{}},self.document=self.window.document}var Gt=function(t){return function(e,n){var r,i,o=String(z(e)),s=U(n),a=o.length;return s<0||s>=a?t?"":void 0:(r=o.charCodeAt(s))<55296||r>56319||s+1===a||(i=o.charCodeAt(s+1))<56320||i>57343?t?o.charAt(s):r:t?o.slice(s,s+2):i-56320+(r-55296<<10)+65536}},Zt=Gt(!0),Vt=function(t,e,n){return e+(n?Zt(t,e).length:1)},qt=l("toStringTag"),Wt="Arguments"==P(function(){return arguments}()),Ht=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),qt))?n:Wt?P(e):"Object"==(r=P(e))&&"function"==typeof e.callee?"Arguments":r},Yt=RegExp.prototype.exec,Xt=function(t,e){var n=t.exec;if("function"==typeof n){var r=n.call(t,e);if("object"!=typeof r)throw new TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==Ht(t))throw new TypeError("RegExp#exec called on incompatible receiver");return Yt.call(t,e)},$t=function(){var t=h(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},Jt=RegExp.prototype.exec,Kt=String.prototype.replace,Qt=Jt,te=function(){var t=/a/,e=/b*/g;return Jt.call(t,"a"),Jt.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),ee=void 0!==/()??/.exec("")[1];(te||ee)&&(Qt=function(t){var e,n,r,i,o=this;return ee&&(n=new RegExp("^"+o.source+"$(?!\\s)",$t.call(o))),te&&(e=o.lastIndex),r=Jt.call(o,t),te&&r&&(o.lastIndex=o.global?r.index+r[0].length:e),ee&&r&&r.length>1&&Kt.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r});var ie=Qt;D({target:"RegExp",proto:!0,forced:ie!==/./.exec},{exec:ie});var rt=l("species"),ne=!c((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),re=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2===n.length&&"a"===n[0]&&"b"===n[1]}(),oe=function(t,e,n){var r=l(t),i=!c((function(){var e={};return e[r]=function(){return 7},7!=""[t](e)})),o=i?!c((function(){var e=!1,n=/a/;return n.exec=function(){return e=!0,null},"split"===t&&(n.constructor={},n.constructor[rt]=function(){return n}),n[r](""),!e})):void 0;if(!i||!o||"replace"===t&&!ne||"split"===t&&!re){var s=/./[r],a=n(z,r,""[t],(function(t,e,n,r,o){return e.exec===ie?i&&!o?{done:!0,value:s.call(e,n,r)}:{done:!0,value:t.call(n,e,r)}:{done:!1}})),u=a[0],h=a[1];O(String.prototype,t,u),b(RegExp.prototype,r,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)})}},se=Math.max,ae=Math.min,le=Math.floor,ue=/\$([$&`']|\d\d?|<[^>]*>)/g,he=/\$([$&`']|\d\d?)/g;oe("replace",2,(function(t,e,n,r){return[function(r,i){var o=t(this),s=null==r?void 0:r[e];return void 0!==s?s.call(r,o,i):n.call(String(o),r,i)},function(t,e){var o=r(n,t,this,e);if(o.done)return o.value;var s=h(t),a=String(this),l="function"==typeof e;l||(e=String(e));var u=s.global;if(u){var c=s.unicode;s.lastIndex=0}for(var f=[];;){var d=Xt(s,a);if(null===d)break;if(f.push(d),!u)break;""===String(d[0])&&(s.lastIndex=Vt(a,Z(s.lastIndex),c))}for(var _,p="",m=0,v=0;v<f.length;v++){d=f[v];for(var g=String(d[0]),y=se(ae(U(d.index),a.length),0),x=[],b=1;b<d.length;b++)x.push(void 0===(_=d[b])?_:String(_));var w=d.groups;if(l){var T=[g].concat(x,y,a);void 0!==w&&T.push(w);var A=String(e.apply(void 0,T))}else A=i(g,a,y,x,w,e);y>=m&&(p+=a.slice(m,y)+A,m=y+g.length)}return p+a.slice(m)}];function i(t,e,r,i,o,s){var a=r+t.length,l=i.length,u=he;return void 0!==o&&(o=pt(o),u=ue),n.call(s,u,(function(n,s){var u;switch(s.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(a);case"<":u=o[s.slice(1,-1)];break;default:var h=+s;if(0===h)return n;if(h>l){var c=le(h/10);return 0===c?n:c<=l?void 0===i[c-1]?s.charAt(1):i[c-1]+s.charAt(1):n}u=i[h-1]}return void 0===u?"":u}))}}));var ce,dt=[].sort,fe=[1,2,3];D(D.P+D.F*(c((function(){fe.sort(void 0)}))||!c((function(){fe.sort(null)}))||!((ce=dt)&&c((function(){ce.call(null)})))),"Array",{sort:function(t){return void 0===t?dt.call(pt(this)):dt.call(pt(this),N(t))}});var de=e((function(t){var e=a("meta"),n=y.f,r=0,i=Object.isExtensible||function(){return!0},o=!c((function(){return i(Object.preventExtensions({}))})),s=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!u(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!C(t,e)){if(!i(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!C(t,e)){if(!i(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return o&&l.NEED&&i(t)&&!C(t,e)&&s(t),t}}})),pe=(de.KEY,de.NEED,de.fastKey,de.getWeak,de.onFreeze,Array.isArray||function(t){return"Array"==P(t)}),_e=Q.concat("length","prototype"),me={f:Object.getOwnPropertyNames||function(t){return K(t,_e)}},ge=Object.getOwnPropertyDescriptor,ve={f:f?ge:function(t,e){if(t=R(t),e=v(e,!0),m)try{return ge(t,e)}catch(t){}if(C(t,e))return x(!Tt.f.call(t,e),t[e])}},ye=Gt(!0);xt(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=ye(e,n),this._i+=t.length,{value:t,done:!1})}));var be,xe,we,Te=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Ae=function(t,e,n,r){try{return r?e(h(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&h(i.call(t)),e}},Ee=l("iterator"),ke=Array.prototype,Se=function(t){return void 0!==t&&(k.Array===t||ke[Ee]===t)},Pe=l("iterator"),Me=n.getIteratorMethod=function(t){if(null!=t)return t[Pe]||t["@@iterator"]||k[Ht(t)]},ze=e((function(t){var e={},n={},r=t.exports=function(t,r,i,o,s){var a,l,u,c,f=s?function(){return t}:Me(t),d=I(i,o,r?2:1),_=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(Se(f)){for(a=Z(t.length);a>_;_++)if((c=r?d(h(l=t[_])[0],l[1]):d(t[_]))===e||c===n)return c}else for(u=f.call(t);!(l=u.next()).done;)if((c=Ae(u,d,l.value,r))===e||c===n)return c};r.BREAK=e,r.RETURN=n})),Re=l("species"),Le=function(t,e){var n,r=h(t).constructor;return void 0===r||null==(n=h(r)[Re])?e:N(n)},Ce=r.process,Oe=r.setImmediate,Ne=r.clearImmediate,Ie=r.MessageChannel,Fe=r.Dispatch,De=0,Be={},je=function(){var t=+this;if(Be.hasOwnProperty(t)){var e=Be[t];delete Be[t],e()}},Ue=function(t){je.call(t.data)};Oe&&Ne||(Oe=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Be[++De]=function(){!function(t,e,n){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},be(De),De},Ne=function(t){delete Be[t]},"process"==P(Ce)?be=function(t){Ce.nextTick(I(je,t,1))}:Fe&&Fe.now?be=function(t){Fe.now(I(je,t,1))}:Ie?(we=(xe=new Ie).port2,xe.port1.onmessage=Ue,be=I(we.postMessage,we,1)):r.addEventListener&&"function"==typeof postMessage&&!r.importScripts?(be=function(t){r.postMessage(t+"","*")},r.addEventListener("message",Ue,!1)):be="onreadystatechange"in p("script")?function(t){nt.appendChild(p("script")).onreadystatechange=function(){nt.removeChild(this),je.call(t)}}:function(t){setTimeout(I(je,t,1),0)});var Ge={set:Oe,clear:Ne},Ze=Ge.set,Ve=r.MutationObserver||r.WebKitMutationObserver,qe=r.process,We=r.Promise,He="process"==P(qe);function Ye(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=N(e),this.reject=N(n)}var Xe={f:function(t){return new Ye(t)}},$e=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},Je=r.navigator,Ke=Je&&Je.userAgent||"",tr=function(t,e,n){for(var r in e)O(t,r,e[r],n);return t},Qe=l("species"),ti=function(t){var e=r[t];f&&e&&!e[Qe]&&y.f(e,Qe,{configurable:!0,get:function(){return this}})},ei=l("iterator"),ii=!1;try{[7][ei]().return=function(){ii=!0}}catch(t){}var ni,ri,oi,si,ai=function(t,e){if(!e&&!ii)return!1;var n=!1;try{var r=[7],i=r[ei]();i.next=function(){return{done:n=!0}},r[ei]=function(){return i},t(r)}catch(t){}return n},ui=Ge.set,hr=function(){var t,e,n,i=function(){var r,i;for(He&&(r=qe.domain)&&r.exit();t;){i=t.fn,t=t.next;try{i()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(He)n=function(){qe.nextTick(i)};else if(!Ve||r.navigator&&r.navigator.standalone)if(We&&We.resolve){var o=We.resolve(void 0);n=function(){o.then(i)}}else n=function(){Ze.call(r,i)};else{var s=!0,a=document.createTextNode("");new Ve(i).observe(a,{characterData:!0}),n=function(){a.data=s=!s}}return function(r){var i={fn:r,next:void 0};e&&(e.next=i),t||(t=i,n()),e=i}}(),hi=r.TypeError,ci=r.process,fi=ci&&ci.versions,di=fi&&fi.v8||"",pi=r.Promise,_i="process"==Ht(ci),mi=function(){},gi=ri=Xe.f,br=!!function(){try{var t=pi.resolve(1),e=(t.constructor={})[l("species")]=function(t){t(mi,mi)};return(_i||"function"==typeof PromiseRejectionEvent)&&t.then(mi)instanceof e&&0!==di.indexOf("6.6")&&-1===Ke.indexOf("Chrome/66")}catch(t){}}(),vi=function(t){var e;return!(!u(t)||"function"!=typeof(e=t.then))&&e},yi=function(t,e){if(!t._n){t._n=!0;var n=t._c;hr((function(){for(var r=t._v,i=1==t._s,o=0,s=function(e){var n,o,s,a=i?e.ok:e.fail,l=e.resolve,u=e.reject,h=e.domain;try{a?(i||(2==t._h&&wi(t),t._h=1),!0===a?n=r:(h&&h.enter(),n=a(r),h&&(h.exit(),s=!0)),n===e.promise?u(hi("Promise-chain cycle")):(o=vi(n))?o.call(n,l,u):l(n)):u(r)}catch(t){h&&!s&&h.exit(),u(t)}};n.length>o;)s(n[o++]);t._c=[],t._n=!1,e&&!t._h&&bi(t)}))}},bi=function(t){ui.call(r,(function(){var e,n,i,o=t._v,s=xi(t);if(s&&(e=$e((function(){_i?ci.emit("unhandledRejection",o,t):(n=r.onunhandledrejection)?n({promise:t,reason:o}):(i=r.console)&&i.error&&i.error("Unhandled promise rejection",o)})),t._h=_i||xi(t)?2:1),t._a=void 0,s&&e.e)throw e.v}))},xi=function(t){return 1!==t._h&&0===(t._a||t._c).length},wi=function(t){ui.call(r,(function(){var e;_i?ci.emit("rejectionHandled",t):(e=r.onrejectionhandled)&&e({promise:t,reason:t._v})}))},Ti=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),yi(e,!0))},Ai=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw hi("Promise can't be resolved itself");(e=vi(t))?hr((function(){var r={_w:n,_d:!1};try{e.call(t,I(Ai,r,1),I(Ti,r,1))}catch(t){Ti.call(r,t)}})):(n._v=t,n._s=1,yi(n,!1))}catch(t){Ti.call({_w:n,_d:!1},t)}}};br||(pi=function(t){Te(this,pi,"Promise","_h"),N(t),ni.call(this);try{t(I(Ai,this,1),I(Ti,this,1))}catch(t){Ti.call(this,t)}},(ni=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=tr(pi.prototype,{then:function(t,e){var n=gi(Le(this,pi));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=_i?ci.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&yi(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),oi=function(){var t=new ni;this.promise=t,this.resolve=I(Ai,t,1),this.reject=I(Ti,t,1)},Xe.f=gi=function(t){return t===pi||t===si?new oi(t):ri(t)}),D(D.G+D.W+D.F*!br,{Promise:pi}),ct(pi,"Promise"),ti("Promise"),si=n.Promise,D(D.S+D.F*!br,"Promise",{reject:function(t){var e=gi(this);return(0,e.reject)(t),e.promise}}),D(D.S+D.F*!br,"Promise",{resolve:function(t){return function(t,e){if(h(t),u(e)&&e.constructor===t)return e;var n=Xe.f(t);return(0,n.resolve)(e),n.promise}(this,t)}}),D(D.S+D.F*!(br&&ai((function(t){pi.all(t).catch(mi)}))),"Promise",{all:function(t){var e=this,n=gi(e),r=n.resolve,i=n.reject,o=$e((function(){var n=[],o=0,s=1;ze(t,!1,(function(t){var a=o++,l=!1;n.push(void 0),s++,e.resolve(t).then((function(t){l||(l=!0,n[a]=t,--s||r(n))}),i)})),--s||r(n)}));return o.e&&i(o.v),n.promise},race:function(t){var e=this,n=gi(e),r=n.reject,i=$e((function(){ze(t,!1,(function(t){e.resolve(t).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}});var Ei=y.f,ki=Function.prototype,Si=/^\s*function ([^ (]*)/;"name"in ki||f&&Ei(ki,"name",{configurable:!0,get:function(){try{return(""+this).match(Si)[1]}catch(t){return""}}});var Pi=function(t,e){var r=(n.Object||{})[t]||Object[t],i={};i[t]=e(r),D(D.S+D.F*c((function(){r(1)})),"Object",i)};function Mi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zi(t,e,n){return e&&Mi(t.prototype,e),n&&Mi(t,n),t}function Ri(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Li(t){return(Li=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ci(t,e){return(Ci=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Oi(t,e,n){return(Oi=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Ci(i,n.prototype),i}).apply(null,arguments)}function Ni(t){var e="function"==typeof Map?new Map:void 0;return(Ni=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Oi(t,arguments,Li(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ci(r,t)})(t)}Pi("keys",(function(){return function(t){return tt(pt(t))}}));var Ii,Fi="v0.21.0",Di=l("match"),Bi=function(t){var e;return u(t)&&(void 0!==(e=t[Di])?!!e:"RegExp"==P(t))},ji=Math.min,Ui=[].push,Gi=!c((function(){}));oe("split",2,(function(t,e,n,r){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var r=String(this);if(void 0===t&&0===e)return[];if(!Bi(t))return n.call(r,t,e);for(var i,o,s,a=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,h=void 0===e?4294967295:e>>>0,c=new RegExp(t.source,l+"g");(i=ie.call(c,r))&&!((o=c.lastIndex)>u&&(a.push(r.slice(u,i.index)),i.length>1&&i.index<r.length&&Ui.apply(a,i.slice(1)),s=i[0].length,u=o,a.length>=h));)c.lastIndex===i.index&&c.lastIndex++;return u===r.length?!s&&c.test("")||a.push(""):a.push(r.slice(u)),a.length>h?a.slice(0,h):a}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:n.call(this,t,e)}:n,[function(n,r){var o=t(this),s=null==n?void 0:n[e];return void 0!==s?s.call(n,o,r):i.call(String(o),n,r)},function(t,e){var o=r(i,t,this,e,i!==n);if(o.done)return o.value;var s=h(t),a=String(this),l=Le(s,RegExp),u=s.unicode,c=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Gi?"y":"g"),f=new l(Gi?s:"^(?:"+s.source+")",c),d=void 0===e?4294967295:e>>>0;if(0===d)return[];if(0===a.length)return null===Xt(f,a)?[a]:[];for(var _=0,p=0,m=[];p<a.length;){f.lastIndex=Gi?p:0;var v,g=Xt(f,Gi?a:a.slice(p));if(null===g||(v=ji(Z(f.lastIndex+(Gi?0:p)),a.length))===_)p=Vt(a,p,u);else{if(m.push(a.slice(_,p)),m.length===d)return m;for(var y=1;y<=g.length-1;y++)if(m.push(g[y]),m.length===d)return m;p=_=v}}return m.push(a.slice(_)),m}]}));var Zi=Ii={},Vi=0,qi={};function Wi(t){var e=[];"string"==typeof t&&(e=t.split("."),t=e.pop());for(var n=Ii.targets,r=0;r<e.length;r++){if(!n[e[r]])return[];n=n[e[r]]}return[t,n]}function Hi(t){Array.isArray(t)&&t.filter((function(t){return t.parent&&t.property})).forEach((function(t){return delete t.parent[t.property]}))}Ii.targets={},Ii.addTarget=function(t,e){Ii.targets[t]=e},Ii.removeTarget=function(t){t&&delete Ii.targets[t]},Ii.withTransferables=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!(this instanceof Ii.withTransferables))return Oi(Ii.withTransferables,e);this.value=e,this.transferables=function t(e,n,r,i){if(void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=[]),!e)return i;if(Array.isArray(e))e.forEach((function(n,r){return t(n,e,r,i)}));else if("object"==typeof e)if(e instanceof ArrayBuffer)i.push({object:e,parent:n,property:r});else if(e.buffer instanceof ArrayBuffer)i.push({object:e.buffer,parent:n,property:r});else for(var o in e)t(e[o],e,o,i);return i}(this.value)},Ut.is_main&&(Ii.postMessage=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(Array.isArray(t))return Promise.all(t.map((function(t){var n;return(n=Ii).postMessage.apply(n,[t,e].concat(r))})));var o={};"object"==typeof e&&(o=e,e=e.method);var s,a=new Promise((function(t,n){qi[Vi]={method:e,message:r,resolve:t,reject:n}})),l=[];return r&&1===r.length&&r[0]instanceof Ii.withTransferables&&(l=r[0].transferables,r=r[0].value),s={type:"main_send",message_id:Vi,method:e,message:r},o.stringify&&(s=JSON.stringify(s)),t.postMessage(s,l.map((function(t){return t.object}))),Hi(l),l.length>0&&Ji("trace","'"+e+"' transferred "+l.length+" objects to worker thread"),Vi++,a},Ii.addWorker=function(t){if(!(t instanceof Worker))throw Error("Worker broker could not add non-Worker object",t);t.addEventListener("message",(function(e){var n="string"==typeof e.data?JSON.parse(e.data):e.data,r=n.message_id;if("worker_reply"===n.type)qi[r]&&(n.error?qi[r].reject(n.error):qi[r].resolve(n.message),delete qi[r]);else if("worker_send"===n.type&&null!=r){var i,o,s,a,l;try{var u=Wi(n.method);if(a=u[0],!(s=u[1]))throw Error("Worker broker could not dispatch message type "+n.method+" on target "+n.target+" because no object with that name is registered on main thread");if(!(l="function"==typeof s[a]&&s[a]))throw Error("Worker broker could not dispatch message type "+n.method+" on target "+n.target+" because object has no method with that name");i=l.apply(s,n.message)}catch(t){o=t}var h,c=[];i instanceof Promise?i.then((function(e){e instanceof Ii.withTransferables&&(c=e.transferables,e=e.value[0]),h={type:"main_reply",message_id:r,message:e},t.postMessage(h,c.map((function(t){return t.object}))),Hi(c),c.length>0&&Ji("trace","'"+a+"' transferred "+c.length+" objects to worker thread")}),(function(e){t.postMessage({type:"main_reply",message_id:r,error:e instanceof Error?e.message+": "+e.stack:e})})):(i instanceof Ii.withTransferables&&(c=i.transferables,i=i.value[0]),h={type:"main_reply",message_id:r,message:i,error:o instanceof Error?o.message+": "+o.stack:o},t.postMessage(h,c.map((function(t){return t.object}))),Hi(c),c.length>0&&Ji("trace","'"+a+"' transferred "+c.length+" objects to worker thread"))}}))},Ii.getMessages=function(){return qi},Ii.getMessageId=function(){return Vi}),Ut.is_worker&&(Ii.postMessage=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i={};"object"==typeof t&&(i=t,t=t.method);var o,s=new Promise((function(e,r){qi[Vi]={method:t,message:n,resolve:e,reject:r}})),a=[];return n&&1===n.length&&n[0]instanceof Ii.withTransferables&&(a=n[0].transferables,n=n[0].value),o={type:"worker_send",message_id:Vi,method:t,message:n},i.stringify&&(o=JSON.stringify(o)),self.postMessage(o,a.map((function(t){return t.object}))),Hi(a),a.length>0&&Ji("trace","'"+t+"' transferred "+a.length+" objects to main thread"),Vi++,s},self.addEventListener("message",(function(t){var e="string"==typeof t.data?JSON.parse(t.data):t.data,n=e.message_id;if("main_reply"===e.type)qi[n]&&(e.error?qi[n].reject(e.error):qi[n].resolve(e.message),delete qi[n]);else if("main_send"===e.type&&null!=n){var r,i,o,s,a;try{var l=Wi(e.method);if(s=l[0],!(o=l[1]))throw Error("Worker broker could not dispatch message type "+e.method+" on target "+e.target+" because no object with that name is registered on main thread");if(!(a="function"==typeof o[s]&&o[s]))throw Error("Worker broker could not dispatch message type "+e.method+" because worker has no method with that name");r=a.apply(o,e.message)}catch(t){i=t}var u,h=[];r instanceof Promise?r.then((function(t){t instanceof Ii.withTransferables&&(h=t.transferables,t=t.value[0]),u={type:"worker_reply",message_id:n,message:t},self.postMessage(u,h.map((function(t){return t.object}))),Hi(h),h.length>0&&Ji("trace","'"+s+"' transferred "+h.length+" objects to main thread")}),(function(t){self.postMessage({type:"worker_reply",message_id:n,error:t instanceof Error?t.message+": "+t.stack:t})})):(r instanceof Ii.withTransferables&&(h=r.transferables,r=r.value[0]),u={type:"worker_reply",message_id:n,message:r,error:i instanceof Error?i.message+": "+i.stack:i},self.postMessage(u,h.map((function(t){return t.object}))),Hi(h),h.length>0&&Ji("trace","'"+s+"' transferred "+h.length+" objects to main thread"))}})));var Yi={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},Xi={},$i={};function Ji(t){var e="object"==typeof t?t.level:t;if(Yi[e]<=Yi[Ji.level]){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(Ut.is_worker)return Zi.postMessage.apply(Zi,[{method:"_logProxy",stringify:!0},t].concat(r));if("object"==typeof t&&!0===t.once){if($i[JSON.stringify(r)])return Promise.resolve(!1);$i[JSON.stringify(r)]=!0}var o=function(t){if(Ut.is_main)return Xi[t]=Xi[t]||(console[t]?console[t]:console.log).bind(console),Xi[t]}(e);return r.length>1?o.apply(void 0,["Tangram "+Fi+" ["+e+"]: "+r[0]].concat(r.slice(1))):o("Tangram "+Fi+" ["+e+"]: "+r[0]),Promise.resolve(!0)}return Promise.resolve(!1)}Ji.level="info",Ji.workers=null,Ji.setLevel=function(t){Ji.level=t,Ut.is_main&&Array.isArray(Ji.workers)&&Zi.postMessage(Ji.workers,"_logSetLevelProxy",t)},Ut.is_main&&(Ji.setWorkers=function(t){Ji.workers=t},Ji.reset=function(){$i={}}),Zi.addTarget("_logProxy",Ji),Zi.addTarget("_logSetLevelProxy",Ji.setLevel),f&&"g"!=/./g.flags&&y.f(RegExp.prototype,"flags",{configurable:!0,get:$t});var Ki=/./.toString,Qi=function(t){O(RegExp.prototype,"toString",t,!0)};c((function(){return"/a/b"!=Ki.call({source:"a",flags:"b"})}))?Qi((function(){var t=h(this);return"/".concat(t.source,"/","flags"in t?t.flags:!f&&t instanceof RegExp?$t.call(t):void 0)})):"toString"!=Ki.name&&Qi((function(){return Ki.call(this)}));var tn,en={};Zi.addTarget("Utils",en),en.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},en.isMicrosoft=function(){return/(Trident\/7.0|Edge[ \/](\d+[.\d]+))/i.test(navigator.userAgent)},en._requests={},en._proxy_requests={},en.io=function(t,e,n,r,i,o,s){if(void 0===e&&(e=6e4),void 0===n&&(n="text"),void 0===r&&(r="GET"),void 0===i&&(i={}),void 0===o&&(o=null),void 0===s&&(s=!1),Ut.is_worker&&en.isMicrosoft())return Ji("debug","Proxying request for URL to worker",t),o&&(en._proxy_requests[o]=!0),Zi.postMessage("Utils.io",t,e,n,r,i,o,!0);var a=new XMLHttpRequest,l=new Promise((function(o,s){if(a.open(r,t,!0),a.timeout=e,a.responseType=n,i&&"object"==typeof i)for(var l in i)a.setRequestHeader(l,i[l]);a.onload=function(){200===a.status?["text","json"].indexOf(a.responseType)>-1?o({body:a.responseText,status:a.status}):o({body:a.response,status:a.status}):204===a.status?o({body:null,status:a.status}):s(Error("Request error with a status of "+a.statusText))},a.onerror=function(t){s(Error("There was a network error"+t.toString()))},a.ontimeout=function(t){s(Error("timeout "+t.toString()))},a.send()}));return l=l.then((function(t){return o&&delete en._requests[o],s?Zi.withTransferables(t):t})),o&&(en._requests[o]=a),l},en.cancelRequest=function(t){if(Ut.is_worker&&en._proxy_requests[t])return Zi.postMessage("Utils.cancelRequest",t);en._requests[t]?(Ji("trace","Cancelling network request key '"+t+"'"),en._requests[t].abort(),delete en._requests[t]):Ji("trace","Could not find network request key '"+t+"'")},en.serializeWithFunctions=function(t){return"function"==typeof t?t.toString():JSON.stringify(t,(function(t,e){return"function"==typeof e?e.toString():e}))},en.use_high_density_display=!0,en.updateDevicePixelRatio=function(){var t=en.device_pixel_ratio;return en.device_pixel_ratio=en.use_high_density_display&&window.devicePixelRatio||1,en.device_pixel_ratio!==t},Ut.is_main&&en.updateDevicePixelRatio(),en.isPowerOf2=function(t){return 0==(t&t-1)},en.interpolate=function(t,e,n){if(!Array.isArray(e)||!Array.isArray(e[0]))return e;if(e.length<1)return e;var r,i,o,s,a;if(t<=e[0][0])s=e[0][1],"function"==typeof n&&(s=n(s));else if(t>=e[e.length-1][0])s=e[e.length-1][1],"function"==typeof n&&(s=n(s));else for(var l=0;l<e.length-1;l++)if(t>=e[l][0]&&t<e[l+1][0]){if(r=e[l][0],i=e[l+1][0],Array.isArray(e[l][1])){s=[];for(var u=0;u<e[l][1].length;u++)"function"==typeof n?(a=n(e[l][1][u]),o=n(e[l+1][1][u])-a,s[u]=o*(t-r)/(i-r)+a):(o=e[l+1][1][u]-e[l][1][u],s[u]=o*(t-r)/(i-r)+e[l][1][u])}else"function"==typeof n?(a=n(e[l][1]),s=(o=n(e[l+1][1])-a)*(t-r)/(i-r)+a):s=(o=e[l+1][1]-e[l][1])*(t-r)/(i-r)+e[l][1];break}return s},en.toCSSColor=function(t){if(null!=t)return 1===t[3]?"rgb("+t.slice(0,3).map((function(t){return Math.round(255*t)})).join(", ")+")":"rgba("+t.map((function(t,e){return e<3&&Math.round(255*t)||t})).join(", ")+")"};var nn=tn={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_label_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1,wireframe:!1},rn=function(t,e){if(h(t),!u(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},on=Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{(n=I(Function.call,ve.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,r){return rn(t,r),e?t.__proto__=r:n(t,r),t}}({},!1):void 0),sn=function(t,e,n){var r,i=e.constructor;return i!==n&&"function"==typeof i&&(r=i.prototype)!==n.prototype&&u(r)&&on&&on(t,r),t},an=y.f,ln=me.f,un=r.RegExp,hn=un,cn=un.prototype,fn=/a/g,dn=/a/g,pn=new un(fn)!==fn;if(f&&(!pn||c((function(){return dn[l("match")]=!1,un(fn)!=fn||un(dn)==dn||"/a/i"!=un(fn,"i")})))){un=function(t,e){var n=this instanceof un,r=Bi(t),i=void 0===e;return!n&&r&&t.constructor===un&&i?t:sn(pn?new hn(r&&!i?t.source:t,e):hn((r=t instanceof un)?t.source:t,r&&i?$t.call(t):e),n?this:cn,un)};for(var _n=function(t){t in un||an(un,t,{configurable:!0,get:function(){return hn[t]},set:function(e){hn[t]=e}})},mn=ln(hn),gn=0;mn.length>gn;)_n(mn[gn++]);cn.constructor=un,un.prototype=cn,O(r,"RegExp",un)}ti("RegExp");var vn,yn=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};function bn(t){if("string"==typeof t&&-1===t.search(/^(data|blob):/)){var e=t.indexOf("?");e>-1&&(t=t.substr(0,e));var n=t.indexOf("#");return n>-1&&(t=t.substr(0,n)),t.substr(0,t.lastIndexOf("/")+1)||""}return""}function xn(t){if("string"==typeof t)return!(t.search(/^(http|https|data|blob):/)>-1||"//"===t.substr(0,2))}function wn(t,e){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}oe("search",1,(function(t,e,n,r){return[function(n){var r=t(this),i=null==n?void 0:n[e];return void 0!==i?i.call(n,r):new RegExp(n)[e](String(r))},function(t){var e=r(n,t,this);if(e.done)return e.value;var i=h(t),o=String(this),s=i.lastIndex;yn(s,0)||(i.lastIndex=0);var a=Xt(i,o);return yn(i.lastIndex,s)||(i.lastIndex=s),null===a?-1:a.index}]}));var Tn={id:0,queue:[],max_time:20,start_time:null,state:{},add:function(t){t.id=Tn.id++,t.max_time=t.max_time||Tn.max_time,t.pause_factor=t.pause_factor||1;var e=new Promise((function(e,n){t.resolve=e,t.reject=n}));return t.promise=e,t.elapsed=0,t.total_elapsed=0,t.stats={calls:0},this.queue.push(t),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,(this.elapsed<Tn.max_time||t.immediate)&&this.process(t),t.promise},remove:function(t){var e=this.queue.indexOf(t);e>-1&&this.queue.splice(e,1)},process:function(t){if(!this.state.user_moving_view||!1!==t.user_moving_view)return t.pause?(t.pause--,!0):(t.stats.calls++,t.start_time=performance.now(),t.run(t))},processAll:function(){this.start_time=this.start_time||performance.now();for(var t=0;t<this.queue.length;t++){var e=this.queue[t];if(!0!==this.process(e)&&(e.pause||(e.pause=e.elapsed>e.max_time?e.pause_factor:0),e.total_elapsed+=e.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Tn.max_time){this.start_time=null;break}}},finish:function(t,e){return t.elapsed=performance.now()-t.start_time,t.total_elapsed+=t.elapsed,this.remove(t),t.resolve(e),t.promise},cancel:function(t){var e;t.cancel instanceof Function&&(e=t.cancel(t)),t.resolve(e)},shouldContinue:function(t){return t.elapsed=performance.now()-t.start_time,this.elapsed=performance.now()-this.start_time,t.elapsed<t.max_time&&this.elapsed<Tn.max_time},removeForTile:function(t){for(var e=this.queue.length-1;e>=0;e--)this.queue[e].tile_id===t&&(this.cancel(this.queue[e]),this.queue.splice(e,1))},setState:function(t){this.state=t}};function An(t){var e=[];return Object.assign(t,{subscribe:function(t){-1===e.indexOf(t)&&e.push(t)},unsubscribe:function(t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},unsubscribeAll:function(){e=[]},trigger:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.forEach((function(e){if("function"==typeof e[t])try{e[t].apply(e,r)}catch(e){Ji("warn","Caught exception in listener for event '"+t+"':",e)}}))},hasSubscribersFor:function(t){var n=!1;return e.forEach((function(e){"function"==typeof e[t]&&(n=!0)})),n}})}function En(t,e){var n={};return e.forEach((function(e){return n[e]=t[e]})),n}D(D.P,"String",{repeat:function(t){var e=String(z(this)),n="",r=U(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});for(var kn,Sn=a("typed_array"),Pn=a("view"),Mn=!(!r.ArrayBuffer||!r.DataView),zn=Mn,Rn=0,Ln="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");Rn<9;)(kn=r[Ln[Rn++]])?(b(kn.prototype,Sn,!0),b(kn.prototype,Pn,!0)):zn=!1;var Cn={ABV:Mn,CONSTR:zn,TYPED:Sn,VIEW:Pn},On=function(t){if(void 0===t)return 0;var e=U(t),n=Z(e);if(e!==n)throw RangeError("Wrong length!");return n},Nn=function(t){for(var e=pt(this),n=Z(e.length),r=arguments.length,i=W(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,s=void 0===o?n:W(o,n);s>i;)e[i++]=t;return e},In=e((function(t,e){var n=me.f,i=y.f,o="prototype",s="Wrong index!",a=r.ArrayBuffer,l=r.DataView,u=r.Math,h=r.RangeError,d=r.Infinity,_=a,p=u.abs,m=u.pow,v=u.floor,g=u.log,x=u.LN2,w=f?"_b":"buffer",T=f?"_l":"byteLength",A=f?"_o":"byteOffset";function E(t,e,n){var r,i,o,s=new Array(n),a=8*n-e-1,l=(1<<a)-1,u=l>>1,h=23===e?m(2,-24)-m(2,-77):0,c=0,f=t<0||0===t&&1/t<0?1:0;for((t=p(t))!=t||t===d?(i=t!=t?1:0,r=l):(r=v(g(t)/x),t*(o=m(2,-r))<1&&(r--,o*=2),(t+=r+u>=1?h/o:h*m(2,1-u))*o>=2&&(r++,o/=2),r+u>=l?(i=0,r=l):r+u>=1?(i=(t*o-1)*m(2,e),r+=u):(i=t*m(2,u-1)*m(2,e),r=0));e>=8;s[c++]=255&i,i/=256,e-=8);for(r=r<<e|i,a+=e;a>0;s[c++]=255&r,r/=256,a-=8);return s[--c]|=128*f,s}function k(t,e,n){var r,i=8*n-e-1,o=(1<<i)-1,s=o>>1,a=i-7,l=n-1,u=t[l--],h=127&u;for(u>>=7;a>0;h=256*h+t[l],l--,a-=8);for(r=h&(1<<-a)-1,h>>=-a,a+=e;a>0;r=256*r+t[l],l--,a-=8);if(0===h)h=1-s;else{if(h===o)return r?NaN:u?-d:d;r+=m(2,e),h-=s}return(u?-1:1)*r*m(2,h-e)}function S(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function P(t){return[255&t]}function M(t){return[255&t,t>>8&255]}function z(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function R(t){return E(t,52,8)}function L(t){return E(t,23,4)}function C(t,e,n){i(t[o],e,{get:function(){return this[n]}})}function O(t,e,n,r){var i=On(+n);if(i+e>t[T])throw h(s);var o=t[w]._b,a=i+t[A],l=o.slice(a,a+e);return r?l:l.reverse()}function N(t,e,n,r,i,o){var a=On(+n);if(a+e>t[T])throw h(s);for(var l=t[w]._b,u=a+t[A],c=r(+i),f=0;f<e;f++)l[u+f]=c[o?f:e-f-1]}if(Cn.ABV){if(!c((function(){a(1)}))||!c((function(){new a(-1)}))||c((function(){return new a,new a(1.5),new a(NaN),"ArrayBuffer"!=a.name}))){for(var I,F=(a=function(t){return Te(this,a),new _(On(t))})[o]=_[o],D=n(_),B=0;D.length>B;)(I=D[B++])in a||b(a,I,_[I]);F.constructor=a}var j=new l(new a(2)),G=l[o].setInt8;j.setInt8(0,2147483648),j.setInt8(1,2147483649),!j.getInt8(0)&&j.getInt8(1)||tr(l[o],{setInt8:function(t,e){G.call(this,t,e<<24>>24)},setUint8:function(t,e){G.call(this,t,e<<24>>24)}},!0)}else a=function(t){Te(this,a,"ArrayBuffer");var e=On(t);this._b=Nn.call(new Array(e),0),this[T]=e},l=function(t,e,n){Te(this,l,"DataView"),Te(t,a,"DataView");var r=t[T],i=U(e);if(i<0||i>r)throw h("Wrong offset!");if(i+(n=void 0===n?r-i:Z(n))>r)throw h("Wrong length!");this[w]=t,this[A]=i,this[T]=n},f&&(C(a,"byteLength","_l"),C(l,"buffer","_b"),C(l,"byteLength","_l"),C(l,"byteOffset","_o")),tr(l[o],{getInt8:function(t){return O(this,1,t)[0]<<24>>24},getUint8:function(t){return O(this,1,t)[0]},getInt16:function(t){var e=O(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=O(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return S(O(this,4,t,arguments[1]))},getUint32:function(t){return S(O(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return k(O(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return k(O(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){N(this,1,t,P,e)},setUint8:function(t,e){N(this,1,t,P,e)},setInt16:function(t,e){N(this,2,t,M,e,arguments[2])},setUint16:function(t,e){N(this,2,t,M,e,arguments[2])},setInt32:function(t,e){N(this,4,t,z,e,arguments[2])},setUint32:function(t,e){N(this,4,t,z,e,arguments[2])},setFloat32:function(t,e){N(this,4,t,L,e,arguments[2])},setFloat64:function(t,e){N(this,8,t,R,e,arguments[2])}});ct(a,"ArrayBuffer"),ct(l,"DataView"),b(l[o],Cn.VIEW,!0),e.ArrayBuffer=a,e.DataView=l})),Fn=l("species"),Dn=function(t,e){return new(function(t){var e;return pe(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!pe(e.prototype)||(e=void 0),u(e)&&null===(e=e[Fn])&&(e=void 0)),void 0===e?Array:e}(t))(e)},Bn=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,s=6==t,a=5==t||s,l=e||Dn;return function(e,u,h){for(var c,f,d=pt(e),_=M(d),p=I(u,h,3),m=Z(_.length),v=0,g=n?l(e,m):r?l(e,0):void 0;m>v;v++)if((a||v in _)&&(f=p(c=_[v],v,d),t))if(n)g[v]=f;else if(f)switch(t){case 3:return!0;case 5:return c;case 6:return v;case 2:g.push(c)}else if(o)return!1;return s?-1:i||o?o:g}},jn=[].copyWithin||function(t,e){var n=pt(this),r=Z(n.length),i=W(t,r),o=W(e,r),s=arguments.length>2?arguments[2]:void 0,a=Math.min((void 0===s?r:W(s,r))-o,r-i),l=1;for(o<i&&i<o+a&&(l=-1,o+=a-1,i+=a-1);a-- >0;)o in n?n[i]=n[o]:delete n[i],i+=l,o+=l;return n},Un=e((function(t){if(f){var e=r,n=c,i=D,o=Cn,s=In,h=I,d=Te,_=x,p=b,m=tr,g=U,w=Z,T=On,A=W,E=v,S=C,P=Ht,M=u,z=pt,R=Se,L=lt,O=gt,N=me.f,F=Me,B=a,j=l,G=Bn,q=H,V=Le,Y=wt,X=k,$=ai,J=ti,K=Nn,Q=jn,tt=y,et=ve,it=tt.f,nt=et.f,ot=e.RangeError,st=e.TypeError,at=e.Uint8Array,ut=Array.prototype,ht=s.ArrayBuffer,ct=s.DataView,ft=G(0),_t=G(2),mt=G(3),vt=G(4),yt=G(5),bt=G(6),xt=q(!0),Tt=q(!1),At=Y.values,Et=Y.keys,kt=Y.entries,St=ut.lastIndexOf,Pt=ut.reduce,Mt=ut.reduceRight,zt=ut.join,Rt=ut.sort,Lt=ut.slice,Ct=ut.toString,Ot=ut.toLocaleString,Nt=j("iterator"),It=j("toStringTag"),Ft=B("typed_constructor"),Dt=B("def_constructor"),Bt=o.CONSTR,jt=o.TYPED,Ut=o.VIEW,Gt=G(1,(function(t,e){return Yt(V(t,t[Dt]),e)})),Zt=n((function(){return 1===new at(new Uint16Array([1]).buffer)[0]})),Vt=!!at&&!!at.prototype.set&&n((function(){new at(1).set({})})),qt=function(t,e){var n=g(t);if(n<0||n%e)throw ot("Wrong offset!");return n},Wt=function(t){if(M(t)&&jt in t)return t;throw st(t+" is not a typed array!")},Yt=function(t,e){if(!M(t)||!(Ft in t))throw st("It is not a typed array constructor!");return new t(e)},Xt=function(t,e){return $t(V(t,t[Dt]),e)},$t=function(t,e){for(var n=0,r=e.length,i=Yt(t,r);r>n;)i[n]=e[n++];return i},Jt=function(t,e,n){it(t,e,{get:function(){return this._d[n]}})},Kt=function(t){var e,n,r,i,o,s,a=z(t),l=arguments.length,u=l>1?arguments[1]:void 0,c=void 0!==u,f=F(a);if(null!=f&&!R(f)){for(s=f.call(a),r=[],e=0;!(o=s.next()).done;e++)r.push(o.value);a=r}for(c&&l>2&&(u=h(u,arguments[2],2)),e=0,n=w(a.length),i=Yt(this,n);n>e;e++)i[e]=c?u(a[e],e):a[e];return i},Qt=function(){for(var t=0,e=arguments.length,n=Yt(this,e);e>t;)n[t]=arguments[t++];return n},te=!!at&&n((function(){Ot.call(new at(1))})),ee=function(){return Ot.apply(te?Lt.call(Wt(this)):Wt(this),arguments)},ie={copyWithin:function(t,e){return Q.call(Wt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return vt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return K.apply(Wt(this),arguments)},filter:function(t){return Xt(this,_t(Wt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return yt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return bt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){ft(Wt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return Tt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return xt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return zt.apply(Wt(this),arguments)},lastIndexOf:function(t){return St.apply(Wt(this),arguments)},map:function(t){return Gt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return Pt.apply(Wt(this),arguments)},reduceRight:function(t){return Mt.apply(Wt(this),arguments)},reverse:function(){for(var t,e=Wt(this).length,n=Math.floor(e/2),r=0;r<n;)t=this[r],this[r++]=this[--e],this[e]=t;return this},some:function(t){return mt(Wt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return Rt.call(Wt(this),t)},subarray:function(t,e){var n=Wt(this),r=n.length,i=A(t,r);return new(V(n,n[Dt]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,w((void 0===e?r:A(e,r))-i))}},ne=function(t,e){return Xt(this,Lt.call(Wt(this),t,e))},rt=function(t){Wt(this);var e=qt(arguments[1],1),n=this.length,r=z(t),i=w(r.length),o=0;if(i+e>n)throw ot("Wrong length!");for(;o<i;)this[e+o]=r[o++]},re={entries:function(){return kt.call(Wt(this))},keys:function(){return Et.call(Wt(this))},values:function(){return At.call(Wt(this))}},oe=function(t,e){return M(t)&&t[jt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},se=function(t,e){return oe(t,e=E(e,!0))?_(2,t[e]):nt(t,e)},ae=function(t,e,n){return!(oe(t,e=E(e,!0))&&M(n)&&S(n,"value"))||S(n,"get")||S(n,"set")||n.configurable||S(n,"writable")&&!n.writable||S(n,"enumerable")&&!n.enumerable?it(t,e,n):(t[e]=n.value,t)};Bt||(et.f=se,tt.f=ae),i(i.S+i.F*!Bt,"Object",{getOwnPropertyDescriptor:se,defineProperty:ae}),n((function(){Ct.call({})}))&&(Ct=Ot=function(){return zt.call(this)});var le=m({},ie);m(le,re),p(le,Nt,re.values),m(le,{slice:ne,set:rt,constructor:function(){},toString:Ct,toLocaleString:ee}),Jt(le,"buffer","b"),Jt(le,"byteOffset","o"),Jt(le,"byteLength","l"),Jt(le,"length","e"),it(le,It,{get:function(){return this[jt]}}),t.exports=function(t,r,s,a){var l=t+((a=!!a)?"Clamped":"")+"Array",u="get"+t,h="set"+t,c=e[l],f=c||{},_=c&&O(c),m=!c||!o.ABV,v={},g=c&&c.prototype,y=function(t,e){it(t,e,{get:function(){return function(t,e){var n=t._d;return n.v[u](e*r+n.o,Zt)}(this,e)},set:function(t){return function(t,e,n){var i=t._d;a&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),i.v[h](e*r+i.o,n,Zt)}(this,e,t)},enumerable:!0})};m?(c=s((function(t,e,n,i){d(t,c,l,"_d");var o,s,a,u,h=0,f=0;if(M(e)){if(!(e instanceof ht||"ArrayBuffer"==(u=P(e))||"SharedArrayBuffer"==u))return jt in e?$t(c,e):Kt.call(c,e);o=e,f=qt(n,r);var _=e.byteLength;if(void 0===i){if(_%r)throw ot("Wrong length!");if((s=_-f)<0)throw ot("Wrong length!")}else if((s=w(i)*r)+f>_)throw ot("Wrong length!");a=s/r}else a=T(e),o=new ht(s=a*r);for(p(t,"_d",{b:o,o:f,l:s,e:a,v:new ct(o)});h<a;)y(t,h++)})),g=c.prototype=L(le),p(g,"constructor",c)):n((function(){c(1)}))&&n((function(){new c(-1)}))&&$((function(t){new c,new c(null),new c(1.5),new c(t)}),!0)||(c=s((function(t,e,n,i){var o;return d(t,c,l),M(e)?e instanceof ht||"ArrayBuffer"==(o=P(e))||"SharedArrayBuffer"==o?void 0!==i?new f(e,qt(n,r),i):void 0!==n?new f(e,qt(n,r)):new f(e):jt in e?$t(c,e):Kt.call(c,e):new f(T(e))})),ft(_!==Function.prototype?N(f).concat(N(_)):N(f),(function(t){t in c||p(c,t,f[t])})),c.prototype=g,g.constructor=c);var x=g[Nt],b=!!x&&("values"==x.name||null==x.name),A=re.values;p(c,Ft,!0),p(g,jt,l),p(g,Ut,!0),p(g,Dt,c),(a?new c(1)[It]==l:It in g)||it(g,It,{get:function(){return l}}),v[l]=c,i(i.G+i.W+i.F*(c!=f),v),i(i.S,l,{BYTES_PER_ELEMENT:r}),i(i.S+i.F*n((function(){f.of.call(c,1)})),l,{from:Kt,of:Qt}),"BYTES_PER_ELEMENT"in g||p(g,"BYTES_PER_ELEMENT",r),i(i.P,l,ie),J(l),i(i.P+i.F*Vt,l,{set:rt}),i(i.P+i.F*!b,l,re),g.toString!=Ct&&(g.toString=Ct),i(i.P+i.F*n((function(){new c(1).slice()})),l,{slice:ne}),i(i.P+i.F*(n((function(){return[1,2].toLocaleString()!=new c([1,2]).toLocaleString()}))||!n((function(){g.toLocaleString.call([1,2])}))),l,{toLocaleString:ee}),X[l]=b?x:A,b||p(g,Nt,A)}}else t.exports=function(){}}));Un("Uint8",1,(function(t){return function(e,n,r){return t(this,e,n,r)}}));var Gn=function(){function t(e,n,r){void 0===r&&(r={}),r=t.sliceOptions(r),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=n,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=r.filtering,this.density=r.density||1,this.sprites=r.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,t.textures[this.name]&&(this.retain_count=t.textures[this.name].retain_count,t.textures[this.name].retain_count=0,t.textures[this.name].destroy()),t.textures[this.name]=this,t.texture_configs[this.name]=JSON.stringify(Object.assign({name:n},r)),this.load(r),Ji("trace","creating Texture "+this.name)}var e=t.prototype;return e.destroy=function(e){var n=(void 0===e?{}:e).force;this.retain_count>0&&!n?Ji("error","Texture '"+this.name+"': destroying texture with retain count of '"+this.retain_count+"'"):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,t.textures[this.name]===this&&(delete t.textures[this.name],delete t.texture_configs[this.name]),this.valid=!1,Ji("trace","destroying Texture "+this.name))},e.retain=function(){this.retain_count++},e.release=function(){this.retain_count<=0&&Ji("error","Texture '"+this.name+"': releasing texture with retain count of '"+this.retain_count+"'"),this.retain_count--,this.retain_count<=0&&this.destroy()},e.bind=function(e){void 0===e&&(e=0),this.valid&&(t.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),t.activeUnit=e,t.boundTexture=null),t.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),t.boundTexture=this.texture))},e.load=function(t){var e=this;return t?(this.loading=null,"string"==typeof t.url?(this.config_type="url",this.setUrl(t.url,t)):t.element?(this.config_type="element",this.setElement(t.element,t)):t.data&&t.width&&t.height&&(this.config_type="data",this.setData(t.width,t.height,t.data,t)),this.loading=this.loading&&this.loading.then((function(){return e.calculateSprites(),e}))||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)},e.setUrl=function(e,n){var r=this;if(void 0===n&&(n={}),this.valid)return this.url=e,this.loading=new Promise((function(e){var i=new Image;i.onload=function(){try{if("data:"===r.url.slice(0,5)){var o=document.createElement("canvas"),s=o.getContext("2d");o.width=i.width,o.height=i.height,s.drawImage(i,0,0),r.setElement(o,n)}else r.setElement(i,n)}catch(e){r.loaded=!1,Ji("warn","Texture '"+r.name+"': failed to load url: '"+r.url+"'",e,n),t.trigger("warning",{message:"Failed to load texture from "+r.url,error:e,texture:n})}r.loaded=!0,e(r)},i.onerror=function(i){r.loaded=!1,Ji("warn","Texture '"+r.name+"': failed to load url: '"+r.url+"'",i,n),t.trigger("warning",{message:"Failed to load texture from "+r.url,error:i,texture:n}),e(r)},en.isSafari()&&"data:"===r.url.slice(0,5)||(i.crossOrigin="anonymous"),i.src=r.url})),this.loading},e.setData=function(t,e,n,r){return void 0===r&&(r={}),this.width=t,this.height=e,Array.isArray(n)&&(n=new Uint8Array(n)),this.update(n,r),this.setFiltering(r),this.loaded=!0,this.loading=Promise.resolve(this),this.loading},e.setElement=function(e,n){var r=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.update(e,n),this.setFiltering(n);else{this.loaded=!1;var i="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";i+="selector string, or a <canvas>, <image> or <video> object",Ji("warn","Texture '"+this.name+"': "+i,n),t.trigger("warning",{message:"Failed to load texture because "+i,texture:n})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading},e.update=function(e,n){void 0===n&&(n={}),this.valid&&(this.bind(),e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof HTMLImageElement&&e.complete?(this.width=e.width,this.height=e.height,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==n.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)):(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,null),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,null),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)),t.trigger("update",this))},e.setFiltering=function(e){if(void 0===e&&(e={}),this.valid){e.filtering=e.filtering||"linear";var n=this.gl;this.bind(),en.isPowerOf2(this.width)&&en.isPowerOf2(this.height)?(this.power_of_2=!0,n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e.TEXTURE_WRAP_S||e.repeat&&n.REPEAT||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e.TEXTURE_WRAP_T||e.repeat&&n.REPEAT||n.CLAMP_TO_EDGE),"mipmap"===e.filtering?(this.filtering="mipmap",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.generateMipmap(n.TEXTURE_2D)):"linear"===e.filtering?(this.filtering="linear",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):"nearest"===e.filtering&&(this.filtering="nearest",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST))):(this.power_of_2=!1,n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),"nearest"===e.filtering?(this.filtering="nearest",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)):(this.filtering="linear",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR))),t.trigger("update",this)}},e.calculateSprites=function(){if(this.sprites)for(var e in this.sprites){var n=this.sprites[e];this.texcoords[e]=t.getTexcoordsForSprite([n[0],n[1]],[n[2],n[3]],[this.width,this.height]),this.sizes[e]=[n[2],n[3]],this.css_sizes[e]=[n[2]/this.density,n[3]/this.density],this.aspects[e]=n[2]/n[3]}},e.byteSize=function(){return Math.round(this.width*this.height*4*("mipmap"==this.filtering?1.33:1))},t}();Gn.create=function(t,e,n){return new Gn(t,e,n)},Gn.retain=function(t){Gn.textures[t]&&Gn.textures[t].retain()},Gn.release=function(t){Gn.textures[t]&&Gn.textures[t].release()},Gn.destroy=function(t){Object.keys(Gn.textures).forEach((function(e){var n=Gn.textures[e];n.gl===t&&n.destroy({force:!0})}))},Gn.getSpriteInfo=function(t,e){var n=Gn.textures[t];return n&&{size:n.sizes[e],css_size:n.css_sizes[e],aspect:n.aspects[e],texcoords:n.texcoords[e]}},Gn.getTexcoordsForSprite=function(t,e,n){var r=n[1]-t[1]-e[1];return[t[0]/n[0],r/n[1],(e[0]+t[0])/n[0],(e[1]+r)/n[1]]},Gn.createFromObject=function(t,e){var n=[];if(e)for(var r in e){var i=e[r];if(!i.skip_create&&Gn.changed(r,i)){var o=Gn.create(t,r,i);n.push(o.loading)}}return Promise.all(n)},Gn.default="__default",Gn.createDefault=function(t){return Gn.create(t,Gn.default)},Gn.sliceOptions=function(t){return{filtering:t.filtering,sprites:t.sprites,url:t.url,element:t.element,data:t.data,width:t.width,height:t.height,density:t.density,repeat:t.repeat,TEXTURE_WRAP_S:t.TEXTURE_WRAP_S,TEXTURE_WRAP_T:t.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:t.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:t.UNPACK_PREMULTIPLY_ALPHA_WEBGL}},Gn.changed=function(t,e){var n=Gn.textures[t];if(n){if("element"===n.config_type||null!=e.element)return!0;if(e=Gn.sliceOptions(e),Gn.texture_configs[t]===JSON.stringify(Object.assign({name:t},e)))return!1}return!0},Gn.getInfo=function(t){if(t||(t=Object.keys(Gn.textures)),Array.isArray(t))return Promise.all(t.map((function(t){return Gn.getInfo(t)})));var e=Gn.textures[t];return e?(e.loading||Promise.resolve(e)).then((function(){return{name:e.name,width:e.width,height:e.height,density:e.density,css_size:[e.width/e.density,e.height/e.density],aspect:e.width/e.height,sprites:e.sprites,texcoords:e.texcoords,sizes:e.sizes,css_sizes:e.css_sizes,aspects:e.aspects,filtering:e.filtering,power_of_2:e.power_of_2,valid:e.valid}})):Promise.resolve(null)},Gn.syncTexturesToWorker=function(t){return Zi.postMessage("Texture.getInfo",t).then((function(t){return t&&t.filter((function(t){return t})).forEach((function(t){return Gn.textures[t.name]=t})),Gn.textures}))},Gn.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},Gn.textures={},Gn.texture_configs={},Gn.boundTexture=null,Gn.activeUnit=null,Zi.addTarget("Texture",Gn),An(Gn),oe("match",1,(function(t,e,n,r){return[function(n){var r=t(this),i=null==n?void 0:n[e];return void 0!==i?i.call(n,r):new RegExp(n)[e](String(r))},function(t){var e=r(n,t,this);if(e.done)return e.value;var i=h(t),o=String(this);if(!i.global)return Xt(i,o);var s=i.unicode;i.lastIndex=0;for(var a,l=[],u=0;null!==(a=Xt(i,o));){var c=String(a[0]);l[u]=c,""===c&&(i.lastIndex=Vt(o,Z(i.lastIndex),s)),u++}return 0===u?null:l}]}));var Zn={parseUniforms:function(t){var e=[];for(var n in t){var r,i=n,o=t[n];if("number"==typeof o)e.push({type:"float",method:"1f",name:n,value:o,key:i,uniforms:t});else if(Array.isArray(o)){if("number"==typeof o[0])o.length>=2&&o.length<=4?e.push({type:"vec"+o.length,method:o.length+"fv",name:n,value:o,key:i,uniforms:t}):o.length>4&&e.push({type:"float[]",method:"1fv",name:n+"[0]",value:o,key:i,uniforms:t});else if("string"==typeof o[0])for(r=0;r<o.length;r++)e.push({type:"sampler2D",method:"1i",name:n+"["+r+"]",value:o[r],key:r,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&o[0].length>=2&&o[0].length<=4)for(r=0;r<o.length;r++)e.push({type:"vec"+o[0].length,method:o[0].length+"fv",name:n+"["+r+"]",value:o[r],key:r,uniforms:o})}else"boolean"==typeof o?e.push({type:"bool",method:"1i",name:n,value:o,key:i,uniforms:t}):"string"==typeof o&&e.push({type:"sampler2D",method:"1i",name:n,value:o,key:i,uniforms:t})}return e},defineVariable:function(t,e){var n,r;if("number"==typeof e)n="float";else if(Array.isArray(e))"number"==typeof e[0]?e.length>=2&&e.length<=4?n="vec"+e.length:(n="float",r=e.length):"string"==typeof e[0]?(n="sampler2D",r=e.length):Array.isArray(e[0])&&"number"==typeof e[0][0]&&e[0].length>=2&&e[0].length<=4&&(n="vec"+e[0].length,r=e.length);else if("boolean"==typeof e)n="bool";else{if("string"!=typeof e)return;n="sampler2D"}var i="";return i+=n+" "+t,r&&(i+="["+r+"]"),i+";\n"},defineUniform:function(t,e){var n=Zn.defineVariable(t,e);if(n)return"uniform "+n},expandVec3:function(t,e){var n;if(void 0===e&&(e=1),Array.isArray(t)){if(2!==t.length)return t;n=[].concat(t,[e]).map(parseFloat)}else n=[t,t,t].map(parseFloat);if(n&&n.every((function(t){return"number"==typeof t&&!isNaN(t)})))return n},expandVec4:function(t,e){var n;if(void 0===e&&(e=1),Array.isArray(t)){if(3!==t.length)return t;n=[].concat(t,[e]).map(parseFloat)}else n=[t,t,t,e].map(parseFloat);if(n&&n.every((function(t){return"number"==typeof t&&!isNaN(t)})))return n}},Vn=[];function qn(t,e){var n=Vn.filter((function(e){return e[0]===t}))[0];return(n=n&&n[1])||(Vn.push([t,{}]),n=Vn[Vn.length-1][1]),n[e]||(n[e]=t.getExtension(e)),n[e]}function Wn(t){var e,n,r=0;if(0===t.length)return r;for(e=0,n=t.length;e<n;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return r}var Hn=/^\s*#pragma.*$/gm,Yn=/\\\s*\n/gm,Xn=function(){function t(e,n,r,i){i=i||{},this.gl=e,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,this.defines=Object.assign({},i.defines||{}),this.blocks=Object.assign({},i.blocks||{}),this.block_scopes=Object.assign({},i.block_scopes||{}),this.extensions=i.extensions||[],this.dependent_uniforms=i.uniforms,this.uniforms={},this.attribs={},this.vertex_source=n,this.fragment_source=r,this.id=t.id++,this.name=i.name}var e=t.prototype;return e.destroy=function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1},e.use=function(){this.compiled&&(t.current!==this&&this.gl.useProgram(this.program),t.current=this)},e.compile=function(){var e=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for "+this.id+" ("+this.name+") because already compiling");this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var n,r=this.checkExtensions(),i=this.buildDefineList(),o=this.buildShaderBlockList();for(var s in o){var a=o[s];if(a&&(!Array.isArray(a)||0!==a.length)){n=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+s+"\\s*$","m");var l=this.computed_vertex_source.match(n),u=this.computed_fragment_source.match(n);if(null!=l||null!=u){var h="";a.forEach((function(t){var e=t.scope+", "+t.key+", "+t.num;h+="\n// tangram-block-start: "+e+"\n",h+=t.source,h+="\n// tangram-block-end: "+e+"\n"})),null!=l&&(this.computed_vertex_source=this.computed_vertex_source.replace(n,h)),null!=u&&(this.computed_fragment_source=this.computed_fragment_source.replace(n,h)),i["TANGRAM_BLOCK_"+s.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(Hn,""),this.computed_fragment_source=this.computed_fragment_source.replace(Hn,""),this.ensureUniforms(this.dependent_uniforms);var c,f=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);c=f&&f.precision>0?"precision highp float;\n":"precision mediump float;\n",i.TANGRAM_VERTEX_SHADER=!0,i.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=c+t.buildDefineString(i)+this.computed_vertex_source,i.TANGRAM_VERTEX_SHADER=!1,i.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=t.buildExtensionString(r)+c+t.buildDefineString(i)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(Yn,""),this.computed_fragment_source=this.computed_fragment_source.replace(Yn,"");try{this.program=t.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(t){throw this.program=null,this.compiled=!1,this.compiling=!1,this.error=t,this.error.vertex_shader_source=this.computed_vertex_source,this.error.fragment_shader_source=this.computed_fragment_source,"vertex"!==t.type&&"fragment"!==t.type||(this.shader_errors=t.errors,this.shader_errors.forEach((function(n){n.type=t.type,n.block=e.block(t.type,n.line),n.line=e.block(t.type,n.line)})),this.error.shader_errors=this.shader_errors),t}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()},e.buildDefineList=function(){var e,n={};for(e in t.defines)n[e]=t.defines[e];for(e in this.defines)n[e]=this.defines[e];return n},e.buildShaderBlockList=function(){var e,n={};for(e in t.blocks){var r;n[e]=[],Array.isArray(t.blocks[e])?(r=n[e]).push.apply(r,t.blocks[e].map((function(t,n){return{key:e,source:t,num:n,scope:"ShaderProgram"}}))):n[e]=[{key:e,source:t.blocks[e],num:0,scope:"ShaderProgram"}]}for(e in this.blocks)if(n[e]=n[e]||[],Array.isArray(this.blocks[e]))for(var i=this.block_scopes&&this.block_scopes[e]||[],o=null,s=0,a=0;a<this.blocks[e].length;a++)i[a]!==o&&(o=i[a],s=0),n[e].push({key:e,source:this.blocks[e][a],num:s,scope:o||this.name}),s++;else n[e].push({key:e,source:this.blocks[e],num:0,scope:this.name});return n},e.ensureUniforms=function(t){if(t){var e=Object.entries(t).map((function(t){var e=t[0],n=t[1];return Zn.defineUniform(e,n)})).filter((function(t){return t}));this.computed_vertex_source=e.join("\n")+this.computed_vertex_source,this.computed_fragment_source=e.join("\n")+this.computed_fragment_source}},e.setUniforms=function(t,e){if(void 0===e&&(e=!0),this.compiled){e&&(this.texture_unit=0);for(var n=Zn.parseUniforms(t),r=0;r<n.length;r++){var i=n[r];"sampler2D"===i.type?this.setTextureUniform(i.name,i.value):this.uniform(i.method,i.name,i.value)}}},e.saveUniforms=function(t){var e=t||this.uniforms;for(var n in e){var r=this.uniforms[n];r&&(r.saved_value=r.value)}this.saved_texture_unit=this.texture_unit||0},e.restoreUniforms=function(t){var e=t||this.uniforms;for(var n in e){var r=this.uniforms[n];r&&r.saved_value&&(r.value=r.saved_value,this.updateUniform(r))}this.texture_unit=this.saved_texture_unit||0},e.setTextureUniform=function(t,e){var n=Gn.textures[e];null!=n?(n.bind(this.texture_unit),this.uniform("1i",t,this.texture_unit),this.texture_unit++):Ji("warn","Cannot find texture '"+e+"'")},e.uniform=function(t,e,n){if(this.compiled){this.uniforms[e]=this.uniforms[e]||{};var r=this.uniforms[e];r.name=e,void 0===r.location&&(r.location=this.gl.getUniformLocation(this.program,e)),r.method=t,r.value=n,this.updateUniform(r)}},e.updateUniform=function(t){this.compiled&&t&&null!=t.location&&(this.use(),this.commitUniform(t))},e.commitUniform=function(t){var e=t.location,n=t.value;switch(t.method){case"1i":this.gl.uniform1i(e,n);break;case"1f":this.gl.uniform1f(e,n);break;case"2f":this.gl.uniform2f(e,n[0],n[1]);break;case"3f":this.gl.uniform3f(e,n[0],n[1],n[2]);break;case"4f":this.gl.uniform4f(e,n[0],n[1],n[2],n[3]);break;case"1iv":this.gl.uniform1iv(e,n);break;case"3iv":this.gl.uniform3iv(e,n);break;case"1fv":this.gl.uniform1fv(e,n);break;case"2fv":this.gl.uniform2fv(e,n);break;case"3fv":this.gl.uniform3fv(e,n);break;case"4fv":this.gl.uniform4fv(e,n);break;case"Matrix3fv":this.gl.uniformMatrix3fv(e,!1,n);break;case"Matrix4fv":this.gl.uniformMatrix4fv(e,!1,n)}},e.refreshUniforms=function(){if(this.compiled)for(var t in this.uniforms){var e=this.uniforms[t];e.location=this.gl.getUniformLocation(this.program,t),this.updateUniform(e)}},e.refreshAttributes=function(){this.attribs={}},e.attribute=function(t){if(this.compiled){var e=this.attribs[t]=this.attribs[t]||{};return null!=e.location||(e.name=t,e.location=this.gl.getAttribLocation(this.program,t)),e}},e.source=function(t){return"vertex"===t?this.computed_vertex_source:"fragment"===t?this.computed_fragment_source:void 0},e.lines=function(t){var e=this.source(t);return e?e.split("\n"):[]},e.line=function(t,e){var n=this.lines(t);if(n)return n[e]},e.block=function(t,e){for(var n,r=this.lines(t),i=0;i<e&&i<r.length;i++){var o=r[i],s=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);s&&s.length>1?n={scope:s[1],name:s[2],num:s[3]}:(s=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&s.length>1&&(n=null),n&&(n.line=null==n.line?-1:n.line+1,n.source=o)}return n},e.checkExtensions=function(){var t=this,e=[];return this.extensions.forEach((function(n){var r=qn(t.gl,n),i="TANGRAM_EXTENSION_"+n;t.defines[i]=null!=r,r?e.push(n):Ji("debug","Could not enable extension '"+n+"'")})),e},t}();Xn.id=0,Xn.current=null,Xn.defines={},Xn.blocks={},Xn.reset=function(){Xn.programs_by_source={},Xn.shaders_by_source={}},Xn.reset(),Xn.buildDefineString=function(t){var e="";for(var n in t)null!=t[n]&&!1!==t[n]&&("boolean"==typeof t[n]&&!0===t[n]?e+="#define "+n+"\n":"number"==typeof t[n]&&Math.floor(t[n])===t[n]?e+="#define "+n+" "+t[n].toFixed(1)+"\n":e+="#define "+n+" "+t[n]+"\n");return e},Xn.buildExtensionString=function(t){var e="";return(t=t||[]).forEach((function(t){e+="#ifdef GL_"+t+"\n#extension GL_"+t+" : enable\n#endif\n"})),e},Xn.addBlock=function(t){var e;Xn.blocks[t]=Xn.blocks[t]||[];for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=Xn.blocks[t]).push.apply(e,r)},Xn.removeBlock=function(t){Xn.blocks[t]=[]},Xn.replaceBlock=function(t){Xn.removeBlock(t);for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Xn.addBlock.apply(Xn,[t].concat(n))},Xn.updateProgram=function(t,e,n,r){var i=Wn(t._tangram_id+"::"+n+"::"+r);if(Xn.programs_by_source[i])return Ji("trace","Reusing identical source GL program object"),Xn.programs_by_source[i];var o=Xn.createShader(t,n,t.VERTEX_SHADER),s=Xn.createShader(t,r,t.FRAGMENT_SHADER);if(t.useProgram(null),null!=e)for(var a=t.getAttachedShaders(e),l=0;l<a.length;l++)t.detachShader(e,a[l]);else e=t.createProgram();if(null==o||null==s)return e;if(t.attachShader(e,o),t.attachShader(e,s),t.bindAttribLocation(e,0,"a_position"),t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS)){var u=new Error("WebGL program error:\n            VALIDATE_STATUS: "+t.getProgramParameter(e,t.VALIDATE_STATUS)+"\n            ERROR: "+t.getError()+"\n            --- Vertex Shader ---\n            "+n+"\n            --- Fragment Shader ---\n            "+r);throw Object.assign(new Error(u),{type:"program"})}return Xn.programs_by_source[i]=e,e},Xn.createShader=function(t,e,n){var r=Wn(t._tangram_id+"::"+e);if(Xn.shaders_by_source[r])return Ji("trace","Reusing identical source GL shader object"),Xn.shaders_by_source[r];var i=t.createShader(n);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var o=n===t.VERTEX_SHADER?"vertex":"fragment",s=t.getShaderInfoLog(i),a=function(t){t=String(t);for(var e,n=[];e=t.match(/ERROR\:([^\n]+)/);){t=t.slice(e.index+1);var i=(o=e[1].trim()).split(":"),r=i.slice(2).join(":").trim(),s=parseInt(i[0],10),o=parseInt(i[1],10);n.push({message:r,file:s,line:o})}return n}(s);throw Object.assign(new Error(s),{type:o,errors:a})}return Xn.shaders_by_source[r]=i,i};var $n={disabled:!1,bound_vao:[],init:function(t){var e;!0!==this.disabled&&(e=qn(t,"OES_vertex_array_object")),null!=e?Ji("info","Vertex Array Object extension available"):!0!==this.disabled?Ji("warn","Vertex Array Object extension NOT available"):Ji("warn","Vertex Array Object extension force disabled")},getExtension:function(t,e){if(!0!==this.disabled)return qn(t,e)},create:function(t,e,n){var r={};r.setup=e,r.teardown=n;var i=this.getExtension(t,"OES_vertex_array_object");return null!=i&&(r._vao=i.createVertexArrayOES(),i.bindVertexArrayOES(r._vao)),r.setup(),r},getCurrentBinding:function(t){var e=this.bound_vao.filter((function(e){return e[0]===t}))[0];return e&&e[1]},setCurrentBinding:function(t,e){var n=this.bound_vao,r=n.filter((function(e){return e[0]===t}))[0];null==r?n.push([t,e]):r[1]=e},bind:function(t,e){var n=this.getExtension(t,"OES_vertex_array_object");if(null!=e)null!=n&&null!=e._vao?(n.bindVertexArrayOES(e._vao),this.setCurrentBinding(t,e)):e.setup();else{var r=this.getCurrentBinding(t);null!=n?n.bindVertexArrayOES(null):null!=r&&"function"==typeof r.teardown&&r.teardown(),this.setCurrentBinding(t,null)}},destroy:function(t,e){var n=this.getExtension(t,"OES_vertex_array_object");null!=n&&null!=e&&null!=e._vao&&(n.deleteVertexArrayOES(e._vao),e._vao=null)}},Jn=Et(!1);D(D.S,"Object",{values:function(t){return Jn(t)}});var Kn,Qn=Bn(6),er="findIndex",ir=!0;function nr(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var n=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(n)for(var r in n){var i=n[r];null===i||"object"!=typeof i||Array.isArray(i)?void 0!==i&&(t[r]=i):null===t[r]||"object"!=typeof t[r]||Array.isArray(t[r])?t[r]=nr({},i):t[r]=nr(t[r],i)}}return t}er in[]&&Array(1)[er]((function(){ir=!1})),D(D.P+D.F*ir,"Array",{findIndex:function(t){return Qn(this,t,arguments.length>1?arguments[1]:void 0)}}),A(er);var li=Kn={};Kn.default_source_max_zoom=18,Kn.default_view_max_zoom=20,Kn.max_style_zoom=25,Kn.tile_size=256,Kn.half_circumference_meters=20037508.342789244,Kn.circumference_meters=2*Kn.half_circumference_meters,Kn.min_zoom_meters_per_pixel=Kn.circumference_meters/Kn.tile_size;var rr=[];Kn.metersPerPixel=function(t){return rr[t]=rr[t]||Kn.min_zoom_meters_per_pixel/Math.pow(2,t),rr[t]};var or=[];Kn.metersPerTile=function(t){return or[t]=or[t]||Kn.circumference_meters/Math.pow(2,t),or[t]},Kn.tile_scale=4096,Kn.units_per_pixel=Kn.tile_scale/Kn.tile_size,Kn.height_scale=16;var sr=[];Kn.unitsPerMeter=function(t){return sr[t]=sr[t]||Kn.tile_scale/(Kn.tile_size*Kn.metersPerPixel(t)),sr[t]},Kn.metersForTile=function(t){return{x:t.x*Kn.circumference_meters/Math.pow(2,t.z)-Kn.half_circumference_meters,y:-(t.y*Kn.circumference_meters/Math.pow(2,t.z)-Kn.half_circumference_meters)}},Kn.tileForMeters=function(t,e){var n=t[0],r=t[1];return{x:Math.floor((n+Kn.half_circumference_meters)/(Kn.circumference_meters/Math.pow(2,e))),y:Math.floor((-r+Kn.half_circumference_meters)/(Kn.circumference_meters/Math.pow(2,e))),z:e}},Kn.wrapTile=function(t,e){var n=t.x,r=t.y,i=t.z;void 0===e&&(e={x:!0,y:!1});var o=(1<<i)-1;return e.x&&(n&=o),e.y&&(r&=o),{x:n,y:r,z:i}},Kn.metersToLatLng=function(t){return t[0]/=Kn.half_circumference_meters,t[1]/=Kn.half_circumference_meters,t[1]=(2*Math.atan(Math.exp(t[1]*Math.PI))-Math.PI/2)/Math.PI,t[0]*=180,t[1]*=180,t},Kn.latLngToMeters=function(t){return t[1]=Math.log(Math.tan(t[1]*Math.PI/360+Math.PI/4))/Math.PI,t[1]*=Kn.half_circumference_meters,t[0]*=Kn.half_circumference_meters/180,t},Kn.tileSpaceToLatlng=function(t,e,n){var r=Kn.unitsPerMeter(e);return Kn.transformGeometry(t,(function(t){t[0]=t[0]/r+n.x,t[1]=t[1]/r+n.y,Kn.metersToLatLng(t)})),t},Kn.copyGeometry=function(t){if(null!=t){var e={type:t.type};return"Point"===t.type?e.coordinates=[t.coordinates[0],t.coordinates[1]]:"LineString"===t.type||"MultiPoint"===t.type?e.coordinates=t.coordinates.map((function(t){return[t[0],t[1]]})):"Polygon"===t.type||"MultiLineString"===t.type?e.coordinates=t.coordinates.map((function(t){return t.map((function(t){return[t[0],t[1]]}))})):"MultiPolygon"===t.type&&(e.coordinates=t.coordinates.map((function(t){return t.map((function(t){return t.map((function(t){return[t[0],t[1]]}))}))}))),e}},Kn.transformGeometry=function(t,e){null!=t&&("Point"===t.type?e(t.coordinates):"LineString"===t.type||"MultiPoint"===t.type?t.coordinates.forEach(e):"Polygon"===t.type||"MultiLineString"===t.type?t.coordinates.forEach((function(t){return t.forEach(e)})):"MultiPolygon"===t.type&&t.coordinates.forEach((function(t){t.forEach((function(t){return t.forEach(e)}))})))},Kn.boxIntersect=function(t,e){return!(e.sw.x>t.ne.x||e.ne.x<t.sw.x||e.sw.y>t.ne.y||e.ne.y<t.sw.y)},Kn.findBoundingBox=function(t){for(var e=1/0,n=-1/0,r=1/0,i=-1/0,o=t[0].length,s=0;s<o;s++){var a=t[0][s];a[0]<e&&(e=a[0]),a[1]<r&&(r=a[1]),a[0]>n&&(n=a[0]),a[1]>i&&(i=a[1])}return[e,r,n,i]},Kn.geometryType=function(t){return"Polygon"===t||"MultiPolygon"===t?"polygon":"LineString"===t||"MultiLineString"===t?"line":"Point"===t||"MultiPoint"===t?"point":void 0},Kn.centroid=function(t,e){if(void 0===e&&(e=!0),t&&0!==t.length){var n,r=0,i=0,o=0,s=t[0],a=s.length;e&&(n=s[0],s=s.map((function(t){return[t[0]-n[0],t[1]-n[1]]})));for(var l=0,u=a-1;l<a;u=l,l++){var h=s[l],c=s[u],f=h[1]*c[0]-c[1]*h[0];r+=(h[0]+c[0])*f,i+=(h[1]+c[1])*f,o+=3*f}if(o){var d=[r/o,i/o];return e&&(d[0]+=n[0],d[1]+=n[1]),d}}},Kn.multiCentroid=function(t){for(var e=0,n=null,r=0;r<t.length;r++){var i=Kn.centroid(t[r]);i&&((n=n||[0,0])[0]+=i[0],n[1]+=i[1],e++)}return e>0&&(n[0]/=e,n[1]/=e),n},Kn.signedPolygonRingAreaSum=function(t){for(var e=0,n=t.length,r=0;r<n-1;r++){var i=t[r],o=t[r+1];e+=i[0]*o[1]-o[0]*i[1]}return e+(t[n-1][0]*t[0][1]-t[0][0]*t[n-1][1])},Kn.polygonRingArea=function(t){return Math.abs(Kn.signedPolygonRingAreaSum(t))/2},Kn.polygonArea=function(t){if(t)return Kn.polygonRingArea(t[0])},Kn.multiPolygonArea=function(t){for(var e=0,n=0;n<t.length;n++)e+=Kn.polygonArea(t[n]);return e},Kn.ringWinding=function(t){var e=Kn.signedPolygonRingAreaSum(t);return e>0?"CW":e<0?"CCW":void 0};var ar="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",lr="["+ar+"]",ur=RegExp("^"+lr+lr+"*"),cr=RegExp(lr+lr+"*$"),fr=function(t,e,n){var r={},i=c((function(){return!!ar[t]()||"​"!="​"[t]()})),o=r[t]=i?e(dr):ar[t];n&&(r[n]=o),D(D.P+D.F*i,"String",r)},dr=fr.trim=function(t,e){return t=String(z(t)),1&e&&(t=t.replace(ur,"")),2&e&&(t=t.replace(cr,"")),t},pr=fr,_r=me.f,mr=ve.f,gr=y.f,vr=pr.trim,yr=r.Number,xr=yr,wr=yr.prototype,Tr="Number"==P(lt(wr)),Ar="trim"in String.prototype,Er=function(t){var e=v(t,!1);if("string"==typeof e&&e.length>2){var n,r,i,o=(e=Ar?e.trim():vr(e,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=e.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+e}for(var s,a=e.slice(2),l=0,u=a.length;l<u;l++)if((s=a.charCodeAt(l))<48||s>i)return NaN;return parseInt(a,r)}}return+e};if(!yr(" 0o1")||!yr("0b1")||yr("+0x1")){yr=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof yr&&(Tr?c((function(){wr.valueOf.call(n)})):"Number"!=P(n))?sn(new xr(Er(e)),n,yr):Er(e)};for(var kr,Sr=f?_r(xr):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Pr=0;Sr.length>Pr;Pr++)C(xr,kr=Sr[Pr])&&!C(yr,kr)&&gr(yr,kr,mr(xr,kr));yr.prototype=wr,wr.constructor=yr,O(r,"Number",yr)}D(D.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991});var Mr=de.onFreeze;Pi("freeze",(function(t){return function(e){return t&&u(e)?t(Mr(e)):e}}));var zr={functions:{},num_functions:0,num_cached:0};function Rr(t,e){if("string"==typeof t)t=Lr(t,e);else if(null!=t&&"object"==typeof t)for(var n in t)t[n]=Rr(t[n],e);return t}function Lr(t,e){var n="string"==typeof t&&t.match(/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m);if(n&&n.length>2)try{var r=n[2],i="function"==typeof e?e(r):r,o=Wn(i);if(void 0===zr.functions[o]){var s=n[1].length>0&&n[1].split(",").map((function(t){return t.trim()})).filter((function(t){return t}));s=s.length>0?s:["context"],zr.functions[o]=new Function(s.toString(),i),zr.functions[o].source=r,zr.num_functions++}else zr.num_cached++;return zr.functions[o]}catch(e){return t}return t}var Cr=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?r(parseFloat(t)/100*255):r(parseInt(t))}function s(t){return"%"===t[t.length-1]?i(parseFloat(t)/100):i(parseFloat(t))}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in n)return n[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),u=i.indexOf(")");if(-1!==l&&u+1===i.length){var h=i.substr(0,l),c=i.substr(l+1,u-(l+1)).split(","),f=1;switch(h){case"rgba":if(4!==c.length)return null;f=s(c.pop());case"rgb":return 3!==c.length?null:[o(c[0]),o(c[1]),o(c[2]),f];case"hsla":if(4!==c.length)return null;f=s(c.pop());case"hsl":if(3!==c.length)return null;var d=(parseFloat(c[0])%360+360)%360/360,_=s(c[1]),p=s(c[2]),m=p<=.5?p*(_+1):p+_-p*_,v=2*p-m;return[r(255*a(v,m,d+1/3)),r(255*a(v,m,d)),r(255*a(v,m,d-1/3)),f];default:return null}}return null}}catch(t){}})),Or=(Cr.parseCSSColor,{}),Nr=function(t){return Math.max(t,0)},Ir=function(t){return isNaN(t)?0:t},Fr=function(t){return Array.isArray(t)?t.map(parseFloat).map(Ir):Ir(parseFloat(t))},Dr=function(t){return Array.isArray(t)?t.map(Fr).map(Nr):Nr(Fr(t))};Object.assign(Or,{clampPositive:Nr,noNaN:Ir,parseNumber:Fr,parsePositiveNumber:Dr}),Or.wrapFunction=function(t){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n        var $id = context.id;\n\n        var val = (function(){ "+t+" }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    "},Or.zeroPair=Object.freeze([0,0]),Or.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},Or.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},Or.getFeatureParseContext=function(t,e,n){return{feature:t,id:t.id,tile:e,global:n,zoom:e.style_z,geometry:li.geometryType(t.geometry.type),meters_per_pixel:e.meters_per_pixel,meters_per_pixel_sq:e.meters_per_pixel_sq,units_per_meter_overzoom:e.units_per_meter_overzoom}};var Br={STATIC:0,DYNAMIC:1,ZOOM:2};Or.CACHE_TYPE=Br,Or.createPropertyCache=function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=null),null!=t){if(t.value)return{value:t.value,zoom:t.zoom?{}:null,type:t.type};var r={value:t,type:Br.STATIC};return Array.isArray(r.value)&&Array.isArray(r.value[0])?(r.zoom={},r.type=Br.ZOOM):"function"==typeof r.value&&(r.type=Br.DYNAMIC,r.dynamic_transform="function"==typeof n?n:null),"function"==typeof e&&(r.zoom?r.value=r.value.map((function(t,n){return[t[0],e(t[1],n)]})):"function"!=typeof r.value&&(r.value=e(r.value,0))),r}},Or.createColorPropertyCache=function(t){return Or.createPropertyCache(t,(function(t){return"Style.color.pseudoRandomColor"===t?Lr(Or.wrapFunction(Or.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===t?Or.macros["Style.color.randomColor"]:t}))};var jr=function(t){return"string"==typeof t&&"%"===t[t.length-1]},Ur=function(t){return"auto"===t},Gr=function(t){return jr(t)||Ur(t)},Zr="'size' can specify either width or height as derived from aspect ratio, but not both";function Vr(t,e){return Or.createPropertyCache(t.value,(function(n,r){return Array.isArray(n)?(n=n.map((function(e,n){return t.has_ratio[r][n]?e:Dr(e)})).map((function(n,i){return t.has_pct[r][i]?e.css_size[i]*n/100:n})),t.has_ratio[r][0]?n[0]=n[1]*e.aspect:t.has_ratio[r][1]&&(n[1]=n[0]/e.aspect)):(n=Dr(n),n=t.has_pct[r]?e.css_size.map((function(t){return t*n/100})):[n,n]),n}))}function qr(t,e){try{return t(e)}catch(n){Ji("warn","Property function in layer '"+e.layers[e.layers.length-1]+"' failed with\n","error "+n.stack+"\n","function '"+t.source+"'\n",e.feature,e)}}Or.createPointSizePropertyCache=function(t,e){var n=null,r=null;if(jr(t))n=[!0];else if(Array.isArray(t)){if(Array.isArray(t[0])){if(t.some((function(t){return Array.isArray(t[1])?t[1].some((function(t){return Gr(t)})):jr(t[1])}))&&(n=t.map((function(t){return Array.isArray(t[1])?t[1].map((function(t){return jr(t)})):jr(t[1])})),(r=t.map((function(t){return Array.isArray(t[1])&&t[1].map((function(t){return Ur(t)}))}))).some((function(t){return Array.isArray(t)&&t.every((function(t){return t}))}))))throw Zr}else if(t.some(Gr)&&(n=[t.map(jr)],(r=[t.map(Ur)])[0].every((function(t){return t}))))throw Zr}else if(Ur(t))throw"this value only allowed as half of an array, eg [16px, auto]:";if(n||r){if(!e)throw"% or 'auto' keywords can only be used to specify point size when a texture is defined";(t={value:t}).has_pct=n,t.has_ratio=r,t.sprites={}}else t=Or.createPropertyCache(t,Dr);return t},Or.evalCachedPointSizeProperty=function(t,e,n,r){if(null!=t)return t.has_pct||t.has_ratio?e?(t.sprites[e.sprite]||(t.sprites[e.sprite]=Vr(t,e)),Or.evalCachedProperty(t.sprites[e.sprite],r)):(t.texture=t.texture||Vr(t,n),Or.evalCachedProperty(t.texture,r)):Or.evalCachedProperty(t,r)},Or.evalCachedProperty=function(t,e){return null==t?void 0:t.dynamic?qr(t.dynamic,e):t.static?t.static:t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"==typeof t.value?(t.dynamic_transform?t.dynamic=function(e){return t.dynamic_transform(t.value(e))}:t.dynamic=t.value,qr(t.dynamic,e)):Array.isArray(t.value)&&Array.isArray(t.value[0])?(t.zoom=t.zoom||{},t.zoom[e.zoom]=en.interpolate(e.zoom,t.value),t.zoom[e.zoom]):(t.static=t.value,t.static)},Or.convertUnits=function(t,e){if(null!=t.value)return"px"===t.units?t.value*li.metersPerPixel(e.zoom):t.value;if("string"==typeof t)"px"===t.trim().slice(-2)?(t=Fr(t),t*=li.metersPerPixel(e.zoom)):t=Fr(t);else if(Array.isArray(t))return Array.isArray(t[0])?t.map((function(t){return[t[0],Or.convertUnits(t[1],e)]})):t.map((function(t){return Or.convertUnits(t,e)}));return t},Or.parseUnits=function(t){var e={value:Fr(t)};return 0!==e.value&&"string"==typeof t&&"px"===t.trim().slice(-2)&&(e.units="px"),e},Or.evalCachedDistanceProperty=function(t,e){return null==t?void 0:t.dynamic?qr(t.dynamic,e):t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"==typeof t.value?(t.dynamic=t.value,qr(t.dynamic,e)):t.zoom?(t.zoom[e.zoom]=en.interpolate(e.zoom,t.value,(function(t){return Or.convertUnits(t,e)})),t.zoom[e.zoom]):Or.convertUnits(t.value,e)},Or.string_colors={},Or.colorForString=function(t){if(Or.string_colors[t])return Or.string_colors[t];var e=Cr.parseCSSColor(t);return e&&4===e.length?(e[0]/=255,e[1]/=255,e[2]/=255):e=Or.defaults.color,Or.string_colors[t]=e,e},Or.evalCachedColorProperty=function(t,e){if(void 0===e&&(e={}),null!=t){if(t.dynamic){var n=qr(t.dynamic,e);return"string"==typeof n&&(n=Or.colorForString(n)),n&&null==n[3]&&(n[3]=1),n}if(t.static)return t.static;if(t.zoom&&t.zoom[e.zoom])return t.zoom[e.zoom];if("function"==typeof t.value){t.dynamic=t.value;var r=qr(t.dynamic,e);return"string"==typeof r&&(r=Or.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if("string"==typeof t.value)return t.static=Or.colorForString(t.value),t.static;if(t.zoom){if(!t.zoom_preprocessed){for(var i=0;i<t.value.length;i++){var o=t.value[i];o&&"string"==typeof o[1]&&(o[1]=Or.colorForString(o[1]))}t.zoom_preprocessed=!0}return t.zoom[e.zoom]=en.interpolate(e.zoom,t.value),t.zoom[e.zoom][3]=t.zoom[e.zoom][3]||1,t.zoom[e.zoom]}return t.static=t.value.map((function(t){return t})),t.static&&null==t.static[3]&&(t.static[3]=1),t.static}},Or.evalCachedColorPropertyWithAlpha=function(t,e,n){var r=Or.evalCachedColorProperty(t,n);if(null!=r&&null!=e){var i=Or.evalCachedProperty(e,n);if(null!=i)return[r[0],r[1],r[2],i]}return r},Or.parseColor=function(t,e){if(void 0===e&&(e={}),"function"==typeof t&&(t=qr(t,e)),"string"==typeof t)t=Or.colorForString(t);else if(Array.isArray(t)&&Array.isArray(t[0])){for(var n=0;n<t.length;n++){var r=t[n];"string"==typeof r[1]&&(r[1]=Or.colorForString(r[1]))}e.zoom&&(t=en.interpolate(e.zoom,t))}return Array.isArray(t)?null==(t=t.map((function(t){return t})))[3]&&(t[3]=1):t=[0,0,0,1],t},Or.calculateOrder=function(t,e){return"function"==typeof t?t=qr(t,e):"string"==typeof t&&(t=e.feature.properties[t]?e.feature.properties[t]:Dr(t)),t},Or.evalProperty=function(t,e){return"function"==typeof t?qr(t,e):t},D(D.P,"Array",{fill:Nn}),A("fill");var Wr,Hr=function(){function t(t,e,n){this.gl=t,this.workers=e,this._lock_fn="function"==typeof n&&n,this.init()}var e=t.prototype;return e.init=function(){this.requests={},this.feature=null,this.read_delay=0,this.read_delay_timer=null,this.pixels=null,this.fbo=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.fbo_size={width:256,height:256};var t=Gn.create(this.gl,"__selection_fbo",{filtering:"nearest"});t.setData(this.fbo_size.width,this.fbo_size.height,null,{filtering:"nearest"}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t.texture,0);var e=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.fbo_size.width,this.fbo_size.height),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,e),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.destroy=function(){this.gl&&this.fbo&&(this.gl.deleteFramebuffer(this.fbo),this.fbo=null,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))},e.bind=function(){var e;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.fbo_size.width,this.fbo_size.height),(e=this.gl).clearColor.apply(e,t.defaultColor)},e.getFeatureAt=function(t,e){var n=this,r=e.radius;return!t||t.x<0||t.y<0||t.x>1||t.y>1?Promise.resolve({feature:null,changed:!1}):new Promise((function(e,i){n.selection_request_id=n.selection_request_id+1||0,n.requests[n.selection_request_id]={id:n.selection_request_id,point:t,radius:r,resolve:e,reject:i}}))},e.pendingRequests=function(){return Object.keys(this.requests).length?this.requests:null},e.hasPendingRequests=function(){return null!=this.pendingRequests()},e.clearPendingRequests=function(){for(var t in this.requests){var e=this.requests[t];e.sent||(e.reject({request:e}),delete this.requests[t])}},e.read=function(){var t=this;null!=this.read_delay_timer&&clearTimeout(this.read_delay_timer),this.read_delay_timer=setTimeout((function(){if(!t.locked){var e=t.gl;for(var n in e.bindFramebuffer(e.FRAMEBUFFER,t.fbo),t.requests){var r=t.requests[n];if(!r.sent){var i=void 0,o=255,s=r.point,a=r.radius,l=void 0;if(a){var u=Math.min(t.fbo_size.width,t.fbo_size.height);l={x:Math.min(Math.ceil(2*a.x*t.fbo_size.width),u),y:Math.min(Math.ceil(2*a.y*t.fbo_size.height),u)}}else a={x:0,y:0},l={x:1,y:1};if((null==t.pixels||t.pixels.byteLength<l.x*l.y*4)&&(t.pixels=new Uint8Array(l.x*l.y*4)),t.pixels.fill instanceof Function)t.pixels.fill(0);else for(var h=0;h<t.pixels.length;h++)t.pixels[h]=0;e.readPixels(Math.round((s.x-a.x)*t.fbo_size.width),Math.round((1-s.y-a.y)*t.fbo_size.height),l.x,l.y,e.RGBA,e.UNSIGNED_BYTE,t.pixels);var c=4*(Math.round(l.y/2)*l.x+Math.round(l.x/2)),f=t.pixels[c]+(t.pixels[c+1]<<8)+(t.pixels[c+2]<<16);if(f>0)i=f+(t.pixels[c+3]<<24)>>>0,o=t.pixels[c+3];else{var d=-1>>>0;c=0;for(var _=0;_<l.y;_++)for(var p=0;p<l.x;p++,c+=4)if((f=t.pixels[c]+(t.pixels[c+1]<<8)+(t.pixels[c+2]<<16))>0){var m=(p-l.x/2)*(p-l.x/2)+(_-l.y/2)*(_-l.y/2);m<=d&&(i=f+(t.pixels[c+3]<<24)>>>0,o=t.pixels[c+3],d=m)}}255!==o?null!=t.workers[o]&&Zi.postMessage(t.workers[o],"self.getFeatureSelection",{id:r.id,key:i}).then((function(e){t.finishRead(e)})):t.finishRead({id:r.id}),r.sent=!0}}e.bindFramebuffer(e.FRAMEBUFFER,null)}}),this.read_delay)},e.finishRead=function(t){var e=this.requests[t.id];if(e){var n=t.feature,r=!1;(null!=n&&null==this.feature||null==n&&null!=this.feature||null!=n&&null!=this.feature&&JSON.stringify(n)!==JSON.stringify(this.feature))&&(r=!0),this.feature=n,e.resolve({feature:n,changed:r,request:e}),delete this.requests[t.id]}else Ji("error","FeatureSelection.finishRead(): could not find message",t)},t.makeEntry=function(t){this.map_entry++;var e=255&this.map_entry,n=this.map_entry>>8&255,r=this.map_entry>>16&255,i=this.map_prefix,o=e/255,s=n/255,a=r/255,l=i/255,u=e+(n<<8)+(r<<16)+(i<<24)>>>0;return this.map[u]={color:[o,s,a,l]},this.map_size++,this.tiles[t.key]||(this.tiles[t.key]={entries:[],tile:{key:t.key,coords:t.coords,style_z:t.style_z,source:t.source,generation:t.generation}}),this.tiles[t.key].entries.push(u),this.map[u]},t.makeColor=function(t,e,n){var r=this.makeEntry(e);return r.feature={id:t.id,properties:t.properties,source_name:n.source,source_layer:n.layer,layers:n.layers,tile:this.tiles[e.key].tile},r.color},t.reset=function(t){var e=this;Array.isArray(t)?t.forEach((function(t){return e.clearSource(t)})):(this.tiles={},this.map={},this.map_size=0,this.map_entry=0)},t.clearSource=function(t){for(var e in this.tiles)this.tiles[e].tile.source===t&&this.clearTile(e)},t.clearTile=function(t){var e=this;this.tiles[t]&&(this.tiles[t].entries.forEach((function(t){return delete e.map[t]})),this.map_size-=this.tiles[t].entries.length,delete this.tiles[t])},t.getMapSize=function(){return this.map_size},t.setPrefix=function(t){this.map_prefix=t},zi(t,[{key:"locked",get:function(){return this._lock_fn&&this._lock_fn()||!1}}]),t}();Hr.map={},Hr.tiles={},Hr.map_size=0,Hr.map_entry=0,Hr.map_prefix=0,Hr.defaultColor=[0,0,0,1];var Yr=Wr={};Wr.BYTE=5120,Wr.UNSIGNED_BYTE=5121,Wr.SHORT=5122,Wr.UNSIGNED_SHORT=5123,Wr.INT=5124,Wr.UNSIGNED_INT=5125,Wr.FLOAT=5126,Un("Uint16",2,(function(t){return function(e,n,r){return t(this,e,n,r)}}));var Xr,$r=function(){function t(t,e,n,r,i){i=i||{},this.gl=t,this.vertex_data=e,this.element_data=n,this.vertex_layout=r,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=i.draw_mode||this.gl.TRIANGLES,this.data_usage=i.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=i.uniforms,this.textures=i.textures,this.retain=i.retain||!1,this.created_at=+new Date,this.fade_in_time=i.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}var e=t.prototype;return e.render=function(t){if(void 0===t&&(t={}),!this.valid)return!1;var e=t.program||Xn.current;e.use(),this.uniforms&&(e.saveUniforms(this.uniforms),e.setUniforms(this.uniforms,!1));var n=(+new Date-this.created_at)/1e3;return e.uniform("1f","u_visible_time",n),this.bind(e),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),$n.bind(this.gl,null),this.uniforms&&e.restoreUniforms(this.uniforms),n<this.fade_in_time},e.bind=function(t){var e=this,n=this.vaos[t.id];n?$n.bind(this.gl,n):this.vaos[t.id]=$n.create(this.gl,(function(){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,e.vertex_buffer),e.toggle_element_array&&e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,e.element_buffer),e.vertex_layout.enableDynamicAttributes(e.gl,t)})),this.vertex_layout.enableStaticAttributes(this.gl,t)},e.upload=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)},e.destroy=function(){if(!this.valid)return!1;for(var t in this.valid=!1,this.vaos)$n.destroy(this.gl,this.vaos[t]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach((function(t){return Gn.release(t)})),!0},t}(),Jr=["emission","ambient","diffuse","specular"],Kr=function(){function t(t){var e=this;t=t||{},Jr.forEach((function(n){var r=t[n];null!=r&&(r.texture?e[n]={texture:r.texture,mapping:r.mapping||"spheremap",scale:Zn.expandVec3(null!=r.scale?r.scale:1),amount:Zn.expandVec4(null!=r.amount?r.amount:1)}:"number"==typeof r||Array.isArray(r)?e[n]={amount:Zn.expandVec4(r)}:e[n]="string"==typeof r?{amount:Or.parseColor(r)}:r)})),this.specular&&(this.specular.shininess=t.shininess?parseFloat(t.shininess):.2),null!=t.normal&&(this.normal={texture:t.normal.texture,mapping:t.normal.mapping||"triplanar",scale:Zn.expandVec3(null!=t.normal.scale?t.normal.scale:1),amount:null!=t.normal.amount?t.normal.amount:1})}t.isValid=function(t){return null!=t&&(null!=t.emission||null!=t.ambient||null!=t.diffuse||null!=t.specular)};var e=t.prototype;return e.inject=function(e){var n=this;Jr.forEach((function(t){var r="TANGRAM_MATERIAL_"+t.toUpperCase(),i=r+"_TEXTURE";e.defines[r]=null!=n[t],n[t]&&n[t].texture&&(e.defines[i]=!0,e.defines[i+"_"+n[t].mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_"+n[t].mapping.toUpperCase()]=!0,e.texcoords=e.texcoords||"uv"===n[t].mapping)})),this.normal&&this.normal.texture&&(e.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,e.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,e.texcoords=e.texcoords||"uv"===this.normal.mapping),e.replaceShaderBlock(t.block,"/*\n\nDefines globals:\nmaterial\nlight_accumulator_*\n\n*/\n\n\n// MATERIALS\n//\nstruct Material {\n    #ifdef TANGRAM_MATERIAL_EMISSION\n        vec4 emission;\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n            vec3 emissionScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_AMBIENT\n        vec4 ambient;\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n            vec3 ambientScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        vec4 diffuse;\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n            vec3 diffuseScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        vec4 specular;\n        float shininess;\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n            vec3 specularScale;\n        #endif\n    #endif\n\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\n        vec3 normalScale;\n        float normalAmount;\n    #endif\n};\n\n// Note: uniform is copied to a global instance to allow modification\nuniform Material u_material;\nMaterial material;\n\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\n\n// Global light accumulators for each property\nvec4 light_accumulator_ambient = vec4(vec3(0.0), 1.);\nvec4 light_accumulator_diffuse = vec4(vec3(0.0), 1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\n    vec4 light_accumulator_specular = vec4(vec3(0.0), 1.);\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap (in sampler2D _tex, in vec3 _eyeToPoint, in vec3 _normal, in vec2 _skew) {\n    // Normalized vector from camera to surface\n    vec3 eye = normalize(_eyeToPoint);\n\n    // Adjust for camera skew\n    eye.xy -= _skew;\n    eye = normalize(eye);\n\n    // Reflection of eye off of surface normal\n    vec3 r = reflect(eye, _normal);\n\n    // Map reflected vector onto the surface of a sphere\n    r.z += 1.0;\n    float m = 2. * length(r);\n\n    // Adjust xy to account for spherical shape, and center in middle of texture\n    vec2 uv = r.xy / m + .5;\n\n    // Sample the environment map\n    return texture2D(_tex, uv);\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend (in vec3 _normal) {\n    vec3 blending = abs(_normal);\n    blending = normalize(max(blending, 0.00001));\n    float b = (blending.x + blending.y + blending.z);\n    return blending / b;\n}\n\nvec4 getTriPlanar (in sampler2D _tex, in vec3 _pos, in vec3 _normal, in vec3 _scale) {\n    vec3 blending = getTriPlanarBlend(_normal);\n    vec4 xaxis = texture2D(_tex, fract(_pos.yz * _scale.x));\n    vec4 yaxis = texture2D(_tex, fract(_pos.xz * _scale.y));\n    vec4 zaxis = texture2D(_tex, fract(_pos.xy * _scale.z));\n    return  xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar (in sampler2D _tex, in vec3 _pos, in vec2 _scale) {\n    return texture2D( _tex, fract(_pos.xy * _scale.x) );\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal (inout vec3 _normal) {\n    // Get NORMALMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n    _normal += texture2D(u_material_normal_texture, fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\n    vec3 normalTex = getPlanar(u_material_normal_texture, v_world_position.xyz, material.normalScale.xy).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\n    vec3 normalTex = getTriPlanar(u_material_normal_texture, v_world_position.xyz, _normal, material.normalScale).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    _normal = normalize(_normal);\n}\n#endif\n\nvoid calculateMaterial (in vec3 _eyeToPoint, inout vec3 _normal) {\n    // get EMISSION TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\n        material.emission *= texture2D(u_material_emission_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\n        material.emission *= getPlanar(u_material_emission_texture, v_world_position.xyz, material.emissionScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\n        material.emission *= getTriPlanar(u_material_emission_texture, v_world_position.xyz, _normal, material.emissionScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\n        material.emission *= getSphereMap(u_material_emission_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get AMBIENT TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\n        material.ambient *= texture2D(u_material_ambient_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\n        material.ambient *= getPlanar(u_material_ambient_texture, v_world_position.xyz, material.ambientScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\n        material.ambient *= getTriPlanar(u_material_ambient_texture, v_world_position.xyz, _normal, material.ambientScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\n        material.ambient *= getSphereMap(u_material_ambient_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get DIFFUSE TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\n        material.diffuse *= texture2D(u_material_diffuse_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\n        material.diffuse *= getPlanar(u_material_diffuse_texture, v_world_position.xyz, material.diffuseScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\n        material.diffuse *= getTriPlanar(u_material_diffuse_texture, v_world_position.xyz, _normal, material.diffuseScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\n        material.diffuse *= getSphereMap(u_material_diffuse_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get SPECULAR TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\n        material.specular *= texture2D(u_material_specular_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\n        material.specular *= getPlanar(u_material_specular_texture, v_world_position.xyz, material.specularScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\n        material.specular *= getTriPlanar(u_material_specular_texture, v_world_position.xyz, _normal, material.specularScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\n        material.specular *= getSphereMap(u_material_specular_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n}\n","Material"),e.addShaderBlock("setup","\nmaterial = u_material;\n","Material")},e.setupProgram=function(t){var e=this;Jr.forEach((function(n){e[n]&&(e[n].texture?(t.setTextureUniform("u_material_"+n+"_texture",e[n].texture),t.uniform("3fv","u_material."+n+"Scale",e[n].scale),t.uniform("4fv","u_material."+n,e[n].amount)):e[n].amount&&t.uniform("4fv","u_material."+n,e[n].amount))})),this.specular&&t.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(t.setTextureUniform("u_material_normal_texture",this.normal.texture),t.uniform("3fv","u_material.normalScale",this.normal.scale),t.uniform("1f","u_material.normalAmount",this.normal.amount))},t}();Kr.block="material";var Qr=Xr={};Xr.copy=function(t){for(var e=[],n=t.length,r=0;r<n;r++)e[r]=t[r];return e},Xr.neg=function(t){for(var e=[],n=t.length,r=0;r<n;r++)e[r]=-t[r];return e},Xr.add=function(t,e){for(var n=[],r=Math.min(t.length,e.length),i=0;i<r;i++)n[i]=t[i]+e[i];return n},Xr.sub=function(t,e){for(var n=[],r=Math.min(t.length,e.length),i=0;i<r;i++)n[i]=t[i]-e[i];return n},Xr.signed_area=function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])},Xr.mult=function(t,e){var n,r=[],i=t.length;if("number"==typeof e)for(n=0;n<i;n++)r[n]=t[n]*e;else for(i=Math.min(t.length,e.length),n=0;n<i;n++)r[n]=t[n]*e[n];return r},Xr.div=function(t,e){var n,r=[];if("number"==typeof e)for(n=0;n<t.length;n++)r[n]=t[n]/e;else{var i=Math.min(t.length,e.length);for(n=0;n<i;n++)r[n]=t[n]/e[n]}return r},Xr.perp=function(t,e){return[e[1]-t[1],t[0]-e[0]]},Xr.rot=function(t,e){var n=Math.cos(e),r=Math.sin(e);return[t[0]*n-t[1]*r,t[0]*r+t[1]*n]},Xr.angle=function(t){var e=t[0],n=t[1];return Math.atan2(n,e)},Xr.angleBetween=function(t,e){var n=Xr.dot(Xr.normalize(Xr.copy(t)),Xr.normalize(Xr.copy(e)));return n>1&&(n=1),Math.acos(n)},Xr.isEqual=function(t,e){for(var n=t.length,r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0},Xr.lengthSq=function(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t.length>=3?t[0]*t[0]+t[1]*t[1]+t[2]*t[2]:0},Xr.length=function(t){return Math.sqrt(Xr.lengthSq(t))},Xr.normalize=function(t){var e;if(2===t.length){if(1==(e=t[0]*t[0]+t[1]*t[1]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e):(t[0]=0,t[1]=0)}else if(t.length>=3){if(1==(e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e,t[2]/=e):(t[0]=0,t[1]=0,t[2]=0)}return t},Xr.cross=function(t,e){return 2===t.length?t[0]*e[1]-t[1]*e[0]:3===t.length?[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]:void 0},Xr.dot=function(t,e){for(var n=0,r=Math.min(t.length,e.length),i=0;i<r;i++)n+=t[i]*e[i];return n};var to=function(){function t(t,e){this.name=e.name,this.view=t,null==e.ambient||"number"==typeof e.ambient?this.ambient=Zn.expandVec3(e.ambient||0):this.ambient=Or.parseColor(e.ambient).slice(0,3),null==e.diffuse||"number"==typeof e.diffuse?this.diffuse=Zn.expandVec3(null!=e.diffuse?e.diffuse:1):this.diffuse=Or.parseColor(e.diffuse).slice(0,3),null==e.specular||"number"==typeof e.specular?this.specular=Zn.expandVec3(e.specular||0):this.specular=Or.parseColor(e.specular).slice(0,3)}t.create=function(e,n){if(t.types[n.type])return new t.types[n.type](e,n)},t.setMode=function(e,n){!0===e&&(e="fragment"),e=t.enabled&&(null!=e?e:"fragment"),n.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===e,n.defines.TANGRAM_LIGHTING_VERTEX="vertex"===e},t.inject=function(e){if(Xn.removeBlock(t.block),t.enabled){var n="";if(e&&Object.keys(e).length>0){var r={};for(var i in e)r[e[i].type]=!0;for(var o in r)t.types[o].inject();for(var s in e)e[s].inject(),n+="calculateLight("+s+", _eyeToPoint, _normal);\n"}var a="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                "+n+"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }";Xn.addBlock(t.block,a)}};var e=t.prototype;return e.inject=function(){var e="\n            uniform "+this.struct_name+" u_"+this.name+";\n            "+this.struct_name+" "+this.name+";\n            ",n="\n            "+this.name+" = u_"+this.name+";\n\n        ";Xn.addBlock(t.block,e),Xn.addBlock("setup",n)},e.update=function(){},e.setupProgram=function(t){t.uniform("3fv","u_"+this.name+".ambient",this.ambient),t.uniform("3fv","u_"+this.name+".diffuse",this.diffuse),t.uniform("3fv","u_"+this.name+".specular",this.specular)},t}();to.types={},to.block="lighting",to.enabled=!0;var eo=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="ambient",r.struct_name="AmbientLight",r}return Ri(e,t),e.inject=function(){Xn.addBlock(to.block,"/*\n\nExpected globals:\nlight_accumulator_*\n\n*/\n\nstruct AmbientLight {\n    vec3 ambient;\n};\n\nvoid calculateLight(in AmbientLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n    light_accumulator_ambient.rgb += _light.ambient;\n}\n")},e.prototype.setupProgram=function(t){t.uniform("3fv","u_"+this.name+".ambient",this.ambient)},e}(to);to.types.ambient=eo;var io=function(t){function e(e,n){var r;if((r=t.call(this,e,n)||this).type="directional",r.struct_name="DirectionalLight",n.direction)r._direction=n.direction;else{var i=Math.sin(60*Math.PI/180);r._direction=[Math.cos(135*Math.PI/180)*i,Math.sin(135*Math.PI/180)*i,-.5],null==n.ambient&&(r.ambient=Zn.expandVec3(.5))}return r.direction=r._direction.map(parseFloat),r}return Ri(e,t),e.inject=function(){Xn.addBlock(to.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct DirectionalLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec3 direction;\n};\n\nvoid calculateLight(in DirectionalLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    light_accumulator_ambient.rgb += _light.ambient;\n\n    float nDotVP = clamp(dot(_normal, -_light.direction), 0.0, 1.0);\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(_light.direction, _normal);\n            float eyeDotR = max(dot(normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf;\n    #endif\n}\n")},e.prototype.setupProgram=function(e){t.prototype.setupProgram.call(this,e),e.uniform("3fv","u_"+this.name+".direction",this.direction)},zi(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=Qr.normalize(Qr.copy(t))}}]),e}(to);to.types.directional=io;var no=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="point",r.struct_name="PointLight",r.position=n.position||[0,0,"100px"],r.position_eye=[],r.origin=n.origin||"ground",r.attenuation=isNaN(parseFloat(n.attenuation))?0:parseFloat(n.attenuation),n.radius?Array.isArray(n.radius)&&2===n.radius.length?r.radius=n.radius:r.radius=[null,n.radius]:r.radius=null,r}Ri(e,t),e.inject=function(){Xn.addBlock(to.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct PointLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n};\n\nvoid calculateLight(in PointLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // Normalize the vector from surface to light position\n    float nDotVP = clamp(dot(VP, _normal), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // Computer accumulators\n    light_accumulator_ambient.rgb += _light.ambient * attenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0; // power factor for shiny speculars\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(0.0, dot(-normalize(_eyeToPoint), reflectVector));\n            pf = pow(eyeDotR, material.shininess);\n        }\n\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation;\n    #endif\n}\n")};var n=e.prototype;return n.inject=function(){t.prototype.inject.call(this),Xn.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,Xn.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],Xn.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius},n.update=function(){this.updateEyePosition()},n.updateEyePosition=function(){if("world"===this.origin){var t=li.latLngToMeters([].concat(this.position));this.position_eye[0]=t[0]-this.view.camera.position_meters[0],this.position_eye[1]=t[1]-this.view.camera.position_meters[1],this.position_eye[2]=Or.convertUnits(this.position[2],{zoom:this.view.zoom,meters_per_pixel:li.metersPerPixel(this.view.zoom)}),this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]}else"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=Or.convertUnits(this.position,{zoom:this.view.zoom,meters_per_pixel:li.metersPerPixel(this.view.zoom)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]));this.position_eye[3]=1},n.setupProgram=function(e){t.prototype.setupProgram.call(this,e),e.uniform("4fv","u_"+this.name+".position",this.position_eye),Xn.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&e.uniform("1f","u_"+this.name+".attenuationExponent",this.attenuation),Xn.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&e.uniform("1f","u_"+this.name+".innerRadius",Or.convertUnits(this.radius[0],{zoom:this.view.zoom,meters_per_pixel:li.metersPerPixel(this.view.zoom)})),Xn.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&e.uniform("1f","u_"+this.name+".outerRadius",Or.convertUnits(this.radius[1],{zoom:this.view.zoom,meters_per_pixel:li.metersPerPixel(this.view.zoom)}))},e}(to);to.types.point=no;var ro=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="spotlight",r.struct_name="SpotLight",r.direction=r._direction=(n.direction||[0,0,-1]).map(parseFloat),r.exponent=n.exponent?parseFloat(n.exponent):.2,r.angle=n.angle?parseFloat(n.angle):20,r}return Ri(e,t),e.inject=function(){Xn.addBlock(to.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct SpotLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n\n    vec3 direction;\n    float spotCosCutoff;\n    float spotExponent;\n};\n\nvoid calculateLight(in SpotLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // normal . light direction\n    float nDotVP = clamp(dot(_normal, VP), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // spotlight attenuation factor\n    float spotAttenuation = 0.0;\n\n    // See if point on surface is inside cone of illumination\n    float spotDot = clamp(dot(-VP, _light.direction), 0.0, 1.0);\n\n    if (spotDot >= _light.spotCosCutoff) {\n        spotAttenuation = pow(spotDot, _light.spotExponent);\n    }\n\n    light_accumulator_ambient.rgb += _light.ambient * attenuation * spotAttenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation * spotAttenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        // Power factor for shiny speculars\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(dot(-normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation * spotAttenuation;\n    #endif\n}\n")},e.prototype.setupProgram=function(e){t.prototype.setupProgram.call(this,e),e.uniform("3fv","u_"+this.name+".direction",this.direction),e.uniform("1f","u_"+this.name+".spotCosCutoff",Math.cos(3.14159*this.angle/180)),e.uniform("1f","u_"+this.name+".spotExponent",this.exponent)},zi(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=Qr.normalize(Qr.copy(t))}}]),e}(no);to.types.spotlight=ro,D(D.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}});var oo=function(t){function e(e){var n;return(n=t.call(this)||this).name="MethodNotImplemented",n.message="Method "+e+" must be implemented in subclass",n}return Ri(e,t),e}(Ni(Error)),so=function(){function t(t,e){var n=this;this.validate(t),this.config=t,this.sources=e,this.id=t.id,this.name=t.name,this.pad_scale=t.pad_scale||1e-5,this.default_winding=null,this.rasters=[],Array.isArray(t.rasters)&&t.rasters.forEach((function(t){-1===n.rasters.indexOf(t)&&n.rasters.push(t)})),this.preprocess=t.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=t.transform,"function"==typeof this.transform&&this.transform.bind(this),this.extra_data=t.extra_data,this.scripts=t.scripts,this.setZooms(t),this.zoom_offset=null!=t.zoom_offset?t.zoom_offset:0,this.zoom_offset<0&&(Ji({level:"warn",once:!0},"Data source '"+this.name+"' zoom_offset must not be negative – setting to 0."),this.zoom_offset=0),this.setTileSize(t.tile_size),this.min_display_zoom=Math.max(t.min_display_zoom||0,this.zooms[0]),this.max_display_zoom=null!=t.max_display_zoom?t.max_display_zoom:null}t.register=function(e,n){e&&n&&(t.types[e]=n)},t.create=function(e,n){if("function"==typeof t.types[e.type]){var r=t.types[e.type](e);if(r)return new r(e,n)}},t.tileLayoutChanged=function(t,e){if(!t||!e)return!0;var n=["max_zoom","zooms","min_display_zoom","max_display_zoom","bounds","tile_size","zoom_offset"],r=En(t.config,n),i=En(e.config,n);return JSON.stringify(r)!==JSON.stringify(i)},t.projectData=function(t){var e=+new Date;for(var n in t.layers)for(var r=t.layers[n].features.length,i=0;i<r;i++){var o=t.layers[n].features[i];li.transformGeometry(o.geometry,this.projectCoord)}void 0!==t.debug&&(t.debug.projection=+new Date-e)},t.projectCoord=function(t){li.latLngToMeters(t)},t.scaleData=function(t,e){var n=e.coords.z,r=e.min,i=li.unitsPerMeter(n);for(var o in t.layers)for(var s=t.layers[o].features.length,a=0;a<s;a++){var l=t.layers[o].features[a];li.transformGeometry(l.geometry,(function(t){t[0]=(t[0]-r.x)*i,t[1]=(t[1]-r.y)*i*-1}))}};var e=t.prototype;return e.load=function(t){var e=this;return t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=[].concat(this.rasters),this._load(t).then((function(t){for(var n in t.source_data.layers){var r=t.source_data.layers[n];r&&r.features&&r.features.forEach((function(t){li.transformGeometry(t.geometry,(function(t){t[1]=-t[1],e.pad_scale&&(t[0]=Math.round(t[0]*(1+e.pad_scale)-li.tile_scale*e.pad_scale/2),t[1]=Math.round(t[1]*(1+e.pad_scale)-li.tile_scale*e.pad_scale/2))})),e.updateDefaultWinding(t.geometry)}))}return t.default_winding=e.default_winding||"CCW",t}))},e._load=function(){throw new oo("_load")},e.copyTileData=function(t,e){return Ji("trace","Copy tile data from "+t.key+" to "+e.key),e.source_data={layers:t.source_data.layers},e.rasters=[].concat(t.rasters),e.pad_scale=t.pad_scale,e.default_winding=t.default_winding,e},e.setZooms=function(t){var e=t.max_zoom,n=t.zooms;if(this.max_zoom=null!=e?e:li.default_source_max_zoom,Array.isArray(n))this.zooms=n,this.max_zoom=this.zooms[this.zooms.length-1];else{this.zooms=[];for(var r=0;r<=this.max_zoom;r++)this.zooms[r]=r}},e.setTileSize=function(t){this.tile_size=t||256,("number"!=typeof this.tile_size||this.tile_size<256||!en.isPowerOf2(this.tile_size))&&(Ji({level:"warn",once:!0},"Data source '"+this.name+"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '"+t+"'"),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8+this.zoom_offset},e.updateDefaultWinding=function(t){return null==this.default_winding&&("Polygon"===t.type?this.default_winding=li.ringWinding(t.coordinates[0]):"MultiPolygon"===t.type&&(this.default_winding=li.ringWinding(t.coordinates[0][0]))),this.default_winding},e.includesTile=function(t,e){if(t.z<this.min_display_zoom||null!=this.max_display_zoom&&e>this.max_display_zoom)return!1;for(var n=0;n<this.rasters.length;n++){var r=this.rasters[n];if(this.sources[r]&&this.sources[r]!==this&&!this.sources[r].includesTile(t,t.z))return!1}return!0},e.validate=function(){},t}();so.types={};var ao=0,lo=function(t){function e(e,n){var r;(r=t.call(this,e,n)||this).response_type="";var i=function(t,e){if(!e||0===Object.keys(e).length)return[t,[]];var n=t.indexOf("?"),r=t.indexOf("#"),i="";r>-1&&(i=t.slice(r),t=t.slice(0,r)),-1===n&&(n=t.length,t+="?"),n++;var o="",s=[];for(var a in e)""===wn(a,t)?o+=a+"="+e[a]+"&":s.push([a,e[a]]);return[t=t.slice(0,n)+o+t.slice(n)+i,s]}(e.url,e.url_params),o=i[0],s=i[1];return r.url=o,s.forEach((function(t){var n=t[0],i=t[1];Ji({level:"warn",once:!0},"Data source '"+r.name+"': parameter '"+n+"' already present in URL '"+e.url+"', skipping value '"+n+"="+i+"' specified in 'url_params'")})),e.request_headers&&"object"==typeof e.request_headers&&(r.request_headers=e.request_headers),r}Ri(e,t);var n=e.prototype;return n._load=function(t){var e=this,n=this.formatURL(this.url,t),r=t.source_data;return r.url=n,t.debug=t.debug||{},t.debug.network=+new Date,new Promise((function(i){var o=ao+++"-"+n,s=en.io(n,6e4,e.response_type,"GET",e.request_headers,o);r.request_id=o,r.error=null,s.then((function(n){var o=n.body;t.debug.response_size=o&&(o.length||o.byteLength),t.debug.network=+new Date-t.debug.network,t.debug.parsing=+new Date,null!=o&&"function"==typeof e.preprocess&&(o=e.preprocess(o)),(o=o instanceof Promise?o:Promise.resolve(o)).then((function(n){null!=n?e.parseSourceData(t,r,n):r.layers={},t.debug.parsing=+new Date-t.debug.parsing,i(t)}))})).catch((function(e){r.error=e.stack,i(t)}))}))},n.validate=function(t){if("string"!=typeof t.url)throw Error("Network data source must provide a string `url` property")},n.formatURL=function(){throw new oo("formatURL")},n.parseSourceData=function(){throw new oo("parseSourceData")},e}(so),uo=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).tiled=!0,r.bounds=r.parseBounds(e),r.builds_geometry_tiles=!1,r.tms=!0===e.tms,r.url&&r.url.search("{s}")>-1&&(Array.isArray(e.url_subdomains)&&e.url_subdomains.length>0?(r.url_subdomains=e.url_subdomains,r.next_url_subdomain=0):Ji({level:"warn",once:!0},"Data source '"+r.name+"': source URL includes '{s}' subdomain marker ('"+r.url+"'), but no subdomains were specified in 'url_subdomains' parameter")),r.url&&r.url.search("{r}")>-1&&(Array.isArray(e.url_density_scales)&&e.url_density_scales.length>0?r.url_density_scales=e.url_density_scales:r.url_density_scales=[1,2]),r}Ri(e,t);var n=e.prototype;return n.parseBounds=function(t){if(Array.isArray(t.bounds)&&4===t.bounds.length){var e=t.bounds,n=e[0],r=e[1],i=e[2],o=e[3];return{latlng:[].concat(t.bounds),meters:{min:li.latLngToMeters([n,o]),max:li.latLngToMeters([i,r])},tiles:{min:{},max:{}}}}},n.checkBounds=function(t,e){if(e){t=li.wrapTile(t);var n=e.tiles.min[t.z];n||(n=e.tiles.min[t.z]=li.tileForMeters(e.meters.min,t.z));var r=e.tiles.max[t.z];if(r||(r=e.tiles.max[t.z]=li.tileForMeters(e.meters.max,t.z)),t.y<n.y||t.y>r.y)return!1;if(n.x<=r.x){if(t.x<n.x||t.x>r.x)return!1}else if(t.x>r.x&&t.x<n.x)return!1}return!0},n.includesTile=function(e,n){return!!t.prototype.includesTile.call(this,e,n)&&!!this.checkBounds(e,this.bounds)},n.formatURL=function(t,e){var n=li.wrapTile(e.coords,{x:!0});this.tms&&(n.y=Math.pow(2,n.z)-1-n.y);var r=t.replace("{x}",n.x).replace("{y}",n.y).replace("{z}",n.z).replace("{r}",this.getDensityModifier()).replace("{q}",this.toQuadKey(n));return null!=this.url_subdomains&&(r=r.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),r},n.getDensityModifier=function(){if(this.url_density_scales){var t=en.device_pixel_ratio,e=this.url_density_scales.filter((function(e){return t>=e})).reverse()[0];if((e=null!=e?e:this.url_density_scales[0])>1)return"@"+e+"x"}return""},n.toQuadKey=function(t){for(var e=t.x,n=t.y,r="",i=t.z;i>0;i--){var o=0,s=1<<i-1;0!=(e&s)&&o++,0!=(n&s)&&(o+=2),r+=o.toString()}return r},e.urlHasTilePattern=function(t){return t&&(t.search("{x}")>-1&&t.search("{y}")>-1&&t.search("{z}")>-1||t.search("{q}")>-1)},e}(lo),ho={coord:function(t){return{x:t.x,y:t.y,z:t.z,key:this.coordKey(t)}},coordKey:function(t){return t.x+"/"+t.y+"/"+t.z},key:function(t,e,n){if(!(t.y<0||t.y>=1<<t.z||t.z<0))return[e.name,t.x,t.y,t.z,n].join("/")},normalizedKey:function(t,e,n){return this.key(this.normalizedCoord(t,e),e,n)},normalizedCoord:function(t,e){return e.zoom_bias&&(t=this.coordAtZoom(t,Math.max(t.z-e.zoom_bias,e.zooms[0]))),this.coordForTileZooms(t,e.zooms)},coordAtZoom:function(t,e){var n=t.x,r=t.y,i=t.z;if(i!==(e=Math.max(0,e))){var o=Math.pow(2,i-e);n=Math.floor(n/o),r=Math.floor(r/o),i=e}return this.coord({x:n,y:r,z:i})},coordForTileZooms:function(t,e){var n=t.x,r=t.y,i=t.z,o=this.findZoomInRange(i,e);return o!==i?this.coordAtZoom({x:n,y:r,z:i},o):this.coord({x:n,y:r,z:i})},findZoomInRange:function(t,e){return e.filter((function(e){return t>=e})).reverse()[0]||e[0]},isDescendant:function(t,e){if(e.z>t.z){var n=this.coordAtZoom(e,t.z),r=n.x,i=n.y;return t.x===r&&t.y===i}return!1},parent:function(t){var e=t.coords,n=t.source,r=t.style_z;if(r>0){r--;var i=Math.max(r-n.zoom_bias,n.zooms[0]),o=this.coordForTileZooms(this.coordAtZoom(e,i),n.zooms);return o.z>r?null:{key:this.key(o,n,r),coords:o,style_z:r,source:n}}},children:function(t,e){var n=t.coords,r=t.source,i=t.style_z;void 0===e&&(e={}),i++;var o=this.coordForTileZooms(this.coordAtZoom(n,i-r.zoom_bias),r.zooms);if(o.z===n.z)return[{key:this.key(o,r,i),coords:o,style_z:i,source:r}];var s=this.key(o,r,i);if(e[r.id]=e[r.id]||{},null==e[r.id][s]){for(var a=Math.pow(2,o.z-n.z),l=n.x*a,u=n.y*a,h=[],c=l;c<l+a;c++)for(var f=u;f<u+a;f++){var d=this.coord({x:c,y:f,z:o.z});h.push({key:this.key(d,r,i),coords:d,style_z:i,source:r})}e[r.id][s]=h}return e[r.id][s]}},co=function(t){function e(e,n){var r;return-1===(r=t.call(this,e,n)||this).rasters.indexOf(r.name)&&r.rasters.unshift(r.name),r.filtering=e.filtering,r.textures={},r}Ri(e,t);var n=e.prototype;return n.load=function(t){return new Promise(function(e,n){t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=[].concat(this.rasters);var r=li.tile_scale;return t.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[r,0],[r,-r],[0,-r],[0,0]]]},properties:{}}]}},t.default_winding="CW",e(t)}.bind(this))},n.tileTexture=function(t){return new Promise(function(e,n){var r=this.adjustRasterTileZoom(t),i=r.key;if(!this.textures[i]){var o=this.formatURL(this.url,{coords:r});this.textures[i]={name:o,url:o,filtering:this.filtering,coords:r}}return e(this.textures[i])}.bind(this))},n.adjustRasterTileZoom=function(t){var e=t.coords,n=this.sources[t.source];if(n!==this){var r=this.zoom_bias-n.zoom_bias;r>0?e=ho.normalizedCoord(t.coords,{zoom_bias:r,zooms:this.zooms}):(r<0&&Ji({level:"warn",once:!0},"Raster source '"+this.name+"' supports higher zoom detail than source '"+n.name+"' it's attached to. Downsampling this source "+-r+" extra zoom levels to match."),e=ho.coordForTileZooms(e,this.zooms))}return e},e}(uo),fo=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).load_image={},r.alpha=null!=e.alpha?Math.max(Math.min(e.alpha,1),0):null,r.mask_alpha=!0,r.preserve_tiles_within_zoom=0,r.max_display_density=e.max_display_density,Array.isArray(e.composite)?r.images=e.composite.map((function(t){return{url:t.url,bounds:r.parseBounds(t),alpha:null!=t.alpha?Math.max(Math.min(t.alpha,1),0):null}})):r.images=[{url:r.url,bounds:r.bounds,alpha:r.alpha}],r}Ri(e,t);var n=e.prototype;return n.tileTexture=function(t,e){return new Promise(function(n,r){var i,o,s,a,l,u,h,c,f,d;return i=this,o=e.blend,s=e.generation,a=this.adjustRasterTileZoom(t),l="opaque"!==o,u="raster-"+this.name+"-"+a.key+"-"+(l?"alpha":"opaque")+"-"+s,Gn.textures[u]?n({name:u,coords:a,skip_create:!0}):(h=en.device_pixel_ratio,this.max_display_density&&(h=Math.min(h,this.max_display_density)),h*=2,c=document.createElement("canvas"),f=c.getContext("2d"),c.width=this.tile_size*h,c.height=this.tile_size*h,f.imageSmoothingEnabled="nearest"!==this.filtering,d=this.images.filter((function(e){return i.checkBounds(t.coords,e.bounds)})),Promise.resolve(Promise.all(d.map((function(e){var n=l?null!=e.alpha?e.alpha:i.alpha:1;return i.drawImage(e.url,e.bounds,n,t,h,f)})))).then(function(t){try{return n({name:u,element:c,filtering:this.filtering,coords:a})}catch(t){return r(t)}}.bind(this),r))}.bind(this))},n.drawImage=function(t,e,n,r,i,o){return new Promise(function(s,a){var l,u,h,c,f,d,_;return l=Wn(t),this.load_image[l]=this.load_image[l]||this.loadImage(t),Promise.resolve(this.load_image[l]).then(function(t){try{return u=t,h=li.metersPerPixel(r.coords.z)/i/(this.tile_size/li.tile_size),c=(e.meters.min[0]-r.min.x)/h,f=-(e.meters.min[1]-r.min.y)/h,d=(e.meters.max[0]-e.meters.min[0])/h,_=-(e.meters.max[1]-e.meters.min[1])/h,o.globalAlpha=null!=n?n:1,o.drawImage(u,c,f,d,_),s()}catch(t){return a(t)}}.bind(this),a)}.bind(this))},n.loadImage=function(t){var e=this;return new Promise((function(n){var r=new Image;r.onload=function(){return n(r)},r.onerror=function(r){Ji("warn","Raster source '"+e.name+"': failed to load url: '"+t+"'",r),n(null)},en.isSafari()&&"data:"===t.slice(0,5)||(r.crossOrigin="anonymous"),r.src=t}))},n.includesTile=function(t,e){var n=this;return!!so.prototype.includesTile.call(this,t,e)&&this.images.some((function(e){return n.checkBounds(t,e.bounds)}))},n.validate=function(t){var e="Raster data source must provide a string `url` parameter, or an array of `composite` raster ";e+="image objects that each have a `url` parameter";var n="Raster data source must provide a `bounds` parameter, or an array of `composite` raster ";if(n+="image objects that each have a `bounds` parameter",Array.isArray(t.composite)){if(t.composite.some((function(t){return"string"!=typeof t.url})))throw Error(e);if(t.composite.some((function(t){return!(Array.isArray(t.bounds)&&4===t.bounds.length)})))throw Error(n);if(null!=t.url||null!=t.bounds)throw Error("Raster data source must have *either* a single image specified as `url` and `bounds `parameters, or an array of `composite` raster image objects, each with `url` and `bounds`.")}else{if("string"!=typeof t.url)throw Error(e);if(!Array.isArray(t.bounds)||4!==t.bounds.length)throw Error(n)}},e}(co);so.register("Raster",(function(t){return co.urlHasTilePattern(t.url)?co:fo}));var po={init:function(t){var e=void 0===t?{}:t,n=e.generation,r=e.styles,i=e.sources,o=void 0===i?{}:i,s=e.introspection;this.setGeneration(n),this.styles=r,this.sources=o,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=s||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.stencil_proxy_tiles=!0,this.variants={},this.vertex_layouts={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque","opaque"!==this.blend?null==this.blend_order&&(this.blend_order=this.default_blend_orders[this.blend]):this.blend_order=this.default_blend_orders[this.blend],this.defines["TANGRAM_BLEND_"+this.blend.toUpperCase()]=!0,this.removeShaderBlock("setup"),this.material instanceof Kr||(Kr.isValid(this.material)||(this.material=Or.defaults.material),this.material=new Kr(this.material)),this.material.inject(this),to.setMode(this.lighting,this),this.setupRasters(),this.setupCustomAttributes(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),Zi.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(t){this.generation=t,this.main_thread_target=["Style",this.name,this.generation].join("_"),Ut.is_main&&Zi.addTarget(this.main_thread_target,this)},startData:function(t){this.tile_data[t.id]=this.tile_data[t.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(t){return new Promise(function(e,n){var r=this.tile_data[t.id];if(this.tile_data[t.id]=null,r&&Object.keys(r.meshes).length>0){for(var i in r.meshes){var o=r.meshes[i];0!==o.vertex_data.vertex_count?(o.vertex_data.end(),o.vertex_elements=o.vertex_data.element_buffer,o.vertex_data=o.vertex_data.vertex_buffer):delete r.meshes[i]}return e(this.buildRasterTextures(t,r))}return e(null)}.bind(this))},hasDataForTile:function(t){return null!=this.tile_data[t.id]},getTileMesh:function(t,e){var n=this.tile_data[t.id].meshes;if(null==n[e.key]){var r=this.vertexLayoutForMeshVariant(e);n[e.key]={variant:e,vertex_data:r.createVertexData()}}return n[e.key]},vertexLayoutForMeshVariant:function(){},meshVariantTypeForDraw:function(){},addFeature:function(t,e,n){var r=n.tile;if(r.generation===this.generation){this.tile_data[r.id]||this.startData(r);var i=this.parseFeature(t,e,n);i&&this.buildGeometry(t.geometry,i,n)>0&&(t.generation=this.generation)}},buildGeometry:function(t,e,n){var r,i=this;if("Polygon"===t.type?r=this.buildPolygons([t.coordinates],e,n):"MultiPolygon"===t.type?r=this.buildPolygons(t.coordinates,e,n):"LineString"===t.type?r=this.buildLines([t.coordinates],e,n):"MultiLineString"===t.type?r=this.buildLines(t.coordinates,e,n):"Point"===t.type?r=this.buildPoints([t.coordinates],e,n):"MultiPoint"===t.type&&(r=this.buildPoints(t.coordinates,e,n)),r>0&&nn.layer_stats){var o=n.tile;o.debug.layers=o.debug.layers||{list:{},tree:{}};var s=o.debug.layers.list,a=o.debug.layers.tree,l={};n.layers.forEach((function(t){var e,n;_o(s,t,1,r,((e={})[i.name]=r,e),((n={})[i.baseStyle()]=r,n));for(var o=a,u=l,h=t.split(":"),c=0;c<h.length;c++){var f,d,_=h[c];o[_]=o[_]||{features:0,geoms:0,styles:{},base:{}},null==u[_]&&(u[_]={},_o(o,_,1,r,((f={})[i.name]=r,f),((d={})[i.baseStyle()]=r,d))),c<h.length-1&&(o[_].layers=o[_].layers||{}),o=o[_].layers,u=u[_]}}))}return r},parseFeature:function(t,e,n){try{var r=this.feature_style;if(r.order=this.parseOrder(e.order,n),null==r.order&&"overlay"!==this.blend){var i="Layer '"+e.layers.join(", ")+"', draw group '"+e.group+"': ";return i+="'order' parameter is required unless blend mode is 'overlay'",null!=e.order&&(i+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",i+="or JS function), but evaluated to null for one or more features"),void Ji({level:"warn",once:!0},i)}if(!(r=this._parseFeature(t,e,n)))return;if(this.shaders.attributes)for(var o in r.attributes=r.attributes||{},this.shaders.attributes)r.attributes[o]=Or.evalCachedProperty(e.attributes&&e.attributes[o],n),"number"!=typeof r.attributes[o]&&(r.attributes[o]=0);return this.selection?r.interactive=Or.evalProperty(e.interactive,n):r.interactive=!1,!0===r.interactive?r.selection_color=Hr.makeColor(t,n.tile,n):r.selection_color=Hr.defaultColor,r}catch(e){Ji("error","Style.parseFeature: style parsing error",t,r,e.stack)}},_parseFeature:function(){return this.feature_style},preprocess:function(t){if(!t.preprocessed){if(this.draw)for(var e in this.draw){var n=this.draw[e];"object"!=typeof n||Array.isArray(n)?null==t[e]&&(t[e]=n):t[e]=nr({},n,t[e])}if(this.selection?this.introspection&&(t.interactive=!0):t.interactive=!1,!(t=this._preprocess(t)))return;if(this.shaders.attributes)for(var r in t.attributes=t.attributes||{},this.shaders.attributes)t.attributes[r]=Or.createPropertyCache(null!=t.attributes[r]?t.attributes[r]:0);t.preprocessed=!0}return t},_preprocess:function(t){return t},parseOrder:function(t,e){return"number"!=typeof t?Or.calculateOrder(t,e):t},scaleOrder:function(t){return 2*t},parseColor:function(t,e){return t?Or.evalCachedColorProperty(t,e):this.shaders.blocks.color||this.shaders.blocks.filter?Or.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(t){this.gl=t,this.max_texture_size=Gn.getMaxTextureSize(this.gl)},makeMesh:function(t,e,n){void 0===n&&(n={});var r=this.vertexLayoutForMeshVariant(n.variant);return nn.wireframe?(e=function(t){for(var e=new Uint16Array(2*t.length),n=0;n<t.length;n+=3)e.set([t[n],t[n+1],t[n+1],t[n+2],t[n+2],t[n]],2*n);return e}(e),new $r(this.gl,t,e,r,Object.assign({},n,{draw_mode:this.gl.LINES}))):new $r(this.gl,t,e,r,n)},render:function(t){return t.render()},getProgram:function(t){void 0===t&&(t="program"),this.compileSetup();var e=this[t];if(e&&!e.error){if(!e.compiled){Ji("debug","Compiling style '"+this.name+"', program key '"+t+"'");try{e.compile()}catch(e){throw Ji("error","Style: error compiling program for style '"+this.name+"' (program key '"+t+"')",this,e.stack,e.type,e.shader_errors),e}}return e}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for "+this.name+" because no GL context");var t=this.buildDefineList();if(this.selection){var e=Object.assign({},t);e.TANGRAM_FEATURE_SELECTION=!0}var n=this.shaders&&this.shaders.blocks,r=this.shaders&&this.shaders.block_scopes,i=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in i)null==i[o]&&Ji({level:"warn",once:!0},"Style '"+this.name+"' has invalid uniform '"+o+"': uniform values must be non-null");var s=this.shaders&&this.shaders.extensions;"string"==typeof s&&(s=[s]),this.program=new Xn(this.gl,this.vertex_shader_src,this.fragment_shader_src,{name:this.name,defines:t,uniforms:i,blocks:n,block_scopes:r,extensions:s}),this.selection?this.selection_program=new Xn(this.gl,this.vertex_shader_src,"// Fragment shader for feature selection passes\n// Renders in silhouette according to selection (picking) color, or black if none defined\n\n#ifdef TANGRAM_FEATURE_SELECTION\n    varying vec4 v_selection_color;\n#endif\n\nvoid main (void) {\n    #ifdef TANGRAM_FEATURE_SELECTION\n        gl_FragColor = v_selection_color;\n    #else\n        gl_FragColor = vec4(0., 0., 0., 1.);\n    #endif\n}\n",{name:this.name+" (selection)",defines:e,uniforms:i,blocks:n,block_scopes:r,extensions:s}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(t,e,n){void 0===n&&(n=null),this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[t]=this.shaders.blocks[t]||[],this.shaders.blocks[t].push(e),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[t]=this.shaders.block_scopes[t]||[],this.shaders.block_scopes[t].push(n)},removeShaderBlock:function(t){this.shaders.blocks&&(this.shaders.blocks[t]=null),this.shaders.block_scopes&&(this.shaders.block_scopes[t]=null)},replaceShaderBlock:function(t,e,n){void 0===n&&(n=null),this.removeShaderBlock(t),this.addShaderBlock(t,e,n)},buildDefineList:function(){var t={};if(null!=this.defines)for(var e in this.defines)t[e]=this.defines[e];if(null!=this.shaders&&null!=this.shaders.defines)for(e in this.shaders.defines)t[e]=this.shaders.defines[e];return t},hasRasters:function(){return["color","normal","custom"].indexOf(this.raster)>-1},setupRasters:function(){var t=this;if(this.hasRasters()){"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var e=Object.keys(this.sources).filter((function(e){return t.sources[e]instanceof co})).length;if(this.defines.TANGRAM_NUM_RASTER_SOURCES=""+e,e>0){var n=Object.keys(this.sources).filter((function(e){return t.sources[e].mask_alpha})).length;this.defines.TANGRAM_HAS_MASKED_RASTERS=n>0,this.defines.TANGRAM_ALL_MASKED_RASTERS=n===e,this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster","// Uniforms defining raster textures and macros for accessing them\n\n#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_rasters[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture samplers\nuniform vec2 u_raster_sizes[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture sizes (width/height in pixels)\nuniform vec3 u_raster_offsets[TANGRAM_NUM_RASTER_SOURCES];  // raster tile texture UV starting offset for tile\n\n// Raster sources can optionally mask by the alpha channel (render with only full or no alpha, based on a threshold),\n// which is used for handling transparency outside the raster image when rendering with opaque blending\n#if defined(TANGRAM_HAS_MASKED_RASTERS) && !defined(TANGRAM_ALL_MASKED_RASTERS) // only add uniform if we need it\nuniform bool u_raster_mask_alpha;\n#endif\n\n// Note: the raster accessors below are #defines rather than functions to\n// avoid issues with constant integer expressions for array indices\n\n// Adjusts UVs in model space to account for raster tile texture overzooming\n// (applies scale and offset adjustments)\n#define adjustRasterUV(raster_index, uv) \\\n    ((uv) * u_raster_offsets[raster_index].z + u_raster_offsets[raster_index].xy)\n\n// Returns the UVs of the current model position for a raster sampler\n#define currentRasterUV(raster_index) \\\n    (adjustRasterUV(raster_index, v_modelpos_base_zoom.xy))\n\n// Returns pixel location in raster tile texture at current model position\n#define currentRasterPixel(raster_index) \\\n    (currentRasterUV(raster_index) * rasterPixelSize(raster_index))\n\n// Samples a raster tile texture for the current model position\n#define sampleRaster(raster_index) \\\n    (texture2D(u_rasters[raster_index], currentRasterUV(raster_index)))\n\n// Samples a raster tile texture for a given pixel\n#define sampleRasterAtPixel(raster_index, pixel) \\\n    (texture2D(u_rasters[raster_index], (pixel) / rasterPixelSize(raster_index)))\n\n// Returns size of raster sampler in pixels\n#define rasterPixelSize(raster_index) \\\n    (u_raster_sizes[raster_index])\n\n#endif\n","Raster")}}},buildRasterTextures:function(t,e){return new Promise(function(n,r){var i,o,s,a;if(!this.hasRasters())return n(e);if(0===t.rasters.length)return n(e);var l=function(){try{return!i||i.length<1?n(e):i.some((function(t){return!t.loaded}))?n(null):(e.uniforms.u_raster_mask_alpha=!0===this.sources[t.rasters[0]].mask_alpha,o=e.uniforms.u_rasters=[],s=e.uniforms.u_raster_sizes=[],a=e.uniforms.u_raster_offsets=[],i.forEach((function(n){var r=n.index;if(o[r]=n.name,e.textures.push(n.name),s[r]=[n.width,n.height],t.coords.z>n.coords.z){var i=t.coords.z-n.coords.z,l=Math.pow(2,i);a[r]=[(t.coords.x%l+l)%l/l,(l-1-t.coords.y%l)/l,1/l]}else a[r]=[0,0,1]})),n(e))}catch(t){return r(t)}}.bind(this),u=function(t){try{return n(e)}catch(t){return r(t)}};try{return Promise.resolve(Zi.postMessage(this.main_thread_target+".loadTextures",{coords:t.coords,source:t.source,rasters:t.rasters,min:t.min,max:t.max})).then((function(t){try{return i=t,l()}catch(t){return u()}}),u)}catch(t){u()}}.bind(this))},loadTextures:function(t){return new Promise(function(e,n){var r,i,o,s,a;return r=this,i={},o={},s=[],t.rasters.map((function(t){return r.sources[t]})).filter((function(t){return t})).forEach((function(e,n){e instanceof co&&s.push(e.tileTexture(t,r).then((function(t){i[t.name]=t,o[t.name]=n})))})),Promise.resolve(Promise.all(s)).then(function(t){try{return Promise.resolve(Gn.createFromObject(this.gl,i)).then((function(t){try{return Promise.resolve(Promise.all(Object.keys(i).map((function(t){return Gn.textures[t]&&Gn.textures[t].load()})).filter((function(t){return t})))).then((function(t){try{return(a=t).forEach((function(t){return t.retain()})),e(a.map((function(t){return{name:t.name,width:t.width,height:t.height,loaded:t.loaded,index:o[t.name],coords:i[t.name].coords}})))}catch(t){return n(t)}}),n)}catch(t){return n(t)}}),n)}catch(t){return n(t)}}.bind(this),n)}.bind(this))},setupCustomAttributes:function(){if(this.shaders.attributes)for(var t=Object.entries(this.shaders.attributes),e=0;e<t.length;e++){var n=t[e],r=n[0],i=n[1];"float"===i.type&&(!1!==i.varying?(this.addShaderBlock("attributes","\n                            #ifdef TANGRAM_VERTEX_SHADER\n                                attribute float a_"+r+";\n                                varying float v_"+r+";\n                                #define "+r+" a_"+r+"\n                            #else\n                                varying float v_"+r+";\n                                #define "+r+" v_"+r+"\n                            #endif\n                        "),this.addShaderBlock("setup","#ifdef TANGRAM_VERTEX_SHADER\nv_"+r+" = a_"+r+";\n#endif")):this.addShaderBlock("attributes","\n                            #ifdef TANGRAM_VERTEX_SHADER\n                                attribute float a_"+r+";\n                                #define "+r+" a_"+r+"\n                            #endif\n                        "))}},addCustomAttributesToAttributeList:function(t){if(this.shaders.attributes)for(var e=Object.entries(this.shaders.attributes),n=0;n<e.length;n++){var r=e[n],i=r[0];"float"===r[1].type&&t.push({name:"a_"+i,size:1,type:Yr.FLOAT,normalized:!1})}return t},addCustomAttributesToVertexTemplate:function(t,e){if(this.shaders.attributes)for(var n in this.shaders.attributes)this.vertex_template[e++]=null!=t.attributes[n]?t.attributes[n]:0},setup:function(){this.setUniforms(),this.material.setupProgram(Xn.current)},setUniforms:function(){var t=Xn.current;t&&t.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:Number.MIN_SAFE_INTEGER,add:1,multiply:2,inlay:3,translucent:4,overlay:5},getBlendOrderForDraw:function(t){return"opaque"!==this.blend&&null!=t.blend_order?t.blend_order:this.blend_order}};function _o(t,e,n,r,i,o){for(var s in t[e]=t[e]||{features:0,geoms:0,styles:{},base:{}},t[e].features+=n,t[e].geoms+=r,i)t[e].styles[s]=t[e].styles[s]||0,t[e].styles[s]+=i[s];for(var a in o)t[e].base[a]=t[e].base[a]||0,t[e].base[a]+=o[a]}Un("Int16",2,(function(t){return function(e,n,r){return t(this,e,n,r)}})),Un("Uint32",4,(function(t){return function(e,n,r){return t(this,e,n,r)}})),Un("Int32",4,(function(t){return function(e,n,r){return t(this,e,n,r)}})),Un("Int8",1,(function(t){return function(e,n,r){return t(this,e,n,r)}})),Un("Float32",4,(function(t){return function(e,n,r){return t(this,e,n,r)}}));var mo,go=Math.pow(2,16)-1,vo=!1,yo=function(){function t(){this.array=[],this.has_overflown=!1}var e=t.prototype;return e.push=function(t){this.has_overflown&&!vo||t>go&&(this.has_overflown=!0,!vo)||this.array.push(t)},e.end=function(){if(this.array.length){var t=(e=this.array,new(this.has_overflown&&vo?Uint32Array:Uint16Array)(e));return this.array=[],this.has_overflown=!1,t}return!1;var e},t}();yo.setElementIndexUint=function(t){vo=t};var bo=((mo={})[Yr.FLOAT]=Float32Array,mo[Yr.BYTE]=Int8Array,mo[Yr.UNSIGNED_BYTE]=Uint8Array,mo[Yr.INT]=Int32Array,mo[Yr.UNSIGNED_INT]=Uint32Array,mo[Yr.SHORT]=Int16Array,mo[Yr.UNSIGNED_SHORT]=Uint16Array,mo),xo=function(){function t(e,n){var r=(void 0===n?{}:n).prealloc,i=void 0===r?500:r;this.vertex_layout=e,this.vertex_elements=new yo,this.stride=this.vertex_layout.stride,t.array_pool.length>0?(this.vertex_buffer=t.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),Ji("trace","VertexData: reused buffer of bytes "+this.byte_length+", "+this.size+" vertices")):(this.size=i,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}var e=t.prototype;return e.setBufferViews=function(){var t=this;this.views={},this.views[Yr.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach((function(e){if(null==t.views[e.type]){var n=bo[e.type];t.views[e.type]=new n(t.vertex_buffer.buffer)}}))},e.checkBufferSize=function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var e=new Uint8Array(this.byte_length);e.set(this.vertex_buffer),t.array_pool.push(this.vertex_buffer),this.vertex_buffer=e,this.setBufferViews(),this.realloc_count++}},e.setAddVertexFunction=function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()},e.addVertex=function(t){this.checkBufferSize(),this.vertexLayoutAddVertex(t,this.views,this.offset),this.offset+=this.stride,this.vertex_count++},e.end=function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),Ji("trace","VertexData: "+this.size+" vertices total, realloc count "+this.realloc_count),this},t}();xo.array_pool=[];var wo=function(){function t(t){this.attribs=t,this.dynamic_attribs=this.attribs.filter((function(t){return null==t.static})),this.static_attribs=this.attribs.filter((function(t){return null!=t.static})),this.components=[],this.index={},this.offset={},this.stride=0;for(var e=0,n=0,r=0;r<this.attribs.length;r++){var i=this.attribs[r];if(null==i.static){i.offset=this.stride,i.byte_size=i.size;var o=0;switch(i.type){case Yr.FLOAT:case Yr.INT:case Yr.UNSIGNED_INT:i.byte_size*=4,o=2;break;case Yr.SHORT:case Yr.UNSIGNED_SHORT:i.byte_size*=2,o=1}3&i.byte_size&&(i.byte_size+=4-(3&i.byte_size)),this.stride+=i.byte_size;for(var s=i.offset>>o,a=0;a<i.size;a++)this.components.push({type:i.type,shift:o,offset:s++,index:n++});this.index[i.name]=e,e+=i.size,this.offset[i.name]=i.offset}else i.static=Array.isArray(i.static)?i.static:[i.static],i.method="vertexAttrib"+i.static.length+"fv"}}var e=t.prototype;return e.enableDynamicAttributes=function(e,n){var r=this;for(var i in t.enabled_attribs)e.disableVertexAttribArray(i);t.enabled_attribs={},this.dynamic_attribs.forEach((function(i){var o=n.attribute(i.name).location;-1!==o&&(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,i.size,i.type,i.normalized,r.stride,i.offset),t.enabled_attribs[o]=n)}))},e.enableStaticAttributes=function(t,e){this.static_attribs.forEach((function(n){var r=e.attribute(n.name).location;-1!==r&&t[n.method]instanceof Function&&(t.enableVertexAttribArray(r),t[n.method](r,n.static),t.disableVertexAttribArray(r))}))},e.createVertexData=function(){return new xo(this)},e.getAddVertexFunction=function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex},e.createAddVertexFunction=function(){var e=Wn(JSON.stringify(this.attribs));if(null==t.add_vertex_funcs[e]){var n,r=["var t, o;"],i=[].concat(this.components);i.sort((function(t,e){return t.type!==e.type?t.type-e.type:t.index-e.index}));for(var o=0;o<i.length;o++){var s=i[o];n!==s.type&&(r.push("t = vs["+s.type+"];"),r.push("o = off"+(s.shift?" >> "+s.shift:"")+";"),n=s.type),r.push("t[o + "+s.offset+"] = v["+s.index+"];")}r=r.join("\n");var a=new Function("v","vs","off",r);t.add_vertex_funcs[e]=a}this.addVertex=t.add_vertex_funcs[e]},t}();wo.enabled_attribs={},wo.add_vertex_funcs={};var To=[{x:0,y:0},{x:li.tile_scale,y:-li.tile_scale}],Ao=[0,0,1,1];function Eo(t,e,n){var r=To[0],i=To[1];return t[0]<=r.x+n&&e[0]<=r.x+n||t[0]>=i.x-n&&e[0]>=i.x-n||t[1]>=r.y-n&&e[1]>=r.y-n||t[1]<=i.y+n&&e[1]<=i.y+n}function ko(t,e){e=e||0;var n=To[0],r=To[1];return t[0]<=n.x+e||t[0]>=r.x-e||t[1]>=n.y-e||t[1]<=r.y+e}var So=Mo,Po=Mo;function Mo(t,e,n){n=n||2;var r,i,o,s,a,l,u,h=e&&e.length,c=h?e[0]*n:t.length,f=zo(t,0,c,n,!0),d=[];if(!f||f.next===f.prev)return d;if(h&&(f=function(t,e,n,r){var i,o,l,u=[];for(i=0,o=e.length;i<o;i++)(l=zo(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===l.next&&(l.steiner=!0),u.push(Uo(l));for(u.sort(Fo),i=0;i<u.length;i++)Do(u[i],n),n=Ro(n,n.next);return n}(t,e,f,n)),t.length>80*n){r=o=t[0],i=s=t[1];for(var _=n;_<c;_+=n)(a=t[_])<r&&(r=a),(l=t[_+1])<i&&(i=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-r,s-i))?1/u:0}return Lo(f,d,n,r,i,u),d}function zo(t,e,n,r,i){var o,s;if(i===ts(t,e,n,r)>0)for(o=e;o<n;o+=r)s=Jo(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=Jo(o,t[o],t[o+1],s);return s&&qo(s,s.next)&&(Ko(s),s=s.next),s}function Ro(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!qo(r,r.next)&&0!==Vo(r.prev,r,r.next))r=r.next;else{if(Ko(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Lo(t,e,n,r,i,o,s){if(t){!s&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=jo(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,s,a,l,u=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<u&&(a++,r=r.nextZ);e++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(s>1)}(i)}(t,r,i,o);for(var a,l,u=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Oo(t,r,i,o):Co(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Ko(t),t=l.next,u=l.next;else if((t=l)===u){s?1===s?Lo(t=No(Ro(t),e,n),e,n,r,i,o,2):2===s&&Io(t,e,n,r,i,o):Lo(Ro(t),e,n,r,i,o,1);break}}}function Co(t){var e=t.prev,n=t,r=t.next;if(Vo(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Go(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Vo(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Oo(t,e,n,r){var i=t.prev,o=t,s=t.next;if(Vo(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,h=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,c=jo(a,l,e,n,r),f=jo(u,h,e,n,r),d=t.prevZ,_=t.nextZ;d&&d.z>=c&&_&&_.z<=f;){if(d!==t.prev&&d!==t.next&&Go(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Vo(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,_!==t.prev&&_!==t.next&&Go(i.x,i.y,o.x,o.y,s.x,s.y,_.x,_.y)&&Vo(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&Go(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Vo(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;_&&_.z<=f;){if(_!==t.prev&&_!==t.next&&Go(i.x,i.y,o.x,o.y,s.x,s.y,_.x,_.y)&&Vo(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function No(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!qo(i,o)&&Wo(i,r,r.next,o)&&Xo(i,o)&&Xo(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Ko(r),Ko(r.next),r=t=o),r=r.next}while(r!==t);return Ro(r)}function Io(t,e,n,r,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Zo(s,a)){var l=$o(s,a);return s=Ro(s,s.next),l=Ro(l,l.next),Lo(s,e,n,r,i,o),void Lo(l,e,n,r,i,o)}a=a.next}s=s.next}while(s!==t)}function Fo(t,e){return t.x-e.x}function Do(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===s)return n;var l,u=n,h=n.x,c=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=h&&i!==r.x&&Go(o<c?i:s,o,h,c,o<c?s:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),Xo(r,t)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&Bo(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(t,e)){var n=$o(e,t);Ro(e,e.next),Ro(n,n.next)}}function Bo(t,e){return Vo(t.prev,t,e.prev)<0&&Vo(e.next,t,t.next)<0}function jo(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Uo(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Go(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function Zo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wo(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Xo(t,e)&&Xo(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Vo(t.prev,t,e.prev)||Vo(t,e.prev,e))||qo(t,e)&&Vo(t.prev,t,t.next)>0&&Vo(e.prev,e,e.next)>0)}function Vo(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function qo(t,e){return t.x===e.x&&t.y===e.y}function Wo(t,e,n,r){var i=Yo(Vo(t,e,n)),o=Yo(Vo(t,e,r)),s=Yo(Vo(n,r,t)),a=Yo(Vo(n,r,e));return i!==o&&s!==a||!(0!==i||!Ho(t,n,e))||!(0!==o||!Ho(t,r,e))||!(0!==s||!Ho(n,t,r))||!(0!==a||!Ho(n,e,r))}function Ho(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Yo(t){return t>0?1:t<0?-1:0}function Xo(t,e){return Vo(t.prev,t,t.next)<0?Vo(t,e,t.next)>=0&&Vo(t,t.prev,e)>=0:Vo(t,e,t.prev)<0||Vo(t,t.next,e)<0}function $o(t,e){var n=new Qo(t.i,t.x,t.y),r=new Qo(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Jo(t,e,n,r){var i=new Qo(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ko(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qo(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ts(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}Mo.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,s=Math.abs(ts(t,0,o,n));if(i)for(var a=0,l=e.length;a<l;a++){var u=e[a]*n,h=a<l-1?e[a+1]*n:t.length;s-=Math.abs(ts(t,u,h,n))}var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*n,d=r[a+1]*n,_=r[a+2]*n;c+=Math.abs((t[f]-t[_])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[_+1]-t[f+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},Mo.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n},So.default=Po;var es=[0,0,1];function is(t,e,n,r){var i,o,s,a,l,u,h,c,f,d=r.texcoord_index,_=r.texcoord_scale,p=r.texcoord_normalize,m=e.vertex_elements,v=t.length,g=0;if(d){p=p||1;var y=_||Ao;i=y[0],o=y[1],s=y[2],a=y[3]}for(var x=0;x<v;x++){var b=t[x],w=e.vertex_count,T=(f=So.flatten(b),So(f.vertices,f.holes,f.dimensions)),A=T.length;if(A){var E;d&&(l=(E=li.findBoundingBox(b))[0],u=E[1],h=(s-i)/(E[2]-l),c=(a-o)/(E[3]-u));for(var k=0;k<b.length;k++)for(var S=b[k],P=0;P<S.length;P++){var M=S[P];n[0]=M[0],n[1]=M[1],d&&(n[d+0]=((M[0]-l)*h+i)*p,n[d+1]=((M[1]-u)*c+o)*p),e.addVertex(n)}for(var z=0;z<A;z++)m.push(w+T[z]);g+=A/3}}return g}var ns='uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_order_offset;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_color;\n\n// Optional normal attribute, otherwise default to up\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\n    attribute vec3 a_normal;\n    #define TANGRAM_NORMAL a_normal\n#else\n    #define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n\n// Optional dynamic line extrusion\n#ifdef TANGRAM_EXTRUDE_LINES\n    attribute vec2 a_extrude; // extrusion direction in xy plane\n    attribute vec2 a_offset;  // offset direction in xy plane\n\n    // Polygon and line styles have slightly different VBO layouts, saving memory by optimizing vertex packing.\n    // All lines have a width scaling factor, but only some have a height (position.z) or offset.\n    // The vertex height is stored in different attributes to account for this.\n    attribute vec2 a_z_and_offset_scale; // stores vertex height in x, and offset scaling factor in y\n    #define TANGRAM_POSITION_Z a_z_and_offset_scale.x // vertex height is stored in separate line-specific attrib\n    #define TANGRAM_OFFSET_SCALING a_z_and_offset_scale.y // zoom scaling factor for line offset\n    #define TANGRAM_WIDTH_SCALING a_position.z // zoom scaling factor for line width (stored in position attrib)\n\n    uniform float u_v_scale_adjust; // scales texture UVs for line dash patterns w/fractional pixel width\n#else\n    #define TANGRAM_POSITION_Z a_position.z // vertex height\n#endif\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n// Optional texture UVs\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\n    attribute vec2 a_texcoord;\n    varying vec2 v_texcoord;\n#endif\n\n// Optional model position varying for tile coordinate zoom\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#define TANGRAM_UNPACK_SCALING(x) (x / 1024.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // Texture UVs\n    #ifdef TANGRAM_TEXTURE_COORDS\n        v_texcoord = a_texcoord;\n        #ifdef TANGRAM_EXTRUDE_LINES\n            v_texcoord.y *= u_v_scale_adjust;\n        #endif\n    #endif\n\n    // Pass model position to fragment shader\n    #ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n        v_modelpos_base_zoom = modelPositionBaseZoom();\n    #endif\n\n    // Position\n    vec4 position = vec4(a_position.xy, TANGRAM_POSITION_Z / TANGRAM_HEIGHT_SCALE, 1.); // convert height back to meters\n\n    #ifdef TANGRAM_EXTRUDE_LINES\n        vec2 _extrude = a_extrude.xy;\n        vec2 _offset = a_offset.xy;\n\n        // Adjust line width based on zoom level, to prevent proxied lines\n        // from being either too small or too big.\n        // "Flattens" the zoom between 1-2 to peg it to 1 (keeps lines from\n        // prematurely shrinking), then interpolate and clamp to 4 (keeps lines\n        // from becoming too small when far away).\n        float _dz = clamp(u_map_position.z - u_tile_origin.z, 0., 4.);\n        _dz += step(1., _dz) * (1. - _dz) + mix(0., 2., clamp((_dz - 2.) / 2., 0., 1.));\n\n        // Interpolate line width between zooms\n        float _mdz = (_dz - 0.5) * 2.; // zoom from mid-point\n        _extrude -= _extrude * TANGRAM_UNPACK_SCALING(TANGRAM_WIDTH_SCALING) * _mdz;\n\n        // Interpolate line offset between zooms\n        // Scales from the larger value to the smaller one\n        float _dwdz = TANGRAM_UNPACK_SCALING(TANGRAM_OFFSET_SCALING);\n        float _sdwdz = sign(step(0., _dwdz) - 0.5); // sign indicates "direction" of scaling\n        _offset -= _offset * abs(_dwdz) * ((1.-step(0., _sdwdz)) - (_dz * -_sdwdz)); // scale "up" or "down"\n\n        // Scale line width and offset to be consistent in screen space\n        float _ssz = exp2(-_dz - (u_tile_origin.z - u_tile_origin.w));\n        _extrude *= _ssz;\n        _offset *= _ssz;\n\n        // Modify line width before extrusion\n        #ifdef TANGRAM_BLOCK_WIDTH\n            float width = 1.;\n            #pragma tangram: width\n            _extrude *= width;\n        #endif\n\n        position.xy += _extrude + _offset;\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = wrapWorldPosition(u_model * position);\n\n    // Adjust for tile and view position\n    position = u_modelView * position;\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    // Setup varyings\n    v_position = position;\n    v_normal = normalize(u_normalMatrix * TANGRAM_NORMAL);\n    v_color = a_color;\n\n    #if defined(TANGRAM_LIGHTING_VERTEX)\n        // Vertex lighting\n        vec3 normal = v_normal;\n\n        // Modify normal before lighting\n        #pragma tangram: normal\n\n        // Pass lighting intensity to fragment shader\n        v_lighting = calculateLighting(position.xyz - u_eye, normal, vec4(1.));\n    #endif\n\n    // Camera\n    cameraProjection(position);\n\n    // +1 is to keep all layers including proxies > 0\n    applyLayerOrder(a_position.w + u_tile_proxy_order_offset + 1., position);\n\n    gl_Position = position;\n}\n',rs="uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n#ifdef TANGRAM_EXTRUDE_LINES\n    uniform bool u_has_line_texture;\n    uniform sampler2D u_texture;\n    uniform float u_texture_ratio;\n    uniform vec4 u_dash_background_color;\n    uniform float u_has_dash;\n#endif\n\n#define TANGRAM_NORMAL v_normal\n\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\n    varying vec2 v_texcoord;\n#endif\n\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n    vec3 normal = TANGRAM_NORMAL;\n\n    // Apply raster to vertex color\n    #ifdef TANGRAM_RASTER_TEXTURE_COLOR\n        vec4 _raster_color = sampleRaster(0);\n\n        #if defined(TANGRAM_BLEND_OPAQUE) || defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n            // Raster sources can optionally mask by the alpha channel, which will render with only full or no alpha.\n            // This is used for handling transparency outside the raster image in some blend modes,\n            // which either don't support alpha, or would cause transparent pixels to write to the depth buffer,\n            // obscuring geometry underneath.\n            #ifdef TANGRAM_HAS_MASKED_RASTERS   // skip masking logic if no masked raster sources\n            #ifndef TANGRAM_ALL_MASKED_RASTERS  // skip source check for masking if *all* raster sources are masked\n            if (u_raster_mask_alpha) {\n            #else\n            {\n            #endif\n                #if defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n                if (_raster_color.a < TANGRAM_EPSILON) {\n                    discard;\n                }\n                #else // TANGRAM_BLEND_OPAQUE\n                if (_raster_color.a < 1. - TANGRAM_EPSILON) {\n                    discard;\n                }\n                // only allow full alpha in opaque blend mode (avoids artifacts blending w/canvas tile background)\n                _raster_color.a = 1.;\n                #endif\n            }\n            #endif\n        #endif\n\n        color *= _raster_color; // multiplied to tint texture color\n    #endif\n\n    // Apply line texture\n    #ifdef TANGRAM_EXTRUDE_LINES\n    { // enclose in scope to avoid leakage of internal variables\n        if (u_has_line_texture) {\n            vec2 _line_st = vec2(v_texcoord.x, fract(v_texcoord.y / u_texture_ratio));\n            vec4 _line_color = texture2D(u_texture, _line_st);\n\n            // If the line has a dash pattern, the line texture indicates if the current fragment should be\n            // the dash foreground or background color. If the line doesn't have a dash pattern,\n            // the line texture color is used directly (but also tinted by the vertex color).\n            color = mix(\n                color * _line_color, // no dash: tint the line texture with the vertex color\n                mix(u_dash_background_color, color, _line_color.a), // choose dash foreground or background color\n                u_has_dash // 0 if no dash, 1 if has dash\n            );\n\n            // Use alpha discard test as a lower-quality substitute for blending\n            #if defined(TANGRAM_BLEND_OPAQUE)\n                if (color.a < TANGRAM_ALPHA_TEST) {\n                    discard;\n                }\n            #endif\n        }\n    }\n    #endif\n\n    // First, get normal from raster tile (if applicable)\n    #ifdef TANGRAM_RASTER_TEXTURE_NORMAL\n        normal = normalize(sampleRaster(0).rgb * 2. - 1.);\n    #endif\n\n    // Second, alter normal with normal map texture (if applicable)\n    #if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\n        calculateNormal(normal);\n    #endif\n\n    // Normal modification applied here for fragment lighting or no lighting,\n    // and in vertex shader for vertex lighting\n    #if !defined(TANGRAM_LIGHTING_VERTEX)\n        #pragma tangram: normal\n    #endif\n\n    // Color modification before lighting is applied\n    #pragma tangram: color\n\n    #if defined(TANGRAM_LIGHTING_FRAGMENT)\n        // Calculate per-fragment lighting\n        color = calculateLighting(v_position.xyz - u_eye, normal, color);\n    #elif defined(TANGRAM_LIGHTING_VERTEX)\n        // Apply lighting intensity interpolated from vertex shader\n        color *= v_lighting;\n    #endif\n\n    // Post-processing effects (modify color after lighting)\n    #pragma tangram: filter\n\n    gl_FragColor = color;\n}\n",os=Object.create(po);Object.assign(os,{name:"polygons",built_in:!0,vertex_shader_src:ns,fragment_shader_src:rs,selection:!0,init:function(){po.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_TEXTURE_COORDS=this.texcoords},_parseFeature:function(t,e,n){var r=this.feature_style;return r.color=this.parseColor(e.color,n),r.color?(r.alpha=Or.evalCachedProperty(e.alpha,n),r.variant=e.variant,r.z=Or.evalCachedDistanceProperty(e.z,n)||Or.defaults.z,r.z*=li.height_scale,r.extrude=Or.evalProperty(e.extrude,n),r.extrude&&(!0===r.extrude?(r.height=t.properties.height||Or.defaults.height,r.min_height=t.properties.min_height||Or.defaults.min_height):"number"==typeof r.extrude?(r.height=r.extrude,r.min_height=0):Array.isArray(r.extrude)&&(r.min_height=r.extrude[0],r.height=r.extrude[1]),r.height*=li.height_scale,r.min_height*=li.height_scale),r.tile_edges=e.tile_edges,r):null},_preprocess:function(t){return t.color=Or.createColorPropertyCache(t.color),t.alpha=Or.createPropertyCache(t.alpha),t.z=Or.createPropertyCache(t.z,Or.parseUnits),this.computeVariant(t),t},computeVariant:function(t){var e=t.interactive?1:0,n=null!=t.extrude?1:0,r=this.texcoords?1:0,i=this.getBlendOrderForDraw(t),o=[e,n,r,i].join("/");t.variant=o,null==this.variants[o]&&(this.variants[o]={key:o,blend_order:i,mesh_order:0,selection:e,normal:n,texcoords:r})},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.key]){var e=[{name:"a_position",size:4,type:Yr.SHORT,normalized:!1},{name:"a_normal",size:3,type:Yr.BYTE,normalized:!0,static:t.normal?null:[0,0,1]},{name:"a_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]},{name:"a_texcoord",size:2,type:Yr.UNSIGNED_SHORT,normalized:!0,static:t.texcoords?null:[0,0]}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.key]=new wo(e)}return this.vertex_layouts[t.key]},meshVariantTypeForDraw:function(t){return this.variants[t.variant]},makeVertexTemplate:function(t,e){var n=0;return this.vertex_template[n++]=0,this.vertex_template[n++]=0,this.vertex_template[n++]=t.z||0,this.vertex_template[n++]=this.scaleOrder(t.order),e.variant.normal&&(this.vertex_template[n++]=0,this.vertex_template[n++]=0,this.vertex_template[n++]=127),this.vertex_template[n++]=255*t.color[0],this.vertex_template[n++]=255*t.color[1],this.vertex_template[n++]=255*t.color[2],this.vertex_template[n++]=255*(null!=t.alpha?t.alpha:t.color[3]),e.variant.selection&&(this.vertex_template[n++]=255*t.selection_color[0],this.vertex_template[n++]=255*t.selection_color[1],this.vertex_template[n++]=255*t.selection_color[2],this.vertex_template[n++]=255*t.selection_color[3]),e.variant.texcoords&&(this.vertex_template[n++]=0,this.vertex_template[n++]=0),this.addCustomAttributesToVertexTemplate(t,n),this.vertex_template},buildPolygons:function(t,e,n){var r=this.getTileMesh(n.tile,this.meshVariantTypeForDraw(e)),i=r.vertex_data,o=i.vertex_layout,s=this.makeVertexTemplate(e,r),a={texcoord_index:o.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!e.tile_edges,tile_edge_tolerance:li.tile_scale*n.tile.pad_scale*4,winding:n.winding};return e.extrude&&e.height?function(t,e,n,r,i,o,s,a,l){var u=l.remove_tile_edges,h=l.tile_edge_tolerance,c=l.texcoord_index,f=l.texcoord_scale,d=l.texcoord_normalize,_=l.winding,p=e+(r||0),m=e+n;o[2]=m;var v=is(t,i,o,{texcoord_index:c,texcoord_scale:f,texcoord_normalize:d}),g=i.vertex_elements,y=i.vertex_count;if(c){d=d||1;var x=f||Ao,b=x[0],w=x[1],T=x[2],A=x[3],E=[[b,A],[b,w],[T,w],[T,A]]}for(var k=t.length,S=0;S<k;S++)for(var P=t[S],M=0;M<P.length;M++)for(var z=P[M],R=0;R<z.length-1;R++)if(!u||!Eo(z[R],z[R+1],h)){var L=void 0,C=void 0;"CCW"===_?(L=R,C=R+1):(L=R+1,C=R);var O=[[z[C][0],z[C][1],m],[z[C][0],z[C][1],p],[z[L][0],z[L][1],p],[z[L][0],z[L][1],m]],N=Qr.normalize([z[C][0]-z[L][0],z[C][1]-z[L][1],0]),I=Qr.cross(es,N);o[s+0]=127*I[0],o[s+1]=127*I[1],o[s+2]=127*I[2];for(var F=0;F<O.length;F++)o[0]=O[F][0],o[1]=O[F][1],o[2]=O[F][2],c&&(o[c+0]=E[F][0]*d,o[c+1]=E[F][1]*d),i.addVertex(o);g.push(y+0),g.push(y+1),g.push(y+2),g.push(y+2),g.push(y+3),g.push(y+0),y+=4,v+=2}return v}(t,e.z,e.height,e.min_height,i,s,o.index.a_normal,0,a):is(t,i,s,a)}});var ss=/"/g,as=function(t,e,n,r){var i=String(z(t)),o="<"+e;return""!==n&&(o+=" "+n+'="'+String(r).replace(ss,"&quot;")+'"'),o+">"+i+"</"+e+">"},ls=function(t,e){var n={};n[t]=e(as),D(D.P+D.F*c((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",n)};ls("sub",(function(t){return function(){return t(this,"sub","","")}}));var us=[0,0],hs={butt:0,square:1,round:2},cs={miter:0,bevel:1,round:2},fs=li.tile_scale,ds=[0,0],ps=[1,0],_s=[.5,0];function ms(t,e){if(!(t.length<2)){var n,r,i,o,s=e.join_type,a=e.cap_type,l=e.closed_polygon,u=e.remove_tile_edges,h=e.tile_edge_tolerance,c=e.v_scale,f=e.miter_len_sq,d=null!=e.texcoord_index,_=0;if(l&&s===cs.miter){var p=function(t){if(ko(t[0]))return 0;for(var e=0;e<t.length;e++)if(ko(t[t.length-1-e]))return t.length-1-e;return 0}(t);if(0!==p){var m=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=(r+e)%t.length;0!==i&&n.push(t[i])}return n.push(n[0]),n}(t,p);return e.extra_lines=e.extra_lines||[],void e.extra_lines.push(m)}}var v=0,g=t.length-1,y=0;for(n=t[v],r=t[v+1];Qr.isEqual(n,r);)if(n=r,r=t[1+ ++v],y++,v===t.length-1)return;for(;Qr.isEqual(t[g],t[g-1]);)if(y++,0==--g)return;if(!(t.length<2+y))if(o=Qr.normalize(Qr.perp(n,r)),u&&Eo(n,r,h)){var x=gs(t,v,h);x&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(x))}else{l?function(t,e,n,r,i){void 0===r||ko(t)?(ws(t,n,n,1,0,i,1),ws(t,n,n,0,0,i,-1)):r===cs.miter?ys(0,t,e,n,i.miter_len_sq,!0,i):bs(r,0,t,e,n,!0,i)}(n,i=Qr.normalize(Qr.perp(t[g-1],n)),o,s,e):(ko(n)||(Es(n,_,o,a,!0,e),d&&a!==hs.butt&&(_+=.5*c*e.texcoord_width)),ws(n,o,o,1,_,e,1),ws(n,o,o,0,_,e,-1)),d&&(_+=c*Qr.length(Qr.sub(r,n)));for(var b=v+1;b<g;b++){var w=b,T=b+1;if(n=t[w],r=t[T],!Qr.isEqual(n,r)){if(u&&Eo(n,r,h)){ws(n,o,o,1,_,e,1),ws(n,o,o,0,_,e,-1),xs(1,e);var A=gs(t,w+1,h);return void(A&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(A)))}i=o,o=Qr.normalize(Qr.perp(n,r)),s===cs.miter?ys(_,n,i,o,f,!1,e):bs(s,_,n,i,o,!1,e),d&&(_+=c*Qr.length(Qr.sub(r,n)))}}n=r,i=o,l?function(t,e,n,r,i,o){if(ko(t))ws(t,e,e,1,i,o,1),ws(t,e,e,0,i,o,-1),xs(1,o);else{var s=vs(e,n);r===cs.miter&&Qr.lengthSq(s)>o.miter_len_sq&&(r=cs.bevel),r===cs.miter?(ws(t,s,e,1,i,o,1),ws(t,s,e,0,i,o,-1),xs(1,o)):(ws(t,e,e,1,i,o,1),ws(t,e,e,0,i,o,-1),xs(1,o))}}(n,i,o=Qr.normalize(Qr.perp(n,t[1])),s,_,e):(ws(n,i,o,1,_,e,1),ws(n,i,o,0,_,e,-1),xs(1,e),ko(n)||Es(n,_,i,a,!1,e))}}}function gs(t,e,n){for(var r=e;t[r+1]&&Eo(t[r],t[r+1],n);)r++;return t.length-r>=2&&t.slice(r)}function vs(t,e){var n=Qr.normalize(Qr.add(t,e)),r=2/(1+Math.abs(Qr.dot(t,n)));return Qr.mult(n,r*r)}function ys(t,e,n,r,i,o,s){var a=vs(n,r);Qr.lengthSq(a)>i?bs(cs.bevel,t,e,n,r,o,s):(ws(e,a,a,1,t,s,1),ws(e,a,a,0,t,s,-1),o||xs(1,s))}function bs(t,e,n,r,i,o,s){var a=vs(r,i),l=i[0]*r[1]-i[1]*r[0]>0;null!=s.texcoord_index&&(ds[1]=e,ps[1]=e),l?(ws(n,a,a,1,e,s,1),ws(n,r,a,0,e,s,-1),o||xs(1,s),As(n,Qr.neg(r),a,Qr.neg(i),a,ds,ps,ds,!1,t===cs.bevel,s),ws(n,a,a,1,e,s,1),ws(n,i,a,0,e,s,-1)):(ws(n,r,a,1,e,s,1),ws(n,a,a,0,e,s,-1),o||xs(1,s),As(n,r,Qr.neg(a),i,a,ps,ds,ps,!1,t===cs.bevel,s),ws(n,i,a,1,e,s,1),ws(n,a,a,0,e,s,-1))}function xs(t,e){for(var n=e.vertex_data.vertex_elements,r=e.vertex_data.vertex_count-2*t-2,i=0;i<t;i++)n.push(r+2*i+2),n.push(r+2*i+1),n.push(r+2*i+0),n.push(r+2*i+2),n.push(r+2*i+3),n.push(r+2*i+1),e.geom_count+=2}function ws(t,e,n,r,i,o,s){var a=o.vertex_template,l=o.vertex_data;a[0]=t[0],a[1]=t[1];var u=o.half_width*s;a[o.extrude_index+0]=e[0]*u,a[o.extrude_index+1]=e[1]*u,o.offset&&(a[o.offset_index+0]=n[0]*o.offset,a[o.offset_index+1]=n[1]*o.offset),null!=o.texcoord_index&&(a[o.texcoord_index+0]=65535*r,a[o.texcoord_index+1]=65535*i),l.addVertex(a)}var Ts=[0,0];function As(t,e,n,r,i,o,s,a,l,u,h){for(var c=e[0]*r[1]-e[1]*r[0],f=Qr.dot(e,r),d=Math.atan2(c,f);d>=Math.PI;)d-=2*Math.PI;if(u)_=1;else{var _=function(t,e){t<0&&(t=-t);var n=e>10?Math.log2(e/5):1;return Math.ceil(t/Math.PI*n)}(d,h.half_width);if(_<1)return}var p=h.vertex_data.vertex_count,m=h.vertex_data.vertex_elements;ws(t,n,i,s[0],s[1],h,1),ws(t,e,i,o[0],o[1],h,1);var v=e,g=null!=h.texcoord_index;if(g)if(l)var y=Qr.sub(o,s);else{Ts=Qr.copy(o);var x=Qr.div(Qr.sub(a,o),_)}var b,w,T=d/_,A=d<0?-1:1;c>0?(b=2,w=1):(b=1,w=2);for(var E=0;E<_;E++)0===E&&d<0&&(v=Qr.neg(v)),v=Qr.rot(v,T),g&&(l?(y=Qr.rot(y,T),Ts[0]=y[0]+s[0],Ts[1]=y[1]*h.texcoord_width*h.v_scale+s[1]):Ts=Qr.add(Ts,x)),ws(t,v,i,Ts[0],Ts[1],h,A),m.push(p+E+b),m.push(p),m.push(p+E+w)}function Es(t,e,n,r,i,o){var s=Qr.neg(n),a=null!=o.texcoord_index;switch(r){case hs.square:var l;i?(l=[n[1],-n[0]],ws(t,Qr.add(n,l),n,1,e,o,1),ws(t,Qr.add(s,l),n,0,e,o,1),a&&(e+=.5*o.texcoord_width*o.v_scale),ws(t,n,n,1,e,o,1),ws(t,s,n,0,e,o,1)):(l=[-n[1],n[0]],ws(t,n,n,1,e,o,1),ws(t,s,n,0,e,o,1),a&&(e+=.5*o.texcoord_width*o.v_scale),ws(t,Qr.add(n,l),n,1,e,o,1),ws(t,Qr.add(s,l),n,0,e,o,1)),xs(1,o);break;case hs.round:var u,h,c=ds,f=ps,d=_s;i?(u=n,h=s,a&&(e+=.5*o.texcoord_width*o.v_scale,c=ps,f=ds,d=_s)):(u=s,h=n),a&&(ds[1]=e,ps[1]=e,_s[1]=e),As(t,u,us,h,n,c,d,f,!0,!1,o);break;case hs.butt:return}}var ks=[255,255,255,255],Ss=[0,0,0,0],Ps=Object.create(po);Object.assign(Ps,{name:"lines",built_in:!0,vertex_shader_src:ns,fragment_shader_src:rs,selection:!0,init:function(){po.init.apply(this,arguments),this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style,this.dash_textures={}},calcDistance:function(t,e){return Or.evalCachedDistanceProperty(t,e)||0},calcDistanceNextZoom:function(t,e){e.zoom++;var n=this.calcDistance(t,e);return e.zoom--,n},calcWidth:function(t,e,n){var r=this.calcDistance(t.width,n);if(!(r<0)){var i;if(i=t.next_width?this.calcDistanceNextZoom(t.next_width,n):r/2,0===r&&0===i||i<0)return!1;if(e.width_unscaled=r,e.next_width_unscaled=i,t.next_width){var o=.5*(r+(i*=2));e.width=o*n.units_per_meter_overzoom,e.width_scale=1-i/o}else e.width=r*n.units_per_meter_overzoom,e.width_scale=0;return t.texcoords&&(t.inline_texcoord_width?e.texcoord_width=t.inline_texcoord_width:e.texcoord_width=(e.width_unscaled||e.next_width_unscaled)*n.units_per_meter_overzoom/n.tile.overzoom2),!0}},calcOffset:function(t,e,n){if(t.offset_precalc)e.offset=t.offset_precalc,e.offset_scale=t.offset_scale_precalc;else if(t.offset){var r=this.calcDistance(t.offset,n);if(t.next_offset){var i=2*this.calcDistanceNextZoom(t.next_offset,n);Math.abs(r)>=Math.abs(i)?(e.offset=r*n.units_per_meter_overzoom,e.offset_scale=0!==r?1-i/r:0):(e.offset=i*n.units_per_meter_overzoom,e.offset_scale=0!==i?-1*(1-r/i):0)}else e.offset=r*n.units_per_meter_overzoom,e.offset_scale=0}else e.offset=0,e.offset_scale=0},_parseFeature:function(t,e,n){var r=this.feature_style;if(!1!==this.calcWidth(e,r,n)&&(this.calcOffset(e,r,n),r.color=this.parseColor(e.color,n),r.color)){if(r.alpha=Or.evalCachedProperty(e.alpha,n),r.variant=e.variant,r.z=Or.evalCachedDistanceProperty(e.z,n)||Or.defaults.z,r.height=t.properties.height||Or.defaults.height,r.extrude=Or.evalProperty(e.extrude,n),r.extrude&&("number"==typeof r.extrude?r.height=r.extrude:Array.isArray(r.extrude)&&(r.height=r.extrude[1])),r.extrude&&r.height&&(r.z+=r.height),r.z*=li.height_scale,r.cap=e.cap,r.join=e.join,r.miter_limit=e.miter_limit,r.tile_edges=e.tile_edges,r.outline=r.outline||{width:{},next_width:{},preprocessed:!0},e.outline&&!1!==e.outline.visible&&e.outline.color&&e.outline.width){var i=2*this.calcDistance(e.outline.width,n),o=2*this.calcDistanceNextZoom(e.outline.next_width,n);0===i&&0===o||i<0||o<0?(r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null,r.outline.texcoords=!1):(r.outline.width.value=i+r.width_unscaled,r.outline.next_width.value=o+r.next_width_unscaled,r.outline.inline_texcoord_width=r.texcoord_width,r.outline.offset_precalc=r.offset,r.outline.offset_scale_precalc=r.offset_scale,r.outline.color=e.outline.color,r.outline.alpha=e.outline.alpha,r.outline.interactive=e.outline.interactive,r.outline.cap=e.outline.cap,r.outline.join=e.outline.join,r.outline.miter_limit=e.outline.miter_limit,r.outline.texcoords=e.outline.texcoords,r.outline.extrude=e.outline.extrude,r.outline.z=e.outline.z,r.outline.style=e.outline.style,r.outline.variant=e.outline.variant,e.outline.order?r.outline.order=this.parseOrder(e.outline.order,n):r.outline.order=r.order,r.outline.order>r.order&&(r.outline.order=r.order),r.outline.order-=.5)}else r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null;return r}},_preprocess:function(t){if(t.color=Or.createColorPropertyCache(t.color),t.alpha=Or.createPropertyCache(t.alpha),t.width=Or.createPropertyCache(t.width,Or.parseUnits),t.width&&t.width.type!==Or.CACHE_TYPE.STATIC&&(t.next_width=Or.createPropertyCache(t.width,Or.parseUnits)),t.offset=t.offset&&Or.createPropertyCache(t.offset,Or.parseUnits),t.offset&&t.offset.type!==Or.CACHE_TYPE.STATIC&&(t.next_offset=Or.createPropertyCache(t.offset,Or.parseUnits)),t.z=Or.createPropertyCache(t.z,Or.parseUnits),t.dash=void 0!==t.dash?t.dash:this.dash,t.dash_key=t.dash&&this.dashTextureKey(t.dash),t.dash_background_color=void 0!==t.dash_background_color?t.dash_background_color:this.dash_background_color,t.dash_background_color=t.dash_background_color&&Or.parseColor(t.dash_background_color),t.texture_merged=t.dash_key||(void 0!==t.texture?t.texture:this.texture),t.texcoords=this.texcoords||t.texture_merged?1:0,this.computeVariant(t),t.outline){t.outline.is_outline=!0,t.outline.style=t.outline.style||this.name,t.outline.color=Or.createColorPropertyCache(t.outline.color),t.outline.alpha=Or.createPropertyCache(t.outline.alpha),t.outline.width=Or.createPropertyCache(t.outline.width,Or.parseUnits),t.outline.next_width=Or.createPropertyCache(t.outline.width,Or.parseUnits),t.outline.interactive=null!=t.outline.interactive?t.outline.interactive:t.interactive,t.outline.cap=t.outline.cap||t.cap,t.outline.join=t.outline.join||t.join,t.outline.miter_limit=null!=t.outline.miter_limit?t.outline.miter_limit:t.miter_limit,t.outline.offset=t.offset,t.outline.extrude=t.extrude,t.outline.z=t.z;var e=this.styles[t.outline.style];e?(t.outline.dash=void 0!==t.outline.dash?t.outline.dash:e.dash,t.outline.texture=void 0!==t.outline.texture?t.outline.texture:e.texture,null!=t.outline.dash?(t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash),t.outline.texture_merged=t.outline.dash_key):null===t.outline.dash||null!=t.outline.texture?(t.outline.dash_key=null,t.outline.texture_merged=t.outline.texture):(t.outline.dash=t.dash,t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash),t.outline.texture_merged=t.outline.dash_key),t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:e.dash_background_color,t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:t.dash_background_color,t.outline.dash_background_color=t.outline.dash_background_color&&Or.parseColor(t.outline.dash_background_color),t.outline.texcoords=e.texcoords||t.outline.texture_merged?1:0,void 0===t.outline.blend_order&&null!=t.blend_order&&(t.outline.blend_order=t.blend_order),e.computeVariant(t.outline)):(Ji({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': line 'outline' specifies non-existent draw style '"+t.outline.style+"' (or maybe the style is defined but is missing a 'base' or has another error), skipping outlines for features matching this layer group"),t.outline=null)}return t},dashTextureKey:function(t){return"__dash_"+JSON.stringify(t)},getDashTexture:function(t){var e=this.dashTextureKey(t);if(null==this.dash_textures[e]){this.dash_textures[e]=!0;var n=function(t,e){void 0===e&&(e={});var n=e.dash_color||ks,r=e.background_color||Ss,i=t,o=e.scale||1;i.length%2==1&&Array.prototype.push.apply(i,i);for(var s=!0,a=[],l=0;l<i.length;l++){for(var u=Math.floor(i[l]*o),h=0;h<u;h++)Array.prototype.push.apply(a,s?n:r);s=!s}return a.reverse(),{pixels:a=new Uint8Array(a),length:a.length/4}}(t,{scale:20});Gn.create(this.gl,e,{data:n.pixels,height:n.length,width:1,filtering:"nearest"})}},endData:function(t){return new Promise(function(e,n){var r,i,o,s;return r=this,Promise.resolve(po.endData.call(this,t)).then(function(t){try{if(i=t){i.uniforms.u_has_line_texture=!1,i.uniforms.u_texture=Gn.default,i.uniforms.u_v_scale_adjust=li.tile_scale,o=[],s=function(t){return new Promise((function(e,n){var s,a,l;if((s=i.meshes[t].variant).texture){if((a=i.meshes[t].uniforms=i.meshes[t].uniforms||{}).u_has_line_texture=!0,a.u_texture=s.texture,a.u_texture_ratio=1,s.dash&&(a.u_v_scale_adjust=20*li.tile_scale,a.u_has_dash=null!=s.dash_background_color?1:0,a.u_dash_background_color=s.dash_background_color||[0,0,0,0]),s.dash_key&&null==r.dash_textures[s.dash_key]){r.dash_textures[s.dash_key]=!0;var u=function(){try{return c.call(this)}catch(t){return n(t)}}.bind(this),h=function(t){try{return Ji("trace",r.name+": line dash texture create failed because style no longer on main thread"),u()}catch(t){return n(t)}};try{return Promise.resolve(Zi.postMessage(r.main_thread_target+".getDashTexture",s.dash)).then((function(t){try{return u()}catch(t){return h()}}),h)}catch(t){h()}}function c(){return null==Gn.textures[s.texture]?o.push(Gn.syncTexturesToWorker([s.texture]).then((function(t){var e=t[s.texture];e&&(a.u_texture_ratio=e.height/e.width)}))):(l=Gn.textures[s.texture],a.u_texture_ratio=l.height/l.width),f.call(this)}return c.call(this)}function f(){return e()}return f.call(this)}))};var a,l,u,h=[];for(a in i.meshes)h.push(a);function c(){return h.length?(l=h.shift(),Promise.resolve(s(l)).then((function(t){try{return c}catch(t){return n(t)}}),n)):[1]}return(u=function(t){for(;t;){if(t.then)return void t.then(u,n);try{if(t.pop){if(t.length)return t.pop()?f.call(this):t;t=c}else t=t.call(this)}catch(t){return n(t)}}}.bind(this))(c);function f(){return Promise.resolve(Promise.all(o)).then(function(t){try{return d.call(this)}catch(t){return n(t)}}.bind(this),n)}}function d(){return e(i)}return d.call(this)}catch(t){return n(t)}}.bind(this),n)}.bind(this))},computeVariant:function(t){var e=t.offset?1:0;e+="/"+t.texcoords,e+="/"+(t.interactive?1:0),e+="/"+(t.extrude||t.z?1:0),e+="/"+t.is_outline,t.dash_key&&(e+=t.dash_key,t.dash_background_color&&(e+=t.dash_background_color)),t.texture_merged&&(e+=t.texture_merged);var n=this.getBlendOrderForDraw(t);e=Wn(e+="/"+n),t.variant=e,null==this.variants[e]&&(this.variants[e]={key:e,blend_order:n,mesh_order:t.is_outline?0:1,selection:t.interactive?1:0,offset:t.offset?1:0,z_or_offset:t.offset||t.extrude||t.z?1:0,texcoords:t.texcoords,texture:t.texture_merged,dash:t.dash,dash_key:t.dash_key,dash_background_color:t.dash_background_color})},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.key]){var e=[{name:"a_position",size:4,type:Yr.SHORT,normalized:!1},{name:"a_extrude",size:2,type:Yr.SHORT,normalized:!1},{name:"a_offset",size:2,type:Yr.SHORT,normalized:!1,static:t.offset?null:[0,0]},{name:"a_z_and_offset_scale",size:2,type:Yr.SHORT,normalized:!1,static:t.z_or_offset?null:[0,0]},{name:"a_texcoord",size:2,type:Yr.UNSIGNED_SHORT,normalized:!0,static:t.texcoords?null:[0,0]},{name:"a_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.key]=new wo(e)}return this.vertex_layouts[t.key]},meshVariantTypeForDraw:function(t){return this.variants[t.variant]},makeVertexTemplate:function(t,e){var n=0;return this.vertex_template[n++]=0,this.vertex_template[n++]=0,this.vertex_template[n++]=1024*t.width_scale,this.vertex_template[n++]=this.scaleOrder(t.order),this.vertex_template[n++]=0,this.vertex_template[n++]=0,e.variant.offset&&(this.vertex_template[n++]=0,this.vertex_template[n++]=0),e.variant.z_or_offset&&(this.vertex_template[n++]=t.z||0,this.vertex_template[n++]=1024*t.offset_scale),e.variant.texcoords&&(this.vertex_template[n++]=0,this.vertex_template[n++]=0),this.vertex_template[n++]=255*t.color[0],this.vertex_template[n++]=255*t.color[1],this.vertex_template[n++]=255*t.color[2],this.vertex_template[n++]=255*(null!=t.alpha?t.alpha:t.color[3]),e.variant.selection&&(this.vertex_template[n++]=255*t.selection_color[0],this.vertex_template[n++]=255*t.selection_color[1],this.vertex_template[n++]=255*t.selection_color[2],this.vertex_template[n++]=255*t.selection_color[3]),this.addCustomAttributesToVertexTemplate(t,n),this.vertex_template},buildLines:function(t,e,n,r){if(this.feature_style=this.outline_feature_style,e.outline&&null!=e.outline.color&&null!=e.outline.width.value){var i=this.styles[e.outline.style];i&&i.addFeature(n.feature,e.outline,n)}this.feature_style=this.inline_feature_style;var o=this.getTileMesh(n.tile,this.meshVariantTypeForDraw(e)),s=o.vertex_data,a=s.vertex_layout;return function(t,e,n,r,i,o,s,a){var l,u=e.cap?hs[e.cap]:hs.butt,h=e.join?cs[e.join]:cs.miter;if(h===cs.miter)var c=e.miter_limit||3,f=c*c;i.a_texcoord&&(l=1/(e.texcoord_width*fs));for(var d={closed_polygon:o,remove_tile_edges:s,tile_edge_tolerance:a,miter_len_sq:f,join_type:h,cap_type:u,vertex_data:n,vertex_template:r,half_width:e.width/2,extrude_index:i.a_extrude,offset_index:i.a_offset,v_scale:l,texcoord_index:i.a_texcoord,texcoord_width:e.texcoord_width,offset:e.offset,geom_count:0},_=0;_<t.length;_++)ms(t[_],d);if(d.extra_lines)for(var p=0;p<d.extra_lines.length;p++)ms(d.extra_lines[p],d);return d.geom_count}(t,e,s,this.makeVertexTemplate(e,o),a.index,r&&r.closed_polygon,!e.tile_edges&&r&&r.remove_tile_edges,li.tile_scale*n.tile.pad_scale*2)},buildPolygons:function(t,e,n){for(var r=0,i=0;i<t.length;i++)r+=this.buildLines(t[i],e,n,{closed_polygon:!0,remove_tile_edges:!0});return r}}),D(D.P+D.F*c((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(t){var e=pt(this),n=v(e);return"number"!=typeof n||isFinite(n)?e.toISOString():null}}),ls("anchor",(function(t){return function(e){return t(this,"a","name",e)}}));var Ms=128/Math.PI,zs=16384/Math.PI,Rs=[0,2,2,0],Ls=[1,1,3,3],Cs=new Array(4),Os=["left","top-left","bottom-left"],Ns=["right","top-right","bottom-right"],Is=["top","top-left","top-right"],Fs=["bottom","bottom-left","bottom-right"],Ds={computeOffset:function(t,e,n,r){if(void 0===r&&(r=null),!n||"center"===n)return t;var i=[t[0],t[1]];return r=r||this.default_buffer,this.isLeftAnchor(n)?(i[0]-=e[0]/2,"left"===n&&(i[0]-=r[0])):this.isRightAnchor(n)&&(i[0]+=e[0]/2,"right"===n&&(i[0]+=r[1])),this.isTopAnchor(n)?(i[1]-=e[1]/2,"top"===n&&(i[1]-=r[2])):this.isBottomAnchor(n)&&(i[1]+=e[1]/2,"bottom"===n&&(i[1]+=r[3])),i},alignForAnchor:function(t){if(t&&"center"!==t){if(this.isLeftAnchor(t))return"right";if(this.isRightAnchor(t))return"left"}return"center"},isLeftAnchor:function(t){return Os.indexOf(t)>-1},isRightAnchor:function(t){return Ns.indexOf(t)>-1},isTopAnchor:function(t){return Is.indexOf(t)>-1},isBottomAnchor:function(t){return Fs.indexOf(t)>-1},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function Bs(t,e){return!(t[2]<e[0]||t[0]>e[2]||t[3]<e[1]||t[1]>e[3])}var js,Us,Gs,Zs,Vs=[[1,0],[0,1]],qs=[],Ws=[],Hs=function(){function t(t,e,n,r,i){this.dimension=[r/2,i/2],this.angle=n,this.centroid=[t,e],this.quad=null,this.axis_0=null,this.axis_1=null,this.update()}var e=t.prototype;return e.toJSON=function(){return{x:this.centroid[0],y:this.centroid[1],a:this.angle,w:this.dimension[0],h:this.dimension[1]}},e.getExtent=function(){return 0===this.angle?[this.quad[0],this.quad[1],this.quad[4],this.quad[5]]:[Math.min(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.min(this.quad[1],this.quad[3],this.quad[5],this.quad[7]),Math.max(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.max(this.quad[1],this.quad[3],this.quad[5],this.quad[7])]},e.updateAxes=function(){this.axis_0=Qr.normalize([this.quad[4]-this.quad[6],this.quad[5]-this.quad[7]]),this.axis_1=Qr.normalize([this.quad[4]-this.quad[2],this.quad[5]-this.quad[3]])},e.update=function(){var t=this.centroid,e=this.dimension[0],n=this.dimension[1];if(0===this.angle)this.quad=[t[0]-e,t[1]-n,t[0]+e,t[1]-n,t[0]+e,t[1]+n,t[0]-e,t[1]+n],this.axis_0=Vs[0],this.axis_1=Vs[1];else{var r=Math.cos(this.angle)*e,i=Math.sin(this.angle)*e,o=-Math.sin(this.angle)*n,s=Math.cos(this.angle)*n;this.quad=[t[0]-r-o,t[1]-i-s,t[0]+r-o,t[1]+i-s,t[0]+r+o,t[1]+i+s,t[0]-r+o,t[1]-i+s],this.updateAxes()}},t.projectToAxis=function(t,e,n){var r=t.quad;return js=r[0]*e[0]+r[1]*e[1],Us=r[2]*e[0]+r[3]*e[1],Gs=r[4]*e[0]+r[5]*e[1],Zs=r[6]*e[0]+r[7]*e[1],n[0]=Math.min(js,Us,Gs,Zs),n[1]=Math.max(js,Us,Gs,Zs),n},t.axisCollide=function(e,n,r,i){return t.projectToAxis(e,r,qs),t.projectToAxis(n,r,Ws),!(Ws[0]>qs[1]||Ws[1]<qs[0]||(t.projectToAxis(e,i,qs),t.projectToAxis(n,i,Ws),Ws[0]>qs[1]||Ws[1]<qs[0]))},t.intersect=function(e,n){return t.axisCollide(e,n,e.axis_0,e.axis_1)&&t.axisCollide(e,n,n.axis_0,n.axis_1)},t}(),Ys=function(){function t(e,n){void 0===n&&(n={}),this.id=t.nextLabelId(),this.type="",this.size=e,this.layout=n,this.position=null,this.angle=0,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.offset=n.offset,this.unit_scale=this.layout.units_per_pixel,this.aabb=null,this.obb=null,this.align="center",this.throw_away=!1}var e=t.prototype;return e.toJSON=function(){return{id:this.id,type:this.type,obb:this.obb.toJSON(),position:this.position,angle:this.angle,size:this.size,offset:this.offset,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:Xs(this.layout)}},e.update=function(){this.align=this.layout.align||Ds.alignForAnchor(this.anchor)},e.occluded=function(t,e){var n=this;void 0===e&&(e=null);var r=!1,i=t.aabb,o=t.obb;return i.length>0&&function(t,e,n){for(var r=0;r<e.length&&(!Bs(t,e[r])||null==n(r));r++);}(this.aabb,i,(function(t){if(!e||i[t]!==e.aabb)return 0===n.obb.angle&&0===o[t].angle||Hs.intersect(n.obb,o[t])?(r=!0,!0):void 0})),r},e.inTileBounds=function(){return this.aabb[0]>=0&&this.aabb[1]>-li.tile_scale&&this.aabb[0]<li.tile_scale&&this.aabb[1]<=0||this.aabb[2]>=0&&this.aabb[3]>-li.tile_scale&&this.aabb[2]<li.tile_scale&&this.aabb[3]<=0},e.mayRepeatAcrossTiles=function(){if(this.layout.collide)return!0;var t=this.layout.repeat_distance;return 0!==t&&(Math.abs(this.position[0])<t||Math.abs(this.position[0]-li.tile_scale)<t||Math.abs(this.position[1])<t||Math.abs(-(this.position[1]-li.tile_scale))<t)},e.discard=function(t,e){return void 0===e&&(e=null),!!this.throw_away||this.occluded(t,e)},t}();function Xs(t){return{priority:t.priority,collide:t.collide,repeat_distance:t.repeat_distance,repeat_group:t.repeat_group,buffer:t.buffer,italic:t.italic}}Ys.add=function(t,e){if(t.placed=!0,t.aabb&&(e.aabb.push(t.aabb),e.obb.push(t.obb)),t.aabbs)for(var n=0;n<t.aabbs.length;n++)e.aabb.push(t.aabbs[n]),e.obb.push(t.obbs[n])},Ys.id=0,Ys.id_prefix=0,Ys.id_multiplier=0,Ys.nextLabelId=function(){return Ys.id_prefix+Ys.id++*Ys.id_multiplier},Ys.epsilon=.9999;var $s=function(){function t(t,e){this.key=t,this.repeat_dist=e,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}var e=t.prototype;return e.check=function(t){for(var e=t.position,n=0;n<this.positions.length;n++){var r=this.positions[n],i=e[0]-r[0],o=e[1]-r[1];if(i*i+o*o<this.repeat_dist_sq)return!0}},e.add=function(t){t&&t.position&&this.positions.push(t.position)},t.clear=function(t){this.groups[t]={}},t.check=function(t,e,n){if(e.repeat_distance&&e.repeat_group&&this.groups[n][e.repeat_group])return this.groups[n][e.repeat_group].check(t)},t.add=function(e,n,r){n.repeat_distance&&n.repeat_group&&(null==this.groups[r][n.repeat_group]&&(this.groups[r][n.repeat_group]=new t(n.repeat_group,n.repeat_distance*n.repeat_scale)),this.groups[r][n.repeat_group].add(e))},t}();$s.groups={};var Js=function(){function t(t,e){this.anchor=t,this.span=e,this.cells={}}var e=t.prototype;return e.addLabel=function(t){var e=this;t.aabb&&this.addLabelBboxes(t,t.aabb),t.aabbs&&t.aabbs.forEach((function(n){return e.addLabelBboxes(t,n)}))},e.addLabelBboxes=function(t,e){var n=[Math.max(Math.floor((e[0]-this.anchor.x)/this.span),0),Math.max(Math.floor(-(e[1]-this.anchor.y)/this.span),0),Math.max(Math.floor((e[2]-this.anchor.x)/this.span),0),Math.max(Math.floor(-(e[3]-this.anchor.y)/this.span),0)];t.cells=[];for(var r=n[1];r<=n[3];r++){this.cells[r]=this.cells[r]||{};for(var i=n[0];i<=n[2];i++)this.cells[r][i]=this.cells[r][i]||{aabb:[],obb:[]},t.cells.push(this.cells[r][i])}},t}(),Ks={tiles:{},grid:null,initGrid:function(t){this.grid=null==t?null:new Js(t.anchor,t.span)},startTile:function(t,e){var n=void 0===e?{}:e,r=n.apply_repeat_groups,i=void 0===r||r,o=n.return_hidden,s=void 0!==o&&o,a=this.tiles[t]={bboxes:{aabb:[],obb:[]},objects:{},labels:{},styles:{},repeat:i,return_hidden:s};null==a.complete&&(a.complete=new Promise((function(t,e){a.resolve=t,a.reject=e})))},resetTile:function(t){delete this.tiles[t]},abortTile:function(t){this.tiles[t]&&this.tiles[t].resolve&&this.tiles[t].resolve([]),this.resetTile(t)},addStyle:function(t,e){this.tiles[e].styles[t]=!0},collide:function(t,e,n){var r=this.tiles[n];if(!r)return Ji("trace","Collision.collide() called with null tile",n,this.tiles,e,t),Promise.resolve([]);for(var i=r.objects,o=0;o<t.length;o++){var s=t[o],a=s.label.layout.priority;i[a]=i[a]||{},i[a][e]=i[a][e]||[],i[a][e].push(s)}return delete r.styles[e],0===Object.keys(r.styles).length&&this.endTile(n),r.complete.then((function(){return r.resolve=null,r.labels[e]||[]}))},endTile:function(t){var e=this.tiles[t],n=e.labels;this.grid&&this.addLabelsToGrid(t),e.repeat&&$s.clear(t);for(var r=Object.keys(e.objects).sort((function(t,e){return t-e})),i=0;i<r.length;i++){var o=e.objects[r[i]];if(o)for(var s in o){var a=o[s];n[s]=n[s]||[];for(var l=0;l<a.length;l++){var u=a[l];this.canBePlaced(u,t,u.linked,e)?u.linked?this.canBePlaced(u.linked,t,u,e)?(u.show=!0,(u.label.breach||u.linked.label.breach)&&(u.label.breach=!0,u.linked.label.breach=!0),(u.label.may_repeat_across_tiles||u.linked.label.may_repeat_across_tiles)&&(u.label.may_repeat_across_tiles=!0,u.linked.label.may_repeat_across_tiles=!0),n[s].push(u),this.place(u,t,e),this.place(u.linked,t,e)):e.return_hidden&&(u.show=!1,n[s].push(u)):(u.show=!0,n[s].push(u),this.place(u,t,e)):e.return_hidden&&(u.show=!1,n[s].push(u))}}}delete this.tiles[t],e.resolve()},addLabelsToGrid:function(t){var e=this,n=this.tiles[t];for(var r in n.objects){var i=n.objects[r];if(i)for(var o in i)i[o].forEach((function(t){return e.grid.addLabel(t.label)}))}},canBePlaced:function(t,e,n,r){void 0===n&&(n=null);var i=(void 0===r?{}:r).repeat,o=void 0===i||i,s=t.label,a=t.label.layout;if(null!=s.placed)return s.placed;var l=!a.collide;if(l||(l=this.grid&&s.cells?s.cells.reduce((function(t,e){return t&&s.discard(e,n&&n.label)&&(t=!1),t}),!0):!s.discard(this.tiles[e].bboxes,n&&n.label)),l){if(!o||!$s.check(s,a,e))return!0;s.placed=!1}else a.collide&&(s.placed=!1);return s.placed},place:function(t,e,n){var r=t.label,i=n.repeat,o=void 0===i||i;null==r.placed&&(o&&$s.add(r,r.layout,e),this.grid&&r.cells?r.cells.forEach((function(t){return Ys.add(r,t)})):Ys.add(r,this.tiles[e].bboxes))}},Qs=function(t){function e(e,n,r,i){var o;return void 0===i&&(i=0),(o=t.call(this,n,r)||this).type="point",o.position=[e[0],e[1]],o.angle=i,o.parent=o.layout.parent,o.update(),o.start_anchor_index=1,o.degenerate=!(o.size[0]||o.size[1]||o.layout.buffer[0]||o.layout.buffer[1]),o.throw_away=!1,o}Ri(e,t);var n=e.prototype;return n.update=function(){t.prototype.update.call(this),this.computeOffset(),this.updateBBoxes()},n.computeOffset=function(){if(this.offset=[this.layout.offset[0],this.layout.offset[1]],this.parent){var t=this.parent;this.offset=Ds.computeOffset(this.offset,t.size,t.anchor,Ds.zero_buffer),this.offset=Ds.computeOffset(this.offset,t.size,this.anchor,Ds.zero_buffer),t.offset!==Or.zeroPair&&(this.offset===Or.zeroPair?this.offset=t.offset:(this.offset[0]+=t.offset[0],this.offset[1]+=t.offset[1]))}this.offset=Ds.computeOffset(this.offset,this.size,this.anchor)},n.updateBBoxes=function(){var t=(this.size[0]+2*this.layout.buffer[0])*this.unit_scale*Ys.epsilon,e=(this.size[1]+2*this.layout.buffer[1])*this.unit_scale*Ys.epsilon;this.layout.italic&&(t+=5*this.unit_scale),this.obb=new Hs(this.position[0]+this.offset[0]*this.unit_scale,this.position[1]-this.offset[1]*this.unit_scale,-this.angle,t,e),this.aabb=this.obb.getExtent(),this.inTileBounds&&(this.breach=!this.inTileBounds()),this.mayRepeatAcrossTiles&&(this.may_repeat_across_tiles=this.mayRepeatAcrossTiles())},n.discard=function(e,n){if(void 0===n&&(n=null),this.degenerate)return!1;if(t.prototype.discard.call(this,e,n)){if(Array.isArray(this.layout.anchor))for(var r=this.start_anchor_index;r<this.layout.anchor.length;r++)if(this.anchor=this.layout.anchor[r],this.update(),!t.prototype.discard.call(this,e,n))return!1;return!0}return!1},e}(Ys);Qs.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var ta=Qs.PLACEMENT;function ea(t,e,n){var r=[],i=n.placement,o=Math.max(e[0],e[1])*n.placement_min_length_ratio*n.units_per_pixel;if(i===ta.SPACED){var s=function(t,e,n){var r=n.units_per_pixel,i=(n.placement_spacing||80)*r,o=function(t){for(var e=0,n=0;n<t.length-1;n++)e+=na(t[n],t[n+1]);return e}(t);if(o<=e)return!1;for(var s=Math.max(Math.floor(o/i),1),a=[],l=[],u=.5*(o-(s-1)*i),h=0;h<s;h++){var c=ra(t,u,e,n),f=c.position,d=c.angle;null!=f&&null!=d&&(a.push(f),l.push(d)),u+=i}return{positions:a,angles:l}}(t,o,n);if(!s)return[];for(var a=s.positions,l=s.angles,u=0;u<a.length;u++){var h=a[u],c=l[u];!0!==n.tile_edges&&ko(h)||r.push(new Qs(h,e,n,c))}}else if(i===ta.VERTEX){for(var f,d,_=0;_<t.length-1;_++)if(f=t[_],d=t[_+1],!0===n.tile_edges||!ko(f)){var p=ia(f,d,n.angle);r.push(new Qs(f,e,n,p))}var m=ia(f,d,n.angle);r.push(new Qs(d,e,n,m))}else if(i===ta.MIDPOINT)for(var v=0;v<t.length-1;v++){var g=t[v],y=t[v+1],x=[.5*(g[0]+y[0]),.5*(g[1]+y[1])];if((!0===n.tile_edges||!ko(x))&&(!o||na(g,y)>o)){var b=ia(g,y,n.angle);r.push(new Qs(x,e,n,b))}}return r}function ia(t,e,n){return void 0===n&&(n=0),"auto"===n?Math.atan2(e[0]-t[0],e[1]-t[1]):n}function na(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function ra(t,e,n,r){for(var i,o,s=0,a=0;a<t.length-1;a++){var l=t[a],u=t[a+1],h=na(l,u);if(!(h<=n)&&(s+=h)>e){i=oa(l,u,s-e),o=ia(l,u,r.angle);break}}return{position:i,angle:o}}function oa(t,e,n){var r=n/na(t,e);return[r*t[0]+(1-r)*e[0],r*t[1]+(1-r)*e[1]]}var sa={key:function(t){return[t.style,t.weight,t.family,t.px_size,t.fill,t.stroke,t.stroke_width,t.underline_width,t.background_color,t.background_width,t.background_stroke_color,t.background_stroke_width,t.transform,t.text_wrap,t.max_lines,t.supersample,en.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:"normal",size:"12px",px_size:12,family:"Helvetica",fill:[1,1,1,1],text_wrap:15,max_lines:5,align:"center"},compute:function(t,e){var n={};t.font=t.font||this.defaults,n.supersample=t.supersample_text?1.5:1,n.can_articulate=t.can_articulate,n.fill=Or.evalCachedColorPropertyWithAlpha(t.font.fill,t.font.alpha,e),n.fill=en.toCSSColor(n.fill),t.font.stroke&&t.font.stroke.color&&(n.stroke=Or.evalCachedColorPropertyWithAlpha(t.font.stroke.color,t.font.stroke.alpha,e),n.stroke=en.toCSSColor(n.stroke),n.stroke_width=Or.evalCachedProperty(t.font.stroke.width,e)),!0!==t.font.underline||n.can_articulate||(n.underline_width=1.5*n.supersample),t.font.background&&!n.can_articulate&&(n.background_color=Or.evalCachedColorPropertyWithAlpha(t.font.background.color,t.font.background.alpha,e),n.background_color=en.toCSSColor(n.background_color),n.background_color&&(n.background_width=Or.evalCachedProperty(t.font.background.width,e)),n.background_stroke_color=t.font.background.stroke&&t.font.background.stroke.color&&Or.evalCachedColorPropertyWithAlpha(t.font.background.stroke.color,t.font.background.stroke.alpha,e),n.background_stroke_color&&(n.background_stroke_color=en.toCSSColor(n.background_stroke_color),n.background_stroke_width=null!=t.font.background.stroke.width?Or.evalCachedProperty(t.font.background.stroke.width,e):1)),n.weight=Or.evalCachedProperty(t.font.weight,e)||this.defaults.weight,"number"==typeof n.weight&&(n.weight=Math.min(Math.max(n.weight,1),1e3)),t.font.family?(n.family=t.font.family,n.family!==this.defaults.family&&(n.family+=", "+this.defaults.family)):n.family=this.defaults.family,n.style=t.font.style||this.defaults.style,n.transform=t.font.transform,n.px_size=Or.evalCachedProperty(t.font.px_size,e)*n.supersample,n.font_css=this.fontCSS(n);var r=t.text_wrap;return null!=r||n.can_articulate||(r=!0),!0===r&&(r=this.defaults.text_wrap),n.text_wrap=r,n.max_lines=t.max_lines||this.defaults.max_lines,n},fontCSS:function(t){return[t.style,t.weight,t.px_size+"px",t.family].filter((function(t){return t})).join(" ")}},aa=e((function(t){!function(){function e(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function n(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+e+";"}function i(t){var e=t.a.offsetWidth,n=e+100;return t.f.style.width=n+"px",t.c.scrollLeft=n,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,!0)}function o(t,n){function r(){var t=o;i(t)&&t.a.parentNode&&n(t.g)}var o=t;e(t.b,r),e(t.c,r),i(t)}function s(t,e){var n=e||{};this.family=t,this.style=n.style||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"normal"}var a=null,l=null,u=null,h=null;function c(){if(null===u){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}u=""!==t.style.font}return u}function f(t,e){return[t.style,t.weight,c()?t.stretch:"","100px",e].join(" ")}s.prototype.load=function(t,e){var i=this,s=t||"BESbswy",u=0,c=e||3e3,d=(new Date).getTime();return new Promise((function(t,e){var _;if(null===h&&(h=!!document.fonts),(_=h)&&(null===l&&(l=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),_=!l),_){_=new Promise((function(t,e){!function n(){(new Date).getTime()-d>=c?e():document.fonts.load(f(i,'"'+i.family+'"'),s).then((function(e){1<=e.length?t():setTimeout(n,25)}),(function(){e()}))}()}));var p=new Promise((function(t,e){u=setTimeout(e,c)}));Promise.race([p,_]).then((function(){clearTimeout(u),t(i)}),(function(){e(i)}))}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function l(){var e;(e=-1!=m&&-1!=v||-1!=m&&-1!=g||-1!=v&&-1!=g)&&((e=m!=v&&m!=g&&v!=g)||(null===a&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=a&&(m==y&&v==y&&g==y||m==x&&v==x&&g==x||m==b&&v==b&&g==b)),e=!e),e&&(w.parentNode&&w.parentNode.removeChild(w),clearTimeout(u),t(i))}var h=new n(s),_=new n(s),p=new n(s),m=-1,v=-1,g=-1,y=-1,x=-1,b=-1,w=document.createElement("div");w.dir="ltr",r(h,f(i,"sans-serif")),r(_,f(i,"serif")),r(p,f(i,"monospace")),w.appendChild(h.a),w.appendChild(_.a),w.appendChild(p.a),document.body.appendChild(w),y=h.a.offsetWidth,x=_.a.offsetWidth,b=p.a.offsetWidth,function t(){if((new Date).getTime()-d>=c)w.parentNode&&w.parentNode.removeChild(w),e(i);else{var n=document.hidden;!0!==n&&void 0!==n||(m=h.a.offsetWidth,v=_.a.offsetWidth,g=p.a.offsetWidth,l()),u=setTimeout(t,50)}}(),o(h,(function(t){m=t,l()})),r(h,f(i,'"'+i.family+'",sans-serif')),o(_,(function(t){v=t,l()})),r(_,f(i,'"'+i.family+'",serif')),o(p,(function(t){g=t,l()})),r(p,f(i,'"'+i.family+'",monospace'))}))}))},t.exports=s}()})),la={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(t){var e=this,n=JSON.stringify(t)===this.last_loaded;return t&&!n&&function(){var n=[],r=function(r){Array.isArray(t[r])?t[r].forEach((function(t){return n.push(e.loadFontFace(r,t))})):n.push(e.loadFontFace(r,t[r]))};for(var i in t)r(i);e.last_loaded=JSON.stringify(t),e.fonts_loaded=Promise.all(n.filter((function(t){return t})))}(),this.fonts_loaded},loadFontFace:function(t,e){return new Promise(function(n,r){var i,o;if(null==e||"object"!=typeof e&&"external"!==e)return n();if(i={family:t},"object"==typeof e){if(Object.assign(i,e),"string"==typeof e.url)return Promise.resolve(this.injectFontFace(i)).then(function(t){try{return s.call(this)}catch(t){return r(t)}}.bind(this),r);function s(){return a.call(this)}return s.call(this)}function a(){var e=function(){try{return n()}catch(t){return r(t)}},s=function(n){try{return Ji("warn","Font face '"+t+"' is NOT available",i,n),e()}catch(t){return r(t)}};try{return i.weight="string"==typeof i.weight?i.weight.split(" ")[0]:i.weight,o=new aa(t,i),Promise.resolve(o.load()).then((function(n){try{return Ji("debug","Font face '"+t+"' is available",i),e()}catch(t){return s(t)}}),s)}catch(t){s(t)}}return a.call(this)}.bind(this))},injectFontFace:function(t){return new Promise(function(e,n){var r,i,o,s,a,l,u,h,c,f,d;if(r=t.family,i=t.url,o=t.weight,s=t.style,void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace),a=i,"blob:"===i.slice(0,5))return Promise.resolve(en.io(i,6e4,"arraybuffer")).then(function(t){try{if(a=t.body,l=new Uint8Array(a),this.supports_native_font_loading)a=l;else{for(u="",h=0;h<l.length;h++)u+=String.fromCharCode(l[h]);a="data:font/opentype;base64,"+btoa(u)}return _.call(this)}catch(t){return n(t)}}.bind(this),n);function _(){return this.supports_native_font_loading?("string"==typeof a?c=new FontFace(r,"url("+encodeURI(a)+")",{weight:o,style:s}):a instanceof Uint8Array&&(c=new FontFace(r,a,{weight:o,style:s})),document.fonts.add(c),Ji("trace","Adding FontFace to document.fonts:",c)):(f="\n                @font-face {\n                    font-family: '"+r+"';\n                    font-weight: "+(o||"normal")+";\n                    font-style: "+(s||"normal")+";\n                    src: url("+encodeURI(a)+");\n                }",(d=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(d),d.sheet.insertRule(f,0),Ji("trace","Injecting CSS font face:",f)),e()}return _.call(this)}.bind(this))}},ua=new RegExp("[֑-߿‏‫‮יִ-﷽ﹰ-ﻼ]");function ha(t){return ua.test(t)}var ca="\0-/:-@[-`{-¿×÷ʹ-˿ -⯿‐-\u2029‬ -⯿",fa=new RegExp("["+ca+"]+");function da(t){return fa.test(t)}var pa=new RegExp("^["+ca+"؀-ۿ]+"),_a=new RegExp("["+ca+"آ-إاد-زوٱ-ٷڈ-ڙۄ-ۋۏےۓۮۯ]"),ma=new RegExp("^[ؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ۭ]+"),ga="[̀-֑ͯ-ׇֽֿׁׂׅׄަ-ްऀ-ःऺ-ौॎॏ॑-ॗॢॣঁ-ঃ়া-ৌৗৢৣਁ-ਃ਼-ੌੑઁ-ઃ઼ા-ૌૢૣଁ-ଃ଼ା-ୌୖୗୢୣஂா-்ௗఀ-ఃా-ౌౕౖౢౣಁ-ಃ಼ಾ-ೌೕೖೢೣഁ-ഃാ-ൌൎൗൢൣංඃ්-ෟෲෳัิ-ฺ็-๎ັິ-ຼ່-ໍ༹༘༙༵༷༾༿ཱ-ྃ྆྇ྍ-ྼ࿆ါ-း်-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ឴-៑៓ᩕ-ᩞᩡ-᩼᷀-᷿⃐-⃿]",va=new RegExp("^.(?:"+ga+"+)?([्্੍્୍్್്྄္្᩠᩿]\\W(?:"+ga+"+)?)*"),ya={Mongolian:"᠀-᢯"},ba=Object.keys(ya).map((function(t){return ya[t]})).join(""),xa=new RegExp("["+ba+"]");function wa(t,e,n){var r=e?1:2;if(t.length<r)return[t];var i=t;if(n.segment[i])return n.stats.segment_hits++,n.segment[i];var o=[];if(pa.exec(t)){o=t.split(_a);for(var s=-1,a=0;a<o.length-1;a++){if(a>0){var l=ma.exec(o[a]);l&&(o[a]=o[a].substring(l[0].length),o[a-1]+=l[0],s+=l[0].length)}s+=1+o[a].length,o[a]+=t.slice(s,s+1)}t=""}for(;t.length;){for(var u="",h=t,c=0;c<r&&h.length;c++){var f=(va.exec(h)||h)[0];u+=f,h=h.substring(f.length)}o.push(u),t=t.substring(u.length)}return e&&o.reverse(),n.stats.segment_misses++,n.segment[i]=o,o}var Ta=function(){function t(t,e,n){void 0===e&&(e=1/0),void 0===n&&(n=1/0),this.width=0,this.height=0,this.lines=[],this.max_lines=e,this.text_wrap=n,this.context=t}var e=t.prototype;return e.createLine=function(t){return this.lines.length<this.max_lines&&new Aa(t,this.text_wrap)},e.push=function(t){if(this.lines.length<this.max_lines){var e=this.context.measureText(t.text).width;return t.width=e,e>this.width&&(this.width=Math.ceil(e)),this.lines.push(t),this.height+=t.height,!0}return this.addEllipsis(),!1},e.advance=function(t,e){return!!this.push(t)&&this.createLine(e)},e.addEllipsis=function(){var e=this.lines[this.lines.length-1],n=Math.ceil(this.context.measureText(t.ellipsis).width);e.append(t.ellipsis),e.width+=n,e.width>this.width&&(this.width=e.width)},e.finish=function(t){t?this.push(t):this.addEllipsis()},t.parse=function(e,n,r,i,o){var s;s="number"==typeof n?e.split(" "):[e];for(var a=new t(o,r,n),l=a.createLine(i),u=0;u<s.length;u++){for(var h=s[u].split("\n"),c=0===u,f=0;f<h.length&&l;f++){var d=h[f];ha(d)&&da(d[d.length-1])&&(d+="‏");var _=c?d:" "+d;if(n&&u>0&&l.exceedsTextwrap(_)){if(!(l=a.advance(l,i)))break;l.append(d),c=!0}else l.append(_);f<h.length-1&&(l=a.advance(l,i),c=!0)}u===s.length-1&&a.finish(l)}return a},t}();Ta.ellipsis="...";var Aa=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.chars=0,this.text="",this.height=Math.ceil(t),this.text_wrap=e}var e=t.prototype;return e.append=function(t){this.chars+=t.length,this.text+=t},e.exceedsTextwrap=function(t){return t.length+this.chars>this.text_wrap},t}(),Ea=function(){function t(){this.createCanvas(),this.vertical_text_buffer=8,this.horizontal_text_buffer=4,this.background_size=4}var e=t.prototype;return e.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.style.backgroundColor="transparent",this.context=this.canvas.getContext("2d")},e.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.context.clearRect(0,0,t,e)},e.setFont=function(t){var e=t.font_css,n=t.fill,r=t.stroke,i=t.stroke_width,o=t.px_size,s=t.supersample;this.px_size=o;var a=this.context,l=en.device_pixel_ratio*s;r&&i>0&&(a.strokeStyle=r,a.lineWidth=i*l),a.fillStyle=n,a.font=e,a.miterLimit=2},e.textSizes=function(t,e){return new Promise(function(n,r){return Promise.resolve(la.loadFonts()).then(function(i){try{return n(Tn.add({type:"textSizes",run:this.processTextSizesTask.bind(this),texts:e,tile_id:t,cursor:{styles:Object.keys(e),texts:null,style_idx:null,text_idx:null}}))}catch(t){return r(t)}}.bind(this),r)}.bind(this))},e.processTextSizesTask=function(e){var n,r=e.cursor,i=e.texts;for(r.style_idx=r.style_idx||0;r.style_idx<r.styles.length;){var o=r.styles[r.style_idx];null==r.text_idx&&(r.text_idx=0,r.texts=Object.keys(i[o]));for(var s=i[o],a=!0;r.text_idx<r.texts.length;){var l=r.texts[r.text_idx],u=s[l],h=u.text_settings;if(a&&(this.setFont(h),a=!1),u.size=this.textSize(o,l,h).size,h.can_articulate){var c=!1,f=!1;if(ha(l)&&(da(l)?c=!0:f=!0),u.isRTL=c,u.no_curving=f||(n=l,xa.test(n)),u.vertical_buffer=this.vertical_text_buffer,u.segment_sizes=[],!u.no_curving){var d=wa(l,c,t.cache);u.segments=d;for(var _=0;_<d.length;_++)u.segment_sizes.push(this.textSize(o,d[_],h).size)}}if(r.text_idx++,!Tn.shouldContinue(e))return!1}r.text_idx=null,r.style_idx++}return Tn.finish(e,i),!0},e.textSize=function(e,n,r){var i=r.transform,o=r.text_wrap,s=r.max_lines,a=r.stroke_width,l=void 0===a?0:a,u=r.background_color,h=r.background_stroke_width,c=void 0===h?0:h,f=r.background_width,d=r.underline_width,_=void 0===d?0:d,p=r.supersample;if(t.cache.text[e]=t.cache.text[e]||{},t.cache.text[e][n])return t.cache.stats.text_hits++,t.cache.text[e][n];t.cache.stats.text_misses++,t.cache.text_count++;var m=en.device_pixel_ratio*p,v=this.applyTextTransform(n,i),g=this.context,y=this.vertical_text_buffer*m,x=(l+this.horizontal_text_buffer)*m;f=null!=f?f:this.background_size;var b=u||c?(f+c)*m:0,w=(2+_+(_?l+1:0))*m,T=this.px_size+w,A=Ta.parse(v,o,s,T,g),E=A.width,k=A.height,S=A.lines,P=[(E+=2*b)/m,(k+=2*b)/m],M=[E+2*x,k+2*y],z=[M[0]/m,M[1]/m];return t.cache.text[e][n]={lines:S,size:{collision_size:P,texture_size:M,logical_size:z,horizontal_buffer:x,vertical_buffer:y,dpr:m,line_height:T,background_size:b}},t.cache.text[e][n]},e.drawTextMultiLine=function(t,e,n,r,i){var o=e[0],s=e[1],a=n.dpr,l=n.collision_size,u=n.texture_size,h=n.line_height,c=n.horizontal_buffer,f=n.vertical_buffer;if(r.background_color||r.background_stroke_color){var d=r.background_stroke_color,_=(r.background_stroke_width||0)*a;this.context.save(),r.background_color&&(this.context.fillStyle=r.background_color,this.context.fillRect(o+c+("curved"===i?u[0]:0)+_,s+f+_,a*l[0]-2*_,a*l[1]-2*_)),d&&_&&(this.context.strokeStyle=d,this.context.lineWidth=_,this.context.strokeRect(o+c+("curved"===i?u[0]:0)+.5*_,s+f+.5*_,a*l[0]-_,a*l[1]-_)),this.context.restore()}for(var p=r.underline_width||0,m=r.stroke_width||0,v=s-(p?.5*(p+m+1)*a:0),g=0;g<t.length;g++){var y=t[g];this.drawTextLine(y,[o,v],n,r,i),v+=h}this.drawTextDebug([o,s],n,i)},e.drawTextLine=function(t,e,n,r,i){var o,s=e[0],a=e[1],l=r.stroke,u=r.stroke_width,h=r.transform,c=r.align,f=void 0===c?"center":c,d=n.horizontal_buffer,_=n.vertical_buffer,p=n.texture_size,m=n.background_size,v=n.line_height,g=n.dpr,y=(r.underline_width||0)*g,x=this.applyTextTransform(t.text,h);"left"===f?o=s+d+m:"center"===f?o=s+p[0]/2-t.width/2:"right"===f&&(o=s+p[0]-t.width-d-m);var b=a+.75*_+v+m-.5*y,w=l&&u>0&&"curved"===i?p[0]:0;if(y){this.context.save(),this.context.strokeStyle=this.context.fillStyle,this.context.lineWidth=y;var T=b+(.5*u+2)*g+.5*this.context.lineWidth;this.context.beginPath(),this.context.moveTo(o+w,T),this.context.lineTo(o+w+t.width,T),this.context.stroke(),this.context.restore()}l&&u>0&&this.context.strokeText(x,o+w,b),this.context.fillText(x,o,b)},e.drawTextDebug=function(t,e,n){var r=t[0],i=t[1],o=e.dpr,s=e.horizontal_buffer,a=e.vertical_buffer,l=e.texture_size,u=e.collision_size;nn.draw_label_collision_boxes&&(this.context.save(),this.context.strokeStyle="blue",this.context.lineWidth=2,this.context.strokeRect(r+s,i+a,o*u[0],o*u[1]),"curved"===n&&this.context.strokeRect(r+l[0]+s,i+a,o*u[0],o*u[1]),this.context.restore()),nn.draw_label_texture_boxes&&(this.context.save(),this.context.strokeStyle="green",this.context.lineWidth=2,this.context.strokeRect(r+2,i+2,l[0]-4,l[1]-4),"curved"===n&&this.context.strokeRect(r+2+l[0],i+2,l[0]-4,l[1]-4),this.context.restore())},e.rasterize=function(t,e,n,r,i){return Tn.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:this.cancelRasterizeTask.bind(this),pause_factor:2,user_moving_view:!1,texts:t,textures:e,texture_prefix:r,gl:i,tile_id:n,cursor:{styles:Object.keys(t),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_resize:!0,texture_names:[]}})},e.processRasterizeTask=function(t){for(var e,n=t.cursor,r=t.texts,i=t.textures;n.texture_idx<t.textures.length;){for(e=i[n.texture_idx],n.texture_resize&&(n.texture_resize=!1,this.resize.apply(this,e.texture_size));n.style_idx<n.styles.length;){var o=n.styles[n.style_idx];null==n.text_idx&&(n.text_idx=0,n.texts=Object.keys(r[o]));for(var s=r[o],a=!0;n.text_idx<n.texts.length;){var l=n.texts[n.text_idx],u=s[l],h=u.text_settings;if(a&&(this.setFont(h),a=!1),h.can_articulate){u.texcoords=u.texcoords||{};for(var c=0;c<u.type.length;c++){var f=u.type[c];if("straight"===f){if(u.textures[c]!==n.texture_idx)continue;var d=u.isRTL?l.split().reverse().join():l,_=e.texcoord_cache[o][d],p=void 0;if(_.texcoord)p=_.texcoord;else{var m=_.texture_position,v=this.textSize(o,d,h),g=v.size,y=v.lines;this.drawTextMultiLine(y,m,g,h,f),p=Gn.getTexcoordsForSprite(m,g.texture_size,e.texture_size),_.texcoord=p}u.texcoords[f]={texcoord:p,texture_id:_.texture_id}}else if("curved"===f){var x=u.segments;u.texcoords.curved=u.texcoords.curved||[],u.texcoords_stroke=u.texcoords_stroke||[];for(var b=0;b<x.length;b++)if(u.textures[c][b]===n.texture_idx){var w=x[b],T=e.texcoord_cache[o][w],A=void 0,E=void 0;if(T.texcoord)A=T.texcoord,E=T.texcoord_stroke,u.texcoords_stroke.push(E);else{var k=T.texture_position,S=this.textSize(o,w,h),P=S.size,M=S.lines;this.drawTextMultiLine(M,k,P,h,f),A=Gn.getTexcoordsForSprite(k,P.texture_size,e.texture_size);var z=[k[0]+P.texture_size[0],k[1]];E=Gn.getTexcoordsForSprite(z,P.texture_size,e.texture_size),T.texcoord=A,T.texcoord_stroke=E,u.texcoords_stroke.push(E)}u.texcoords.curved.push({texcoord:A,texture_id:T.texture_id})}}}}else{var R=this.textSize(o,l,h).lines,L=Object.assign({},h);for(var C in u.align)u.align[C].texture_id===n.texture_idx&&(L.align=C,this.drawTextMultiLine(R,u.align[C].texture_position,u.size,L),u.align[C].texcoords=Gn.getTexcoordsForSprite(u.align[C].texture_position,u.size.texture_size,e.texture_size))}if(n.text_idx++,!Tn.shouldContinue(t))return!1}n.text_idx=null,n.style_idx++}var O=t.texture_prefix+n.texture_idx;Gn.create(t.gl,O,{element:this.canvas,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),Gn.retain(O),n.texture_names.push(O),n.texture_idx++,n.texture_resize=!0,n.style_idx=0}return Tn.finish(t,n.texture_names),!0},e.cancelRasterizeTask=function(t){Ji("trace","RasterizeTask: release textures ["+t.cursor.texture_names.join(", ")+"]"),t.cursor.texture_names.forEach((function(t){return Gn.release(t)}))},e.setTextureTextPositions=function(t,e){var n={cx:0,cy:0,width:0,height:0,column_width:0,texture_id:0,texcoord_cache:{}},r=[];for(var i in t){var o=t[i];for(var s in o){var a=o[s],l=void 0;if(a.text_settings.can_articulate){a.textures=[],n.texcoord_cache[i]=n.texcoord_cache[i]||{};for(var u=0;u<a.type.length;u++){var h=a.type[u];if("straight"===h){var c=a.isRTL?s.split().reverse().join():s;if(!n.texcoord_cache[i][c]){var f=a.size.texture_size;l=this.placeText(f[0],f[1],i,n,r,e),n.texcoord_cache[i][c]={texture_id:n.texture_id,texture_position:l}}a.textures[u]=n.texture_id}else if("curved"===h){a.textures[u]=[];for(var d=0;d<a.segment_sizes.length;d++){var _=a.segments[d];if(!n.texcoord_cache[i][_]){var p=a.segment_sizes[d].texture_size,m=2*p[0];l=this.placeText(m,p[1],i,n,r,e),n.texcoord_cache[i][_]={texture_id:n.texture_id,texture_position:l}}a.textures[u].push(n.texture_id)}}}}else{var v=a.size.texture_size;for(var g in a.align)l=this.placeText(v[0],v[1],i,n,r,e),a.align[g].texture_id=n.texture_id,a.align[g].texture_position=l}}}return n.column_width>0&&n.height>0&&(r[n.texture_id]={texture_size:[n.width,n.height],texcoord_cache:n.texcoord_cache}),r},e.placeText=function(t,e,n,r,i,o){var s;return r.cy+e>o?(r.cx+=r.column_width,r.cy=0,r.column_width=t):r.column_width=Math.max(r.column_width,t),r.cx+r.column_width<=o?(s=[r.cx,r.cy],r.cy+=e,r.height=Math.max(r.height,r.cy),r.width=Math.max(r.width,r.cx+r.column_width)):(i[r.texture_id]={texture_size:[r.width,r.height],texcoord_cache:r.texcoord_cache},r.texcoord_cache={},r.texcoord_cache[n]={},r.texture_id++,r.cx=0,r.cy=e,r.column_width=t,r.width=t,r.height=e,s=[0,0]),s},e.applyTextTransform=function(t,e){return"capitalize"===e?t.replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1)})):"uppercase"===e?t.toUpperCase():"lowercase"===e?t.toLowerCase():t},t.fontPixelSize=function(e){if(null!=e){var n=(e="string"==typeof e?e:String(e)).match(t.font_size_re)||[],r=n[1],i=n[2];return"em"===(i=i||"px")?r*=16:"pt"===i?r/=.75:"%"===i&&(r/=6.25),(r=Or.parsePositiveNumber(r))*en.device_pixel_ratio}},t.pruneTextCache=function(){t.cache.text_count>t.cache.text_count_max&&(t.cache.text={},t.cache.text_count=0,Ji("debug","TextCanvas: pruning text cache")),Object.keys(t.cache.segment).length>t.cache.segment_count_max&&(t.cache.segment={},Ji("debug","TextCanvas: pruning segment cache"))},t}();Ea.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,Ea.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}};var ka=0,Sa={resetText:function(){Ut.is_main?this.canvas=new Ea:Ut.is_worker&&(this.texts={})},freeText:function(t){delete this.texts[t.id]},parseTextFeature:function(t,e,n,r){var i=this.parseTextSource(t,e,n);if(null!=i&&""!==i){var o=sa.compute(e,n),s=sa.key(o);this.texts[r.id]=this.texts[r.id]||{};var a=this.texts[r.id][s]=this.texts[r.id][s]||{};if(i instanceof Object){var l=[],u=i.left+"-"+i.right;for(var h in i){var c=i[h];if(c){var f=this.computeTextLayout({},t,e,n,r,c,o,u,h);a[c]||(a[c]={text_settings:o,ref:0}),l.push({draw:e,text:c,text_settings_key:s,layout:f})}}return l.length>0&&l}var d=this.computeTextLayout({},t,e,n,r,i,o);return a[i]||(a[i]={text_settings:o,ref:0}),{draw:e,text:i,text_settings_key:s,layout:d}}},parseTextSource:function(t,e,n){var r,i=e.text_source||"name";if(null==i||Array.isArray(i)||"object"!=typeof i)r=this.parseTextSourceValue(i,t,n);else for(var o in r={},i)r[o]=this.parseTextSourceValue(i[o],t,n);return r},parseTextSourceValue:function(t,e,n){var r;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if("string"==typeof t[i]?r=e.properties[t[i]]:"function"==typeof t[i]&&(r=t[i](n)),r)return r}else"string"==typeof t?r=e.properties[t]:t instanceof Function&&(r=t(n));return r},prepareTextLabels:function(t,e){return new Promise(function(n,r){var i;if(0===Object.keys(this.texts[t.id]||{}).length)return n([]);var o=function(e){try{return Ks.abortTile(t.id),n([])}catch(t){return r(t)}};try{return Promise.resolve(Zi.postMessage(this.main_thread_target+".calcTextSizes",t.id,this.texts[t.id])).then(function(r){try{return i=r,t.canceled?(Ji("trace","Style "+this.name+": stop tile build because tile was canceled: "+t.key+", post-calcTextSizes()"),n([])):(this.texts[t.id]=i||[],i?n(this.buildTextLabels(t,e)):(Ks.abortTile(t.id),n([])))}catch(t){return o()}}.bind(this),o)}catch(t){o()}}.bind(this))},collideAndRenderTextLabels:function(t,e,n){return new Promise(function(r,i){var o,s,a;return Promise.resolve(this.prepareTextLabels(t,n)).then(function(n){try{return 0===(o=n).length?(Ks.collide([],e,t.id),r({})):Promise.resolve(Ks.collide(o,e,t.id)).then(function(e){try{if(o=e,t.canceled)return Ji("trace","stop tile build because tile was canceled: "+t.key+", post-collide()"),r({});if(null==(s=this.texts[t.id])||0===o.length)return r({});this.cullTextStyles(s,o),o.forEach((function(t){var e=t.text_settings_key,n=s[e]&&s[e][t.text];n.text_settings.can_articulate?(n.type||(n.type=[]),-1===n.type.indexOf(t.label.type)&&n.type.push(t.label.type)):(n.align=n.align||{},n.align[t.label.align]={})}));var n=function(t){try{return r({})}catch(t){return i(t)}};try{return Promise.resolve(Zi.postMessage(this.main_thread_target+".rasterizeTexts",t.id,t.key,s)).then((function(e){try{return a=e,t.canceled?(Ji("trace","stop tile build because tile was canceled: "+t.key+", post-rasterizeTexts()"),r({})):r(Object.assign({labels:o},a))}catch(t){return n()}}),n)}catch(t){n()}}catch(t){return i(t)}}.bind(this),i)}catch(t){return i(t)}}.bind(this),i)}.bind(this))},cullTextStyles:function(t,e){for(var n=0;n<e.length;n++){var r=e[n];t[r.text_settings_key][r.text].ref++}for(var i in t)for(var o in t[i])t[i][o].ref<1&&delete t[i][o];for(var s in t)0===Object.keys(t[s]).length&&delete t[s]},calcTextSizes:function(t,e){return this.canvas.textSizes(t,e)},rasterizeTexts:function(t,e,n){return new Promise(function(r,i){var o,s,a,l;return o=new Ea,s=Math.min(this.max_texture_size,2048),a=o.setTextureTextPositions(n,s),l=["labels",this.name,e,t,ka,""].join("-"),ka++,Promise.resolve(o.rasterize(n,a,t,l,this.gl)).then((function(t){try{return r((a=t)?{texts:n,textures:a}:{})}catch(t){return i(t)}}),i)}.bind(this))},preprocessText:function(t){if(t&&t.font&&"object"==typeof t.font)return t.font.weight=Or.createPropertyCache(t.font.weight),t.font.fill=Or.createPropertyCache(t.font.fill||sa.defaults.fill),t.font.alpha=Or.createPropertyCache(t.font.alpha),t.font.stroke&&(t.font.stroke.color=Or.createPropertyCache(t.font.stroke.color),t.font.stroke.alpha=Or.createPropertyCache(t.font.stroke.alpha)),t.font.background&&(t.font.background.color=Or.createPropertyCache(t.font.background.color),t.font.background.alpha=Or.createPropertyCache(t.font.background.alpha),t.font.background.width=Or.createPropertyCache(t.font.background.width,Or.parsePositiveNumber),t.font.background.stroke&&(t.font.background.stroke.color=Or.createPropertyCache(t.font.background.stroke.color),t.font.background.stroke.alpha=Or.createPropertyCache(t.font.background.stroke.alpha))),t.font.px_size=Or.createPropertyCache(t.font.size||sa.defaults.size,Ea.fontPixelSize,Ea.fontPixelSize),t.font.stroke&&null!=t.font.stroke.width&&(t.font.stroke.width=Or.createPropertyCache(t.font.stroke.width,Or.parsePositiveNumber)),t.font.background&&t.font.background.stroke&&null!=t.font.background.stroke.width&&(t.font.background.stroke.width=Or.createPropertyCache(t.font.background.stroke.width,Or.parsePositiveNumber)),t.offset=Or.createPropertyCache(t.offset,(function(t){return Array.isArray(t)&&t.map(Or.parseNumber)})),t.buffer=Or.createPropertyCache(t.buffer,(function(t){return(Array.isArray(t)?t:[t,t]).map(Or.parsePositiveNumber)})),t.repeat_distance=Or.createPropertyCache(t.repeat_distance,Or.parsePositiveNumber),t},computeTextLayout:function(t,e,n,r,i,o,s,a,l){var u=t||{};return u=this.computeLayout(u,e,n,r,i),null==n.repeat_distance&&(u.repeat_distance="point"===r.geometry?0:li.tile_size,u.repeat_distance&&(u.repeat_distance*=u.units_per_pixel,u.repeat_scale=1,"function"==typeof n.repeat_group?u.repeat_group=n.repeat_group(r):u.repeat_group=n.repeat_group)),u.repeat_distance&&(a&&(u.repeat_group+="/"+a),u.repeat_group+="/"+o),u.subdiv=i.overzoom2,u.align=n.align,u.italic="normal"!==s.style,"right"===l?u.orientation=1:"left"===l&&(u.orientation=-1),u}};Un("Float64",8,(function(t){return function(e,n,r){return t(this,e,n,r)}}));var Pa=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ma=function(t,e,n){var r=new Float64Array(3);return r[0]=t,r[1]=e,r[2]=n,r},za=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],_=e[12],p=e[13],m=e[14],v=e[15],g=n*a-r*s,y=n*l-i*s,x=n*u-o*s,b=r*l-i*a,w=r*u-o*a,T=i*u-o*l,A=h*p-c*_,E=h*m-f*_,k=h*v-d*_,S=c*m-f*p,P=c*v-d*p,M=f*v-d*m,z=g*M-y*P+x*S+b*k-w*E+T*A;return z?(z=1/z,t[0]=(a*M-l*P+u*S)*z,t[1]=(l*k-s*M-u*E)*z,t[2]=(s*P-a*k+u*A)*z,t[3]=(i*P-r*M-o*S)*z,t[4]=(n*M-i*k+o*E)*z,t[5]=(r*k-n*P-o*A)*z,t[6]=(p*T-m*w+v*b)*z,t[7]=(m*x-_*T-v*y)*z,t[8]=(_*w-p*x+v*g)*z,t):null},Ra=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],h=e[8],c=h*s-a*u,f=-h*o+a*l,d=u*o-s*l,_=n*c+r*f+i*d;return _?(_=1/_,t[0]=c*_,t[1]=(-h*r+i*u)*_,t[2]=(a*r-i*s)*_,t[3]=f*_,t[4]=(h*n-i*l)*_,t[5]=(-a*n+i*o)*_,t[6]=d*_,t[7]=(-u*n+r*l)*_,t[8]=(s*n-r*o)*_,t):null},La=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],_=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=n[0],x=n[1],b=n[2],w=n[3];return t[0]=y*r+x*a+b*c+w*p,t[1]=y*i+x*l+b*f+w*m,t[2]=y*o+x*u+b*d+w*v,t[3]=y*s+x*h+b*_+w*g,y=n[4],x=n[5],b=n[6],w=n[7],t[4]=y*r+x*a+b*c+w*p,t[5]=y*i+x*l+b*f+w*m,t[6]=y*o+x*u+b*d+w*v,t[7]=y*s+x*h+b*_+w*g,y=n[8],x=n[9],b=n[10],w=n[11],t[8]=y*r+x*a+b*c+w*p,t[9]=y*i+x*l+b*f+w*m,t[10]=y*o+x*u+b*d+w*v,t[11]=y*s+x*h+b*_+w*g,y=n[12],x=n[13],b=n[14],w=n[15],t[12]=y*r+x*a+b*c+w*p,t[13]=y*i+x*l+b*f+w*m,t[14]=y*o+x*u+b*d+w*v,t[15]=y*s+x*h+b*_+w*g,t},Ca=function(t,e,n){var r,i,o,s,a,l,u,h,c,f,d,_,p=n[0],m=n[1],v=n[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*v+e[12],t[13]=e[1]*p+e[5]*m+e[9]*v+e[13],t[14]=e[2]*p+e[6]*m+e[10]*v+e[14],t[15]=e[3]*p+e[7]*m+e[11]*v+e[15]):(r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],_=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=u,t[7]=h,t[8]=c,t[9]=f,t[10]=d,t[11]=_,t[12]=r*p+a*m+c*v+e[12],t[13]=i*p+l*m+f*v+e[13],t[14]=o*p+u*m+d*v+e[14],t[15]=s*p+h*m+_*v+e[15]),t},Oa=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Na=function(t,e,n,r,i){var o=1/Math.tan(e/2),s=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*s,t[15]=0,t},Ia=function(t,e,n,r){var i,o,s,a,l,u,h,c,f,d,_=e[0],p=e[1],m=e[2],v=r[0],g=r[1],y=r[2],x=n[0],b=n[1],w=n[2];return Math.abs(_-x)<1e-6&&Math.abs(p-b)<1e-6&&Math.abs(m-w)<1e-6?Pa(t):(h=_-x,c=p-b,f=m-w,i=g*(f*=d=1/Math.sqrt(h*h+c*c+f*f))-y*(c*=d),o=y*(h*=d)-v*f,s=v*c-g*h,(d=Math.sqrt(i*i+o*o+s*s))?(i*=d=1/d,o*=d,s*=d):(i=0,o=0,s=0),a=c*s-f*o,l=f*i-h*s,u=h*o-c*i,(d=Math.sqrt(a*a+l*l+u*u))?(a*=d=1/d,l*=d,u*=d):(a=0,l=0,u=0),t[0]=i,t[1]=a,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=c,t[7]=0,t[8]=s,t[9]=u,t[10]=f,t[11]=0,t[12]=-(i*_+o*p+s*m),t[13]=-(a*_+l*p+u*m),t[14]=-(h*_+c*p+f*m),t[15]=1,t)},Fa=Pa,Da=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ba=function(){function t(t,e,n){void 0===n&&(n={}),this.view=e,this.position=n.position,this.zoom=n.zoom}t.create=function(t,e,n){switch(n.type){case"isometric":return new Ua(t,e,n);case"flat":return new Ga(t,e,n);case"perspective":default:return new ja(t,e,n)}};var e=t.prototype;return e.update=function(){},e.setupProgram=function(){},e.updateView=function(){if(this.position||this.zoom){var t={};this.position&&(t={lng:this.position[0],lat:this.position[1],zoom:this.position[2]}),this.zoom&&(t.zoom=this.zoom),this.view.setView(t)}},e.setupMatrices=function(t,e){La(t.model_view32,this.view_matrix,t.model),e.uniform("Matrix4fv","u_modelView",t.model_view32),za(t.normal32,t.model_view32),Ra(t.inverse_normal32,t.normal32),e.uniform("Matrix3fv","u_normalMatrix",t.normal32),e.uniform("Matrix3fv","u_inverseNormalMatrix",t.inverse_normal32)},t}(),ja=function(t){function e(e,n,r){var i;return void 0===r&&(r={}),(i=t.call(this,e,n,r)||this).type="perspective",i.focal_length=r.focal_length,i.fov=r.fov,i.focal_length||i.fov||(i.focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]]),i.vanishing_point=r.vanishing_point||[0,0],i.vanishing_point=i.vanishing_point.map(parseFloat),i.vanishing_point_skew=[],i.position_meters=null,i.view_matrix=new Float64Array(16),i.projection_matrix=new Float32Array(16),Xn.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }"),i}Ri(e,t);var n=e.prototype;return n.constrainCamera=function(t){var e=t.view_height,n=t.height,r=t.focal_length,i=t.fov;return n?(r=2*n/e,i=2*Math.atan(1/r)):(r?i=2*Math.atan(1/r):i&&(i=i*Math.PI/180,r=1/Math.tan(i/2)),n=e/2*r),{view_height:e,height:n,focal_length:r,fov:i}},n.updateMatrices=function(){var t=this.view.size.css.height*this.view.meters_per_pixel,e=this.constrainCamera({view_height:t,focal_length:en.interpolate(this.view.zoom,this.focal_length),fov:en.interpolate(this.view.zoom,this.fov)}),n=e.height,r=e.fov,i=[this.view.center.meters.x,this.view.center.meters.y,n];this.position_meters=i,Ia(this.view_matrix,Ma(i[0],i[1],0),Ma(i[0],i[1],-1),Ma(0,1,0)),Na(this.projection_matrix,r,this.view.aspect,1,2*n),this.vanishing_point_skew[0]=this.vanishing_point[0]/this.view.size.css.width,this.vanishing_point_skew[1]=this.vanishing_point[1]/this.view.size.css.height,this.projection_matrix[8]=2*-this.vanishing_point_skew[0],this.projection_matrix[9]=2*-this.vanishing_point_skew[1],Ca(this.projection_matrix,this.projection_matrix,Ma(t/2*this.view.aspect*(2*-this.vanishing_point_skew[0]),t/2*(2*-this.vanishing_point_skew[1]),0)),Ca(this.projection_matrix,this.projection_matrix,Ma(0,0,-n))},n.update=function(){t.prototype.update.call(this),this.updateMatrices()},n.setupProgram=function(t){t.uniform("Matrix4fv","u_projection",this.projection_matrix),t.uniform("3f","u_eye",[0,0,this.position_meters[2]]),t.uniform("2fv","u_vanishing_point",this.vanishing_point_skew)},e}(Ba),Ua=function(t){function e(e,n,r){var i;return void 0===r&&(r={}),(i=t.call(this,e,n,r)||this).type="isometric",i.axis=r.axis||{x:0,y:1},2===i.axis.length&&(i.axis={x:i.axis[0],y:i.axis[1]}),i.position_meters=null,i.viewport_height=null,i.view_matrix=new Float64Array(16),i.projection_matrix=new Float32Array(16),Xn.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n                // position.xy += position.z * u_isometric_axis;\n\n                // Reverse z for depth buffer so up is negative,\n                // and scale down values so objects higher than one screen height will not get clipped\n                // pull forward slightly to avoid going past far clipping plane\n                position.z = -position.z / 100. + 1. - 0.001;\n            }"),i}Ri(e,t);var n=e.prototype;return n.update=function(){t.prototype.update.call(this),this.viewport_height=this.view.size.css.height*this.view.meters_per_pixel;var e=[this.view.center.meters.x,this.view.center.meters.y,this.viewport_height];this.position_meters=e,Fa(this.view_matrix),Ca(this.view_matrix,this.view_matrix,Ma(-e[0],-e[1],0)),Fa(this.projection_matrix),this.projection_matrix[8]=this.axis.x/this.view.aspect,this.projection_matrix[9]=this.axis.y,Oa(this.projection_matrix,this.projection_matrix,Ma(2/this.view.size.meters.x,2/this.view.size.meters.y,2/this.view.size.meters.y))},n.setupProgram=function(t){t.uniform("Matrix4fv","u_projection",this.projection_matrix),t.uniform("3fv","u_eye",[0,0,this.viewport_height]),t.uniform("2fv","u_vanishing_point",[0,0])},e}(Ba),Ga=function(t){function e(e,n,r){var i;return void 0===r&&(r={}),(i=t.call(this,e,n,r)||this).type="flat",i}return Ri(e,t),e.prototype.update=function(){this.axis.x=0,this.axis.y=0,t.prototype.update.call(this)},e}(Ua),Za=function(){function t(t,e){An(this),this.scene=t,this.createMatrices(),this.zoom=null,this.center=null,this.bounds=null,this.meters_per_pixel=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.zoom_direction=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={css:{},device:{},meters:{}},this.aspect=null,this.buffer=0,this.continuous_zoom="boolean"!=typeof e.continuousZoom||e.continuousZoom,this.wrap=!1!==e.wrapView,this.preserve_tiles_within_zoom=1,this.reset()}var e=t.prototype;return e.reset=function(){this.createCamera()},e.createCamera=function(){var t=this.getActiveCamera();t&&(this.camera=Ba.create(t,this,this.scene.config.cameras[t]),this.camera.updateView())},e.getActiveCamera=function(){if(this.scene.config&&this.scene.config.cameras){for(var t in this.scene.config.cameras)if(this.scene.config.cameras[t].active)return t;var e=Object.keys(this.scene.config.cameras);return e.length&&e[0]}},e.setActiveCamera=function(t){var e=this.getActiveCamera();return e===t?t:(this.scene.config.cameras[t]&&(this.scene.config.cameras[t].active=!0,e&&this.scene.config.cameras[e]&&delete this.scene.config.cameras[e].active),this.scene.updateConfig({rebuild:!1,normalize:!1}),this.getActiveCamera())},e.update=function(){null!=this.camera&&this.ready()&&this.camera.update(),this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout},e.setViewportSize=function(t,e){this.size.css={width:t,height:e},this.size.device={width:Math.round(this.size.css.width*en.device_pixel_ratio),height:Math.round(this.size.css.height*en.device_pixel_ratio)},this.aspect=this.size.css.width/this.size.css.height,this.updateBounds()},e.setView=function(t){var e=void 0===t?{}:t,n=e.lng,r=e.lat,i=e.zoom,o=!1;return"number"==typeof n&&"number"==typeof r&&(this.center&&n===this.center.lng&&r===this.center.lat||(o=!0,this.center={lng:n,lat:r})),"number"==typeof i&&i!==this.zoom&&(o=!0,this.setZoom(i)),o&&this.updateBounds(),o},e.setZoom=function(t){var e=this.tile_zoom,n=this.baseZoom(t);this.continuous_zoom||(t=n),n!==e&&(this.zoom_direction=n>e?1:-1),this.zoom=t,this.tile_zoom=n,this.updateBounds(),this.scene.requestRedraw()},e.baseZoom=function(t){return Math.floor(t)},e.setPanning=function(t){this.panning=t,this.panning||(this.panning_stop_at=+new Date)},e.markUserInput=function(){this.user_input_at=+new Date},e.ready=function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height&&null!=this.center&&"number"==typeof this.zoom},e.updateBounds=function(){if(this.ready()){this.meters_per_pixel=li.metersPerPixel(this.zoom),this.size.meters={x:this.size.css.width*this.meters_per_pixel,y:this.size.css.height*this.meters_per_pixel};var t=li.latLngToMeters([this.center.lng,this.center.lat]);this.center.meters={x:t[0],y:t[1]},this.center.tile=li.tileForMeters([this.center.meters.x,this.center.meters.y],this.tile_zoom),this.bounds={sw:{x:this.center.meters.x-this.size.meters.x/2,y:this.center.meters.y-this.size.meters.y/2},ne:{x:this.center.meters.x+this.size.meters.x/2,y:this.center.meters.y+this.size.meters.y/2}},this.scene.tile_manager.updateTilesForView(),this.trigger("move"),this.scene.requestRedraw()}},e.findVisibleTileCoordinates=function(){if(!this.bounds)return[];var t=this.tile_zoom,e=li.tileForMeters([this.bounds.sw.x,this.bounds.sw.y],t),n=li.tileForMeters([this.bounds.ne.x,this.bounds.ne.y],t),r=[e.x-this.buffer,n.x+this.buffer,n.y-this.buffer,e.y+this.buffer];if(!1===this.wrap){var i=(1<<t)-1;r=r.map((function(t){return Math.min(Math.max(0,t),i)}))}for(var o=[],s=r[0];s<=r[1];s++)for(var a=r[2];a<=r[3];a++)o.push(ho.coord({x:s,y:a,z:t}));return o},e.pruneTilesForView=function(){var t=this;this.ready()&&this.scene.tile_manager.removeTiles((function(e){if(e.visible||e.isProxy())return!1;if(e.loading&&e.style_z!==t.tile_zoom)return!0;if(Math.abs(e.style_z-t.tile_zoom)>(null!=e.preserve_tiles_within_zoom?e.preserve_tiles_within_zoom:t.preserve_tiles_within_zoom))return!0;var n=t.meters_per_pixel*li.tile_size,r=ho.coordAtZoom(li.tileForMeters([t.center.meters.x-t.size.meters.x/2-n,t.center.meters.y+t.size.meters.y/2+n],t.tile_zoom),e.coords.z),i=ho.coordAtZoom(li.tileForMeters([t.center.meters.x+t.size.meters.x/2+n,t.center.meters.y-t.size.meters.y/2-n],t.tile_zoom),e.coords.z);return(e.coords.x<r.x||e.coords.x>i.x||e.coords.y<r.y||e.coords.y>i.y)&&(Ji("trace","View: remove tile "+e.key+" (as "+e.coords.key+") for being too far out of visible area ("+r.key+", "+i.key+")"),!0)}))},e.createMatrices=function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)},e.setupTile=function(t,e){t.setupProgram(this.matrices,e),this.camera.setupMatrices(this.matrices,e)},e.setupProgram=function(t){t.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),t.uniform("3fv","u_map_position",[this.center.meters.x,this.center.meters.y,this.zoom]),t.uniform("1f","u_meters_per_pixel",this.meters_per_pixel),t.uniform("1f","u_device_pixel_ratio",en.device_pixel_ratio),t.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),t.uniform("1i","u_view_panning",this.panning),this.camera.setupProgram(t)},e.isAnimating=function(){return this.pan_snap_timer<=.5},t}(),Va=Qs.PLACEMENT,qa=Object.create(po);Object.assign(qa,Sa),Object.assign(qa,{name:"points",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_order_offset;\nuniform bool u_tile_fade_in;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\nuniform bool u_view_panning;\nuniform float u_view_pan_snap_timer;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_shape;\nattribute vec4 a_color;\nattribute vec2 a_texcoord;\nattribute vec2 a_offset;\n\nuniform float u_point_type;\n\n#ifdef TANGRAM_CURVED_LABEL\n    attribute vec4 a_offsets;\n    attribute vec4 a_pre_angles;\n    attribute vec4 a_angles;\n#endif\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    attribute float a_outline_edge;\n    attribute vec4 a_outline_color;\n\n    varying float v_outline_edge;\n    varying vec4 v_outline_color;\n    varying float v_aa_offset;\n#endif\n\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\n    varying float v_label_hidden;\n#endif\n\n#define TANGRAM_PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvec2 rotate2D(vec2 _st, float _angle) {\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle)) * _st;\n}\n\n#ifdef TANGRAM_CURVED_LABEL\n    // Assumes stops are [0, 0.33, 0.66, 0.99];\n    float mix4linear(vec4 v, float x) {\n        x = clamp(x, 0., 1.);\n        return mix(mix(v[0], v[1], 3. * x),\n                   mix(v[1],\n                       mix(v[2], v[3], 3. * (max(x, .66) - .66)),\n                       3. * (clamp(x, .33, .66) - .33)),\n                   step(0.33, x)\n                );\n    }\n#endif\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // discard hidden labels by collapsing into degenerate triangle\n    #ifndef TANGRAM_SHOW_HIDDEN_LABELS\n        if (a_shape.w == 0.) {\n            gl_Position = vec4(0., 0., 0., 1.);\n            return;\n        }\n    #else\n        // highlight hidden label in fragment shader for debugging\n        if (a_shape.w == 0.) {\n            v_label_hidden = 1.; // label debug testing\n        }\n        else {\n            v_label_hidden = 0.;\n        }\n    #endif\n\n    v_alpha_factor = 1.0;\n    v_color = a_color;\n    v_texcoord = a_texcoord; // UV from vertex attribute\n\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        v_outline_color = a_outline_color;\n        v_outline_edge = a_outline_edge;\n\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // use point dimensions for UVs instead (ignore attribute), add antialiasing info for fragment shader\n            float _size = abs(a_shape.x / 128.); // radius in pixels\n            v_texcoord = sign(a_shape.xy) * (_size + 1.) / _size;\n            _size += 2.;\n            v_aa_offset = 2. / _size;\n        }\n    #endif\n\n    // Position\n    vec4 position = u_modelView * vec4(a_position.xyz, 1.);\n\n    // Apply positioning and scaling in screen space\n    vec2 _shape = a_shape.xy / 256.;                 // values have an 8-bit fraction\n    vec2 _offset = vec2(a_offset.x, -a_offset.y);    // flip y to make it point down\n    float _theta = a_shape.z / 4096.;\n\n    #ifdef TANGRAM_CURVED_LABEL\n        //TODO: potential bug? null is passed in for non-curved labels, otherwise the first offset will be 0\n        if (a_offsets[0] != 0.){\n            vec4 _angles_scaled = (TANGRAM_PI / 16384.) * a_angles;\n            vec4 _pre_angles_scaled = (TANGRAM_PI / 128.) * a_pre_angles;\n            vec4 _offsets_scaled = (1. / 64.) * a_offsets;\n\n            float _zoom = clamp(u_map_position.z - u_tile_origin.z, 0., 1.); //fract(u_map_position.z);\n            float _pre_angle = mix4linear(_pre_angles_scaled, _zoom);\n            float _angle = mix4linear(_angles_scaled, _zoom);\n            float _offset_curve = mix4linear(_offsets_scaled, _zoom);\n\n            _shape = rotate2D(_shape, _pre_angle); // rotate in place\n            _shape.x += _offset_curve;            // offset for curved label segment\n            _shape = rotate2D(_shape, _angle);     // rotate relative to curved label anchor\n            _shape += rotate2D(_offset, _theta);   // offset if specified in the scene file\n        }\n        else {\n            _shape = rotate2D(_shape + _offset, _theta);\n        }\n    #else\n        _shape = rotate2D(_shape + _offset, _theta);\n    #endif\n\n    // Fade in (if requested) based on time mesh has been visible.\n    // Value passed to fragment shader in the v_alpha_factor varying\n    #ifdef TANGRAM_FADE_IN_RATE\n        if (u_tile_fade_in) {\n            v_alpha_factor *= clamp(u_visible_time * TANGRAM_FADE_IN_RATE, 0., 1.);\n        }\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = u_model * position;\n    v_world_position.xy += _shape * u_meters_per_pixel;\n    v_world_position = wrapWorldPosition(v_world_position);\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    cameraProjection(position);\n\n    #ifdef TANGRAM_LAYER_ORDER\n        // +1 is to keep all layers including proxies > 0\n        applyLayerOrder(a_position.w + u_tile_proxy_order_offset + 1., position);\n    #endif\n\n    // Apply pixel offset in screen-space\n    // Multiply by 2 is because screen is 2 units wide Normalized Device Coords (and u_resolution device pixels wide)\n    // Device pixel ratio adjustment is because shape is in logical pixels\n    position.xy += _shape * position.w * 2. * u_device_pixel_ratio / u_resolution;\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // enlarge by 1px to catch missed MSAA fragments\n            position.xy += sign(_shape) * position.w * u_device_pixel_ratio / u_resolution;\n        }\n    #endif\n\n    // Snap to pixel grid\n    // Only applied to fully upright sprites/labels (not shader-drawn points), while panning is not active\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n    if (!u_view_panning && (abs(_theta) < TANGRAM_EPSILON) && u_point_type != TANGRAM_POINT_TYPE_SHADER) {\n    #else\n    if (!u_view_panning && (abs(_theta) < TANGRAM_EPSILON)) {\n    #endif\n        vec2 _position_fract = fract((((position.xy / position.w) + 1.) * .5) * u_resolution);\n        vec2 _position_snap = position.xy + ((step(0.5, _position_fract) - _position_fract) * position.w * 2. / u_resolution);\n\n        // Animate the snapping to smooth the transition and make it less noticeable\n        #ifdef TANGRAM_VIEW_PAN_SNAP_RATE\n            position.xy = mix(position.xy, _position_snap, clamp(u_view_pan_snap_timer * TANGRAM_VIEW_PAN_SNAP_RATE, 0., 1.));\n        #else\n            position.xy = _position_snap;\n        #endif\n    }\n\n    gl_Position = position;\n}\n",fragment_shader_src:"uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nuniform sampler2D u_texture;\nuniform float u_point_type;\nuniform bool u_apply_color_blocks;\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    varying vec4 v_outline_color;\n    varying float v_outline_edge;\n    varying float v_aa_offset;\n#endif\n\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\n    varying float v_label_hidden;\n#endif\n\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    //l is the distance from the center to the fragment, R is the radius of the drawn point\n    float _tangram_antialias(float l, float R){\n        float low  = R - v_aa_offset;\n        float high = R + v_aa_offset;\n        return 1. - smoothstep(low, high, l);\n    }\n#endif\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        // Only apply shader blocks to point, not to attached text (N.B.: for compatibility with ES)\n        if (u_point_type == TANGRAM_POINT_TYPE_TEXTURE) { // sprite texture\n            color *= texture2D(u_texture, v_texcoord);\n        }\n        else if (u_point_type == TANGRAM_POINT_TYPE_LABEL) { // label texture\n            color = texture2D(u_texture, v_texcoord);\n            color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n        }\n        else if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // Mask of outermost circle, either outline or point boundary\n            float _d = length(v_texcoord); // distance to this fragment from the point center\n            float _outer_alpha = _tangram_antialias(_d, 1.);\n            float _fill_alpha = _tangram_antialias(_d, 1. - (v_outline_edge * 0.5)) * color.a;\n            float _stroke_alpha = (_outer_alpha - _tangram_antialias(_d, 1. - v_outline_edge)) * v_outline_color.a;\n\n            // Apply alpha compositing with stroke 'over' fill.\n            #ifdef TANGRAM_BLEND_ADD\n                color.a = _stroke_alpha + _fill_alpha;\n                color.rgb = color.rgb * _fill_alpha + v_outline_color.rgb * _stroke_alpha;\n            #else // TANGRAM_BLEND_OVERLAY (and fallback for not implemented blending modes)\n                color.a = _stroke_alpha + _fill_alpha * (1. - _stroke_alpha);\n                color.rgb = mix(color.rgb * _fill_alpha, v_outline_color.rgb, _stroke_alpha) / max(color.a, 0.001); // avoid divide by zero\n            #endif\n        }\n    #else\n        // If shader points not supported, assume label texture\n        color = texture2D(u_texture, v_texcoord);\n        color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n    #endif\n\n    // Shader blocks for color/filter are only applied for sprites, shader points, and standalone text,\n    // NOT for text attached to a point (N.B.: for compatibility with ES)\n    if (u_apply_color_blocks) {\n        #pragma tangram: color\n        #pragma tangram: filter\n    }\n\n    color.a *= v_alpha_factor;\n\n    // highlight hidden label in fragment shader for debugging\n    #ifdef TANGRAM_SHOW_HIDDEN_LABELS\n        if (v_label_hidden > 0.) {\n            color.a *= 0.5;\n            color.rgb = vec3(1., 0., 0.);\n        }\n    #endif\n\n    // Use alpha test as a lower-quality substitute\n    // For opaque and translucent: avoid transparent pixels writing to depth buffer, obscuring geometry underneath\n    // For multiply: avoid transparent pixels multiplying geometry underneath to zero/full black\n    #if defined(TANGRAM_BLEND_OPAQUE) || defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n        if (color.a < TANGRAM_ALPHA_TEST) {\n            discard;\n        }\n    #endif\n\n    // Make points more visible in wireframe debug mode\n    #ifdef TANGRAM_WIREFRAME\n        color = vec4(vec3(0.5), 1.); // use gray outline for textured points\n        #ifdef TANGRAM_HAS_SHADER_POINTS\n            if (u_point_type == TANGRAM_POINT_TYPE_SHADER) {\n                color = vec4(v_color.rgb, 1.); // use original vertex color outline for shader points\n            }\n        #endif\n    #endif\n\n    gl_FragColor = color;\n}\n",selection:!0,collision:!0,blend:"overlay",init:function(t){void 0===t&&(t={}),po.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=1,this.defines.TANGRAM_POINT_TYPE_LABEL=2,this.defines.TANGRAM_POINT_TYPE_SHADER=3,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.stencil_proxy_tiles=!1,this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),!0===nn.suppress_label_fade_in?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),!0!==nn.suppress_label_snap_animation&&(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=2),!0===nn.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0),!0===nn.wireframe&&(this.defines.TANGRAM_WIREFRAME=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(t,e,n){var r=n.tile;if(r.generation===this.generation){var i={};if(i.color=this.parseColor(e.color,n),i.texture=e.texture,i.label_texture=null,i.blend_order=e.blend_order,i.color||i.texture){var o;if(i.alpha=Or.evalCachedProperty(e.alpha,n),this.hasSprites(i)){if(!(o=this.parseSprite(i,e,n)))return void Ji({level:"debug",once:!0},"Layer group '"+e.layers.join(", ")+"' uses a texture '"+i.texture+"', but doesn't specify which sprite to draw. Features that match this layer group won't be drawn without specifying the sprite with the 'sprite' or 'sprite_default' properties. The merged draw parameters for this layer group are:",e).then((function(n){n&&Ji("debug","Example feature for layer group '"+e.layers.join(", ")+"'",t)}));i.texcoords=o.texcoords}else if(e.sprite)return void Ji({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"' specifies sprite '"+e.sprite+"', but the texture '"+e.texture+"' doesn't define any sprites. Features that match this layer group won't be drawn. The merged draw parameters for this layer group are:",e);if(this.calcSize(e,i,o,n),e.outline&&(i.outline_width=Or.evalCachedProperty(e.outline.width,n)||Or.defaults.outline.width,i.outline_color=this.parseColor(e.outline.color,n)),i.outline_edge_pct=0,i.outline_width&&i.outline_color){var s=i.outline_width;i.size[0]+=s,i.size[1]+=s,i.outline_edge_pct=s/Math.min(i.size[0],i.size[1])*2,i.outline_alpha=Or.evalCachedProperty(e.outline.alpha,n)}i.size[0]=Math.min(i.size[0],256),i.size[1]=Math.min(i.size[1],256),i.placement=e.placement,i.placement_min_length_ratio=Or.evalCachedProperty(e.placement_min_length_ratio,n),i.placement===Va.SPACED&&e.placement_spacing&&(i.placement_spacing=Or.evalCachedProperty(e.placement_spacing,n)),i.angle=Or.evalProperty(e.angle,n)||0,i.z=Or.evalCachedDistanceProperty(e.z,n)||Or.defaults.z,i.tile_edges=e.tile_edges,this.computeLayout(i,t,e,n,r);var a=e.text&&!1!==e.text.visible&&this.parseTextFeature(t,e.text,n,r);Array.isArray(a)&&(a=null,Ji({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"': cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; provided 'text_source' value was "+JSON.stringify(e.text.text_source))),a&&(a.layout.parent=i,a.layout.priority=e.text.priority?Math.max(a.layout.priority,i.priority+.5):i.priority+.5,Ks.addStyle(this.collision_group_text,r.id)),this.queueFeature({feature:t,draw:e,context:n,style:i,text_feature:a},r),Ks.addStyle(this.collision_group_points,r.id)}}},calcSize:function(t,e,n,r){if(e.size=t.size,e.size){if(e.size=Or.evalCachedPointSizeProperty(t.size,n,Gn.textures[e.texture],r),null==e.size)return void Ji({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': 'size' ("+JSON.stringify(t.size.value)+") couldn't be interpreted, features that match this layer group won't be drawn");"number"==typeof e.size&&(e.size=[e.size,e.size])}else e.size=n&&n.css_size||[16,16]},hasSprites:function(t){return t.texture&&Gn.textures[t.texture]&&Gn.textures[t.texture].sprites},getSpriteInfo:function(t,e){var n=Gn.textures[t.texture].sprites[e]&&Gn.getSpriteInfo(t.texture,e);return e&&!n?(this.texture_missing_sprites[t.texture]=this.texture_missing_sprites[t.texture]||{},this.texture_missing_sprites[t.texture][e]||(Ji("debug","Style: in style '"+this.name+"', could not find sprite '"+e+"' for texture '"+t.texture+"'"),this.texture_missing_sprites[t.texture][e]=!0)):n&&(n.sprite=e),n},parseSprite:function(t,e,n){var r=Or.evalProperty(e.sprite,n);return this.getSpriteInfo(t,r)||this.getSpriteInfo(t,e.sprite_default)},queueFeature:function(t,e){this.tile_data[e.id]&&this.queues[e.id]||this.startData(e),this.queues[e.id]=this.queues[e.id]||[],this.queues[e.id].push(t)},endData:function(t){return new Promise(function(e,n){var r,i,o,s,a,l,u,h,c,f;return r=this,t.canceled?(Ji("trace","Style "+this.name+": stop tile build because tile was canceled: "+t.key),e(null)):(i=this.queues[t.id],delete this.queues[t.id],o=[],s=[],i.forEach((function(t){for(var e=t.style,n=t.feature,i=n.geometry,a=r.buildLabels(e.size,i,e),l=0;l<a.length;l++){var u=a[l],h={feature:n,draw:t.draw,context:t.context,style:e,label:u};if(s.push(h),t.text_feature){var c={feature:n,draw:t.text_feature.draw,context:t.context,text:t.text_feature.text,text_settings_key:t.text_feature.text_settings_key,layout:t.text_feature.layout,point_label:u,linked:h};o.push(c),t.draw.text.optional||(h.linked=c)}}})),Promise.resolve(Promise.all([Ks.collide(s,this.collision_group_points,t.id).then((function(t){t.forEach((function(t){r.feature_style=t.style,r.feature_style.label=t.label,r.feature_style.linked=t.linked,po.addFeature.call(r,t.feature,t.draw,t.context)}))})),this.collideAndRenderTextLabels(t,this.collision_group_text,o)])).then(function(i){try{return a=i[1],l=a.labels,u=a.texts,h=a.textures,l&&u&&l.forEach((function(t){var e=t.text_settings_key,n=u[e]&&u[e][t.text],i=r.feature_style;i.label=t.label,i.linked=t.linked,i.size=n.size.logical_size,i.texcoords=n.align[t.label.align].texcoords,i.label_texture=h[n.align[t.label.align].texture_id],i.blend_order=t.draw.blend_order,po.addFeature.call(r,t.feature,t.draw,t.context)})),this.freeText(t),Promise.resolve(po.endData.call(this,t)).then((function(t){try{return(c=t)&&h&&h.length&&(c.textures=c.textures||[],(f=c.textures).push.apply(f,h)),e(c)}catch(t){return n(t)}}),n)}catch(t){return n(t)}}.bind(this),n))}.bind(this))},_preprocess:function(t){t.color=Or.createColorPropertyCache(t.color),t.alpha=Or.createPropertyCache(t.alpha),t.texture=void 0!==t.texture?t.texture:this.texture,t.blend_order=this.getBlendOrderForDraw(t),t.outline&&(t.outline.color=Or.createColorPropertyCache(t.outline.color),t.outline.alpha=Or.createPropertyCache(t.outline.alpha),t.outline.width=Or.createPropertyCache(t.outline.width,Or.parsePositiveNumber)),t.z=Or.createPropertyCache(t.z,Or.parseUnits);try{t.size=Or.createPointSizePropertyCache(t.size,t.texture)}catch(e){return Ji({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': "+e+" ("+JSON.stringify(t.size)+"), features that match this layer group won't be drawn."),null}if(t.offset=Or.createPropertyCache(t.offset,(function(t){return Array.isArray(t)&&t.map(Or.parseNumber)})),t.buffer=Or.createPropertyCache(t.buffer,(function(t){return(Array.isArray(t)?t:[t,t]).map(Or.parsePositiveNumber)})),t.repeat_distance=Or.createPropertyCache(t.repeat_distance,Or.parseNumber),t.placement=Va[t.placement&&t.placement.toUpperCase()],null==t.placement&&(t.placement=Va.VERTEX),t.placement_spacing=null!=t.placement_spacing?t.placement_spacing:80,t.placement_spacing=Or.createPropertyCache(t.placement_spacing,Or.parsePositiveNumber),t.placement_min_length_ratio=null!=t.placement_min_length_ratio?t.placement_min_length_ratio:1,t.placement_min_length_ratio=Or.createPropertyCache(t.placement_min_length_ratio,Or.parsePositiveNumber),"number"==typeof t.angle)t.angle=t.angle*Math.PI/180;else if("function"==typeof t.angle){var e=t.angle;t.angle=function(t){return e(t)*Math.PI/180}}else t.angle=t.angle||0;return t.text=this.preprocessText(t.text),t.text&&(t.text.key=t.key,t.text.group=t.group,t.text.layers=t.layers,t.text.order=t.order,t.text.blend_order=t.blend_order,t.text.repeat_group=null!=t.text.repeat_group?t.text.repeat_group:t.repeat_group,t.text.anchor=t.text.anchor||this.default_anchor,t.text.optional="boolean"==typeof t.text.optional&&t.text.optional,t.text.interactive=t.text.interactive||t.interactive),t},default_anchor:["bottom","top","right","left"],computeLayout:function(t,e,n,r,i){var o=t||{};o.id=e,o.units_per_pixel=i.units_per_pixel||1,o.collide=!1!==n.collide,o.anchor=n.anchor,o.offset=Or.evalCachedProperty(n.offset,r)||Or.zeroPair,o.buffer=Or.evalCachedProperty(n.buffer,r)||Or.zeroPair,o.repeat_distance=Or.evalCachedProperty(n.repeat_distance,r),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof n.repeat_group?o.repeat_group=n.repeat_group(r):o.repeat_group=n.repeat_group||r.layer);var s=n.priority;return null!=s?"function"==typeof s&&(s=s(r)):s=-1>>>0,o.priority=s,o},buildTextLabels:function(t,e){for(var n=[],r=0;r<e.length;r++){var i=e[r],o=this.texts[t.id][i.text_settings_key][i.text].size.collision_size;i.label=new Qs(i.point_label.position,o,i.layout),n.push(i)}return n},buildLabels:function(t,e,n){var r=[];if("Point"===e.type)r.push(new Qs(e.coordinates,t,n,n.angle));else if("MultiPoint"===e.type)for(var i=e.coordinates,o=0;o<i.length;++o){var s=i[o];r.push(new Qs(s,t,n,n.angle))}else if("LineString"===e.type)for(var a=ea(e.coordinates,t,n),l=0;l<a.length;++l)r.push(a[l]);else if("MultiLineString"===e.type)for(var u=e.coordinates,h=0;h<u.length;h++)for(var c=ea(u[h],t,n),f=0;f<c.length;++f)r.push(c[f]);else if("Polygon"===e.type)if(n.placement===Va.CENTROID){var d=li.centroid(e.coordinates);d&&r.push(new Qs(d,t,n,n.angle))}else for(var _=e.coordinates,p=0;p<_.length;p++)for(var m=ea(_[p],t,n),v=0;v<m.length;++v)r.push(m[v]);else if("MultiPolygon"===e.type)if(n.placement===Va.CENTROID){var g=li.multiCentroid(e.coordinates);g&&r.push(new Qs(g,t,n,n.angle))}else for(var y=e.coordinates,x=0;x<y.length;x++)for(var b=y[x],w=0;w<b.length;w++)for(var T=ea(b[w],t,n),A=0;A<T.length;++A)r.push(T[A]);return r},makeVertexTemplate:function(t,e,n){void 0===n&&(n=!0);var r=0;this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=t.z||0,this.vertex_template[r++]=this.scaleOrder(t.order),this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=t.label.layout.collide?0:1,e.variant.shader_point||(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=0,this.vertex_template[r++]=0;var i=t.color||Or.defaults.color;if(this.vertex_template[r++]=255*i[0],this.vertex_template[r++]=255*i[1],this.vertex_template[r++]=255*i[2],this.vertex_template[r++]=255*(null!=t.alpha?t.alpha:i[3]),e.variant.selection&&(this.vertex_template[r++]=255*t.selection_color[0],this.vertex_template[r++]=255*t.selection_color[1],this.vertex_template[r++]=255*t.selection_color[2],this.vertex_template[r++]=255*t.selection_color[3]),e.variant.shader_point){var o=t.outline_color||Or.defaults.outline.color;this.vertex_template[r++]=255*o[0],this.vertex_template[r++]=255*o[1],this.vertex_template[r++]=255*o[2],this.vertex_template[r++]=255*(null!=t.outline_alpha?t.outline_alpha:o[3]),this.vertex_template[r++]=t.outline_edge_pct||Or.defaults.outline.width}return n&&this.addCustomAttributesToVertexTemplate(t,r),this.vertex_template},buildQuad:function(t,e,n,r,i,o,s,a,l,u,h){return e[0]<=0||e[1]<=0?0:function(t,e,n,r,i,o,s,a,l,u,h,c){var f=128*i[0],d=128*i[1];Cs[0]=-f,Cs[1]=-d,Cs[2]=f,Cs[3]=d;for(var _=h||Ao,p=e.vertex_elements,m=e.vertex_count,v=0;v<4;v++)n[r.a_position+0]=t[0],n[r.a_position+1]=t[1],n[r.a_shape+0]=Cs[Rs[v]],n[r.a_shape+1]=Cs[Ls[v]],n[r.a_shape+2]=l,n[r.a_offset+0]=o[0],n[r.a_offset+1]=o[1],r.a_texcoord&&(n[r.a_texcoord+0]=65535*_[Rs[v]],n[r.a_texcoord+1]=65535*_[Ls[v]]),c&&(n[r.a_pre_angles+0]=Ms*a[0],n[r.a_pre_angles+1]=Ms*a[1],n[r.a_pre_angles+2]=Ms*a[2],n[r.a_pre_angles+3]=Ms*a[3],n[r.a_angles+0]=zs*u[0],n[r.a_angles+1]=zs*u[1],n[r.a_angles+2]=zs*u[2],n[r.a_angles+3]=zs*u[3],n[r.a_offsets+0]=64*s[0],n[r.a_offsets+1]=64*s[1],n[r.a_offsets+2]=64*s[2],n[r.a_offsets+3]=64*s[3]),e.addVertex(n);return p.push(m+0),p.push(m+1),p.push(m+2),p.push(m+2),p.push(m+3),p.push(m+0),2}(t,u,h,u.vertex_layout.index,e,o,s,i,4096*n,r,a,l)},build:function(t,e){var n=t.label;return"curved"===n.type?this.buildCurvedLabel(n,t,e):this.buildStraightLabel(n,t,e)},buildStraightLabel:function(t,e,n){var r,i,o=this.getTileMesh(n.tile,this.meshVariantTypeForDraw(e)),s=this.makeVertexTemplate(e,o);"point"!==t.type?(r=e.size[t.type],i=e.texcoords[t.type].texcoord):(r=e.size,i=e.texcoords),o.uniforms=o.uniforms||{},e.label_texture?(o.uniforms.u_texture=e.label_texture,o.uniforms.u_point_type=2,o.uniforms.u_apply_color_blocks=!1):e.texture?(o.uniforms.u_texture=e.texture,o.uniforms.u_point_type=1,o.uniforms.u_apply_color_blocks=!0):(o.uniforms.u_texture=Gn.default,o.uniforms.u_point_type=3,o.uniforms.u_apply_color_blocks=!0);var a=t.offset,l=this.buildQuad(t.position,r,t.angle,null,null,a,null,i,!1,o.vertex_data,s),u=e.linked&&e.linked.label.id;return this.trackLabel(t,u,o,l,n),l},buildCurvedLabel:function(t,e,n){for(var r,i,o=0,s=0;s<t.num_segments;s++){var a=e.size[t.type][s],l=e.texcoords_stroke[s];e.label_texture=e.label_textures[s],r=this.getTileMesh(n.tile,this.meshVariantTypeForDraw(e)),i=this.makeVertexTemplate(e,r),r.uniforms=r.uniforms||{},r.uniforms.u_texture=e.label_texture,r.uniforms.u_point_type=2,r.uniforms.u_apply_color_blocks=!1;var u=t.offset||[0,0],h=t.position,c=t.angles[s],f=t.offsets[s],d=t.pre_angles[s],_=this.buildQuad(h,a,t.angle,c,d,u,f,l,!0,r.vertex_data,i);o+=_;var p=e.linked&&e.linked.label.id;this.trackLabel(t,p,r,_,n)}for(var m=0;m<t.num_segments;m++){var v=e.size[t.type][m],g=e.texcoords[t.type][m].texcoord;e.label_texture=e.label_textures[m],r=this.getTileMesh(n.tile,this.meshVariantTypeForDraw(e)),i=this.makeVertexTemplate(e,r),r.uniforms=r.uniforms||{},r.uniforms.u_texture=e.label_texture,r.uniforms.u_point_type=2,r.uniforms.u_apply_color_blocks=!1;var y=t.offset||[0,0],x=t.position,b=t.angles[m],w=t.offsets[m],T=t.pre_angles[m],A=this.buildQuad(x,v,t.angle,b,T,y,w,g,!0,r.vertex_data,i);o+=A;var E=e.linked&&e.linked.label.id;this.trackLabel(t,E,r,A,n)}return o},trackLabel:function(t,e,n,r){if(t.layout.collide||t.may_repeat_across_tiles){n.labels=n.labels||{},n.labels[t.id]=n.labels[t.id]||{container:{label:t.toJSON(),linked:e},ranges:[]};var i=2*r,o=n.vertex_data.offset-n.vertex_data.stride*i;n.labels[t.id].ranges.push([o,i])}},buildLines:function(t,e,n){return this.build(e,n)},buildPoints:function(t,e,n){return this.build(e,n)},buildPolygons:function(t,e,n){return this.build(e,n)},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.shader_point]){var e=[{name:"a_position",size:4,type:Yr.SHORT,normalized:!1},{name:"a_shape",size:4,type:Yr.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:Yr.UNSIGNED_SHORT,normalized:!0,static:t.shader_point?[0,0]:null},{name:"a_offset",size:2,type:Yr.SHORT,normalized:!1},{name:"a_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]},{name:"a_outline_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0,static:t.shader_point?null:[0,0,0,0]},{name:"a_outline_edge",size:1,type:Yr.FLOAT,normalized:!1,static:t.shader_point?null:0}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.shader_point]=new wo(e)}return this.vertex_layouts[t.shader_point]},meshVariantTypeForDraw:function(t){var e=t.label_texture||t.texture||"__shader_point",n=e+"/"+t.blend_order;return null==this.variants[n]&&(this.variants[n]={key:n,selection:1,shader_point:"__shader_point"===e,blend_order:t.blend_order,mesh_order:t.label_texture?1:0}),this.variants[n]},makeMesh:function(t,e,n){return void 0===n&&(n={}),n=Object.assign({},n,{fade_in_time:this.fade_in_time}),po.makeMesh.call(this,t,e,n)}});var Wa=Math.abs;D(D.S,"Math",{hypot:function(t,e){for(var n,r,i=0,o=0,s=arguments.length,a=0;o<s;)a<(n=Wa(arguments[o++]))?(i=i*(r=a/n)*r+1,a=n):i+=n>0?(r=n/a)*r:n;return a===1/0?1/0:a*Math.sqrt(i)}});var Ha=[0,.33,.66,.99],Ya=function(t,e,n,r){for(var i=[{type:"straight",tolerance:r.no_curving?1.8:1.5},{type:"curved"},{type:"straight",tolerance:2.3}],o=0;o<i.length;o++){var s=i[o],a=void 0;if("straight"===s.type?a=new $a(e,n,r,s.tolerance):"curved"===s.type&&!r.no_curving&&n.length>2&&(a=new Ja(t,n,r)),a&&!a.throw_away)return a}return!1},Xa=function(){function t(t){this.id=Ys.nextLabelId(),this.layout=t,this.position=[],this.angle=0,this.offset=t.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.obbs=[],this.aabbs=[],this.type="",this.throw_away=!1}var e=t.prototype;return e.toJSON=function(){return{id:this.id,type:this.type,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:Xs(this.layout)}},t.splitLineByOrientation=function(t){for(var e=[t[0]],n=0,r=0,i=0,o=e,s=!1,a=1;a<t.length;a++){var l=t[a],u=t[a-1],h=Qr.length(Qr.sub(l,u));l[0]>u[0]?1===i?(e.push(l),(n+=h)>r&&(o=e,r=n,s=!1)):(e=[u,l],(n=h)>r&&(o=e,r=n,s=!1),i=1):l[0]<u[0]?-1===i?(e.unshift(l),(n+=h)>r&&(o=e,r=n,s=!0)):(e=[l,u],(n=h)>r&&(o=e,r=n,s=!0),i=-1):(-1===i?e.unshift(l):(e.push(l),i=1),(n+=h)>r&&(o=e,r=n,s=-1===i))}return[o,s]},e.discard=function(t,e){if(void 0===e&&(e=null),this.throw_away)return!0;for(var n=0;n<this.obbs.length;n++){var r={aabb:this.aabbs[n],obb:this.obbs[n]};if(Ys.prototype.occluded.call(r,t,e))return!0}return!1},e.inTileBounds=function(){for(var t=0;t<this.aabbs.length;t++){var e={aabb:this.aabbs[t]};if(!Ys.prototype.inTileBounds.call(e))return!1}return!0},t.createOBB=function(t,e,n,r,i,o,s){var a=t[0],l=t[1];return!o||0===o[0]&&0===o[1]||(a+=(o=Qr.rot(o,i))[0]*s,l-=o[1]*s),new Hs(a,l,-r,e,n)},t}(),$a=function(t){function e(e,n,r,i){var o;return(o=t.call(this,r)||this).type="straight",o.size=e,o.throw_away=!o.fit(e,n,r,i),o}Ri(e,t);var n=e.prototype;return n.fit=function(t,e,n,r){var i,o=this.unit_scale,s=Xa.splitLineByOrientation(e);e=s[0],i=s[1],"number"==typeof n.orientation&&(this.offset[1]+=1.2*(t[1]-n.vertical_buffer),i&&(this.offset[1]*=-1),-1===n.orientation&&(this.offset[1]*=-1));for(var a=tl(e),l=t[0]*o,u=0;u<e.length-1;u++)for(var h=e[u],c=0,f=0,d=u+1,_=void 0;d<e.length;){var p=e[d-1],m=e[d],v=Qa(p,m);if(d!==u+1&&(c+=ol(v,_)),Math.abs(c)>.1)break;if(Ka(f+=a[d-1],l)<r){var g=Qr.mult(Qr.add(h,m),.5);return this.angle=-v,Math.abs(this.angle-Math.PI/2)<.01&&(this.angle=-Math.PI/2,"number"==typeof n.orientation&&(this.offset[1]*=-1)),this.position=g,this.updateBBoxes(this.position,t,this.angle,this.angle,this.offset),!0}_=v,d++}return!1},n.updateBBoxes=function(t,e,n,r,i){var o=this.unit_scale;this.obbs=[],this.aabbs=[];var s=(e[0]+2*this.layout.buffer[0])*o*Ys.epsilon,a=(e[1]+2*this.layout.buffer[1])*o*Ys.epsilon,l=Xa.createOBB(t,s,a,n,r,i,o),u=l.getExtent();this.obbs.push(l),this.aabbs.push(u),this.inTileBounds&&(this.breach=!this.inTileBounds()),this.mayRepeatAcrossTiles&&(this.may_repeat_across_tiles=this.mayRepeatAcrossTiles())},e}(Xa),Ja=function(t){function e(e,n,r){var i;return(i=t.call(this,r)||this).type="curved",i.angles=[],i.pre_angles=[],i.offsets=[],i.num_segments=e.length,i.sizes=e,i.throw_away=!i.fit(i.sizes,n,r),i}Ri(e,t);var n=e.prototype;return n.toJSON=function(){return{id:this.id,type:this.type,obbs:this.obbs.map((function(t){return t.toJSON()})),position:this.position,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:Xs(this.layout)}},n.fit=function(t,n,r){var i,o=this.unit_scale,s=Math.max.apply(Math,t.map((function(t){return t[1]}))),a=s*o,l=Xa.splitLineByOrientation(n);n=l[0],i=l[1],"number"==typeof r.orientation&&(this.offset[1]+=1.2*(s-r.vertical_buffer),i&&(this.offset[1]*=-1),-1===r.orientation&&(this.offset[1]*=-1));var u=tl(n),h=t.map((function(t){return t[0]*o})),c=u.reduce((function(t,e){return t+e}),0),f=h.reduce((function(t,e){return t+e}),0);if(f>c)return!1;var d=n.length-1;if(d-0<2)return!1;var _=e.curvaturePlacement(n,c,u,f,0,d),p=n[_];if(-1===_||d-_<2)return!1;this.position=p;for(var m=0;m<h.length;m++){this.offsets[m]=[],this.angles[m]=[],this.pre_angles[m]=[];for(var v=0;v<Ha.length;v++){var g=Ha[v],y=e.scaleLine(g,n),x=y[0],b=y[1];p=x[_];var w=e.placeAtIndex(_,x,b,h),T=w.positions,A=w.offsets,E=w.angles,k=w.pre_angles,S=A.map((function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])/o}));if(0===g){this.angle=1/E.length*E.reduce((function(t,e){return t+e}));for(var P=0;P<T.length;P++){var M=T[P],z=k[P],R=h[P],L=z+E[P],C=this.angle,O=Xa.createOBB(M,R,a,L,C,this.offset,o),N=O.getExtent();this.obbs.push(O),this.aabbs.push(N)}}this.offsets[m].push(S[m]),this.angles[m].push(E[m]),this.pre_angles[m].push(k[m])}}return!0},e.curvaturePlacement=function(t,e,n,r,i,o){i=i||0,o=o||t.length-1;for(var s=[],a=i+1;a<o;a++){var l=t[a-1],u=t[a],h=t[a+1],c=Qr.perp(u,l),f=Qr.perp(h,u),d=Qr.angleBetween(c,f);d>1&&(d=1/0),s.push(d)}s.push(1/0);for(var _=[],p=[],m=i,v=0,g=0;g<i;g++)v+=n[g];for(;v+r<e;){for(var y=v+r,x=v,b=m,w=0;b<o&&x+n[b]<y&&(w+=s[b])!==1/0;)x+=n[b],b++;if(0===w)return m;var T=w/(b-m);_.push(w),p.push(T),v+=n[m],m++}if(0===_.length)return-1;var A=Math.min.apply(null,_),E=p[_.indexOf(A)];return A<1.3&&E<.4?_.indexOf(A):-1},e.scaleLine=function(t,e){var n=[e[0]],r=[];return e.forEach((function(i,o){if(o!==e.length-1){var s=Qr.sub(e[o+1],e[o]),a=Qr.mult(s,1+t);n.push(Qr.add(n[o],a)),r.push(Qr.length(a))}})),[n,r]},e.placeAtIndex=function(t,n,r,i){var o=n[t],s=e.getIndicesAndOffsets(t,r,i),a=s[0],l=s[1],u=e.getPositionsFromIndicesAndOffsets(n,a,l),h=e.getAnglesFromIndicesAndOffsets(o,a,n,u);return{positions:u,offsets:h[0],angles:h[1],pre_angles:h[2]}},e.getIndicesAndOffsets=function(t,e,n){for(var r=n.length,i=[],o=[],s=0,a=0,l=0;s<r;){for(var u=n[s];s<r&&a+.5*u<=l+e[t];){var h=a-l+.5*u;o.push(h),i.push(t),a+=u,u=n[++s]}l+=e[t],t++}return[i,o]},e.getPositionsFromIndicesAndOffsets=function(t,e,n){for(var r=[],i=0;i<e.length;i++){var o=e[i],s=n[i],a=Qa(t[o],t[o+1]),l=Qr.rot([s,0],a),u=Qr.add(t[o],l);r.push(u)}return r},e.getAnglesFromIndicesAndOffsets=function(t,e,n,r){for(var s=[],a=[],o=[],u=0;u<r.length;u++){var l=r[u],h=e[u],c=Qr.sub(l,t),f=-Qr.angle(c),d=-Qa(n[h],n[h+1])-f;if(u>0){var p=s[u-1],_=a[u-1];Math.abs(f-p)>Math.PI&&(f+=f>p?-2*Math.PI:2*Math.PI),Math.abs(_-d)>Math.PI&&(d+=d>_?-2*Math.PI:2*Math.PI)}s.push(f),a.push(d),o.push(c)}return[o,s,a]},e}(Xa);function Ka(t,e){return e/t}function Qa(t,e){var n=Qr.sub(e,t);return Qr.angle(n)}function tl(t){for(var e=[],n=0;n<t.length-1;n++){var r=t[n],i=t[n+1],o=Math.hypot(r[0]-i[0],r[1]-i[1]);e.push(o)}return e}function ol(t,e){var n,r;for(t>e?(n=e,r=t):(n=t,r=e);r-n>Math.PI;)n+=2*Math.PI;return Math.abs(r-n)}var el=Object.create(qa);Object.assign(el,{name:"text",super:qa,built_in:!0,init:function(t){void 0===t&&(t={}),po.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_CURVED_LABEL=!0,this.reset()},makeVertexTemplate:function(t,e){this.super.makeVertexTemplate.call(this,t,e,!1);for(var n=e.vertex_data.vertex_layout.index.a_pre_angles,r=0;r<12;r++)this.vertex_template[n++]=0;return this.addCustomAttributesToVertexTemplate(t,n),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(t,e,n){var r=this,i=n.tile;if(i.generation===this.generation){var o=t.geometry.type;e.can_articulate="LineString"===o||"MultiLineString"===o,e.supersample_text="LineString"===o||"MultiLineString"===o;var s=this.parseTextFeature(t,e,n,i);s&&(s instanceof Array?s.forEach((function(e){e.feature=t,e.context=n,e.layout.vertex=!1,r.queueFeature(e,i)})):(s.feature=t,s.context=n,s.layout.vertex=!1,this.queueFeature(s,i)),Ks.addStyle(this.name,i.id))}},endData:function(t){return new Promise(function(e,n){var r,i,o,s,a,l,u,h;return r=this,i=this.queues[t.id],delete this.queues[t.id],Promise.resolve(this.collideAndRenderTextLabels(t,this.name,i)).then(function(i){try{return s=(o=i).labels,a=o.texts,l=o.textures,s&&a&&(this.texts[t.id]=a,s.forEach((function(e){var n=e.text_settings_key,i=r.texts[t.id][n]&&r.texts[t.id][n][e.text],o=r.feature_style;o.label=e.label,i.text_settings.can_articulate?(o.size={},o.texcoords={},"straight"===e.label.type?(o.size.straight=i.size.logical_size,o.texcoords.straight=i.texcoords.straight,o.label_texture=l[i.texcoords.straight.texture_id]):(o.size.curved=i.segment_sizes.map((function(t){return t.logical_size})),o.texcoords_stroke=i.texcoords_stroke,o.texcoords.curved=i.texcoords.curved,o.label_textures=i.texcoords.curved.map((function(t){return l[t.texture_id]})))):(o.size=i.size.logical_size,o.texcoords=i.align[e.label.align].texcoords,o.label_texture=l[i.align[e.label.align].texture_id]),o.blend_order=e.draw.blend_order,po.addFeature.call(r,e.feature,e.draw,e.context)}))),this.freeText(t),Promise.resolve(po.endData.call(this,t)).then((function(t){try{if(u=t)for(var r in l&&l.length&&(h=u.textures).push.apply(h,l),u.meshes)u.meshes[r].uniforms.u_apply_color_blocks=!0;return e(u)}catch(t){return n(t)}}),n)}catch(t){return n(t)}}.bind(this),n)}.bind(this))},_preprocess:function(t){return t.blend_order=this.getBlendOrderForDraw(t),this.preprocessText(t)},buildTextLabels:function(t,e){for(var n=[],r=0;r<e.length;r++){var i=e[r],o=this.texts[t.id][i.text_settings_key][i.text],s=void 0;if(i.layout.vertical_buffer=o.vertical_buffer,o.text_settings.can_articulate){var a=o.segment_sizes.map((function(t){return t.collision_size}));i.layout.no_curving=o.no_curving,s=this.buildLabels(a,i.feature.geometry,i.layout,o.size.collision_size)}else s=this.buildLabels(o.size.collision_size,i.feature.geometry,i.layout);for(var l=0;l<s.length;l++){var u=Object.create(i);u.label=s[l],n.push(u)}}return n},buildLabels:function(t,e,n,r){var i=[];if("LineString"===e.type)Array.prototype.push.apply(i,this.buildLineLabels(e.coordinates,t,n,r));else if("MultiLineString"===e.type)for(var o=e.coordinates,s=0;s<o.length;++s)Array.prototype.push.apply(i,this.buildLineLabels(o[s],t,n,r));else if("Point"===e.type)i.push(new Qs(e.coordinates,t,n));else if("MultiPoint"===e.type)for(var a=e.coordinates,l=0;l<a.length;++l)i.push(new Qs(a[l],t,n));else if("Polygon"===e.type){var u=li.centroid(e.coordinates);u&&i.push(new Qs(u,t,n))}else if("MultiPolygon"===e.type){var h=li.multiCentroid(e.coordinates);h&&i.push(new Qs(h,t,n))}return i},buildLineLabels:function(t,e,n,r){var i=[],o=Math.min(n.subdiv,t.length-1);if(o>1)for(var s=(t.length-1)/o,a=0;a<o;a++){var l=Math.floor(a*s),u=Math.floor((a+1)*s)+1,h=t.slice(l,u),c=Ya(e,r,h,n);c&&i.push(c)}if(i.length<o){var f=Ya(e,r,t,n);f&&i.push(f)}return i},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.shader_point]){var e=[{name:"a_position",size:4,type:Yr.SHORT,normalized:!1},{name:"a_shape",size:4,type:Yr.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:Yr.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:Yr.SHORT,normalized:!1},{name:"a_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Yr.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]},{name:"a_pre_angles",size:4,type:Yr.BYTE,normalized:!1},{name:"a_angles",size:4,type:Yr.SHORT,normalized:!1},{name:"a_offsets",size:4,type:Yr.UNSIGNED_SHORT,normalized:!1}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.shader_point]=new wo(e)}return this.vertex_layouts[t.shader_point]}}),el.texture_id=0;var il=Object.create(os);Object.assign(il,{name:"raster",super:os,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1},_preprocess:function(t){return t.color=t.color||Or.defaults.color,this.super._preprocess.apply(this,arguments)}});var nl=function(){function t(){this.styles={},this.base_styles={},this.active_styles=[],this.active_blend_orders=[],this.register(Object.create(os)),this.register(Object.create(Ps)),this.register(Object.create(qa)),this.register(Object.create(el)),this.register(Object.create(il))}var e=t.prototype;return e.init=function(){Xn.removeBlock("global"),Xn.removeBlock("setup"),Xn.addBlock("global","#ifdef TANGRAM_VERTEX_SHADER\n\n// Apply layer ordering to avoid z-fighting\nvoid applyLayerOrder (float layer, inout vec4 position) {\n    position.z -= layer * TANGRAM_LAYER_DELTA * position.w;\n}\n\n// Vertex position in model space: [0, 1] range over the local tile\n// Note positions can be outside that range due to unclipped geometry, geometry higher than a unit cube, etc.\nvec4 modelPosition() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE         // scale coords to ~0-1 range\n            * exp2(u_tile_origin.z - u_tile_origin.w),  // adjust for tile overzooming\n        1.)\n        + vec4(0., 1., 0., 0.);\n        // NB: additional offset to account for unusual Tangram JS y coords,\n        // should be refactored to remove\n}\n\n// Position in model space as above, but according to tile coordinate (as opposed to style) zoom\n// e.g. unadjusted for tile overzooming\nvec4 modelPositionBaseZoom() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE,    // scale coords to ~0-1 range\n        1.)\n        + vec4(0., 1., 0., 0.); // see note on offset above\n}\n\n#endif\n\n// Vertex position in world coordinates, useful for 3d procedural textures, etc.\nvec4 worldPosition() {\n    return v_world_position;\n}\n\n// Optionally wrap world coordinates (allows more precision at higher zooms)\n// e.g. at wrap 1000, the world space will wrap every 1000 meters\n#ifdef TANGRAM_VERTEX_SHADER\n\nvec4 wrapWorldPosition(vec4 world_position) {\n    #if defined(TANGRAM_WORLD_POSITION_WRAP)\n    vec2 anchor = u_tile_origin.xy - mod(u_tile_origin.xy, TANGRAM_WORLD_POSITION_WRAP);\n        world_position.xy -= anchor;\n    #endif\n    return world_position;\n}\n\n#endif\n\n// Normal in world space\n#if defined(TANGRAM_VERTEX_SHADER)\n\nvec3 worldNormal() {\n    return TANGRAM_NORMAL;\n}\n\n#elif defined(TANGRAM_FRAGMENT_SHADER)\n\nvec3 worldNormal() {\n    return u_inverseNormalMatrix * TANGRAM_NORMAL;\n}\n\n#endif\n"),Xn.addBlock("global","// Vertex attribute + varying for feature selection\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    attribute vec4 a_selection_color;\n    varying vec4 v_selection_color;\n#endif\n"),Xn.replaceBlock("setup","// Selection pass-specific rendering\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    if (a_selection_color.rgb == vec3(0.)) {\n        // Discard by forcing invalid triangle if we're in the feature\n        // selection pass but have no selection info\n        // TODO: in some cases we may actually want non-selectable features to occlude selectable ones?\n        gl_Position = vec4(0., 0., 0., 1.);\n        return;\n    }\n    v_selection_color = a_selection_color;\n#endif\n"),Xn.defines.TANGRAM_EPSILON=1e-5,Xn.defines.TANGRAM_LAYER_DELTA=1/16384,Xn.defines.TANGRAM_TILE_SCALE="vec3("+li.tile_scale+"., "+li.tile_scale+"., u_meters_per_pixel * "+li.tile_size+".)",Xn.defines.TANGRAM_HEIGHT_SCALE=li.height_scale,Xn.defines.TANGRAM_ALPHA_TEST=.5},e.destroy=function(t){var e=this;Object.keys(this.styles).forEach((function(n){var r=e.styles[n];r.gl===t&&(Ji("trace","StyleManager.destroy: destroying render style "+r.name),r.base&&e.remove(r.name),r.destroy())}))},e.register=function(t){this.styles[t.name]=t,this.base_styles[t.name]=t},e.remove=function(t){delete this.styles[t]},e.getActiveStyles=function(){return this.active_styles},e.updateActiveStyles=function(t){return this.active_styles=Object.keys(t.reduce((function(t,e){return Object.keys(e.meshes).forEach((function(e){return t[e]=!0})),t}),{})),this.active_styles},e.getActiveBlendOrders=function(){return this.active_blend_orders},e.updateActiveBlendOrders=function(t){var e=[];t.forEach((function(t){Object.entries(t.meshes).forEach((function(t){var n=t[0];t[1].forEach((function(t){var r=t.variant.blend_order,i=e.findIndex((function(t){return t.blend_order===r}));i=i>-1?i:e.push({blend_order:r,styles:[]})-1,-1===e[i].styles.indexOf(n)&&e[i].styles.push(n)}))}))})),this.active_blend_orders=e.sort((function(t,e){return t.blend_order-e.blend_order}))},e.mix=function(t,e){if(t.mixed)return t;t.mixed={};var n,r=[];t.mix&&(Array.isArray(t.mix)?(n=r).push.apply(n,t.mix):r.push(t.mix),(r=r.map((function(t){return e[t]})).filter((function(e){return e&&e!==t}))).forEach((function(e){return t.mixed[e.name]=!0}))),r.push(t),t.animated=r.some((function(t){return t&&t.animated})),t.texcoords=r.some((function(t){return t&&t.texcoords})),t.base=r.map((function(t){return t.base})).filter((function(t){return t})).pop(),t.lighting=r.map((function(t){return t.lighting})).filter((function(t){return null!=t})).pop(),t.texture=r.map((function(t){return t.texture})).filter((function(t){return t})).pop(),t.raster=r.map((function(t){return t.raster})).filter((function(t){return null!=t})).pop(),t.dash=r.map((function(t){return t.dash})).filter((function(t){return null!=t})).pop(),t.dash_background_color=r.map((function(t){return t.dash_background_color})).filter((function(t){return null!=t})).pop(),r.some((function(t){return t.hasOwnProperty("blend")&&t.blend}))&&(t.blend=r.map((function(t){return t.hasOwnProperty("blend")&&t.blend})).filter((function(t){return t})).pop()),t.blend_order=r.map((function(t){return t.blend_order})).filter((function(t){return null!=t})).pop(),t.defines=Object.assign.apply(Object,[{}].concat(r.map((function(t){return t.defines})).filter((function(t){return t})))),t.material=Object.assign.apply(Object,[{}].concat(r.map((function(t){return t.material})).filter((function(t){return t}))));var i=r.map((function(t){return t.draw})).filter((function(t){return t}));return i.length>0&&(t.draw=nr.apply(void 0,[{}].concat(i))),this.mixShaders(t,e,r),t},e.mixShaders=function(t,e,n){var r={},i=n.map((function(t){return t.shaders})).filter((function(t){return t}));if(r.defines=Object.assign.apply(Object,[{}].concat(i.map((function(t){return t.defines})).filter((function(t){return t})))),r.attributes=Object.assign.apply(Object,[{}].concat(i.map((function(t){return t.attributes})).filter((function(t){return t})))),r.uniforms={},r._uniforms=t.shaders&&t.shaders.uniforms||{},r._uniform_scopes={},n.filter((function(t){return t.shaders&&t.shaders.uniforms})).forEach((function(t){var n=function(n){r._uniform_scopes[n]=t.name,Object.defineProperty(r.uniforms,n,{enumerable:!0,configurable:!0,get:function(){return void 0!==r._uniforms[n]?r._uniforms[n]:e[r._uniform_scopes[n]].shaders.uniforms!==r.uniforms?e[r._uniform_scopes[n]].shaders.uniforms[n]:void 0},set:function(t){r._uniforms[n]=t}})};for(var i in t.shaders.uniforms)n(i)})),r.extensions=Object.keys(i.map((function(t){return t.extensions})).filter((function(t){return t})).reduce((function(t,e){return"string"==typeof e?t[e]=!0:e.forEach((function(e){return t[e]=!0})),t}),{})||{}),t.shaders&&t.shaders.blocks)for(var o in t.shaders.block_scopes=t.shaders.block_scopes||{},t.shaders.blocks){var s,a=t.shaders.blocks[o];t.shaders.block_scopes[o]=t.shaders.block_scopes[o]||[],Array.isArray(a)?(s=t.shaders.block_scopes[o]).push.apply(s,a.map((function(){return t.name}))):t.shaders.block_scopes[o].push(t.name)}var l={};return i.forEach((function(t){if(t.blocks){r.blocks=r.blocks||{},r.block_scopes=r.block_scopes||{};var e={};for(var n in t.blocks){var i=t.blocks[n],o=t.block_scopes[n];r.blocks[n]=r.blocks[n]||[],r.block_scopes[n]=r.block_scopes[n]||[],i=Array.isArray(i)?i:[i],o=Array.isArray(o)?o:[o];for(var s=0;s<i.length;s++)l[o[s]]||(e[o[s]]=!0,r.blocks[n].push(i[s]),r.block_scopes[n].push(o[s]))}Object.assign(l,e)}})),Object.assign(t.mixed,l),t.shaders=r,t},e.create=function(t,e,n){void 0===n&&(n={});var r=nr({},e);return r.name=t,(r=this.mix(r,n)).base&&this.base_styles[r.base]?this.styles[t]=r=Object.assign(Object.create(this.base_styles[r.base]),r):r.base=null,r},e.build=function(t){var e=this,n=Object.assign({},t);this.styles&&Object.values(this.styles).forEach((function(t){return Zi.removeTarget(t.main_thread_target)}));for(var r=["opaque","add","multiply","overlay","inlay","translucent"],i=["polygons","lines","points","text","raster"],o=0;o<r.length;o++)for(var s=r[o],a=0;a<i.length;a++){var l=i[a],u=s+"_"+l;null==n[u]&&(n[u]={base:l,blend:s})}var h=Object.keys(n).sort((function(t,r){return e.inheritanceDepth(t,n)-e.inheritanceDepth(r,n)}));for(var c in this.styles)this.base_styles[c]?this.styles[c].reset():delete this.styles[c];var f={};return h.forEach((function(t){f[t]=e.create(t,n[t],f)})),this.styles},e.initStyles=function(t){for(var e in void 0===t&&(t={}),this.styles)this.styles[e].init(t)},e.inheritanceDepth=function(t,e){for(var n=this,r=0;;){var i=e[t];if(!i)break;if(!i.mix)break;if(r++,Array.isArray(i.mix)){r+=Math.max.apply(Math,i.mix.map((function(r){if(t!==r)return n.inheritanceDepth(r,e)})));break}if(t===i.mix)break;t=i.mix}return r},t}();function ul(t){return null!=t}function rl(t){return"("+t+")"}function sl(t){return"string"==typeof t?'"'+t+'"':t}function al(t){return"$"===t[0]?"context['"+t.substring(1)+"']":t.indexOf(".")>-1?-1===t.indexOf("\\.")?"context.feature.properties"+t.split(".").map((function(t){return"['"+t+"']"})).join(""):"context.feature.properties"+t.replace(/\\\./g,"__TANGRAM_DELIMITER__").split(".").map((function(t){return t.replace(/__TANGRAM_DELIMITER__/g,".")})).map((function(t){return"['"+t+"']"})).join(""):"context.feature.properties['"+t+"']"}function dl(t,e){return rl(sl(e)+" === "+al(t))}function ll(t,e){return rl("["+e.map(sl).join(",")+"].indexOf("+al(t)+") > -1")}function hl(t,e){return rl(t.filter(ul).map((function(t){return rl(t.join(" && "))})).join(" "+e+" "))}function cl(t,e,n){return e&&e.length>0?hl(e.map((function(t){return yl(t,n)})),"||"):"true"}function fl(t,e,n){return e&&e.length>0?hl(e.map((function(t){return yl(t,n)})),"&&"):"true"}function pl(t,e,n){return"!"+rl(yl(e,n).join(" && "))}function _l(t,e,n){return"!"+rl(cl(0,e,n))}function ml(t,e){return rl(al(t)+(e?" != ":" == ")+"null")}function gl(t,e,n){var r=[],i=n&&"function"==typeof n.rangeTransform&&n.rangeTransform;if(e.max){var o=i?i(e.max):e.max;r.push(al(t)+" < "+o)}if(e.min){var s=i?s=i(e.min):e.min;r.push(al(t)+" >= "+s)}return rl(r.join(" && "))}function vl(t,e){var n=[];if(e.includes_any){var r="["+(Array.isArray(e.includes_any)?e.includes_any:[e.includes_any]).map(sl).join(",")+"]";n.push(al(t)+" != null && "+r+".some(function(v) { return "+al(t)+".indexOf(v) > -1 })")}if(e.includes_all){var i="["+(Array.isArray(e.includes_all)?e.includes_all:[e.includes_all]).map(sl).join(",")+"]";n.push(al(t)+" != null && "+i+".every(function(v) { return "+al(t)+".indexOf(v) > -1 })")}return rl(n.join(" && "))}function yl(t,e){var n=[];if("function"==typeof t)return[rl(t.toString()+"(context)")];if(Array.isArray(t))return[cl(0,t,e)];if(null==t)return["true"];for(var r=Object.keys(t),i=0;i<r.length;i++){var o=r[i],s=t[o],a=typeof s;if("string"===a||"number"===a)n.push(dl(o,s));else if("boolean"===a)n.push(ml(o,s));else if("not"===o)n.push(pl(0,s,e));else if("any"===o)n.push(cl(0,s,e));else if("all"===o)n.push(fl(0,s,e));else if("none"===o)n.push(_l(0,s,e));else if(Array.isArray(s))n.push(ll(o,s));else if("object"===a&&null!=s)s.max||s.min?n.push(gl(o,s,e)):(s.includes_any||s.includes_all)&&n.push(vl(o,s));else{if(null!=s)throw new Error("Unknown Query syntax: "+s);n.push(" true ")}}return 0===r.length?["true"]:n}function bl(t,e){return null==t?function(){return!0}:new Function("context","return "+rl(yl(t,e).join(" && "))+";")}D(D.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var xl=["filter","draw","visible","enabled","data","exclusive","priority"],wl={};function Tl(t,e){for(var n,r=0,i=0;i<t.length;i++)t[i].length>r&&(r=t[i].length);if(0===r)return null;for(var o={visible:!0},s=function(r){if(n=[],t.forEach((function(t){t[r]&&t[r][e]&&-1===n.indexOf(t[r][e])&&n.push(t[r][e])})),0===n.length)return"continue";nr.apply(void 0,[o].concat(n))},a=0;a<r;a++)s(a);return!1===o.visible?null:o}var Al=["any","all","not","none"],El=function(){function t(e){var n=e.layer,r=e.name,i=e.parent,o=e.draw,s=e.visible,a=e.enabled,l=e.filter,u=e.exclusive,h=e.priority,c=e.styles;if(this.id=t.id++,this.config_data=n.data,this.parent=i,this.name=r,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=o,this.filter=l,this.exclusive=!0===u,this.priority=null!=h?h:Number.MAX_SAFE_INTEGER,this.styles=c,this.is_built=!1,a=void 0===a?s:a,this.enabled=!1!==a,this.draw)for(var f in this.draw)if(this.draw[f]=null==this.draw[f]?{}:this.draw[f],"object"!=typeof this.draw[f]){var d="Draw group '"+f+"' for layer "+this.full_name+" is invalid, must be an object, ";Ji("warn",d+="but was set to `"+f+": "+this.draw[f]+"` instead"),delete this.draw[f]}}var e=t.prototype;return e.build=function(){Ji("trace","Building layer '"+this.full_name+"'"),this.buildFilter(),this.buildDraw(),this.is_built=!0},e.buildDraw=function(){this.draw=Rr(this.draw,Or.wrapFunction),this.calculatedDraw=function(t){var e=[];if(t.parent){var n=t.parent.calculatedDraw||[];e.push.apply(e,n)}return e.push(t.draw),e}(this)},e.buildFilter=function(){this.filter_original=this.filter,this.filter=Rr(this.filter,Or.wrapFunction);var t=typeof this.filter;if(null==this.filter||"object"===t||"function"===t)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||Object.keys(this.filter).length>0)?this.filter=bl(this.filter,Pl):this.filter=null}catch(t){var e="Filter for layer "+this.full_name+" is invalid, `filter: "+JSON.stringify(this.filter)+"` ";Ji("warn",e+="failed with error '"+t.message+"', stack trace: "+t.stack)}else{var n="Filter for layer "+this.full_name+" is invalid, filter value must be an object or function, ";Ji("warn",n+="but was set to `filter: "+this.filter+"` instead")}},e.buildZooms=function(){var t=this.filter&&this.filter.$zoom,e=typeof t;if(null!=t){if(this.zooms={},"number"===e)this.zooms[t]=!0;else if(Array.isArray(t))for(var n=0;n<t.length;n++)this.zooms[t[n]]=!0;else if("object"===e&&(null!=t.min||null!=t.max))for(var r=t.min||0,i=t.max||li.max_style_zoom,o=r;o<i;o++)this.zooms[o]=!0;delete this.filter.$zoom}},e.buildPropMatches=function(){var t=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach((function(e){if(-1===Al.indexOf(e)){var n=t.filter[e],r=typeof n,i=Array.isArray(n);if(!i&&"string"!==r&&"number"!==r)return;"$"===e[0]?(t.context_prop_matches=t.context_prop_matches||[],t.context_prop_matches.push([e.substring(1),i?n:[n]]),delete t.filter[e]):-1===e.indexOf(".")&&(t.feature_prop_matches=t.feature_prop_matches||[],t.feature_prop_matches.push([e,i?n:[n]]),delete t.filter[e])}}))},e.doPropMatches=function(t){if(this.feature_prop_matches)for(var e=0;e<this.feature_prop_matches.length;e++){var n=this.feature_prop_matches[e],r=t.feature.properties[n[0]];if(null==r||-1===n[1].indexOf(r))return!1}if(this.context_prop_matches)for(var i=0;i<this.context_prop_matches.length;i++){var o=this.context_prop_matches[i],s=t[o[0]];if(null==s||-1===o[1].indexOf(s))return!1}return!0},e.doesMatch=function(t){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[t.zoom])return!1;if(!this.doPropMatches(t))return!1;var e;if(this.filter instanceof Function)try{e=this.filter(t)}catch(e){var n="Filter for this "+this.full_name+": `filter: "+this.filter_original+"` ";Ji("error",n+="failed with error '"+e.message+"', stack trace: "+e.stack,t.feature)}else e=null==this.filter;return!!e&&(this.children_to_parse&&(function(t,e,n){for(var r in e){var i=e[r];if("object"!=typeof i||Array.isArray(i)){var o="Layer value must be an object: cannot create layer '"+r+": "+JSON.stringify(i)+"'";o+=", under parent layer '"+t.full_name+"'.",n[t.name]&&(o+=" The parent name '"+t.name+"' is also the name of a style, did you mean to create a 'draw' group",t.parent&&(o+=" under '"+t.parent.name+"'"),o+=" instead?"),Ji("warn",o)}else zl(r,i,t,n)}t.layers.sort((function(t,e){if(t.exclusive<e.exclusive)return 1;if(t.exclusive>e.exclusive)return-1;var n=t.exclusive?1:-1;return t.priority>e.priority?n:t.priority<e.priority?-n:t.full_name<e.full_name?n:t.full_name>e.full_name?-n:void 0}))}(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)},t}();El.id=0;var kl=function(t){function e(e){var n;return(n=t.call(this,e)||this).is_leaf=!0,n}return Ri(e,t),e}(El),Sl=function(t){function e(e){var n;return(n=t.call(this,e)||this).is_tree=!0,n.layers=e.layers||[],n}Ri(e,t);var n=e.prototype;return n.addLayer=function(t){this.layers.push(t)},n.buildDrawGroups=function(t){var e=[],n=[];if(function t(e,n,r,i){var o=!1;if(0!==n.length){for(var s=0;s<n.length;s++){var a=n[s];if(a.is_leaf){if(a.doesMatch(e)&&(o=!0,r.push(a),i.push(a.id),a.exclusive))break}else if(a.is_tree&&a.doesMatch(e)&&(o=!0,t(e,a.layers,r,i)||(r.push(a),i.push(a.id)),a.exclusive))break}return o}}(t,[this],e,n),e.length>0){var r=function(t){if(t.length>1){for(var e=t[0],n=1;n<t.length;n++)e+="/"+t[n];return e}return t[0]}(n);if(void 0===wl[r]){for(var i=e.map((function(t){return t&&!1!==t.visible&&t.calculatedDraw})),o={},s=0;s<i.length;s++){var a=i[s];if(a)for(var l=0;l<a.length;l++){var u=a[l];for(var h in u)o[h]=!0}}for(var c in o)wl[r]=wl[r]||{},wl[r][c]=Tl(i,c),wl[r][c]?(wl[r][c].key=r+"/"+c,wl[r][c].layers=e.map((function(t){return t&&t.full_name})),wl[r][c].group=c):delete wl[r][c];wl[r]&&0===Object.keys(wl[r]).length&&(wl[r]=null)}return wl[r]}},e}(El),Pl={rangeTransform:function(t){return"string"==typeof t&&"px2"===t.trim().slice(-3)?parseFloat(t)+" * context.meters_per_pixel_sq":t}};function Ml(t){return xl.indexOf(t)>-1}function zl(t,e,n,r){var i,o={name:t,layer:e=null==e?{}:e,parent:n,styles:r},s=function(t){var e={},n={};for(var r in t)Ml(r)?e[r]=t[r]:n[r]=t[r];return[e,n]}(e),a=s[0],l=s[1],u=(i=l,0===Object.keys(i).length),h=new(u&&null!=n?kl:Sl)(Object.assign(o,a));return h.enabled&&(n&&n.addLayer(h),h.children_to_parse=u?null:l),h}var Rl=0,Ll=0,Cl=function(){function t(t){var e=t.coords,n=t.style_z,r=t.source,i=t.workers,o=t.view;this.id=Rl++,this.view=o,this.source=r,this.generation=null,this.valid=!0,this.visible=!1,this.proxy_for=null,this.proxied_as=null,this.proxy_level=0,this.proxy_order_offset=0,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.debug={},this.style_z=n,this.coords=ho.normalizedCoord(e,this.source),this.key=ho.key(this.coords,this.source,this.style_z),this.overzoom=Math.max(this.style_z-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=li.metersForTile(this.coords),this.max=li.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:-(this.max.y-this.min.y)},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.meters_per_pixel=li.metersPerPixel(this.style_z),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=li.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=li.unitsPerMeter(this.coords.z)*this.overzoom2,this.preserve_tiles_within_zoom=this.source.preserve_tiles_within_zoom,this.meshes={},this.new_mesh_styles=[],this.pending_label_meshes=null,this.setWorker(i)}var e=t.prototype;return e.freeResources=function(){for(var t in this.meshes)this.meshes[t].forEach((function(t){return t.destroy()}));if(this.meshes={},this.pending_label_meshes)for(var e in this.pending_label_meshes)this.pending_label_meshes[e].forEach((function(t){return t.destroy()}));this.pending_label_meshes=null},e.destroy=function(){Tn.removeForTile(this.id),this.workerMessage("self.removeTile",this.key),this.freeResources(),this.worker=null,this.valid=!1},e.buildAsMessage=function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_z:this.style_z,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation,debug:this.debug}},e.setWorker=function(t){this.source.tiled?this.worker_id=Math.abs(this.coords.x+this.coords.y+this.coords.z)%t.length:this.worker_id=this.source.id%t.length,this.worker=t[this.worker_id]},e.workerMessage=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Zi.postMessage.apply(Zi,[this.worker].concat(e))},e.build=function(t,e){var n=(void 0===e?{}:e).fade_in,r=void 0===n||n;return this.generation=t,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()}).catch((function(t){throw t}))},t.cancel=function(e){e&&(e.canceled=!0,e.source_data&&e.source_data.request_id&&(en.cancelRequest(e.source_data.request_id),e.source_data.request_id=null),t.abortBuild(e))},t.buildGeometry=function(e,n){var r=n.scene_id,i=n.layers,o=n.styles,s=n.global,a=e.source_data;for(var l in e.debug.building=+new Date,e.debug.feature_count=0,e.debug.layers=null,Ks.startTile(e.id,{apply_repeat_groups:!0}),i){var u=i[l];if(u&&u.config_data){if(u.config_data.source===e.source)for(var h=t.getDataForSource(a,u.config_data,l),c=0;c<h.length;c++){var f=h[c],d=f.geom;if(d)for(var _=0;_<d.features.length;_++){var p=d.features[_];if(null!=p.geometry){var m=Or.getFeatureParseContext(p,e,s);m.winding=e.default_winding,m.source=e.source,m.layer=f.layer;var v=u.buildDrawGroups(m,!0);if(v){for(var g in v){var y=v[g],x=y.style||g,b=o[x];b?null!=(y=b.preprocess(y))&&!1!==y.visible&&(m.layers=y.layers,b.addFeature(p,y,m)):Ji("warn","Style '"+x+"' not found, skipping layer '"+l+"':",y,p)}e.debug.feature_count++}}}}}else Ji("warn","Layer "+l+" was defined without a geometry data source and will not be rendered.")}e.debug.building=+new Date-e.debug.building;var w=this.stylesForTile(e,o).map((function(t){return o[t]}));t.buildStyleGroups(e,w,r,(function(t){return t.collision?"collision":"non-collision"}))},t.stylesForTile=function(t,e){var n=[];for(var r in e)e[r].hasDataForTile(t)&&n.push(r);return n},t.buildStyleGroups=function(e,n,r,i){var o=n.reduce((function(t,e){var n=i(e);return t[n]=t[n]||[],t[n].push(e),t}),{});if(0===Object.keys(o).length)return Zi.postMessage("TileManager_"+r+".buildTileStylesCompleted",Zi.withTransferables({tile:t.slice(e),progress:{start:!0,done:!0}})),void Ks.resetTile(e.id);var s={};for(var a in o)t.buildStyleGroup({group_name:a,groups:o,tile:e,progress:s,scene_id:r})},t.buildStyleGroup=function(e){return new Promise((function(n,r){var i,o,s,a,l,u,h;i=e.group_name,o=e.groups,s=e.tile,a=e.progress,l=e.scene_id,u=o[i],h={};var c=function(){try{return n()}catch(t){return r(t)}},f=function(t){try{return Ji("error","Error for style group '"+i+"' for tile "+s.key,t&&t.stack||t),c()}catch(t){return r(t)}};try{return Promise.resolve(Promise.all(u.map((function(t){return new Promise((function(e,n){var r;return Promise.resolve(t.endData(s)).then((function(i){try{return(r=i)&&(h[t.name]=r),e()}catch(t){return n(t)}}),n)}))})))).then((function(e){try{return Ji("trace","Finished style group '"+i+"' for tile "+s.key),o[i]=null,Object.keys(o).every((function(t){return null==o[t]}))&&(a.done=!0),Zi.postMessage("TileManager_"+l+".buildTileStylesCompleted",Zi.withTransferables({tile:Object.assign({},t.slice(s),{mesh_data:h}),progress:a})),a.done&&Ks.resetTile(s.id),c()}catch(t){return f(t)}}),f)}catch(t){f(t)}}))},t.getDataForSource=function(t,e,n){var r=[];if(null!=e&&null!=t&&null!=t.layers)if(!0===e.all_layers)for(var i in null!=e.layer&&Ji({level:"warn",once:!0},"Layer "+n+" includes both 'all_layers: true' and an explicit 'layer' keyword in its 'data' block. 'all_layers: true' takes precedence, 'layer' will be ignored."),t.layers)r.push({layer:i,geom:t.layers[i]});else!e.layer&&t.layers._default?r.push({geom:t.layers._default}):!e.layer&&n?r.push({layer:n,geom:t.layers[n]}):"string"==typeof e.layer?r.push({layer:e.layer,geom:t.layers[e.layer]}):Array.isArray(e.layer)&&e.layer.forEach((function(e){r.push({layer:e,geom:t.layers[e]})}));return r},e.buildMeshes=function(t,e){if(!this.error){this.build_id=Ll++,e.start&&(this.debug.geometry_count=0,this.debug.buffer_size=0);var n={},r=this.mesh_data;if(r)for(var i in r){for(var o in r[i].meshes){var s=r[i].meshes[o];if(s.vertex_data){if(!t[i]){Ji("warn","Could not create mesh because style '"+i+"' not found, for tile "+this.key+", aborting tile");break}var a=Object.assign({},r[i]);a.uniforms=Object.assign({},a.uniforms,s.uniforms),a.variant=s.variant,s.labels&&(a.retain=!0);var l=t[i].makeMesh(s.vertex_data,s.vertex_elements,a);l.variant=a.variant,l.labels=s.labels,n[i]=n[i]||[],n[i].push(l),null==l.variant.mesh_order&&(l.variant.mesh_order=n[i].length-1),this.debug.buffer_size+=l.buffer_size,this.debug.geometry_count+=l.geometry_count}}n[i]&&n[i].sort((function(t,e){var n=t.variant.mesh_order,r=e.variant.mesh_order;return null==n?1:null==r||n<r?-1:1}))}for(var u in delete this.mesh_data,n)t[u].collision?(this.pending_label_meshes=this.pending_label_meshes||{},this.pending_label_meshes[u]=n[u]):(this.meshes[u]&&this.meshes[u].forEach((function(t){return t.destroy()})),this.meshes[u]=n[u],this.new_mesh_styles.push(u));if(e.done){for(var h in this.meshes)-1!==this.new_mesh_styles.indexOf(h)||this.pending_label_meshes&&null!=this.pending_label_meshes[h]||(this.meshes[h].forEach((function(t){return t.destroy()})),delete this.meshes[h]);this.new_mesh_styles=[],this.debug.geometry_ratio=(this.debug.geometry_count/this.debug.feature_count).toFixed(1)}this.printDebug(e)}},e.pendingLabelStyleCount=function(){return this.pending_label_meshes?Object.keys(this.pending_label_meshes).length:0},e.swapPendingLabels=function(){if(this.labeled=!0,this.pending_label_meshes){for(var t in this.pending_label_meshes)this.meshes[t]&&this.meshes[t].forEach((function(t){return t.destroy()})),this.meshes[t]=this.pending_label_meshes[t];this.pending_label_meshes=null}},t.abortBuild=function(t){if(Tn.removeForTile(t.id),Ks.abortTile(t.id),t.mesh_data)for(var e in t.mesh_data){var n=t.mesh_data[e].textures;n&&n.forEach((function(e){var n=Gn.textures[e];n&&(Ji("trace","releasing texture "+e+" for tile "+t.key),n.release())}))}},e.setProxyFor=function(t){t?(this.visible=!0,this.proxy_for=this.proxy_for||[],this.proxy_for.push(t),this.proxy_order_offset=1,t.proxied_as=t.style_z>this.style_z?"child":"parent",this.proxy_level=Math.abs(t.style_z-this.style_z)):(this.proxy_for=null,this.proxy_order_offset=0,this.proxy_level=0)},e.isProxy=function(){return null!=this.proxy_for},e.shouldProxyForStyle=function(t){return!this.proxy_for||this.proxy_for.some((function(e){return null==e.meshes[t]}))},e.setupProgram=function(t,e){var n=t.model,r=t.model32;e.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_z,this.coords.z]),e.uniform("1f","u_tile_proxy_order_offset",this.proxy_order_offset),Fa(n),Ca(n,n,Ma(this.min.x,this.min.y,0)),Oa(n,n,Ma(this.span.x/li.tile_scale,this.span.y/li.tile_scale,1)),Da(r,n),e.uniform("Matrix4fv","u_model",r),e.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)},t.slice=function(t,e){var n=["id","key","loading","loaded","generation","error","debug"];Array.isArray(e)&&n.push.apply(n,e);for(var r={},i=0;i<n.length;i++){var o=n[i];r[o]=t[o]}return r},e.merge=function(t){return this.loading=t.loading,this.loaded=t.loaded,this.generation=t.generation,this.error=t.error,this.mesh_data=t.mesh_data,this.debug=nr(this.debug,t.debug),this},e.printDebug=function(t){var e=["layers"],n={};for(var r in this.debug)-1===e.indexOf(r)&&(n[r]=this.debug[r]);Ji("debug","Tile "+(t.done?"(done)":"")+": debug for "+this.key+": [  "+JSON.stringify(n)+" ]")},t}();Cl.coord_children={};var Ol=function(t,e,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,u=l>>1,h=-7,c=n?i-1:0,f=n?-1:1,d=t[e+c];for(c+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+t[e+c],c+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+c],c+=f,h-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)},Nl=function(t,e,n,r,i,o){var s,a,l,u=8*o-i-1,h=(1<<u)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,_=r?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+c>=1?f/l:f*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=h?(a=0,s=h):s+c>=1?(a=(e*l-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[n+d]=255&a,d+=_,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[n+d]=255&s,d+=_,s/=256,u-=8);t[n+d-_]|=128*p},Il=Fl;function Fl(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function Dl(t){return t.type===Fl.Bytes?t.readVarint()+t.pos:t.pos+1}function Bl(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function jl(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function Ul(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Gl(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Zl(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Vl(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function ql(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Wl(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Hl(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Yl(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Xl(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function $l(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Jl(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Kl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Fl.Varint=0,Fl.Fixed64=1,Fl.Bytes=2,Fl.Fixed32=5,Fl.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=$l(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Kl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=$l(this.buf,this.pos)+4294967296*$l(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=$l(this.buf,this.pos)+4294967296*Kl(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ol(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ol(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return Bl(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return Bl(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return Bl(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return Bl(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return Bl(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return Bl(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,n){for(var r="",i=e;i<n;){var o,s,a,l=t[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h>n)break;1===h?l<128&&(u=l):2===h?128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===h?(o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&((u=(15&l)<<12|(63&o)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),i+=h}return r}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var n=Dl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Fl.Varint)for(;this.buf[this.pos++]>127;);else if(e===Fl.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Fl.Fixed32)this.pos+=4;else{if(e!==Fl.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Jl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Jl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Jl(this.buf,-1&t,this.pos),Jl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Jl(this.buf,-1&t,this.pos),Jl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&jl(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Nl(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Nl(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&jl(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Fl.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,Ul,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Gl,e)},writePackedBoolean:function(t,e){this.writeMessage(t,ql,e)},writePackedFloat:function(t,e){this.writeMessage(t,Zl,e)},writePackedDouble:function(t,e){this.writeMessage(t,Vl,e)},writePackedFixed32:function(t,e){this.writeMessage(t,Wl,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,Hl,e)},writePackedFixed64:function(t,e){this.writeMessage(t,Yl,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,Xl,e)},writeBytesField:function(t,e){this.writeTag(t,Fl.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Fl.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Fl.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Fl.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Fl.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Fl.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Fl.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Fl.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Fl.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Fl.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Ql=tu;function tu(t,e){this.x=t,this.y=e}tu.prototype={clone:function(){return new tu(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},tu.convert=function(t){return t instanceof tu?t:Array.isArray(t)?new tu(t[0],t[1]):t};var eu=iu;function iu(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(nu,this,e)}function nu(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function ru(t){for(var e,n,r=0,i=0,o=t.length,s=o-1;i<o;s=i++)e=t[i],r+=((n=t[s]).x-e.x)*(e.y+n.y);return r}iu.types=["Unknown","Point","LineString","Polygon"],iu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,i=0,o=0,s=0,a=[];t.pos<n;){if(!i){var l=t.readVarint();r=7&l,i=l>>3}if(i--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new Ql(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},iu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,s=1/0,a=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!r){var h=t.readVarint();n=7&h,r=h>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<s&&(s=i),i>a&&(a=i),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,u]},iu.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),u=iu.types[this.type];function h(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-360*(n.y+a)/o;t[e]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(r=0;r<l.length;r++)c[r]=l[r][0];h(l=c);break;case 2:for(r=0;r<l.length;r++)h(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var s=ru(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(l),r=0;r<l.length;r++)for(i=0;i<l[r].length;i++)h(l[r][i])}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var ou=su;function su(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(au,this,e),this.length=this._features.length}function au(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function lu(t,e,n){if(3===t){var r=new ou(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}su.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new eu(this._pbf,e,this.extent,this._keys,this._values)};var uu=function(t,e){this.layers=t.readFields(lu,{},e)},hu=eu,cu=0,fu=1,du=2,pu=["{","["],_u=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).response_type="arraybuffer",!0===e.parse_json?r.parse_json_type=fu:Array.isArray(e.parse_json)?(r.parse_json_type=du,r.parse_json_prop_list=e.parse_json):(null!=e.parse_json&&Ji({level:"warn",once:!0},"Data source '"+r.name+"': 'parse_json' parameter should be 'true', or an array of property names (was '"+JSON.stringify(e.parse_json)+"')"),r.parse_json_type=cu),r}Ri(e,t);var n=e.prototype;return n.parseSourceData=function(t,e,n){var r=new Uint8Array(n),i=new Il(r);if(e.data=new uu(i),e.layers=this.toGeoJSON(e.data),"function"==typeof this.transform){var o={min:Object.assign({},t.min),max:Object.assign({},t.max),coords:Object.assign({},t.coords)};e.layers=this.transform(e.layers,this.extra_data,o)}delete e.data},n.toGeoJSON=function(t){var e={};for(var n in t.layers){for(var r=t.layers[n],i=li.tile_scale/r.extent,o={type:"FeatureCollection",features:[]},s=0;s<r.length;s++){var a=r.feature(s),l={type:"Feature",geometry:{},id:a.id,properties:a.properties};this.parseJSONProperties(l);for(var u=l.geometry,h=a.loadGeometry(),c=0;c<h.length;c++)for(var f=h[c],d=0;d<f.length;d++)f[d]=[f[d].x*i,f[d].y*i];u.coordinates=h,"Point"===hu.types[a.type]?1===h.length?(u.type="Point",u.coordinates=u.coordinates[0][0]):(u.type="MultiPoint",u.coordinates=u.coordinates[0]):"LineString"===hu.types[a.type]?1===h.length?(u.type="LineString",u.coordinates=u.coordinates[0]):u.type="MultiLineString":"Polygon"===hu.types[a.type]&&(u=mu(u)),o.features.push(l)}e[n]=o}return e},n.parseJSONProperties=function(t){if(this.parse_json_type!==cu){var e=t.properties;if(this.parse_json_type===du)this.parse_json_prop_list.forEach((function(t){try{e[t]=JSON.parse(e[t])}catch(t){}}));else for(var n in e)if(pu.indexOf(e[n][0])>-1)try{e[n]=JSON.parse(e[n])}catch(t){}}},e}(uo);function mu(t){for(var e,n=[],r=[],i=0;i<t.coordinates.length;i++){var o=t.coordinates[i],s=li.ringWinding(o);null!=s&&(s===(e=e||s)&&r.length>0&&(n.push(r),r=[]),r.push(o))}return r.length>0&&n.push(r),1===n.length?(t.type="Polygon",t.coordinates=n[0]):n.length>1?(t.type="MultiPolygon",t.coordinates=n):t=null,t}function gu(t,e,n,r,i,o){var s=i-n,a=o-r;if(0!==s||0!==a){var l=((t-n)*s+(e-r)*a)/(s*s+a*a);l>1?(n=i,r=o):l>0&&(n+=s*l,r+=a*l)}return(s=t-n)*s+(a=e-r)*a}function vu(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)yu(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)yu(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)yu(t,e[r][i])}(i),i}function yu(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function bu(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=r||0),"Point"===o)xu(i,a);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)xu(i[u],a);else if("LineString"===o)wu(i,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(u=0;u<i.length;u++)a=[],wu(i[u],a,s,!1),t.push(vu(l,"LineString",a,e.properties));return}Tu(i,a,s,!1)}else if("Polygon"===o)Tu(i,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)bu(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var h=[];Tu(i[u],h,s,!0),a.push(h)}}t.push(vu(l,o,a,e.properties))}}function xu(t,e){e.push(Au(t[0])),e.push(Eu(t[1])),e.push(0)}function wu(t,e,n,r){for(var i,o,s=0,a=0;a<t.length;a++){var l=Au(t[a][0]),u=Eu(t[a][1]);e.push(l),e.push(u),e.push(0),a>0&&(s+=r?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var h=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,s=i,a=r-n>>1,l=r-n,u=e[n],h=e[n+1],c=e[r],f=e[r+1],d=n+3;d<r;d+=3){var _=gu(e[d],e[d+1],u,h,c,f);if(_>s)o=d,s=_;else if(_===s){var p=Math.abs(d-a);p<l&&(o=d,l=p)}}s>i&&(o-n>3&&t(e,n,o,i),e[o+2]=s,r-o>3&&t(e,o,r,i))}(e,0,h,n),e[h+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function Tu(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];wu(t[i],o,n,r),e.push(o)}}function Au(t){return t/360+.5}function Eu(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function ku(t,e,n,r,i,o,s,a){if(r/=e,o>=(n/=e)&&s<r)return t;if(s<n||o>=r)return null;for(var l=[],u=0;u<t.length;u++){var h=t[u],c=h.geometry,f=h.type,d=0===i?h.minX:h.minY,_=0===i?h.maxX:h.maxY;if(d>=n&&_<r)l.push(h);else if(!(_<n||d>=r)){var p=[];if("Point"===f||"MultiPoint"===f)Su(c,p,n,r,i);else if("LineString"===f)Pu(c,p,n,r,i,!1,a.lineMetrics);else if("MultiLineString"===f)zu(c,p,n,r,i,!1);else if("Polygon"===f)zu(c,p,n,r,i,!0);else if("MultiPolygon"===f)for(var m=0;m<c.length;m++){var v=[];zu(c[m],v,n,r,i,!0),v.length&&p.push(v)}if(p.length){if(a.lineMetrics&&"LineString"===f){for(m=0;m<p.length;m++)l.push(vu(h.id,f,p[m],h.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===p.length?(f="LineString",p=p[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===p.length?"Point":"MultiPoint"),l.push(vu(h.id,f,p,h.tags))}}}return l.length?l:null}function Su(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var s=t[o+i];s>=n&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Pu(t,e,n,r,i,o,s){for(var a,l,u=Mu(t),h=0===i?Lu:Cu,c=t.start,f=0;f<t.length-3;f+=3){var d=t[f],_=t[f+1],p=t[f+2],m=t[f+3],v=t[f+4],g=0===i?d:_,y=0===i?m:v,x=!1;s&&(a=Math.sqrt(Math.pow(d-m,2)+Math.pow(_-v,2))),g<n?y>n&&(l=h(u,d,_,m,v,n),s&&(u.start=c+a*l)):g>r?y<r&&(l=h(u,d,_,m,v,r),s&&(u.start=c+a*l)):Ru(u,d,_,p),y<n&&g>=n&&(l=h(u,d,_,m,v,n),x=!0),y>r&&g<=r&&(l=h(u,d,_,m,v,r),x=!0),!o&&x&&(s&&(u.end=c+a*l),e.push(u),u=Mu(t)),s&&(c+=a)}var b=t.length-3;d=t[b],_=t[b+1],p=t[b+2],(g=0===i?d:_)>=n&&g<=r&&Ru(u,d,_,p),b=u.length-3,o&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&Ru(u,u[0],u[1],u[2]),u.length&&e.push(u)}function Mu(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function zu(t,e,n,r,i,o){for(var s=0;s<t.length;s++)Pu(t[s],e,n,r,i,o,!1)}function Ru(t,e,n,r){t.push(e),t.push(n),t.push(r)}function Lu(t,e,n,r,i,o){var s=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*s),t.push(1),s}function Cu(t,e,n,r,i,o){var s=(o-n)/(i-n);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function Ou(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)i=Nu(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){i=[];for(var a=0;a<o.geometry.length;a++)i.push(Nu(o.geometry[a],e))}else if("MultiPolygon"===s)for(i=[],a=0;a<o.geometry.length;a++){for(var l=[],u=0;u<o.geometry[a].length;u++)l.push(Nu(o.geometry[a][u],e));i.push(l)}n.push(vu(o.id,s,i,o.tags))}return n}function Nu(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function Iu(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,s=t.x,a=t.y;for(n=0;n<t.features.length;n++){var l=t.features[n],u=l.geometry,h=l.type;if(l.geometry=[],1===h)for(r=0;r<u.length;r+=2)l.geometry.push(Fu(u[r],u[r+1],e,o,s,a));else for(r=0;r<u.length;r++){var c=[];for(i=0;i<u[r].length;i+=2)c.push(Fu(u[r][i],u[r][i+1],e,o,s,a));l.geometry.push(c)}}return t.transformed=!0,t}function Fu(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function Du(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,Bu(s,t[a],o,i);var l=t[a].minX,u=t[a].minY,h=t[a].maxX,c=t[a].maxY;l<s.minX&&(s.minX=l),u<s.minY&&(s.minY=u),h>s.maxX&&(s.maxX=h),c>s.maxY&&(s.maxY=c)}return s}function Bu(t,e,n,r){var i=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ju(s,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)ju(s,i[a],t,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(a=0;a<u.length;a++)ju(s,u[a],t,n,!0,0===a)}if(s.length){var h=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var c in h={},e.tags)h[c]=e.tags[c];h.mapbox_clip_start=i.start/i.size,h.mapbox_clip_end=i.end/i.size}var f={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:h};null!==e.id&&(f.id=e.id),t.features.push(f)}}function ju(t,e,n,r,i,o){var s=r*r;if(r>0&&e.size<(i?s:r))n.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(n.numSimplified++,a.push(e[l]),a.push(e[l+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=s,t[i-1-r]=a}}(a,o),t.push(a)}}function Uu(t,e){return new Gu(t,e)}function Gu(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)bu(n,t.features[r],e,r);else"Feature"===t.type?bu(n,t,e):bu(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=ku(t,1,-1-n,n,0,-1,2,e),o=ku(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=ku(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=Ou(i,1).concat(r)),o&&(r=r.concat(Ou(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zu(t,e,n){return 32*((1<<t)*n+e)+t}so.register("MVT",(function(){return _u})),Gu.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Gu.prototype.splitTile=function(t,e,n,r,i,o,s){for(var a=[t,e,n,r],l=this.options,u=l.debug;a.length;){r=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();var h=1<<e,c=Zu(e,n,r),f=this.tiles[c];if(!f&&(u>1&&console.time("creation"),f=this.tiles[c]=Du(t,e,n,r,l),this.tileCoords.push({z:e,x:n,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=t,i){if(e===l.maxZoom||e===i)continue;var _=1<<i-e;if(n!==Math.floor(o/_)||r!==Math.floor(s/_))continue}else if(e===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==t.length){u>1&&console.time("clipping");var p,m,v,g,y,x,b=.5*l.buffer/l.extent,w=.5-b,T=.5+b,A=1+b;p=m=v=g=null,y=ku(t,h,n-b,n+T,0,f.minX,f.maxX,l),x=ku(t,h,n+w,n+A,0,f.minX,f.maxX,l),t=null,y&&(p=ku(y,h,r-b,r+T,1,f.minY,f.maxY,l),m=ku(y,h,r+w,r+A,1,f.minY,f.maxY,l),y=null),x&&(v=ku(x,h,r-b,r+T,1,f.minY,f.maxY,l),g=ku(x,h,r+w,r+A,1,f.minY,f.maxY,l),x=null),u>1&&console.timeEnd("clipping"),a.push(p||[],e+1,2*n,2*r),a.push(m||[],e+1,2*n,2*r+1),a.push(v||[],e+1,2*n+1,2*r),a.push(g||[],e+1,2*n+1,2*r+1)}}},Gu.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=Zu(t,e=(e%s+s)%s,n);if(this.tiles[a])return Iu(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,u=t,h=e,c=n;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[Zu(u,h,c)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,h,c),o>1&&console.time("drilling down"),this.splitTile(l.source,u,h,c,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?Iu(this.tiles[a],i):null):null};var Vu=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).load_data=null,r.tile_indexes={},r.setTileSize(512),r.pad_scale=0,r}Ri(e,t);var n=e.prototype;return n._load=function(e){var n=this;return this.load_data||(this.load_data=t.prototype._load.call(this,{source_data:{layers:{}}}).then((function(t){t.source_data.error&&Ji("warn","data source load error(s) for source '"+n.name+"', URL '"+n.url+"': "+t.source_data.error);var e=t.source_data.layers;for(var r in e)n.tile_indexes[r]=Uu(e[r],{maxZoom:n.max_zoom,tolerance:1.5,extent:li.tile_scale,buffer:1e-4});return n.loaded=!0,t}))),this.load_data.then((function(){for(var t in n.tile_indexes)e.source_data.layers[t]=n.getTileFeatures(e,t);return e}))},n.getTileFeatures=function(t,e){var n,r=li.wrapTile(t.coords,{x:!0}),i=this.tile_indexes[e].getTile(r.z,r.x,r.y);if(i&&i.features){n={type:"FeatureCollection",features:[]};for(var o=0;o<i.features.length;o++){var s=i.features[o],a={type:"Feature",geometry:{},id:s.id,properties:s.tags};if(1===s.type)a.geometry.coordinates=s.geometry.map((function(t){return[t[0],t[1]]})),a.geometry.type="MultiPoint";else{if(2!==s.type&&3!==s.type)continue;if(a.geometry.coordinates=s.geometry.map((function(t){return t.map((function(t){return[t[0],t[1]]}))})),2===s.type)a.geometry.type="MultiLineString";else if(a.geometry=mu(a.geometry),null==a.geometry)continue}n.features.push(a)}}return n},n.formatURL=function(){return this.url},n.parseSourceData=function(t,e,n){var r="string"==typeof n?JSON.parse(n):n,i=this.getLayers(r);e.layers=this.preprocessLayers(i,t)},n.preprocessLayers=function(t,e){for(var n in t){var r=t[n];r.features=this.preprocessFeatures(r.features)}if("function"==typeof this.transform){var i={min:Object.assign({},e.min),max:Object.assign({},e.max),coords:Object.assign({},e.coords)};1===Object.keys(t).length&&t._default?t._default=this.transform(t._default,this.extra_data,i):t=this.transform(t,this.extra_data,i)}return t},n.preprocessFeatures=function(t){if(t=t.filter((function(t){return null!=t.geometry})),this.config.generate_label_centroids){var e=[],n={label_placement:!0};t.forEach((function(t){var r,i;if("Polygon"===t.geometry.type)i=Wu(r=t.geometry.coordinates,t.id,t.properties,n),e.push(i);else if("MultiPolygon"===t.geometry.type){r=t.geometry.coordinates;for(var o=-1/0,s=0,a=0;a<r.length;a++){var l=li.polygonArea(r[a]);l>o&&(o=l,s=a)}i=Wu(r[s],t.id,t.properties,n),e.push(i)}})),e=e.filter((function(t){return t})),Array.prototype.push.apply(t,e)}return t},n.getLayers=function(t){return"Feature"===t.type?{_default:{type:"FeatureCollection",features:[t]}}:"FeatureCollection"===t.type?{_default:t}:t},e}(lo),qu=function(t){function e(e,n){return t.call(this,e,n)||this}Ri(e,t);var n=e.prototype;return n.parseSourceData=function(t,e,n){var r="string"==typeof n?JSON.parse(n):n;this.prepareGeoJSON(r,t,e)},n.prepareGeoJSON=function(t,e,n){if("function"==typeof this.transform){var r={min:Object.assign({},e.min),max:Object.assign({},e.max),coords:Object.assign({},e.coords)};t=this.transform(t,this.extra_data,r)}n.layers=Vu.prototype.getLayers(t);var i={coords:e.coords,min:li.metersForTile(li.wrapTile(e.coords,{x:!0}))};so.projectData(n),so.scaleData(n,i)},e}(uo);function Wu(t,e,n,r){var i=li.centroid(t);if(i){var o={};return Object.assign(o,n,r),{type:"Feature",id:e,properties:o,geometry:{type:"Point",coordinates:i}}}}function Hu(t){return t}function Yu(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=function(t,e){var n=function(t){if(null==(e=t.transform))return Hu;var e,n,r,i=e.scale[0],o=e.scale[1],s=e.translate[0],a=e.translate[1];return function(t,e){return e||(n=r=0),t[0]=(n+=t[0])*i+s,t[1]=(r+=t[1])*o+a,t}}(t),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,s=i.length;o<s;++o)e.push(n(i[o].slice(),o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,s)}function o(t){return n(t.slice())}function s(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0].slice()),e}function a(t){for(var e=s(t);e.length<4;)e.push(e[0].slice());return e}function l(t){return t.map(a)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=o(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(o);break;case"LineString":n=s(e.arcs);break;case"MultiLineString":n=e.arcs.map(s);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(e)}(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}so.register("GeoJSON",(function(t){return qu.urlHasTilePattern(t.url)?qu:Vu}));var Xu=function(t){function e(){return t.apply(this,arguments)||this}Ri(e,t);var n=e.prototype;return n.parseSourceData=function(e,n,r){var i="string"==typeof r?JSON.parse(r):r;i=this.toGeoJSON(i);var o=this.getLayers(i);t.prototype.preprocessLayers.call(this,o,e),n.layers=o},n.toGeoJSON=function(t){if(t.objects&&1===Object.keys(t.objects).length){var e=Object.keys(t.objects)[0];t=$u(t,t.objects[e])}else{var n={};for(var r in t.objects)n[r]=$u(t,t.objects[r]);t=n}return t},e}(Vu);function $u(t,e){var n=function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Yu(t,e)}))}:Yu(t,e)}(t,e);return"Feature"===n.type&&(n={type:"FeatureCollection",features:[n]}),n}var Ju=function(t){function e(e,n){return t.call(this,e,n)||this}return Ri(e,t),e.prototype.parseSourceData=function(t,e,n){var r="string"==typeof n?JSON.parse(n):n;r=Xu.prototype.toGeoJSON(r),this.prepareGeoJSON(r,t,e)},e}(qu);so.register("TopoJSON",(function(t){return Ju.urlHasTilePattern(t.url)?Ju:Xu})),t.require$$0=l,t.require$$1=n,t.global=r,t.require$$1$1=y,t.getKeys=tt,t.gOPS=Dt,t.pIE=Tt,t.toIObject=R,t.require$$0$1=me,t.require$$0$2=de,t.require$$0$3=i,t.DESCRIPTORS=f,t.fails=c,t.require$$22=lt,t.uid=a,t.redefine=O,t.LIBRARY=!1,t.$export=D,t.require$$17=C,t.isObject=u,t.isArray=pe,t.hide=b,t.setToStringTag=ct,t.require$$1$2=ve,t.anObject=h,t.require$$16=v,t.require$$9=x,t.createCommonjsModule=e,t.commonjsRequire=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")},t.Utils=en,t.isRelativeURL=xn,t.addBaseURL=function(t,e){if(!t||!xn(t))return t;var n,r="/"!==t[0];if(e?(n=document.createElement("a")).href=e:n=window.location,r)t=bn(n.href)+t;else{var i=n.origin;i||(i=n.protocol+"//"+n.host),t=i+t}return t},t.pathForURL=bn,t.extensionForURL=function(t){var e=(t=t.split("/").pop()).lastIndexOf(".");if(e>-1)return t.substring(e+1)},t._inheritsLoose=Ri,t.flattenRelativeURL=function(t){for(var e=(t||"").split("/"),n=1;n<e.length;n++)"."===e[n]?(e.splice(n,1),n--):".."===e[n]&&(n+=0,e.splice(n-1,2),n--);return e.join("/")},t.createObjectURL=function(t){return void 0===vn&&"function"!=typeof(vn=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(vn=null,Ji("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),vn?vn(t):t},t.isLocalURL=function(t){if("string"==typeof t)return t.search(/^(data|blob):/)>-1},t.subscribeMixin=An,t.log=Ji,t.mergeObjects=nr,t.isReserved=Ml,t.GLSL=Zn,t.TileID=ho,t.Collision=Ks,t.Geo=li,t.LabelPoint=Qs,t.LabelLineStraight=$a,t.OBB=Hs,t.Label=Ys,t.WorkerBroker=Zi,t.Task=Tn,t.Tile=Cl,t._createClass=zi,t.require$$0$4=Un,t.StyleParser=Or,t.Texture=Gn,t.debugSettings=nn,t.debugSumLayerStats=function(t){var e={},n={};return t.filter((function(t){return t.debug.layers})).forEach((function(t){Object.keys(t.debug.layers.list).forEach((function(n){var r=t.debug.layers.list[n];_o(e,n,r.features,r.geoms,r.styles,r.base)})),function t(e,n){for(var r in e){var i=e[r];_o(n,r,i.features,i.geoms,i.styles,i.base),i.layers&&(n[r].layers=n[r].layers||{},t(i.layers,n[r].layers))}}(t.debug.layers.tree,n)})),{list:e,tree:n}},t.ShaderProgram=Xn,t.VertexArrayObject=$n,t.TextCanvas=Ea,t.DataSource=so,t.Light=to,t.FontManager=la,t.FeatureSelection=Hr,t.View=Za,t.StyleManager=nl,t.Style=po,t.sliceObject=En,t.Thread=Ut,t.mergeDebugSettings=function(t){Object.assign(tn,t)},t.version=Fi,t.Vector=Qr,t.VertexData=xo,t.Material=Kr,t.VertexElements=yo,t.compileFunctionStrings=Rr,t.parseLayers=function(t,e){wl={};var n={};for(var r in t){var i=t[r];i&&(n[r]=zl(r,i,null,e))}return n},t.buildFilter=bl,t.FilterOptions=Pl,t.layerCache=function(){return wl},t.cache=zr,t.clearFunctionStringCache=function(){zr.functions={},zr.num_functions=0,zr.num_cached=0}})),o(0,(function(t){var e=Object.assign(self,{FeatureSelection:t.FeatureSelection,sources:{},styles:{},layers:{},tiles:{},init:function(e,n,i,r,s,o,a){return this.scene_id=e,this._worker_id=n,this.num_workers=i,t.log.setLevel(r),t.Utils.device_pixel_ratio=s,t.VertexElements.setElementIndexUint(o),t.FeatureSelection.setPrefix(this._worker_id),this.style_manager=new t.StyleManager,this.importExternalScripts(a),t.Label.id_prefix=n,t.Label.id_multiplier=i,n},importExternalScripts:function(e){var n=this;if(0!==e.length){t.log("debug","loading custom data source scripts in worker:",e);var i=Object.getOwnPropertyNames(window);importScripts.apply(void 0,e),Object.getOwnPropertyNames(window).forEach((function(t){-1===i.indexOf(t)&&(n[t]=window[t])}))}},updateConfig:function(e,n){var i=e.config,r=e.generation,s=e.introspection;return i=JSON.parse(i),t.mergeDebugSettings(n),this.generation=r,this.introspection=s,this.global=t.compileFunctionStrings(i.global),this.createDataSources(i),i.styles=t.compileFunctionStrings(i.styles,t.StyleParser.wrapFunction),this.styles=this.style_manager.build(i.styles),this.style_manager.initStyles({generation:this.generation,styles:this.styles,sources:this.sources,introspection:this.introspection}),this.layers=t.parseLayers(i.layers,this.style_manager.styles),this.syncing_textures=this.syncTextures(i.textures),this.configuring=this.syncing_textures.then((function(){t.log("debug","updated config")})),this.configuring},createDataSources:function(e){var n=this;this.last_config_sources=this.config_sources||{},this.config_sources=e.sources;var i=this.sources,r=[];for(var s in this.sources={},e.sources)if(JSON.stringify(this.last_config_sources[s])!==JSON.stringify(e.sources[s])){e.sources[s]=t.compileFunctionStrings(e.sources[s]);var o=void 0;try{o=t.DataSource.create(Object.assign({},e.sources[s],{name:s}),this.sources)}catch(t){continue}o&&(this.sources[s]=o,r.push(s))}else this.sources[s]=i[s];r.forEach((function(t){for(var e in n.tiles)n.tiles[e].source===t&&delete n.tiles[e]}))},awaitConfiguration:function(){return this.configuring},buildTile:function(e){var n=this,i=e.tile;if(null==this.getTile(i.key)||!0!==this.getTile(i.key).loading)return i=this.tiles[i.key]=Object.assign(this.getTile(i.key)||{},i),this.awaitConfiguration().then((function(){if(!0!==i.loaded)i.loading=!0,i.loaded=!1,i.error=null,n.loadTileSourceData(i).then((function(){n.getTile(i.key)?(i.source_data.error&&t.log("warn","tile load error(s) for "+i.key+": "+i.source_data.error),i.loading=!1,i.loaded=!0,t.Tile.buildGeometry(i,n)):t.log("trace","stop tile build after data source load because tile was removed: "+i.key)})).catch((function(e){i.loading=!1,i.loaded=!1,i.error=e.stack,t.log("error","tile load error for "+i.key+": "+i.error),t.WorkerBroker.postMessage("TileManager_"+n.scene_id+".buildTileError",t.Tile.slice(i))}));else{t.log("trace","used worker cache for tile "+i.key);try{t.Tile.buildGeometry(i,n)}catch(e){i.error=e.toString(),t.WorkerBroker.postMessage("TileManager_"+n.scene_id+".buildTileError",t.Tile.slice(i))}}}))},loadTileSourceData:function(t){var e=this.sources[t.source];if(e){for(var n in this.tiles){var i=this.tiles[n];if(i.source===t.source&&i.coords.key===t.coords.key&&i.loaded)return Promise.resolve(e.copyTileData(i,t))}return e.load(t)}return t.source_data={},Promise.resolve(t)},getTile:function(t){return this.tiles[t]},removeTile:function(e){var n=this.tiles[e];null!=n&&(!0===n.loading&&(t.log("trace","cancel tile load for "+e),n.loading=!1,t.Tile.cancel(n)),t.FeatureSelection.clearTile(e),delete this.tiles[e],t.log("trace","remove tile from cache for "+e))},queryFeatures:function(e){var n=this,i=e.filter,r=e.visible,s=e.geometry,o=e.tile_keys,a=[],l=o.map((function(t){return n.tiles[t]})).filter((function(t){return t&&t.loaded}));return null!=i&&(i=["{","["].indexOf(i[0])>-1?JSON.parse(i):i,i=t.compileFunctionStrings(i,t.StyleParser.wrapFunction)),i=t.buildFilter(i,t.FilterOptions),l.forEach((function(e){var o=function(o){var l=e.source_data.layers[o];if(null==l)return{v:void 0};l.features.forEach((function(l){var h=l.generation===n.generation;if(!(!0===r&&!h||!1===r&&h)){var u=t.StyleParser.getFeatureParseContext(l,e,n.global);if(u.source=e.source,u.layer=o,u.id=l.id,i(u)){var g={type:l.type,id:l.id,properties:Object.assign({},l.properties,{$source:u.source,$layer:u.layer,$geometry:u.geometry,$visible:h})};!0===s&&(g.geometry=t.Geo.copyGeometry(l.geometry),t.Geo.tileSpaceToLatlng(g.geometry,e.coords.z,e.min)),a.push(g)}}}))};for(var l in e.source_data.layers){var h=o(l);if("object"==typeof h)return h.v}})),a},getFeatureSelection:function(e){var n=void 0===e?{}:e,i=n.id,r=n.key,s=t.FeatureSelection.map[r];return{id:i,feature:s&&s.feature}},resetFeatureSelection:function(e){void 0===e&&(e=null),t.FeatureSelection.reset(e)},getFeatureSelectionMapSize:function(){return t.FeatureSelection.getMapSize()},syncTextures:function(e){var n=[];return e&&n.push.apply(n,Object.keys(e)),t.log("trace","sync textures to worker:",n),n.length>0?t.Texture.syncTexturesToWorker(n):Promise.resolve()},updateDevicePixelRatio:function(e){t.Utils.device_pixel_ratio=e},clearFunctionStringCache:function(){t.clearFunctionStringCache()},profile:function(t){console.profile("worker "+this._worker_id+": "+t)},profileEnd:function(t){console.profileEnd("worker "+this._worker_id+": "+t)},debug:{debugSettings:t.debugSettings,layerCache:t.layerCache,functionStringCache:t.cache}});t.WorkerBroker.addTarget("self",e)})),o(0,(function(t){var n={f:t.require$$0},o=t.require$$1$1.f,l=function(e){var i=t.require$$1.Symbol||(t.require$$1.Symbol=t.global.Symbol||{});"_"==e.charAt(0)||e in i||o(i,e,{value:n.f(e)})};l("asyncIterator");var i,h=t.require$$0$1.f,s={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c={f:function(e){return a&&"[object Window]"==s.call(e)?function(t){try{return h(t)}catch(t){return a.slice()}}(e):h(t.toIObject(e))}},u=t.require$$0$2.KEY,f=t.require$$1$2.f,d=t.require$$1$1.f,_=c.f,m=t.global.Symbol,p=t.global.JSON,g=p&&p.stringify,v=t.require$$0("_hidden"),y=t.require$$0("toPrimitive"),x={}.propertyIsEnumerable,w=t.require$$0$3("symbol-registry"),b=t.require$$0$3("symbols"),T=t.require$$0$3("op-symbols"),A=Object.prototype,E="function"==typeof m,k=t.global.QObject,S=!k||!k.prototype||!k.prototype.findChild,P=t.DESCRIPTORS&&t.fails((function(){return 7!=t.require$$22(d({},"a",{get:function(){return d(this,"a",{value:7}).a}})).a}))?function(t,e,n){var r=f(A,e);r&&delete A[e],d(t,e,n),r&&t!==A&&d(A,e,r)}:d,M=function(e){var n=b[e]=t.require$$22(m.prototype);return n._k=e,n},z=E&&"symbol"==typeof m.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof m},R=function(e,n,r){return e===A&&R(T,n,r),t.anObject(e),n=t.require$$16(n,!0),t.anObject(r),t.require$$17(b,n)?(r.enumerable?(t.require$$17(e,v)&&e[v][n]&&(e[v][n]=!1),r=t.require$$22(r,{enumerable:t.require$$9(0,!1)})):(t.require$$17(e,v)||d(e,v,t.require$$9(1,{})),e[v][n]=!0),P(e,n,r)):d(e,n,r)},L=function(e,n){t.anObject(e);for(var r,i=function(e){var n=t.getKeys(e),r=t.gOPS.f;if(r)for(var i,o=r(e),s=t.pIE.f,a=0;o.length>a;)s.call(e,i=o[a++])&&n.push(i);return n}(n=t.toIObject(n)),o=0,s=i.length;s>o;)R(e,r=i[o++],n[r]);return e},C=function(e){var n=x.call(this,e=t.require$$16(e,!0));return!(this===A&&t.require$$17(b,e)&&!t.require$$17(T,e))&&(!(n||!t.require$$17(this,e)||!t.require$$17(b,e)||t.require$$17(this,v)&&this[v][e])||n)},O=function(e,n){if(e=t.toIObject(e),n=t.require$$16(n,!0),e!==A||!t.require$$17(b,n)||t.require$$17(T,n)){var r=f(e,n);return!r||!t.require$$17(b,n)||t.require$$17(e,v)&&e[v][n]||(r.enumerable=!0),r}},N=function(e){for(var n,r=_(t.toIObject(e)),i=[],o=0;r.length>o;)t.require$$17(b,n=r[o++])||n==v||n==u||i.push(n);return i},I=function(e){for(var n,r=e===A,i=_(r?T:t.toIObject(e)),o=[],s=0;i.length>s;)!t.require$$17(b,n=i[s++])||r&&!t.require$$17(A,n)||o.push(b[n]);return o};E||(m=function(){if(this instanceof m)throw TypeError("Symbol is not a constructor!");var e=t.uid(arguments.length>0?arguments[0]:void 0),n=function(r){this===A&&n.call(T,r),t.require$$17(this,v)&&t.require$$17(this[v],e)&&(this[v][e]=!1),P(this,e,t.require$$9(1,r))};return t.DESCRIPTORS&&S&&P(A,e,{configurable:!0,set:n}),M(e)},t.redefine(m.prototype,"toString",(function(){return this._k})),t.require$$1$2.f=O,t.require$$1$1.f=R,t.require$$0$1.f=c.f=N,t.pIE.f=C,t.gOPS.f=I,t.DESCRIPTORS&&!t.LIBRARY&&t.redefine(A,"propertyIsEnumerable",C,!0),n.f=function(e){return M(t.require$$0(e))}),t.$export(t.$export.G+t.$export.W+t.$export.F*!E,{Symbol:m});for(var F="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),D=0;F.length>D;)t.require$$0(F[D++]);for(var B=t.getKeys(t.require$$0.store),j=0;B.length>j;)l(B[j++]);t.$export(t.$export.S+t.$export.F*!E,"Symbol",{for:function(e){return t.require$$17(w,e+="")?w[e]:w[e]=m(e)},keyFor:function(t){if(!z(t))throw TypeError(t+" is not a symbol!");for(var e in w)if(w[e]===t)return e},useSetter:function(){S=!0},useSimple:function(){S=!1}}),t.$export(t.$export.S+t.$export.F*!E,"Object",{create:function(e,n){return void 0===n?t.require$$22(e):L(t.require$$22(e),n)},defineProperty:R,defineProperties:L,getOwnPropertyDescriptor:O,getOwnPropertyNames:N,getOwnPropertySymbols:I}),p&&t.$export(t.$export.S+t.$export.F*(!E||t.fails((function(){var t=m();return"[null]"!=g([t])||"{}"!=g({a:t})||"{}"!=g(Object(t))}))),"JSON",{stringify:function(e){for(var n,r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=n=i[1],(t.isObject(n)||void 0!==e)&&!z(e))return t.isArray(n)||(n=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!z(e))return e}),i[1]=n,g.apply(p,i)}}),m.prototype[y]||t.hide(m.prototype,y,m.prototype.valueOf),t.setToStringTag(m,"Symbol"),t.setToStringTag(Math,"Math",!0),t.setToStringTag(t.global.JSON,"JSON",!0);var U=i={},G=0;i.getContext=function(t,e){var n=!1;null==t&&((t=document.createElement("canvas")).style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=-1,document.body.appendChild(t),n=!0),t.addEventListener("webglcontextlost",(function(){})),t.addEventListener("webglcontextrestored",(function(){}));var r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!r)throw new Error("Couldn't create WebGL context.");return r._tangram_id=G++,n?(i.resize(r,window.innerWidth,window.innerHeight,e.device_pixel_ratio),window.addEventListener("resize",(function(){i.resize(r,window.innerWidth,window.innerHeight,e.device_pixel_ratio)}))):i.resize(r,parseFloat(t.style.width),parseFloat(t.style.height),e.device_pixel_ratio),r},i.resize=function(t,e,n,r){r=r||window.devicePixelRatio||1,t.canvas.style.width=e+"px",t.canvas.style.height=n+"px",t.canvas.width=Math.round(e*r),t.canvas.height=Math.round(n*r),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height)};var Z=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},q=[],V=[],W="undefined"!=typeof Uint8Array?Uint8Array:Array,H=!1;function Y(){H=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)q[e]=t[e],V[t.charCodeAt(e)]=e;V["-".charCodeAt(0)]=62,V["_".charCodeAt(0)]=63}function X(t,e,n){for(var r,i,o=[],s=e;s<n;s+=3)r=(t[s]<<16)+(t[s+1]<<8)+t[s+2],o.push(q[(i=r)>>18&63]+q[i>>12&63]+q[i>>6&63]+q[63&i]);return o.join("")}function $(t){var e;H||Y();for(var n=t.length,r=n%3,i="",o=[],s=0,a=n-r;s<a;s+=16383)o.push(X(t,s,s+16383>a?a:s+16383));return 1===r?(e=t[n-1],i+=q[e>>2],i+=q[e<<4&63],i+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],i+=q[e>>10],i+=q[e>>4&63],i+=q[e<<2&63],i+="="),o.push(i),o.join("")}function J(t,e,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,u=l>>1,h=-7,c=n?i-1:0,f=n?-1:1,d=t[e+c];for(c+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+t[e+c],c+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+c],c+=f,h-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)}function K(t,e,n,r,i,o){var s,a,l,u=8*o-i-1,h=(1<<u)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+c>=1?f/l:f*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=h?(a=0,s=h):s+c>=1?(a=(e*l-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[n+d]=255&s,d+=p,s/=256,u-=8);t[n+d-p]|=128*g}var Q={}.toString,tt=Array.isArray||function(t){return"[object Array]"==Q.call(t)};ot.TYPED_ARRAY_SUPPORT=void 0===Z.TYPED_ARRAY_SUPPORT||Z.TYPED_ARRAY_SUPPORT;var et=it();function it(){return ot.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function nt(t,e){if(it()<e)throw new RangeError("Invalid typed array length");return ot.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=ot.prototype:(null===t&&(t=new ot(e)),t.length=e),t}function ot(t,e,n){if(!(ot.TYPED_ARRAY_SUPPORT||this instanceof ot))return new ot(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return lt(this,t)}return st(this,t,e,n)}function st(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),ot.TYPED_ARRAY_SUPPORT?(t=e).__proto__=ot.prototype:t=ut(t,e),t}(t,e,n,r):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!ot.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|ft(e,n),i=(t=nt(t,r)).write(e,n);return i!==r&&(t=t.slice(0,i)),t}(t,e,n):function(t,e){if(ct(e)){var n=0|ht(e.length);return 0===(t=nt(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?nt(t,0):ut(t,e);if("Buffer"===e.type&&tt(e.data))return ut(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function at(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function lt(t,e){if(at(e),t=nt(t,e<0?0:0|ht(e)),!ot.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function ut(t,e){var n=e.length<0?0:0|ht(e.length);t=nt(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function ht(t){if(t>=it())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+it().toString(16)+" bytes");return 0|t}function ct(t){return!(null==t||!t._isBuffer)}function ft(t,e){if(ct(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Bt(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return jt(t).length;default:if(r)return Bt(t).length;e=(""+e).toLowerCase(),r=!0}}function pt(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function _t(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=ot.from(e,r)),ct(e))return 0===e.length?-1:mt(t,e,n,r,i);if("number"==typeof e)return e&=255,ot.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):mt(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function mt(t,e,n,r,i){var o,s=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,n/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var h=-1;for(o=n;o<a;o++)if(u(t,o)===u(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===l)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var c=!0,f=0;f<l;f++)if(u(t,o+f)!==u(e,f)){c=!1;break}if(c)return o}return-1}function gt(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function vt(t,e,n,r){return Ut(Bt(e,t.length-n),t,n,r)}function yt(t,e,n,r){return Ut(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function bt(t,e,n,r){return yt(t,e,n,r)}function xt(t,e,n,r){return Ut(jt(e),t,n,r)}function wt(t,e,n,r){return Ut(function(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=(n=t.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function Tt(t,e,n){return 0===e&&n===t.length?$(t):$(t.slice(e,n))}function At(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,a,l,u=t[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=n)switch(c){case 1:u<128&&(h=u);break;case 2:128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)>127&&(h=l);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(l=(15&u)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=c}return function(t){var e=t.length;if(e<=Et)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=Et));return n}(r)}ot.poolSize=8192,ot._augment=function(t){return t.__proto__=ot.prototype,t},ot.from=function(t,e,n){return st(null,t,e,n)},ot.TYPED_ARRAY_SUPPORT&&(ot.prototype.__proto__=Uint8Array.prototype,ot.__proto__=Uint8Array),ot.alloc=function(t,e,n){return function(t,e,n,r){return at(e),e<=0?nt(t,e):void 0!==n?"string"==typeof r?nt(t,e).fill(n,r):nt(t,e).fill(n):nt(t,e)}(null,t,e,n)},ot.allocUnsafe=function(t){return lt(null,t)},ot.allocUnsafeSlow=function(t){return lt(null,t)},ot.isBuffer=Gt,ot.compare=function(t,e){if(!ct(t)||!ct(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},ot.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ot.concat=function(t,e){if(!tt(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return ot.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=ot.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!ct(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},ot.byteLength=ft,ot.prototype._isBuffer=!0,ot.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)pt(this,e,e+1);return this},ot.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)pt(this,e,e+3),pt(this,e+1,e+2);return this},ot.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)pt(this,e,e+7),pt(this,e+1,e+6),pt(this,e+2,e+5),pt(this,e+3,e+4);return this},ot.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?At(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return Pt(this,e,n);case"utf8":case"utf-8":return At(this,e,n);case"ascii":return kt(this,e,n);case"latin1":case"binary":return St(this,e,n);case"base64":return Tt(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Mt(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},ot.prototype.equals=function(t){if(!ct(t))throw new TypeError("Argument must be a Buffer");return this===t||0===ot.compare(this,t)},ot.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},ot.prototype.compare=function(t,e,n,r,i){if(!ct(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(e>>>=0),a=Math.min(o,s),l=this.slice(r,i),u=t.slice(e,n),h=0;h<a;++h)if(l[h]!==u[h]){o=l[h],s=u[h];break}return o<s?-1:s<o?1:0},ot.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},ot.prototype.indexOf=function(t,e,n){return _t(this,t,e,n,!0)},ot.prototype.lastIndexOf=function(t,e,n){return _t(this,t,e,n,!1)},ot.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return gt(this,t,e,n);case"utf8":case"utf-8":return vt(this,t,e,n);case"ascii":return yt(this,t,e,n);case"latin1":case"binary":return bt(this,t,e,n);case"base64":return xt(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wt(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},ot.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Et=4096;function kt(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function St(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function Pt(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=Dt(t[o]);return i}function Mt(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function zt(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Rt(t,e,n,r,i,o){if(!ct(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function Lt(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function Ct(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function Ot(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Nt(t,e,n,r,i){return i||Ot(t,0,n,4),K(t,e,n,r,23,4),n+4}function It(t,e,n,r,i){return i||Ot(t,0,n,8),K(t,e,n,r,52,8),n+8}ot.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),ot.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=ot.prototype;else{var i=e-t;n=new ot(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},ot.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||zt(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},ot.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||zt(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},ot.prototype.readUInt8=function(t,e){return e||zt(t,1,this.length),this[t]},ot.prototype.readUInt16LE=function(t,e){return e||zt(t,2,this.length),this[t]|this[t+1]<<8},ot.prototype.readUInt16BE=function(t,e){return e||zt(t,2,this.length),this[t]<<8|this[t+1]},ot.prototype.readUInt32LE=function(t,e){return e||zt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},ot.prototype.readUInt32BE=function(t,e){return e||zt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},ot.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||zt(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},ot.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||zt(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},ot.prototype.readInt8=function(t,e){return e||zt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},ot.prototype.readInt16LE=function(t,e){e||zt(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},ot.prototype.readInt16BE=function(t,e){e||zt(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},ot.prototype.readInt32LE=function(t,e){return e||zt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},ot.prototype.readInt32BE=function(t,e){return e||zt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},ot.prototype.readFloatLE=function(t,e){return e||zt(t,4,this.length),J(this,t,!0,23,4)},ot.prototype.readFloatBE=function(t,e){return e||zt(t,4,this.length),J(this,t,!1,23,4)},ot.prototype.readDoubleLE=function(t,e){return e||zt(t,8,this.length),J(this,t,!0,52,8)},ot.prototype.readDoubleBE=function(t,e){return e||zt(t,8,this.length),J(this,t,!1,52,8)},ot.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||Rt(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},ot.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||Rt(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},ot.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,1,255,0),ot.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},ot.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,2,65535,0),ot.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Lt(this,t,e,!0),e+2},ot.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,2,65535,0),ot.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Lt(this,t,e,!1),e+2},ot.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,4,4294967295,0),ot.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Ct(this,t,e,!0),e+4},ot.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,4,4294967295,0),ot.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Ct(this,t,e,!1),e+4},ot.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);Rt(this,t,e,n,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},ot.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);Rt(this,t,e,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},ot.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,1,127,-128),ot.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},ot.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,2,32767,-32768),ot.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Lt(this,t,e,!0),e+2},ot.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,2,32767,-32768),ot.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Lt(this,t,e,!1),e+2},ot.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,4,2147483647,-2147483648),ot.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Ct(this,t,e,!0),e+4},ot.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||Rt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),ot.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Ct(this,t,e,!1),e+4},ot.prototype.writeFloatLE=function(t,e,n){return Nt(this,t,e,!0,n)},ot.prototype.writeFloatBE=function(t,e,n){return Nt(this,t,e,!1,n)},ot.prototype.writeDoubleLE=function(t,e,n){return It(this,t,e,!0,n)},ot.prototype.writeDoubleBE=function(t,e,n){return It(this,t,e,!1,n)},ot.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!ot.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},ot.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!ot.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=ct(t)?t:Bt(new ot(t,r).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var Ft=/[^+\/0-9A-Za-z-_]/g;function Dt(t){return t<16?"0"+t.toString(16):t.toString(16)}function Bt(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function jt(t){return function(t){var e,n,r,i,o,s;H||Y();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,s=new W(3*a/4-o),r=o>0?a-4:a;var l=0;for(e=0,n=0;e<r;e+=4,n+=3)i=V[t.charCodeAt(e)]<<18|V[t.charCodeAt(e+1)]<<12|V[t.charCodeAt(e+2)]<<6|V[t.charCodeAt(e+3)],s[l++]=i>>16&255,s[l++]=i>>8&255,s[l++]=255&i;return 2===o?(i=V[t.charCodeAt(e)]<<2|V[t.charCodeAt(e+1)]>>4,s[l++]=255&i):1===o&&(i=V[t.charCodeAt(e)]<<10|V[t.charCodeAt(e+1)]<<4|V[t.charCodeAt(e+2)]>>2,s[l++]=i>>8&255,s[l++]=255&i),s}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Ft,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Ut(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function Gt(t){return null!=t&&(!!t._isBuffer||Zt(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Zt(t.slice(0,0))}(t))}function Zt(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var Vt=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:et,Buffer:ot,SlowBuffer:function(t){return+t!=t&&(t=0),ot.alloc(+t)},isBuffer:Gt});function qt(){}function Wt(){Wt.init.call(this)}function Ht(t){return void 0===t._maxListeners?Wt.defaultMaxListeners:t._maxListeners}function Yt(t,e,n,r){var i,o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=new qt,t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=Ht(t))&&i>0&&s.length>i){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=o[e]=n,++t._eventsCount;return t}function Xt(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function $t(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Jt(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function Kt(){throw new Error("setTimeout has not been defined")}function Qt(){throw new Error("clearTimeout has not been defined")}qt.prototype=Object.create(null),Wt.EventEmitter=Wt,Wt.usingDomains=!1,Wt.prototype.domain=void 0,Wt.prototype._events=void 0,Wt.prototype._maxListeners=void 0,Wt.defaultMaxListeners=10,Wt.init=function(){this.domain=null,Wt.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new qt,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Wt.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},Wt.prototype.getMaxListeners=function(){return Ht(this)},Wt.prototype.emit=function(t){var e,n,r,i,o,s,a,l="error"===t;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(a=this.domain,l){if(e=arguments[1],!a){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(n=s[t]))return!1;var h="function"==typeof n;switch(r=arguments.length){case 1:!function(t,e,n){if(e)t.call(n);else for(var r=t.length,i=Jt(t,r),o=0;o<r;++o)i[o].call(n)}(n,h,this);break;case 2:!function(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=Jt(t,i),s=0;s<i;++s)o[s].call(n,r)}(n,h,this,arguments[1]);break;case 3:!function(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=Jt(t,o),a=0;a<o;++a)s[a].call(n,r,i)}(n,h,this,arguments[1],arguments[2]);break;case 4:!function(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=Jt(t,s),l=0;l<s;++l)a[l].call(n,r,i,o)}(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=Jt(t,i),s=0;s<i;++s)o[s].apply(n,r)}(n,h,this,i)}return!0},Wt.prototype.addListener=function(t,e){return Yt(this,t,e,!1)},Wt.prototype.on=Wt.prototype.addListener,Wt.prototype.prependListener=function(t,e){return Yt(this,t,e,!0)},Wt.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,Xt(this,t,e)),this},Wt.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,Xt(this,t,e)),this},Wt.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new qt:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new qt,this;delete r[t]}else!function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,i);r.removeListener&&this.emit("removeListener",t,s||e)}return this},Wt.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new qt,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new qt:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new qt,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},Wt.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},Wt.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):$t.call(t,e)},Wt.prototype.listenerCount=$t,Wt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var te=Kt,ee=Qt;function ie(t){if(te===setTimeout)return setTimeout(t,0);if((te===Kt||!te)&&setTimeout)return te=setTimeout,setTimeout(t,0);try{return te(t,0)}catch(e){try{return te.call(null,t,0)}catch(e){return te.call(this,t,0)}}}"function"==typeof Z.setTimeout&&(te=setTimeout),"function"==typeof Z.clearTimeout&&(ee=clearTimeout);var ne,re=[],oe=!1,rt=-1;function se(){oe&&ne&&(oe=!1,ne.length?re=ne.concat(re):rt=-1,re.length&&ae())}function ae(){if(!oe){var t=ie(se);oe=!0;for(var e=re.length;e;){for(ne=re,re=[];++rt<e;)ne&&ne[rt].run();rt=-1,e=re.length}ne=null,oe=!1,function(t){if(ee===clearTimeout)return clearTimeout(t);if((ee===Qt||!ee)&&clearTimeout)return ee=clearTimeout,clearTimeout(t);try{ee(t)}catch(e){try{return ee.call(null,t)}catch(e){return ee.call(this,t)}}}(t)}}function le(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];re.push(new ue(t,e)),1!==re.length||oe||ie(ae)}function ue(t,e){this.fun=t,this.array=e}function he(){}ue.prototype.run=function(){this.fun.apply(null,this.array)};var ce=he,fe=he,de=he,pe=he,_e=he,dt=he,me=he,ge=Z.performance||{},ve=ge.now||ge.mozNow||ge.msNow||ge.oNow||ge.webkitNow||function(){return(new Date).getTime()},ye=new Date,be={nextTick:le,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:ce,addListener:fe,once:de,off:pe,removeListener:_e,removeAllListeners:dt,emit:me,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*ve.call(ge),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-ye)/1e3}},xe=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8},we=t.createCommonjsModule((function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}})),Te=t.createCommonjsModule((function(t,e){var n=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(o(arguments[r]));return e.join(" ")}r=1;for(var i=arguments,s=i.length,a=String(t).replace(n,(function(t){if("%%"===t)return"%";if(r>=s)return t;switch(t){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(t){return"[Circular]"}default:return t}})),l=i[r];r<s;l=i[++r])d(l)||!v(l)?a+=" "+l:a+=" "+o(l);return a},e.deprecate=function(t,n){if(_(Z.process))return function(){return e.deprecate(t,n).apply(this,arguments)};var r=!1;return function(){return r||(console.error(n),r=!0),t.apply(this,arguments)}};var r,i={};function o(t,n){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(n)?r.showHidden=n:n&&e._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,t,r.depth)}function s(t,e){var n=o.styles[e];return n?"["+o.colors[n][0]+"m"+t+"["+o.colors[n][1]+"m":t}function a(t,e){return t}function l(t,n,r){if(t.customInspect&&n&&x(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return g(i)||(i=l(t,i,r)),i}var o=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return p(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):d(e)?t.stylize("null","null"):void 0}(t,n);if(o)return o;var s=Object.keys(n),a=function(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(n)),b(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return u(n);if(0===s.length){if(x(n)){var v=n.name?": "+n.name:"";return t.stylize("[Function"+v+"]","special")}if(m(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(y(n))return t.stylize(Date.prototype.toString.call(n),"date");if(b(n))return u(n)}var w,T="",A=!1,k=["{","}"];return c(n)&&(A=!0,k=["[","]"]),x(n)&&(T=" [Function"+(n.name?": "+n.name:"")+"]"),m(n)&&(T=" "+RegExp.prototype.toString.call(n)),y(n)&&(T=" "+Date.prototype.toUTCString.call(n)),b(n)&&(T=" "+u(n)),0!==s.length||A&&0!=n.length?r<0?m(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),w=A?function(t,e,n,r,i){for(var o=[],s=0,a=e.length;s<a;++s)E(e,String(s))?o.push(h(t,e,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(h(t,e,n,r,i,!0))})),o}(t,n,r,a,s):s.map((function(e){return h(t,n,r,a,e,A)})),t.seen.pop(),function(t,e,n){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}(w,T,k)):k[0]+T+k[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,n,r,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),E(r,i)||(s="["+i+"]"),a||(t.seen.indexOf(u.value)<0?(a=d(n)?l(t,u.value,null):l(t,u.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),_(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function c(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function d(t){return null===t}function p(t){return"number"==typeof t}function g(t){return"string"==typeof t}function _(t){return void 0===t}function m(t){return v(t)&&"[object RegExp]"===w(t)}function v(t){return"object"==typeof t&&null!==t}function y(t){return v(t)&&"[object Date]"===w(t)}function b(t){return v(t)&&("[object Error]"===w(t)||t instanceof Error)}function x(t){return"function"==typeof t}function w(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(_(r)&&(r=be.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(r)){var n=be.pid;i[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else i[t]=function(){};return i[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=c,e.isBoolean=f,e.isNull=d,e.isNullOrUndefined=function(t){return null==t},e.isNumber=p,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=_,e.isRegExp=m,e.isObject=v,e.isDate=y,e.isError=b,e.isFunction=x,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=xe;var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(n=[T((t=new Date).getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":"),[t.getDate(),A[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=we,e._extend=function(t,e){if(!e||!v(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}})),Ae=(Te.format,Te.deprecate),Ee=Te.debuglog,ke=(Te.inspect,Te.isArray,Te.isBoolean,Te.isNull,Te.isNullOrUndefined,Te.isNumber,Te.isString,Te.isSymbol,Te.isUndefined,Te.isRegExp,Te.isObject,Te.isDate,Te.isError,Te.isFunction,Te.isPrimitive,Te.isBuffer,Te.log,Te.inherits);function Se(){this.head=null,this.tail=null,this.length=0}Te._extend,Se.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},Se.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},Se.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},Se.prototype.clear=function(){this.head=this.tail=null,this.length=0},Se.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},Se.prototype.concat=function(t){if(0===this.length)return ot.alloc(0);if(1===this.length)return this.head.data;for(var e=ot.allocUnsafe(t>>>0),n=this.head,r=0;n;)n.data.copy(e,r),r+=n.data.length,n=n.next;return e};var Pe=t.createCommonjsModule((function(t,e){var n=Vt.Buffer;function r(t,e){for(var n in t)e[n]=t[n]}function i(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=Vt:(r(Vt,e),e.Buffer=i),r(n,i),i.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},i.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=n(t);return void 0!==e?"string"==typeof r?i.fill(e,r):i.fill(e):i.fill(0),i},i.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},i.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return Vt.SlowBuffer(t)}})),Me=(Pe.Buffer,Pe.Buffer),ze=Me.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},Re=Le;function Le(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(Me.isEncoding===ze||!ze(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=Ne,this.end=Ie,e=4;break;case"utf8":this.fillLast=Oe,e=4;break;case"base64":this.text=Fe,this.end=De,e=3;break;default:return this.write=Be,void(this.end=je)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Me.allocUnsafe(e)}function Ce(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function Oe(t){var e=this.lastTotal-this.lastNeed,n=function(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"�".repeat(n);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�".repeat(n+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�".repeat(n+2)}}(this,t,e);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function Ne(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function Ie(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function Fe(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function De(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function Be(t){return t.toString(this.encoding)}function je(t){return t&&t.length?this.write(t):""}Le.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},Le.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�".repeat(this.lastTotal-this.lastNeed):e},Le.prototype.text=function(t,e){var n=function(t,e,n){var r=e.length-1;if(r<n)return 0;var i=Ce(e[r]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--r<n?0:(i=Ce(e[r]))>=0?(i>0&&(t.lastNeed=i-2),i):--r<n?0:(i=Ce(e[r]))>=0?(i>0&&(2===i?i=0:t.lastNeed=i-3),i):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},Le.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length},Ze.ReadableState=Ge;var Ue=Ee("stream");function Ge(t,e){t=t||{},this.objectMode=!!t.objectMode,e instanceof _i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.buffer=new Se,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(this.decoder=new Re(t.encoding),this.encoding=t.encoding)}function Ze(t){if(!(this instanceof Ze))return new Ze(t);this._readableState=new Ge(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),Wt.call(this)}function Ve(t,e,n,r,i){var o=function(t,e){var n=null;return Gt(e)||"string"==typeof e||null==e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(e,n);if(o)t.emit("error",o);else if(null===n)e.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,We(t)}}(t,e);else if(e.objectMode||n&&n.length>0)if(e.ended&&!i){var s=new Error("stream.push() after EOF");t.emit("error",s)}else if(e.endEmitted&&i){var a=new Error("stream.unshift() after end event");t.emit("error",a)}else{var l;!e.decoder||i||r||(n=e.decoder.write(n),l=!e.objectMode&&0===n.length),i||(e.reading=!1),l||(e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,i?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&We(t))),function(t,e){e.readingMore||(e.readingMore=!0,le(Ye,t,e))}(t,e)}else i||(e.reading=!1);return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(e)}function qe(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=8388608?t=8388608:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function We(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(Ue("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?le(He,t):He(t))}function He(t){Ue("emit readable"),t.emit("readable"),Je(t)}function Ye(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(Ue("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function Xe(t){Ue("readable nexttick read 0"),t.read(0)}function $e(t,e){e.reading||(Ue("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),Je(t),e.flowing&&!e.reading&&t.read(0)}function Je(t){var e=t._readableState;for(Ue("flow",e.flowing);e.flowing&&null!==t.read(););}function Ke(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,r=1,i=n.data;for(t-=i.length;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(s===o.length?i+=o:i+=o.slice(0,t),0==(t-=s)){s===o.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++r}return e.length-=r,i}(t,e):function(t,e){var n=ot.allocUnsafe(t),r=e.head,i=1;for(r.data.copy(n),t-=r.data.length;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,s),0==(t-=s)){s===o.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(s));break}++i}return e.length-=i,n}(t,e),r}(t,e.buffer,e.decoder),n);var n}function Qe(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,le(ti,e,t))}function ti(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function ei(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function tr(){}function ii(t,e,n){this.chunk=t,this.encoding=e,this.callback=n,this.next=null}function ni(t,e){Object.defineProperty(this,"buffer",{get:Ae((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),t=t||{},this.objectMode=!!t.objectMode,e instanceof _i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===t.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,r,i){--e.pendingcb,n?le(i,r):i(r),t._writableState.errorEmitted=!0,t.emit("error",r)}(t,n,r,e,i);else{var o=ui(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||ai(t,n),r?le(si,t,n,o,i):si(t,n,o,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new ci(this)}function ri(t){if(!(this instanceof ri||this instanceof _i))return new ri(t);this._writableState=new ni(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),Wt.call(this)}function oi(t,e,n,r,i,o,s){e.writelen=r,e.writecb=s,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function si(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),hr(t,e)}function ai(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),o=e.corkedRequestsFree;o.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;oi(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new ci(e)}else{for(;n;){var a=n.chunk,l=n.encoding,u=n.callback;if(oi(t,e,!1,e.objectMode?1:a.length,a,l,u),n=n.next,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=n,e.bufferProcessing=!1}function ui(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function hi(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function hr(t,e){var n=ui(e);return n&&(0===e.pendingcb?(hi(t,e),e.finished=!0,t.emit("finish")):hi(t,e)),n}function ci(t){var e=this;this.next=null,this.entry=null,this.finish=function(n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}}ke(Ze,Wt),Ze.prototype.push=function(t,e){var n=this._readableState;return n.objectMode||"string"!=typeof t||(e=e||n.defaultEncoding)!==n.encoding&&(t=ot.from(t,e),e=""),Ve(this,n,t,e,!1)},Ze.prototype.unshift=function(t){return Ve(this,this._readableState,t,"",!0)},Ze.prototype.isPaused=function(){return!1===this._readableState.flowing},Ze.prototype.setEncoding=function(t){return this._readableState.decoder=new Re(t),this._readableState.encoding=t,this},Ze.prototype.read=function(t){Ue("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return Ue("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?Qe(this):We(this),null;if(0===(t=qe(t,e))&&e.ended)return 0===e.length&&Qe(this),null;var r,i=e.needReadable;return Ue("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&Ue("length less than watermark",i=!0),e.ended||e.reading?Ue("reading or ended",i=!1):i&&(Ue("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=qe(n,e))),null===(r=t>0?Ke(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&Qe(this)),null!==r&&this.emit("data",r),r},Ze.prototype._read=function(t){this.emit("error",new Error("not implemented"))},Ze.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,Ue("pipe count=%d opts=%j",r.pipesCount,e);var i=e&&!1===e.end?u:s;function o(t){Ue("onunpipe"),t===n&&u()}function s(){Ue("onend"),t.end()}r.endEmitted?le(i):n.once("end",i),t.on("unpipe",o);var a=function(t){return function(){var e=t._readableState;Ue("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&t.listeners("data").length&&(e.flowing=!0,Je(t))}}(n);t.on("drain",a);var l=!1;function u(){Ue("cleanup"),t.removeListener("close",d),t.removeListener("finish",p),t.removeListener("drain",a),t.removeListener("error",f),t.removeListener("unpipe",o),n.removeListener("end",s),n.removeListener("end",u),n.removeListener("data",c),l=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||a()}var h=!1;function c(e){Ue("ondata"),h=!1,!1!==t.write(e)||h||((1===r.pipesCount&&r.pipes===t||r.pipesCount>1&&-1!==ei(r.pipes,t))&&!l&&(Ue("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function f(e){Ue("onerror",e),g(),t.removeListener("error",f),0===t.listeners("error").length&&t.emit("error",e)}function d(){t.removeListener("finish",p),g()}function p(){Ue("onfinish"),t.removeListener("close",d),g()}function g(){Ue("unpipe"),n.unpipe(t)}return n.on("data",c),function(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",f),t.once("close",d),t.once("finish",p),t.emit("pipe",n),r.flowing||(Ue("pipe resume"),n.resume()),t},Ze.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this)),this;if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=ei(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this)),this},Ze.prototype.on=function(t,e){var n=Wt.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&We(this):le(Xe,this))}return n},Ze.prototype.addListener=Ze.prototype.on,Ze.prototype.resume=function(){var t=this._readableState;return t.flowing||(Ue("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,le($e,t,e))}(this,t)),this},Ze.prototype.pause=function(){return Ue("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(Ue("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Ze.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;for(var i in t.on("end",(function(){if(Ue("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)})),t.on("data",(function(i){Ue("wrapped data"),e.decoder&&(i=e.decoder.write(i)),e.objectMode&&null==i||(e.objectMode||i&&i.length)&&(r.push(i)||(n=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n])}(["error","close","destroy","pause","resume"],(function(e){t.on(e,r.emit.bind(r,e))})),r._read=function(e){Ue("wrapped _read",e),n&&(n=!1,t.resume())},r},Ze._fromList=Ke,ri.WritableState=ni,ke(ri,Wt),ni.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},ri.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},ri.prototype.write=function(t,e,n){var r=this._writableState,i=!1;return"function"==typeof e&&(n=e,e=null),ot.isBuffer(t)?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=tr),r.ended?function(t,e){var n=new Error("write after end");t.emit("error",n),le(e,n)}(this,n):function(t,e,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):ot.isBuffer(n)||"string"==typeof n||void 0===n||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),le(r,o),i=!1),i}(this,r,t,n)&&(r.pendingcb++,i=function(t,e,n,r,i){n=function(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=ot.from(e,n)),e}(e,n,r),ot.isBuffer(n)&&(r="buffer");var o=e.objectMode?1:n.length;e.length+=o;var s=e.length<e.highWaterMark;if(s||(e.needDrain=!0),e.writing||e.corked){var a=e.lastBufferedRequest;e.lastBufferedRequest=new ii(n,r,i),a?a.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else oi(t,e,!1,o,n,r,i);return s}(this,r,t,e,n)),i},ri.prototype.cork=function(){this._writableState.corked++},ri.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||ai(this,t))},ri.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},ri.prototype._write=function(t,e,n){n(new Error("not implemented"))},ri.prototype._writev=null,ri.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(t,e,n){e.ending=!0,hr(t,e),n&&(e.finished?le(n):t.once("finish",n)),e.ended=!0,t.writable=!1}(this,r,n)},ke(_i,Ze);for(var fi=Object.keys(ri.prototype),di=0;di<fi.length;di++){var pi=fi[di];_i.prototype[pi]||(_i.prototype[pi]=ri.prototype[pi])}function _i(t){if(!(this instanceof _i))return new _i(t);Ze.call(this,t),ri.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",mi)}function mi(){this.allowHalfOpen||this._writableState.ended||le(gi,this)}function gi(t){t.end()}function vi(t){this.afterTransform=function(e,n){return function(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&t.push(n),i(e);var o=t._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&t._read(o.highWaterMark)}(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function yi(t){if(!(this instanceof yi))return new yi(t);_i.call(this,t),this._transformState=new vi(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(t){br(e,t)})):br(e)}))}function br(t,e){if(e)return t.emit("error",e);var n=t._writableState,r=t._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}function bi(t){if(!(this instanceof bi))return new bi(t);yi.call(this,t)}function xi(){Wt.call(this)}ke(yi,_i),yi.prototype.push=function(t,e){return this._transformState.needTransform=!1,_i.prototype.push.call(this,t,e)},yi.prototype._transform=function(t,e,n){throw new Error("Not implemented")},yi.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},yi.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},ke(bi,yi),bi.prototype._transform=function(t,e,n){n(null,t)},ke(xi,Wt),xi.Readable=Ze,xi.Writable=ri,xi.Duplex=_i,xi.Transform=yi,xi.PassThrough=bi,xi.Stream=xi,xi.prototype.pipe=function(t,e){var n=this;function r(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function i(){n.readable&&n.resume&&n.resume()}n.on("data",r),t.on("drain",i),t._isStdio||e&&!1===e.end||(n.on("end",s),n.on("close",a));var o=!1;function s(){o||(o=!0,t.end())}function a(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function l(t){if(u(),0===Wt.listenerCount(this,"error"))throw t}function u(){n.removeListener("data",r),t.removeListener("drain",i),n.removeListener("end",s),n.removeListener("close",a),n.removeListener("error",l),t.removeListener("error",l),n.removeListener("end",u),n.removeListener("close",u),t.removeListener("close",u)}return n.on("error",l),t.on("error",l),n.on("end",u),n.on("close",u),t.on("close",u),t.emit("pipe",n),t};var wi=xi,Ti=t.createCommonjsModule((function(t,e){if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,e.nodebuffer=!0,e.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)e.blob=!1;else{var n=new ArrayBuffer(0);try{e.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),e.blob=0===r.getBlob("application/zip").size}catch(t){e.blob=!1}}}try{e.nodestream=!!wi.Readable}catch(t){e.nodestream=!1}})),Ai=(Ti.base64,Ti.array,Ti.string,Ti.arraybuffer,Ti.nodebuffer,Ti.uint8array,Ti.blob,Ti.nodestream,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Ei=function(t){for(var e,n,r,i,o,s,a,l=[],u=0,h=t.length,c=h,f="string"!==Rn.getTypeOf(t);u<t.length;)c=h-u,f?(e=t[u++],n=u<h?t[u++]:0,r=u<h?t[u++]:0):(e=t.charCodeAt(u++),n=u<h?t.charCodeAt(u++):0,r=u<h?t.charCodeAt(u++):0),i=e>>2,o=(3&e)<<4|n>>4,s=c>1?(15&n)<<2|r>>6:64,a=c>2?63&r:64,l.push(Ai.charAt(i)+Ai.charAt(o)+Ai.charAt(s)+Ai.charAt(a));return l.join("")},ki=function(t){var e,n,r,i,o,s,a=0,l=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var u,h=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===Ai.charAt(64)&&h--,t.charAt(t.length-2)===Ai.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=Ti.uint8array?new Uint8Array(0|h):new Array(0|h);a<t.length;)e=Ai.indexOf(t.charAt(a++))<<2|(i=Ai.indexOf(t.charAt(a++)))>>4,n=(15&i)<<4|(o=Ai.indexOf(t.charAt(a++)))>>2,r=(3&o)<<6|(s=Ai.indexOf(t.charAt(a++))),u[l++]=e,64!==o&&(u[l++]=n),64!==s&&(u[l++]=r);return u},Si=function(t,e){return new ot(t,e)},Pi=function(t){return ot.alloc?ot.alloc(t):new ot(t)},Mi=function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume},zi=t.createCommonjsModule((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),Ri=t.createCommonjsModule((function(t){var e=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=e)})),Li=(Ri.version,function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}),Ci=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Oi=function(t){if(!Ci(t))throw TypeError(t+" is not an object!");return t},Ni=function(t){try{return!!t()}catch(t){return!0}},Ii=!Ni((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),Fi=zi.document,Di=Ci(Fi)&&Ci(Fi.createElement),Bi=function(t){return Di?Fi.createElement(t):{}},ji=!Ii&&!Ni((function(){return 7!=Object.defineProperty(Bi("div"),"a",{get:function(){return 7}}).a})),Ui=Object.defineProperty,Gi={f:Ii?Object.defineProperty:function(t,e,n){if(Oi(t),e=function(t,e){if(!Ci(t))return t;var n,r;if("function"==typeof(n=t.toString)&&!Ci(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!Ci(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e),Oi(n),ji)try{return Ui(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},Zi=Ii?function(t,e,n){return Gi.f(t,e,function(t,e){return{enumerable:!1,configurable:!0,writable:!0,value:e}}(0,n))}:function(t,e,n){return t[e]=n,t},Vi=function(t,e,n){var r,i,o,s=t&Vi.F,a=t&Vi.G,l=t&Vi.S,u=t&Vi.P,h=t&Vi.B,c=t&Vi.W,f=a?Ri:Ri[e]||(Ri[e]={}),d=f.prototype,p=a?zi:l?zi[e]:(zi[e]||{}).prototype;for(r in a&&(n=e),n)(i=!s&&p&&void 0!==p[r])&&r in f||(o=i?p[r]:n[r],f[r]=a&&"function"!=typeof p[r]?n[r]:h&&i?Li(o,zi):c&&p[r]==o?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(o):u&&"function"==typeof o?Li(Function.call,o):o,u&&((f.virtual||(f.virtual={}))[r]=o,t&Vi.R&&d&&!d[r]&&Zi(d,r,o)))};Vi.F=1,Vi.G=2,Vi.S=4,Vi.P=8,Vi.B=16,Vi.W=32,Vi.U=64,Vi.R=128;var qi,Wi,Hi,Yi,Xi=Vi,$i=zi.document&&document.documentElement,Ji={}.toString,Ki=zi.process,Qi=zi.setImmediate,tn=zi.clearImmediate,en=zi.MessageChannel,nn=0,rn={},on=function(){var t=+this;if(rn.hasOwnProperty(t)){var e=rn[t];delete rn[t],e()}},sn=function(t){on.call(t.data)};Qi&&tn||(Qi=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return rn[++nn]=function(){!function(t,e,n){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},qi(nn),nn},tn=function(t){delete rn[t]},"process"==(Yi=Ki,Ji.call(Yi).slice(8,-1))?qi=function(t){Ki.nextTick(Li(on,t,1))}:en?(Hi=(Wi=new en).port2,Wi.port1.onmessage=sn,qi=Li(Hi.postMessage,Hi,1)):zi.addEventListener&&"function"==typeof postMessage&&!zi.importScripts?(qi=function(t){zi.postMessage(t+"","*")},zi.addEventListener("message",sn,!1)):qi="onreadystatechange"in Bi("script")?function(t){$i.appendChild(Bi("script")).onreadystatechange=function(){$i.removeChild(this),on.call(t)}}:function(t){setTimeout(Li(on,t,1),0)});var an={set:Qi,clear:tn};Xi(Xi.G+Xi.B,{setImmediate:an.set,clearImmediate:an.clear});var ln,un,hn=Ri.setImmediate,cn=Z.MutationObserver||Z.WebKitMutationObserver;if(cn){var fn=0,dn=new cn(gn),pn=Z.document.createTextNode("");dn.observe(pn,{characterData:!0}),ln=function(){pn.data=fn=++fn%2}}else if(Z.setImmediate||void 0===Z.MessageChannel)ln="document"in Z&&"onreadystatechange"in Z.document.createElement("script")?function(){var t=Z.document.createElement("script");t.onreadystatechange=function(){gn(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},Z.document.documentElement.appendChild(t)}:function(){setTimeout(gn,0)};else{var _n=new Z.MessageChannel;_n.port1.onmessage=gn,ln=function(){_n.port2.postMessage(0)}}var mn=[];function gn(){var t,e;un=!0;for(var n=mn.length;n;){for(e=mn,mn=[],t=-1;++t<n;)e[t]();n=mn.length}un=!1}function vn(){}var yn={},bn=["REJECTED"],xn=["FULFILLED"],wn=["PENDING"],Tn=An;function An(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=wn,this.queue=[],this.outcome=void 0,t!==vn&&Pn(this,t)}function En(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function kn(t,e,n){!function(t){1!==mn.push(t)||un||ln()}((function(){var r;try{r=e(n)}catch(e){return yn.reject(t,e)}r===t?yn.reject(t,new TypeError("Cannot resolve promise with itself")):yn.resolve(t,r)}))}function Sn(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function Pn(t,e){var n=!1;function r(e){n||(n=!0,yn.reject(t,e))}function i(e){n||(n=!0,yn.resolve(t,e))}var o=Mn((function(){e(i,r)}));"error"===o.status&&r(o.value)}function Mn(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}An.prototype.catch=function(t){return this.then(null,t)},An.prototype.then=function(t,e){if("function"!=typeof t&&this.state===xn||"function"!=typeof e&&this.state===bn)return this;var n=new this.constructor(vn);return this.state!==wn?kn(n,this.state===xn?t:e,this.outcome):this.queue.push(new En(n,t,e)),n},En.prototype.callFulfilled=function(t){yn.resolve(this.promise,t)},En.prototype.otherCallFulfilled=function(t){kn(this.promise,this.onFulfilled,t)},En.prototype.callRejected=function(t){yn.reject(this.promise,t)},En.prototype.otherCallRejected=function(t){kn(this.promise,this.onRejected,t)},yn.resolve=function(t,e){var n=Mn(Sn,e);if("error"===n.status)return yn.reject(t,n.value);var r=n.value;if(r)Pn(t,r);else{t.state=xn,t.outcome=e;for(var i=-1,o=t.queue.length;++i<o;)t.queue[i].callFulfilled(e)}return t},yn.reject=function(t,e){t.state=bn,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},An.resolve=function(t){return t instanceof this?t:yn.resolve(new this(vn),t)},An.reject=function(t){var e=new this(vn);return yn.reject(e,t)},An.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),o=0,s=-1,a=new this(vn);++s<n;)l(t[s],s);return a;function l(t,s){e.resolve(t).then((function(t){i[s]=t,++o!==n||r||(r=!0,yn.resolve(a,i))}),(function(t){r||(r=!0,yn.reject(a,t))}))}},An.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,n=!1;if(!e)return this.resolve([]);for(var s,i=-1,r=new this(vn);++i<e;)s=t[i],this.resolve(s).then((function(t){n||(n=!0,yn.resolve(r,t))}),(function(t){n||(n=!0,yn.reject(r,t))}));return r};var zn={Promise:"undefined"!=typeof Promise?Promise:Tn},Rn=t.createCommonjsModule((function(t,e){function n(t){return t}function r(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}e.newBlob=function(t,n){e.checkSupport("blob");try{return new Blob([t],{type:n})}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(n)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var i={stringifyByChunk:function(t,e,n){var r=[],i=0,o=t.length;if(o<=n)return String.fromCharCode.apply(null,t);for(;i<o;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+n,o)))):r.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+n,o)))),i+=n;return r.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return Ti.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return Ti.nodebuffer&&1===String.fromCharCode.apply(null,Pi(1)).length}catch(t){return!1}}()}};function o(t){var n=65536,r=e.getTypeOf(t),o=!0;if("uint8array"===r?o=i.applyCanBeUsed.uint8array:"nodebuffer"===r&&(o=i.applyCanBeUsed.nodebuffer),o)for(;n>1;)try{return i.stringifyByChunk(t,r,n)}catch(t){n=Math.floor(n/2)}return i.stringifyByChar(t)}function s(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}e.applyFromCharCode=o;var a={};a.string={string:n,array:function(t){return r(t,new Array(t.length))},arraybuffer:function(t){return a.string.uint8array(t).buffer},uint8array:function(t){return r(t,new Uint8Array(t.length))},nodebuffer:function(t){return r(t,Pi(t.length))}},a.array={string:o,array:n,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return Si(t)}},a.arraybuffer={string:function(t){return o(new Uint8Array(t))},array:function(t){return s(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:n,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return Si(new Uint8Array(t))}},a.uint8array={string:o,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:n,nodebuffer:function(t){return Si(t)}},a.nodebuffer={string:o,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return a.nodebuffer.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:n},e.transformTo=function(t,n){if(n||(n=""),!t)return n;e.checkSupport(t);var r=e.getTypeOf(n);return a[r][t](n)},e.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":Ti.nodebuffer&&function(t){return Gt(t)}(t)?"nodebuffer":Ti.uint8array&&t instanceof Uint8Array?"uint8array":Ti.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(t){if(!Ti[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(t){var e,n,r="";for(n=0;n<(t||"").length;n++)r+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return r},e.delay=function(t,e,n){hn((function(){t.apply(n||null,e||[])}))},e.inherits=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n},e.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},e.prepareContent=function(t,n,i,o,s){return zn.Promise.resolve(n).then((function(t){return Ti.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new zn.Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){n(t.target.error)},r.readAsArrayBuffer(t)})):t})).then((function(n){var a,l=e.getTypeOf(n);return l?("arraybuffer"===l?n=e.transformTo("uint8array",n):"string"===l&&(s?n=ki(n):i&&!0!==o&&(n=r(a=n,Ti.uint8array?new Uint8Array(a.length):new Array(a.length)))),n):zn.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}}));function Ln(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}Rn.newBlob,Rn.applyFromCharCode,Rn.transformTo,Rn.getTypeOf,Rn.checkSupport,Rn.MAX_VALUE_16BITS,Rn.MAX_VALUE_32BITS,Rn.pretty,Rn.delay,Rn.inherits,Rn.extend,Rn.prepareContent,Ln.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}};var Cn=Ln,On=t.createCommonjsModule((function(t,e){for(var n=new Array(256),r=0;r<256;r++)n[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;function i(){Cn.call(this,"utf-8 decode"),this.leftOver=null}function o(){Cn.call(this,"utf-8 encode")}n[254]=n[254]=1,e.utf8encode=function(t){return Ti.nodebuffer?Si(t,"utf-8"):function(t){var e,n,r,i,o,s=t.length,a=0;for(i=0;i<s;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=Ti.uint8array?new Uint8Array(a):new Array(a),o=0,i=0;o<a;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e}(t)},e.utf8decode=function(t){return Ti.nodebuffer?Rn.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,r,i,o,s=t.length,a=new Array(2*s);for(r=0,e=0;e<s;)if((i=t[e++])<128)a[r++]=i;else if((o=n[i])>4)a[r++]=65533,e+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&e<s;)i=i<<6|63&t[e++],o--;o>1?a[r++]=65533:i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|1023&i)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),Rn.applyFromCharCode(a)}(t=Rn.transformTo(Ti.uint8array?"uint8array":"array",t))},Rn.inherits(i,Cn),i.prototype.processChunk=function(t){var r=Rn.transformTo(Ti.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(Ti.uint8array){var i=r;(r=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),r.set(i,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var o=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+n[t[r]]>e?r:e}(r),s=r;o!==r.length&&(Ti.uint8array?(s=r.subarray(0,o),this.leftOver=r.subarray(o,r.length)):(s=r.slice(0,o),this.leftOver=r.slice(o,r.length))),this.push({data:e.utf8decode(s),meta:t.meta})},i.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=i,Rn.inherits(o,Cn),o.prototype.processChunk=function(t){this.push({data:e.utf8encode(t.data),meta:t.meta})},e.Utf8EncodeWorker=o}));function Nn(t){Cn.call(this,"ConvertWorker to "+t),this.destType=t}On.utf8encode,On.utf8decode,On.Utf8DecodeWorker,On.Utf8EncodeWorker,Rn.inherits(Nn,Cn),Nn.prototype.processChunk=function(t){this.push({data:Rn.transformTo(this.destType,t.data),meta:t.meta})};var In=Nn,Fn=wi.Readable;function Dn(t,e,n){Fn.call(this,e),this._helper=t;var r=this;t.on("data",(function(t,e){r.push(t)||r._helper.pause(),n&&n(e)})).on("error",(function(t){r.emit("error",t)})).on("end",(function(){r.push(null)}))}Rn.inherits(Dn,Fn),Dn.prototype._read=function(){this._helper.resume()};var Bn=Dn,jn=null;if(Ti.nodestream)try{jn=Bn}catch(t){}function Un(t,e,n){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=n,Rn.checkSupport(r),this._worker=t.pipe(new In(r)),t.lock()}catch(t){this._worker=new Cn("error"),this._worker.error(t)}}Un.prototype={accumulate:function(t){return function(t,e){return new zn.Promise((function(n,r){var i=[],o=t._internalType,s=t._outputType,a=t._mimeType;t.on("data",(function(t,n){i.push(t),e&&e(n)})).on("error",(function(t){i=[],r(t)})).on("end",(function(){try{var t=function(t,e,n){switch(t){case"blob":return Rn.newBlob(Rn.transformTo("arraybuffer",e),n);case"base64":return Ei(e);default:return Rn.transformTo(t,e)}}(s,function(t,e){var n,r=0,i=null,o=0;for(n=0;n<e.length;n++)o+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(i=new Uint8Array(o),n=0;n<e.length;n++)i.set(e[n],r),r+=e[n].length;return i;case"nodebuffer":return ot.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,i),a);n(t)}catch(t){r(t)}i=[]})).resume()}))}(this,t)},on:function(t,e){var n=this;return"data"===t?this._worker.on(t,(function(t){e.call(n,t.data,t.meta)})):this._worker.on(t,(function(){Rn.delay(e,arguments,n)})),this},resume:function(){return Rn.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(Rn.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new jn(this,{objectMode:"nodebuffer"!==this._outputType},t)}};var Gn=Un,Zn={base64:!1,binary:!1,dir:!1,createFolders:!0,date:null,compression:null,compressionOptions:null,comment:null,unixPermissions:null,dosPermissions:null};function Vn(t){Cn.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=Rn.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}Rn.inherits(Vn,Cn),Vn.prototype.cleanUp=function(){Cn.prototype.cleanUp.call(this),this.data=null},Vn.prototype.resume=function(){return!!Cn.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,Rn.delay(this._tickAndRepeat,[],this)),!0)},Vn.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(Rn.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},Vn.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})};var qn=Vn;function Wn(t){Cn.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}Rn.inherits(Wn,Cn),Wn.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}Cn.prototype.processChunk.call(this,t)};var Hn=Wn,Yn=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}(),Xn=function(t,e){return void 0!==t&&t.length?"string"!==Rn.getTypeOf(t)?function(t,e,n,r){var i=Yn,o=0+n;t^=-1;for(var s=0;s<o;s++)t=t>>>8^i[255&(t^e[s])];return-1^t}(0|e,t,t.length):function(t,e,n,r){var i=Yn,o=0+n;t^=-1;for(var s=0;s<o;s++)t=t>>>8^i[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length):0};function $n(){Cn.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Rn.inherits($n,Cn),$n.prototype.processChunk=function(t){this.streamInfo.crc32=Xn(t.data,this.streamInfo.crc32||0),this.push(t)};var Jn=$n;function Kn(t,e,n,r,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=r,this.compressedContent=i}Kn.prototype={getContentWorker:function(){var t=new qn(zn.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new Hn("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new qn(zn.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Kn.createWorkerFrom=function(t,e,n){return t.pipe(new Jn).pipe(new Hn("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new Hn("compressedSize")).withStreamInfo("compression",e)};var Qn=Kn,er=function(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};er.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var r="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var i=!this._dataBinary;i&&!r&&(e=e.pipe(new On.Utf8EncodeWorker)),!i&&r&&(e=e.pipe(new On.Utf8DecodeWorker))}catch(t){(e=new Cn("error")).error(t)}return new Gn(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof Qn&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new On.Utf8EncodeWorker)),Qn.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof Qn?this._data.getContentWorker():this._data instanceof Cn?this._data:new qn(this._data)}};for(var ir=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],nr=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},rr=0;rr<ir.length;rr++)er.prototype[ir[rr]]=nr;var li=er,or=t.createCommonjsModule((function(t,e){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(t[i]=n[i])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,s;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(s=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],s.set(o,i),i+=o.length;return s}},o={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(n)})),sr=(or.assign,or.shrinkBuf,or.setTyped,or.Buf8,or.Buf16,or.Buf32,4);function ar(t){for(var e=t.length;--e>=0;)t[e]=0}var lr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ur=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],fr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],dr=new Array(576);ar(dr);var pr=new Array(60);ar(pr);var _r=new Array(512);ar(_r);var mr=new Array(256);ar(mr);var gr=new Array(29);ar(gr);var vr,yr,xr,wr=new Array(30);function Tr(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function Ar(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Er(t){return t<256?_r[t]:_r[256+(t>>>7)]}function kr(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function Sr(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,kr(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function Pr(t,e,n){Sr(t,n[2*e],n[2*e+1])}function Mr(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function zr(t,e,n){var r,i,o=new Array(16),s=0;for(r=1;r<=15;r++)o[r]=s=s+n[r-1]<<1;for(i=0;i<=e;i++){var a=t[2*i+1];0!==a&&(t[2*i]=Mr(o[a]++,a))}}function Rr(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Lr(t){t.bi_valid>8?kr(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Cr(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function Or(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&Cr(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Cr(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function Nr(t,e,n){var r,i,o,s,a=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],i=t.pending_buf[t.l_buf+a],a++,0===r?Pr(t,i,e):(Pr(t,(o=mr[i])+256+1,e),0!==(s=lr[o])&&Sr(t,i-=gr[o],s),Pr(t,o=Er(--r),n),0!==(s=ur[o])&&Sr(t,r-=wr[o],s))}while(a<t.last_lit);Pr(t,256,e)}function Ir(t,e){var n,r,i,o=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[i]=0,t.opt_len--,a&&(t.static_len-=s[2*i+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)Or(t,o,n);i=l;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Or(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,Or(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,o,s,a,l=e.dyn_tree,u=e.max_code,h=e.stat_desc.static_tree,c=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(o=0;o<=15;o++)t.bl_count[o]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(o=l[2*l[2*(r=t.heap[n])+1]+1]+1)>p&&(o=p,g++),l[2*r+1]=o,r>u||(t.bl_count[o]++,s=0,r>=d&&(s=f[r-d]),a=l[2*r],t.opt_len+=a*(o+s),c&&(t.static_len+=a*(h[2*r+1]+s)));if(0!==g){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(o=p;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>u||(l[2*i+1]!==o&&(t.opt_len+=(o-l[2*i+1])*l[2*i],l[2*i+1]=o),r--)}}(t,e),zr(o,u,t.bl_count)}function Fr(t,e,n){var r,i,o=-1,s=e[1],a=0,l=7,u=4;for(0===s&&(l=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=e[2*(r+1)+1],++a<l&&i===s||(a<u?t.bl_tree[2*i]+=a:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,o=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))}function Dr(t,e,n){var r,i,o=-1,s=e[1],a=0,l=7,u=4;for(0===s&&(l=138,u=3),r=0;r<=n;r++)if(i=s,s=e[2*(r+1)+1],!(++a<l&&i===s)){if(a<u)do{Pr(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(Pr(t,i,t.bl_tree),a--),Pr(t,16,t.bl_tree),Sr(t,a-3,2)):a<=10?(Pr(t,17,t.bl_tree),Sr(t,a-3,3)):(Pr(t,18,t.bl_tree),Sr(t,a-11,7));a=0,o=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4)}}ar(wr);var Br=!1;function jr(t,e,n,r){Sr(t,0+(r?1:0),3),function(t,e,n,r){Lr(t),kr(t,n),kr(t,~n),or.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n)}var Ur,Gr={_tr_init:function(t){Br||(function(){var t,e,n,r,i,o=new Array(16);for(n=0,r=0;r<28;r++)for(gr[r]=n,t=0;t<1<<lr[r];t++)mr[n++]=r;for(mr[n-1]=r,i=0,r=0;r<16;r++)for(wr[r]=i,t=0;t<1<<ur[r];t++)_r[i++]=r;for(i>>=7;r<30;r++)for(wr[r]=i<<7,t=0;t<1<<ur[r]-7;t++)_r[256+i++]=r;for(e=0;e<=15;e++)o[e]=0;for(t=0;t<=143;)dr[2*t+1]=8,t++,o[8]++;for(;t<=255;)dr[2*t+1]=9,t++,o[9]++;for(;t<=279;)dr[2*t+1]=7,t++,o[7]++;for(;t<=287;)dr[2*t+1]=8,t++,o[8]++;for(zr(dr,287,o),t=0;t<30;t++)pr[2*t+1]=5,pr[2*t]=Mr(t,5);vr=new Tr(dr,lr,257,286,15),yr=new Tr(pr,ur,0,30,15),xr=new Tr(new Array(0),cr,0,19,7)}(),Br=!0),t.l_desc=new Ar(t.dyn_ltree,vr),t.d_desc=new Ar(t.dyn_dtree,yr),t.bl_desc=new Ar(t.bl_tree,xr),t.bi_buf=0,t.bi_valid=0,Rr(t)},_tr_stored_block:jr,_tr_flush_block:function(t,e,n,r){var i,o,s=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),Ir(t,t.l_desc),Ir(t,t.d_desc),s=function(t){var e;for(Fr(t,t.dyn_ltree,t.l_desc.max_code),Fr(t,t.dyn_dtree,t.d_desc.max_code),Ir(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*fr[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==e?jr(t,e,n,r):t.strategy===sr||o===i?(Sr(t,2+(r?1:0),3),Nr(t,dr,pr)):(Sr(t,4+(r?1:0),3),function(t,e,n,r){var i;for(Sr(t,e-257,5),Sr(t,n-1,5),Sr(t,r-4,4),i=0;i<r;i++)Sr(t,t.bl_tree[2*fr[i]+1],3);Dr(t,t.dyn_ltree,e-1),Dr(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),Nr(t,t.dyn_ltree,t.dyn_dtree)),Rr(t),r&&Lr(t)},_tr_tally:function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(mr[n]+256+1)]++,t.dyn_dtree[2*Er(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){Sr(t,2,3),Pr(t,256,dr),function(t){16===t.bi_valid?(kr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},Zr=function(t,e,n,r){for(var i=65535&t|0,o=t>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{o=o+(i=i+e[r++]|0)|0}while(--s);i%=65521,o%=65521}return i|o<<16|0},Vr=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}(),qr=function(t,e,n,r){var i=Vr,o=r+n;t^=-1;for(var s=r;s<o;s++)t=t>>>8^i[255&(t^e[s])];return-1^t},Wr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Hr=258,Yr=262;function Xr(t,e){return t.msg=Wr[e],e}function $r(t){return(t<<1)-(t>4?9:0)}function Jr(t){for(var e=t.length;--e>=0;)t[e]=0}function Kr(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(or.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function Qr(t,e){Gr._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Kr(t.strm)}function to(t,e){t.pending_buf[t.pending++]=e}function eo(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function io(t,e){var n,r,i=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-Yr?t.strstart-(t.w_size-Yr):0,u=t.window,h=t.w_mask,c=t.prev,f=t.strstart+Hr,d=u[o+s-1],p=u[o+s];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(u[(n=e)+s]===p&&u[n+s-1]===d&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<f);if(r=Hr-(f-o),o=f-Hr,r>s){if(t.match_start=e,s=r,r>=a)break;d=u[o+s-1],p=u[o+s]}}}while((e=c[e&h])>l&&0!=--i);return s<=t.lookahead?s:t.lookahead}function no(t){var e,n,r,i,o,s,a,l,u,h,c=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=c+(c-Yr)){or.arraySet(t.window,t.window,c,c,0),t.match_start-=c,t.strstart-=c,t.block_start-=c,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=c?r-c:0}while(--n);e=n=c;do{r=t.prev[--e],t.prev[e]=r>=c?r-c:0}while(--n);i+=c}if(0===t.strm.avail_in)break;if(s=t.strm,a=t.window,l=t.strstart+t.lookahead,u=i,h=void 0,(h=s.avail_in)>u&&(h=u),n=0===h?0:(s.avail_in-=h,or.arraySet(a,s.input,s.next_in,h,l),1===s.state.wrap?s.adler=Zr(s.adler,a,h,l):2===s.state.wrap&&(s.adler=qr(s.adler,a,h,l)),s.next_in+=h,s.total_in+=h,h),t.lookahead+=n,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+3-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Yr&&0!==t.strm.avail_in)}function ro(t,e){for(var n,r;;){if(t.lookahead<Yr){if(no(t),t.lookahead<Yr&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-Yr&&(t.match_length=io(t,n)),t.match_length>=3)if(r=Gr._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=Gr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Qr(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(Qr(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Qr(t,!1),0===t.strm.avail_out)?1:2}function oo(t,e){for(var n,r,i;;){if(t.lookahead<Yr){if(no(t),t.lookahead<Yr&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Yr&&(t.match_length=io(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=Gr._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Qr(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=Gr._tr_tally(t,0,t.window[t.strstart-1]))&&Qr(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Gr._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(Qr(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Qr(t,!1),0===t.strm.avail_out)?1:2}function so(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function ao(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new or.Buf16(1146),this.dyn_dtree=new or.Buf16(122),this.bl_tree=new or.Buf16(78),Jr(this.dyn_ltree),Jr(this.dyn_dtree),Jr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new or.Buf16(16),this.heap=new or.Buf16(573),Jr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new or.Buf16(573),Jr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function lo(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,Gr._tr_init(e),0):Xr(t,-2)}function uo(t){var e,n=lo(t);return 0===n&&((e=t.state).window_size=2*e.w_size,Jr(e.head),e.max_lazy_match=Ur[e.level].max_lazy,e.good_match=Ur[e.level].good_length,e.nice_match=Ur[e.level].nice_length,e.max_chain_length=Ur[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function ho(t,e,n,r,i,o){if(!t)return-2;var s=1;if(-1===e&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||8!==n||r<8||r>15||e<0||e>9||o<0||o>4)return Xr(t,-2);8===r&&(r=9);var a=new ao;return t.state=a,a.strm=t,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new or.Buf8(2*a.w_size),a.head=new or.Buf16(a.hash_size),a.prev=new or.Buf16(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new or.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=e,a.strategy=o,a.method=n,uo(t)}Ur=[new so(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(no(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,Qr(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-Yr&&(Qr(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Qr(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Qr(t,!1),t.strm.avail_out),1)})),new so(4,4,8,4,ro),new so(4,5,16,8,ro),new so(4,6,32,32,ro),new so(4,4,16,16,oo),new so(8,16,32,32,oo),new so(8,16,128,128,oo),new so(8,32,128,256,oo),new so(32,128,258,1024,oo),new so(32,258,258,4096,oo)];var co={deflateInit:function(t,e){return ho(t,e,8,15,8,0)},deflateInit2:ho,deflateReset:uo,deflateResetKeep:lo,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},deflate:function(t,e){var n,r,i,o;if(!t||!t.state||e>5||e<0)return t?Xr(t,-2):-2;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&4!==e)return Xr(t,0===t.avail_out?-5:-2);if(r.strm=t,n=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,to(r,31),to(r,139),to(r,8),r.gzhead?(to(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),to(r,255&r.gzhead.time),to(r,r.gzhead.time>>8&255),to(r,r.gzhead.time>>16&255),to(r,r.gzhead.time>>24&255),to(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),to(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(to(r,255&r.gzhead.extra.length),to(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=qr(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(to(r,0),to(r,0),to(r,0),to(r,0),to(r,0),to(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),to(r,3),r.status=113);else{var s=8+(r.w_bits-8<<4)<<8;s|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(s|=32),s+=31-s%31,r.status=113,eo(r,s),0!==r.strstart&&(eo(r,t.adler>>>16),eo(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(t.adler=qr(t.adler,r.pending_buf,r.pending-i,i)),Kr(t),i=r.pending,r.pending!==r.pending_buf_size));)to(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(t.adler=qr(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=qr(t.adler,r.pending_buf,r.pending-i,i)),Kr(t),i=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,to(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>i&&(t.adler=qr(t.adler,r.pending_buf,r.pending-i,i)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=qr(t.adler,r.pending_buf,r.pending-i,i)),Kr(t),i=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,to(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>i&&(t.adler=qr(t.adler,r.pending_buf,r.pending-i,i)),0===o&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Kr(t),r.pending+2<=r.pending_buf_size&&(to(r,255&t.adler),to(r,t.adler>>8&255),t.adler=0,r.status=113)):r.status=113),0!==r.pending){if(Kr(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&$r(e)<=$r(n)&&4!==e)return Xr(t,-5);if(666===r.status&&0!==t.avail_in)return Xr(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&666!==r.status){var a=2===r.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(no(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=Gr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Qr(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Qr(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Qr(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var n,r,i,o,s=t.window;;){if(t.lookahead<=Hr){if(no(t),t.lookahead<=Hr&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=s[i=t.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=t.strstart+Hr;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);t.match_length=Hr-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=Gr._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Gr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Qr(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Qr(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Qr(t,!1),0===t.strm.avail_out)?1:2}(r,e):Ur[r.level].func(r,e);if(3!==a&&4!==a||(r.status=666),1===a||3===a)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===a&&(1===e?Gr._tr_align(r):5!==e&&(Gr._tr_stored_block(r,0,0,!1),3===e&&(Jr(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Kr(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(to(r,255&t.adler),to(r,t.adler>>8&255),to(r,t.adler>>16&255),to(r,t.adler>>24&255),to(r,255&t.total_in),to(r,t.total_in>>8&255),to(r,t.total_in>>16&255),to(r,t.total_in>>24&255)):(eo(r,t.adler>>>16),eo(r,65535&t.adler)),Kr(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},deflateEnd:function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?Xr(t,-2):(t.state=null,113===e?Xr(t,-3):0):-2},deflateSetDictionary:function(t,e){var n,r,i,o,s,a,l,u,h=e.length;if(!t||!t.state)return-2;if(2===(o=(n=t.state).wrap)||1===o&&42!==n.status||n.lookahead)return-2;for(1===o&&(t.adler=Zr(t.adler,e,h,0)),n.wrap=0,h>=n.w_size&&(0===o&&(Jr(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new or.Buf8(n.w_size),or.arraySet(u,e,h-n.w_size,n.w_size,0),e=u,h=n.w_size),s=t.avail_in,a=t.next_in,l=t.input,t.avail_in=h,t.next_in=0,t.input=e,no(n);n.lookahead>=3;){r=n.strstart,i=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=2,no(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=a,t.input=l,t.avail_in=s,n.wrap=o,0},deflateInfo:"pako deflate (from Nodeca project)"},fo=!0,po=!0;try{String.fromCharCode.apply(null,[0])}catch(t){fo=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){po=!1}for(var _o=new or.Buf8(256),mo=0;mo<256;mo++)_o[mo]=mo>=252?6:mo>=248?5:mo>=240?4:mo>=224?3:mo>=192?2:1;function go(t,e){if(e<65537&&(t.subarray&&po||!t.subarray&&fo))return String.fromCharCode.apply(null,or.shrinkBuf(t,e));for(var n="",r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n}_o[254]=_o[254]=1;var vo=function(t){var e,n,r,i,o,s=t.length,a=0;for(i=0;i<s;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new or.Buf8(a),o=0,i=0;o<a;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},yo=function(t){return go(t,t.length)},bo=function(t){for(var e=new or.Buf8(t.length),n=0,r=e.length;n<r;n++)e[n]=t.charCodeAt(n);return e},xo=function(t,e){var n,r,i,o,s=e||t.length,a=new Array(2*s);for(r=0,n=0;n<s;)if((i=t[n++])<128)a[r++]=i;else if((o=_o[i])>4)a[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&t[n++],o--;o>1?a[r++]=65533:i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|1023&i)}return go(a,r)},wo=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+_o[t[n]]>e?n:e},To=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ao=Object.prototype.toString;function Eo(t){if(!(this instanceof Eo))return new Eo(t);this.options=or.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new To,this.strm.avail_out=0;var n=co.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(Wr[n]);if(e.header&&co.deflateSetHeader(this.strm,e.header),e.dictionary){var r;if(r="string"==typeof e.dictionary?vo(e.dictionary):"[object ArrayBuffer]"===Ao.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=co.deflateSetDictionary(this.strm,r)))throw new Error(Wr[n]);this._dict_set=!0}}function ko(t,e){var n=new Eo(e);if(n.push(t,!0),n.err)throw n.msg||Wr[n.err];return n.result}Eo.prototype.push=function(t,e){var n,r,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:!0===e?4:0,"string"==typeof t?i.input=vo(t):"[object ArrayBuffer]"===Ao.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new or.Buf8(o),i.next_out=0,i.avail_out=o),1!==(n=co.deflate(i,r))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(yo(or.shrinkBuf(i.output,i.next_out))):this.onData(or.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==n);return 4===r?(n=co.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==r||(this.onEnd(0),i.avail_out=0,!0)},Eo.prototype.onData=function(t){this.chunks.push(t)},Eo.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=or.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var So={Deflate:Eo,deflate:ko,deflateRaw:function(t,e){return(e=e||{}).raw=!0,ko(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,ko(t,e)}},Po=function(t,e){var n,r,i,o,s,a,l,u,h,c,f,d,p,g,_,m,v,y,b,x,w,T,A,E,k;n=t.state,r=t.next_in,E=t.input,i=r+(t.avail_in-5),o=t.next_out,k=t.output,s=o-(e-t.avail_out),a=o+(t.avail_out-257),l=n.dmax,u=n.wsize,h=n.whave,c=n.wnext,f=n.window,d=n.hold,p=n.bits,g=n.lencode,_=n.distcode,m=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;t:do{p<15&&(d+=E[r++]<<p,p+=8,d+=E[r++]<<p,p+=8),y=g[d&m];e:for(;;){if(d>>>=b=y>>>24,p-=b,0==(b=y>>>16&255))k[o++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=g[(65535&y)+(d&(1<<b)-1)];continue e}if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}x=65535&y,(b&=15)&&(p<b&&(d+=E[r++]<<p,p+=8),x+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=E[r++]<<p,p+=8,d+=E[r++]<<p,p+=8),y=_[d&v];i:for(;;){if(d>>>=b=y>>>24,p-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=_[(65535&y)+(d&(1<<b)-1)];continue i}t.msg="invalid distance code",n.mode=30;break t}if(w=65535&y,p<(b&=15)&&(d+=E[r++]<<p,(p+=8)<b&&(d+=E[r++]<<p,p+=8)),(w+=d&(1<<b)-1)>l){t.msg="invalid distance too far back",n.mode=30;break t}if(d>>>=b,p-=b,w>(b=o-s)){if((b=w-b)>h&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(T=0,A=f,0===c){if(T+=u-b,b<x){x-=b;do{k[o++]=f[T++]}while(--b);T=o-w,A=k}}else if(c<b){if(T+=u+c-b,(b-=c)<x){x-=b;do{k[o++]=f[T++]}while(--b);if(T=0,c<x){x-=b=c;do{k[o++]=f[T++]}while(--b);T=o-w,A=k}}}else if(T+=c-b,b<x){x-=b;do{k[o++]=f[T++]}while(--b);T=o-w,A=k}for(;x>2;)k[o++]=A[T++],k[o++]=A[T++],k[o++]=A[T++],x-=3;x&&(k[o++]=A[T++],x>1&&(k[o++]=A[T++]))}else{T=o-w;do{k[o++]=k[T++],k[o++]=k[T++],k[o++]=k[T++],x-=3}while(x>2);x&&(k[o++]=k[T++],x>1&&(k[o++]=k[T++]))}break}}break}}while(r<i&&o<a);r-=x=p>>3,d&=(1<<(p-=x<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=o<a?a-o+257:257-(o-a),n.hold=d,n.bits=p},Mo=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],zo=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Ro=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Lo=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Co=function(t,e,n,r,i,o,s,a){var l,u,h,c,f,d,p,g,_,m=a.bits,v=0,y=0,b=0,x=0,w=0,T=0,A=0,E=0,k=0,S=0,P=null,M=0,z=new or.Buf16(16),R=new or.Buf16(16),L=null,C=0;for(v=0;v<=15;v++)z[v]=0;for(y=0;y<r;y++)z[e[n+y]]++;for(w=m,x=15;x>=1&&0===z[x];x--);if(w>x&&(w=x),0===x)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(b=1;b<x&&0===z[b];b++);for(w<b&&(w=b),E=1,v=1;v<=15;v++)if(E<<=1,(E-=z[v])<0)return-1;if(E>0&&(0===t||1!==x))return-1;for(R[1]=0,v=1;v<15;v++)R[v+1]=R[v]+z[v];for(y=0;y<r;y++)0!==e[n+y]&&(s[R[e[n+y]]++]=y);if(0===t?(P=L=s,d=19):1===t?(P=Mo,M-=257,L=zo,C-=257,d=256):(P=Ro,L=Lo,d=-1),S=0,y=0,v=b,f=o,T=w,A=0,h=-1,c=(k=1<<w)-1,1===t&&k>852||2===t&&k>592)return 1;for(;;){p=v-A,s[y]<d?(g=0,_=s[y]):s[y]>d?(g=L[C+s[y]],_=P[M+s[y]]):(g=96,_=0),l=1<<v-A,b=u=1<<T;do{i[f+(S>>A)+(u-=l)]=p<<24|g<<16|_|0}while(0!==u);for(l=1<<v-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,y++,0==--z[v]){if(v===x)break;v=e[n+s[y]]}if(v>w&&(S&c)!==h){for(0===A&&(A=w),f+=b,E=1<<(T=v-A);T+A<x&&!((E-=z[T+A])<=0);)T++,E<<=1;if(k+=1<<T,1===t&&k>852||2===t&&k>592)return 1;i[h=S&c]=w<<24|T<<16|f-o|0}}return 0!==S&&(i[f+S]=v-A<<24|64<<16|0),a.bits=w,0};function Oo(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function No(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new or.Buf16(320),this.work=new or.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Io(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new or.Buf32(852),e.distcode=e.distdyn=new or.Buf32(592),e.sane=1,e.back=-1,0):-2}function Fo(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,Io(t)):-2}function Do(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Fo(t))):-2}function Bo(t,e){var n,r;return t?(r=new No,t.state=r,r.window=null,0!==(n=Do(t,e))&&(t.state=null),n):-2}var jo,Uo,Go=!0;function Zo(t){if(Go){var e;for(jo=new or.Buf32(512),Uo=new or.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Co(1,t.lens,0,288,jo,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Co(2,t.lens,0,32,Uo,0,t.work,{bits:5}),Go=!1}t.lencode=jo,t.lenbits=9,t.distcode=Uo,t.distbits=5}function Vo(t,e,n,r){var i,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new or.Buf8(o.wsize)),r>=o.wsize?(or.arraySet(o.window,e,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>r&&(i=r),or.arraySet(o.window,e,n-r,i,o.wnext),(r-=i)?(or.arraySet(o.window,e,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}var qo={inflateReset:Fo,inflateReset2:Do,inflateResetKeep:Io,inflateInit:function(t){return Bo(t,15)},inflateInit2:Bo,inflate:function(t,e){var n,r,i,o,s,a,l,u,h,c,f,d,p,g,_,m,v,y,b,x,w,T,A,E,k=0,S=new or.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(n=t.state).mode&&(n.mode=13),s=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,u=n.hold,h=n.bits,c=a,f=l,T=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;h<16;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(2&n.wrap&&35615===u){n.check=0,S[0]=255&u,S[1]=u>>>8&255,n.check=qr(n.check,S,2,0),u=0,h=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&u)){t.msg="unknown compression method",n.mode=30;break}if(h-=4,w=8+(15&(u>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<w,t.adler=n.check=1,n.mode=512&u?10:12,u=0,h=0;break;case 2:for(;h<16;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(n.flags=u,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(S[0]=255&u,S[1]=u>>>8&255,n.check=qr(n.check,S,2,0)),u=0,h=0,n.mode=3;case 3:for(;h<32;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}n.head&&(n.head.time=u),512&n.flags&&(S[0]=255&u,S[1]=u>>>8&255,S[2]=u>>>16&255,S[3]=u>>>24&255,n.check=qr(n.check,S,4,0)),u=0,h=0,n.mode=4;case 4:for(;h<16;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(S[0]=255&u,S[1]=u>>>8&255,n.check=qr(n.check,S,2,0)),u=0,h=0,n.mode=5;case 5:if(1024&n.flags){for(;h<16;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(S[0]=255&u,S[1]=u>>>8&255,n.check=qr(n.check,S,2,0)),u=0,h=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((d=n.length)>a&&(d=a),d&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),or.arraySet(n.head.extra,r,o,d,w)),512&n.flags&&(n.check=qr(n.check,r,d,o)),a-=d,o+=d,n.length-=d),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break t;d=0;do{w=r[o+d++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&d<a);if(512&n.flags&&(n.check=qr(n.check,r,d,o)),a-=d,o+=d,w)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break t;d=0;do{w=r[o+d++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&d<a);if(512&n.flags&&(n.check=qr(n.check,r,d,o)),a-=d,o+=d,w)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;h<16;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(u!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}u=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;h<32;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}t.adler=n.check=Oo(u),u=0,h=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,n.hold=u,n.bits=h,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){u>>>=7&h,h-=7&h,n.mode=27;break}for(;h<3;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}switch(n.last=1&u,h-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(Zo(n),n.mode=20,6===e){u>>>=2,h-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}u>>>=2,h-=2;break;case 14:for(u>>>=7&h,h-=7&h;h<32;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&u,u=0,h=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(d=n.length){if(d>a&&(d=a),d>l&&(d=l),0===d)break t;or.arraySet(i,r,o,d,s),a-=d,o+=d,l-=d,s+=d,n.length-=d;break}n.mode=12;break;case 17:for(;h<14;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(n.nlen=257+(31&u),u>>>=5,h-=5,n.ndist=1+(31&u),u>>>=5,h-=5,n.ncode=4+(15&u),u>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;h<3;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}n.lens[P[n.have++]]=7&u,u>>>=3,h-=3}for(;n.have<19;)n.lens[P[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},T=Co(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,T){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;m=(k=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&k,!((_=k>>>24)<=h);){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(v<16)u>>>=_,h-=_,n.lens[n.have++]=v;else{if(16===v){for(E=_+2;h<E;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(u>>>=_,h-=_,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}w=n.lens[n.have-1],d=3+(3&u),u>>>=2,h-=2}else if(17===v){for(E=_+3;h<E;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}h-=_,w=0,d=3+(7&(u>>>=_)),u>>>=3,h-=3}else{for(E=_+7;h<E;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}h-=_,w=0,d=11+(127&(u>>>=_)),u>>>=7,h-=7}if(n.have+d>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;d--;)n.lens[n.have++]=w}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,A={bits:n.lenbits},T=Co(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,T){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},T=Co(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,T){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(a>=6&&l>=258){t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,n.hold=u,n.bits=h,Po(t,f),s=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,u=n.hold,h=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;m=(k=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&k,!((_=k>>>24)<=h);){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(m&&0==(240&m)){for(y=_,b=m,x=v;m=(k=n.lencode[x+((u&(1<<y+b)-1)>>y)])>>>16&255,v=65535&k,!(y+(_=k>>>24)<=h);){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}u>>>=y,h-=y,n.back+=y}if(u>>>=_,h-=_,n.back+=_,n.length=v,0===m){n.mode=26;break}if(32&m){n.back=-1,n.mode=12;break}if(64&m){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&m,n.mode=22;case 22:if(n.extra){for(E=n.extra;h<E;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(k=n.distcode[u&(1<<n.distbits)-1])>>>16&255,v=65535&k,!((_=k>>>24)<=h);){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(0==(240&m)){for(y=_,b=m,x=v;m=(k=n.distcode[x+((u&(1<<y+b)-1)>>y)])>>>16&255,v=65535&k,!(y+(_=k>>>24)<=h);){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}u>>>=y,h-=y,n.back+=y}if(u>>>=_,h-=_,n.back+=_,64&m){t.msg="invalid distance code",n.mode=30;break}n.offset=v,n.extra=15&m,n.mode=24;case 24:if(n.extra){for(E=n.extra;h<E;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break t;if(d=f-l,n.offset>d){if((d=n.offset-d)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}d>n.wnext?(d-=n.wnext,p=n.wsize-d):p=n.wnext-d,d>n.length&&(d=n.length),g=n.window}else g=i,p=s-n.offset,d=n.length;d>l&&(d=l),l-=d,n.length-=d;do{i[s++]=g[p++]}while(--d);0===n.length&&(n.mode=21);break;case 26:if(0===l)break t;i[s++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;h<32;){if(0===a)break t;a--,u|=r[o++]<<h,h+=8}if(f-=l,t.total_out+=f,n.total+=f,f&&(t.adler=n.check=n.flags?qr(n.check,i,f,s-f):Zr(n.check,i,f,s-f)),f=l,(n.flags?u:Oo(u))!==n.check){t.msg="incorrect data check",n.mode=30;break}u=0,h=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;h<32;){if(0===a)break t;a--,u+=r[o++]<<h,h+=8}if(u!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}u=0,h=0}n.mode=29;case 29:T=1;break t;case 30:T=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,n.hold=u,n.bits=h,(n.wsize||f!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&Vo(t,t.output,t.next_out,f-t.avail_out),c-=t.avail_in,f-=t.avail_out,t.total_in+=c,t.total_out+=f,n.total+=f,n.wrap&&f&&(t.adler=n.check=n.flags?qr(n.check,i,f,t.next_out-f):Zr(n.check,i,f,t.next_out-f)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===c&&0===f||4===e)&&0===T&&(T=-5),T},inflateEnd:function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},inflateGetHeader:function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?-2:(n.head=e,e.done=!1,0):-2},inflateSetDictionary:function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?-2:11===n.mode&&Zr(1,e,r,0)!==n.check?-3:Vo(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},inflateInfo:"pako inflate (from Nodeca project)"},Wo={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Ho=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Yo=Object.prototype.toString;function Xo(t){if(!(this instanceof Xo))return new Xo(t);this.options=or.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new To,this.strm.avail_out=0;var n=qo.inflateInit2(this.strm,e.windowBits);if(n!==Wo.Z_OK)throw new Error(Wr[n]);this.header=new Ho,qo.inflateGetHeader(this.strm,this.header)}function $o(t,e){var n=new Xo(e);if(n.push(t,!0),n.err)throw n.msg||Wr[n.err];return n.result}Xo.prototype.push=function(t,e){var n,r,i,o,s,a,l=this.strm,u=this.options.chunkSize,h=this.options.dictionary,c=!1;if(this.ended)return!1;r=e===~~e?e:!0===e?Wo.Z_FINISH:Wo.Z_NO_FLUSH,"string"==typeof t?l.input=bo(t):"[object ArrayBuffer]"===Yo.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new or.Buf8(u),l.next_out=0,l.avail_out=u),(n=qo.inflate(l,Wo.Z_NO_FLUSH))===Wo.Z_NEED_DICT&&h&&(a="string"==typeof h?vo(h):"[object ArrayBuffer]"===Yo.call(h)?new Uint8Array(h):h,n=qo.inflateSetDictionary(this.strm,a)),n===Wo.Z_BUF_ERROR&&!0===c&&(n=Wo.Z_OK,c=!1),n!==Wo.Z_STREAM_END&&n!==Wo.Z_OK)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==Wo.Z_STREAM_END&&(0!==l.avail_in||r!==Wo.Z_FINISH&&r!==Wo.Z_SYNC_FLUSH)||("string"===this.options.to?(i=wo(l.output,l.next_out),o=l.next_out-i,s=xo(l.output,i),l.next_out=o,l.avail_out=u-o,o&&or.arraySet(l.output,l.output,i,o,0),this.onData(s)):this.onData(or.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(c=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==Wo.Z_STREAM_END);return n===Wo.Z_STREAM_END&&(r=Wo.Z_FINISH),r===Wo.Z_FINISH?(n=qo.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Wo.Z_OK):r!==Wo.Z_SYNC_FLUSH||(this.onEnd(Wo.Z_OK),l.avail_out=0,!0)},Xo.prototype.onData=function(t){this.chunks.push(t)},Xo.prototype.onEnd=function(t){t===Wo.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=or.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Jo={Inflate:Xo,inflate:$o,inflateRaw:function(t,e){return(e=e||{}).raw=!0,$o(t,e)},ungzip:$o},Ko={};(0,or.assign)(Ko,So,Jo,Wo);var Qo=Ko,ts="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array?"uint8array":"array";function es(t,e){Cn.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}Rn.inherits(es,Cn),es.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(Rn.transformTo(ts,t.data),!1)},es.prototype.flush=function(){Cn.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},es.prototype.cleanUp=function(){Cn.prototype.cleanUp.call(this),this._pako=null},es.prototype._createPako=function(){this._pako=new Qo[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}};var is={STORE:{magic:"\0\0",compressWorker:function(t){return new Cn("STORE compression")},uncompressWorker:function(){return new Cn("STORE decompression")}},DEFLATE:{magic:"\b\0",compressWorker:function(t){return new es("Deflate",t)},uncompressWorker:function(){return new es("Inflate",{})}}},ol="PK",ns="PK",rs="PK",ul="PK",os=function(t,e){var n,r="";for(n=0;n<e;n++)r+=String.fromCharCode(255&t),t>>>=8;return r},ss=function(t,e,n,r,i,o){var s,a,l=t.file,u=t.compression,h=o!==On.utf8encode,c=Rn.transformTo("string",o(l.name)),f=Rn.transformTo("string",On.utf8encode(l.name)),d=l.comment,p=Rn.transformTo("string",o(d)),g=Rn.transformTo("string",On.utf8encode(d)),_=f.length!==l.name.length,m=g.length!==d.length,v="",y="",b="",x=l.dir,w=l.date,T={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(T.crc32=t.crc32,T.compressedSize=t.compressedSize,T.uncompressedSize=t.uncompressedSize);var A=0;e&&(A|=8),h||!_&&!m||(A|=2048);var E,k,S=0,P=0;x&&(S|=16),"UNIX"===i?(P=798,S|=(k=E=l.unixPermissions,E||(k=x?16893:33204),(65535&k)<<16)):(P=20,S|=63&(l.dosPermissions||0)),s=w.getUTCHours(),s<<=6,s|=w.getUTCMinutes(),s<<=5,s|=w.getUTCSeconds()/2,a=w.getUTCFullYear()-1980,a<<=4,a|=w.getUTCMonth()+1,a<<=5,a|=w.getUTCDate(),_&&(y=os(1,1)+os(Xn(c),4)+f,v+="up"+os(y.length,2)+y),m&&(b=os(1,1)+os(Xn(p),4)+g,v+="uc"+os(b.length,2)+b);var M="";return M+="\n\0",M+=os(A,2),M+=u.magic,M+=os(s,2),M+=os(a,2),M+=os(T.crc32,4),M+=os(T.compressedSize,4),M+=os(T.uncompressedSize,4),M+=os(c.length,2),M+=os(v.length,2),{fileRecord:ol+M+c+v,dirRecord:ns+os(P,2)+M+os(p.length,2)+"\0\0\0\0"+os(S,4)+os(r,4)+c+v+p}},dl=function(t){return"PK\b"+os(t.crc32,4)+os(t.compressedSize,4)+os(t.uncompressedSize,4)};function as(t,e,n,r){Cn.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}Rn.inherits(as,Cn),as.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,Cn.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-r-1))/n:100}}))},as.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=ss(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},as.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=ss(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:dl(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},as.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=this.bytesWritten-t,r=function(t,e,n,r,i){var o=Rn.transformTo("string",i(r));return rs+"\0\0\0\0"+os(t,2)+os(t,2)+os(e,4)+os(n,4)+os(o.length,2)+o}(this.dirRecords.length,n,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},as.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},as.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},as.prototype.resume=function(){return!!Cn.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},as.prototype.error=function(t){var e=this._sources;if(!Cn.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},as.prototype.lock=function(){Cn.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()};var ls=as;function us(t,e){Cn.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}Rn.inherits(us,Cn),us.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},us.prototype.pause=function(){return!!Cn.prototype.pause.call(this)&&(this._stream.pause(),!0)},us.prototype.resume=function(){return!!Cn.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)};var hs=us,cs=function(t,e,n){var r,i=Rn.getTypeOf(e),o=Rn.extend(n||{},Zn);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(t=ds(t)),o.createFolders&&(r=fs(t))&&ps.call(this,r,!0);var a,s="string"===i&&!1===o.binary&&!1===o.base64;n&&void 0!==n.binary||(o.binary=!s),(e instanceof Qn&&0===e.uncompressedSize||o.dir||!e||0===e.length)&&(o.base64=!1,o.binary=!0,e="",o.compression="STORE",i="string"),a=e instanceof Qn||e instanceof Cn?e:Mi(e)?new hs(t,e):Rn.prepareContent(t,e,o.binary,o.optimizedBinaryString,o.base64);var l=new li(t,a,o);this.files[t]=l},fs=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},ds=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},ps=function(t,e){return e=void 0!==e?e:Zn.createFolders,t=ds(t),this.files[t]||cs.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function _s(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var ms={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,r))},filter:function(t){var e=[];return this.forEach((function(n,r){t(n,r)&&e.push(r)})),e},file:function(t,e,n){if(1===arguments.length){if(_s(t)){var r=t;return this.filter((function(t,e){return!e.dir&&r.test(t)}))}var i=this.files[this.root+t];return i&&!i.dir?i:null}return t=this.root+t,cs.call(this,t,e,n),this},folder:function(t){if(!t)return this;if(_s(t))return this.filter((function(e,n){return n.dir&&t.test(e)}));var e=this.root+t,n=ps.call(this,e),r=this.clone();return r.root=n.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter((function(e,n){return n.name.slice(0,t.length)===t})),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=Rn.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:On.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");Rn.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS"),e=function(t,e,n){var r=new ls(e.streamFiles,n,e.platform,e.encodeFileName),i=0;try{t.forEach((function(t,n){i++;var o=function(t,e){var n=t||e,r=is[n];if(!r)throw new Error(n+" is not a valid compression method !");return r}(n.options.compression,e.compression),s=n.options.compressionOptions||e.compressionOptions||{},a=n.dir,l=n.date;n._compressWorker(o,s).withStreamInfo("file",{name:t,dir:a,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(r)})),r.entriesCount=i}catch(t){r.error(t)}return r}(this,n,n.comment||this.comment||"")}catch(t){(e=new Cn("error")).error(t)}return new Gn(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};function gs(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}gs.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return Rn.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}};var vs=gs;function ys(t){vs.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}Rn.inherits(ys,vs),ys.prototype.byteAt=function(t){return this.data[this.zero+t]},ys.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),i=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===n&&this.data[o+2]===r&&this.data[o+3]===i)return o-this.zero;return-1},ys.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),i=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&n===o[1]&&r===o[2]&&i===o[3]},ys.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var bs=ys;function xs(t){vs.call(this,t)}Rn.inherits(xs,vs),xs.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},xs.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},xs.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},xs.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var ws=xs;function Ts(t){bs.call(this,t)}Rn.inherits(Ts,bs),Ts.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var As=Ts;function Es(t){As.call(this,t)}Rn.inherits(Es,As),Es.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var ks=Es,Ss=function(t){var e=Rn.getTypeOf(t);return Rn.checkSupport(e),"string"!==e||Ti.uint8array?"nodebuffer"===e?new ks(t):Ti.uint8array?new As(Rn.transformTo("uint8array",t)):new bs(Rn.transformTo("array",t)):new ws(t)};function Ps(t,e){this.options=t,this.loadOptions=e}Ps.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in is)if(is.hasOwnProperty(e)&&is[e].magic===t)return is[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+Rn.pretty(this.compressionMethod)+" unknown (inner file : "+Rn.transformTo("string",this.fileName)+")");this.decompressed=new Qn(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=Ss(this.extraFields[1].value);this.uncompressedSize===Rn.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===Rn.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===Rn.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===Rn.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,r,i=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<i;)e=t.readInt(2),n=t.readInt(2),r=t.readData(n),this.extraFields[e]={id:e,length:n,value:r}},handleUTF8:function(){var t=Ti.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=On.utf8decode(this.fileName),this.fileCommentStr=On.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=Rn.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var i=Rn.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=Ss(t.value);return 1!==e.readInt(1)||Xn(this.fileName)!==e.readInt(4)?null:On.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=Ss(t.value);return 1!==e.readInt(1)||Xn(this.fileComment)!==e.readInt(4)?null:On.utf8decode(e.readData(t.length-5))}return null}};var Ms=Ps;function zs(t){this.files=[],this.loadOptions=t}zs.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+Rn.pretty(e)+", expected "+Rn.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4)===e;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=Ti.uint8array?"uint8array":"array",n=Rn.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,r=this.zip64EndOfCentralSize-44;0<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(ol),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(ns);)(t=new Ms({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(rs);if(t<0)throw this.isSignature(0,ol)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(rs),this.readBlockEndOfCentral(),this.diskNumber===Rn.MAX_VALUE_16BITS||this.diskWithCentralDirStart===Rn.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===Rn.MAX_VALUE_16BITS||this.centralDirRecords===Rn.MAX_VALUE_16BITS||this.centralDirSize===Rn.MAX_VALUE_32BITS||this.centralDirOffset===Rn.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature("PK"))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature("PK"),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,ul)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(ul),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(ul),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=e-n;if(r>0)this.isSignature(e,ns)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(t){this.reader=Ss(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};var Rs=zs;function Ls(t){return new zn.Promise((function(e,n){var r=t.decompressed.getContentWorker().pipe(new Jn);r.on("error",(function(t){n(t)})).on("end",(function(){r.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}function Cs(){if(!(this instanceof Cs))return new Cs;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new Cs;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}Cs.prototype=ms,Cs.prototype.loadAsync=function(t,e){var n=this;return e=Rn.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:On.utf8decode}),Mi(t)?zn.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):Rn.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var n=new Rs(e);return n.load(t),n})).then((function(t){var n=[zn.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var i=0;i<r.length;i++)n.push(Ls(r[i]));return zn.Promise.all(n)})).then((function(t){for(var r=t.shift(),i=r.files,o=0;o<i.length;o++){var s=i[o];n.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n}))},Cs.support=Ti,Cs.defaults=Zn,Cs.version="3.1.5",Cs.loadAsync=function(t,e){return(new Cs).loadAsync(t,e)},Cs.external=zn;var Os=Cs;function Ns(t){return null==t}var Is=function(t){return"object"==typeof t&&null!==t},Fs=function(t){return Array.isArray(t)?t:Ns(t)?[]:[t]},Ds=function(t,e){var n,r="";for(n=0;n<e;n+=1)r+=t;return r},Bs=function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},js=function(t,e){var n,r,i,o;if(e)for(n=0,r=(o=Object.keys(e)).length;n<r;n+=1)t[i=o[n]]=e[i];return t};function Us(t,e){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=t,this.mark=e,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}Us.prototype=Object.create(Error.prototype),Us.prototype.constructor=Us,Us.prototype.toString=function(t){var e=this.name+": ";return e+=this.reason||"(unknown reason)",!t&&this.mark&&(e+=" "+this.mark.toString()),e};var Gs=Us;function Zs(t,e,n,r,i){this.name=t,this.buffer=e,this.position=n,this.line=r,this.column=i}Zs.prototype.getSnippet=function(t,e){var n,r,i,o,s;if(!this.buffer)return null;for(t=t||4,e=e||75,n="",r=this.position;r>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(r-=1,this.position-r>e/2-1){n=" ... ",r+=5;break}for(i="",o=this.position;o<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(o));)if((o+=1)-this.position>e/2-1){i=" ... ",o-=5;break}return s=this.buffer.slice(r,o),Ds(" ",t)+n+s+i+"\n"+Ds(" ",t+this.position-r+n.length)+"^"},Zs.prototype.toString=function(t){var e,n="";return this.name&&(n+='in "'+this.name+'" '),n+="at line "+(this.line+1)+", column "+(this.column+1),t||(e=this.getSnippet())&&(n+=":\n"+e),n};var Vs=Zs,qs=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],Ws=["scalar","sequence","mapping"],Hs=function(t,e){var n,r;if(e=e||{},Object.keys(e).forEach((function(e){if(-1===qs.indexOf(e))throw new Gs('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.defaultStyle=e.defaultStyle||null,this.styleAliases=(n=e.styleAliases||null,r={},null!==n&&Object.keys(n).forEach((function(t){n[t].forEach((function(e){r[String(e)]=t}))})),r),-1===Ws.indexOf(this.kind))throw new Gs('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function Ys(t,e,n){var r=[];return t.include.forEach((function(t){n=Ys(t,e,n)})),t[e].forEach((function(t){n.forEach((function(e,n){e.tag===t.tag&&r.push(n)})),n.push(t)})),n.filter((function(t,e){return-1===r.indexOf(e)}))}function Xs(t){this.include=t.include||[],this.implicit=t.implicit||[],this.explicit=t.explicit||[],this.implicit.forEach((function(t){if(t.loadKind&&"scalar"!==t.loadKind)throw new Gs("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")})),this.compiledImplicit=Ys(this,"implicit",[]),this.compiledExplicit=Ys(this,"explicit",[]),this.compiledTypeMap=function(){var t,e,n={};function r(t){n[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(r);return n}(this.compiledImplicit,this.compiledExplicit)}Xs.DEFAULT=null,Xs.create=function(){var t,e;switch(arguments.length){case 1:t=Xs.DEFAULT,e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Gs("Wrong number of arguments for Schema.create function")}if(t=Fs(t),e=Fs(e),!t.every((function(t){return t instanceof Xs})))throw new Gs("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!e.every((function(t){return t instanceof Hs})))throw new Gs("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new Xs({include:t,explicit:e})};var $s=Xs,Js=new $s({explicit:[new Hs("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),new Hs("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),new Hs("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}})]}),Ks=new Hs("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"}),Qs=new Hs("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function ta(t){return 48<=t&&t<=55}function ea(t){return 48<=t&&t<=57}var ia,na=new Hs("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,r=t.length,i=0,o=!1;if(!r)return!1;if("-"!==(e=t[i])&&"+"!==e||(e=t[++i]),"0"===e){if(i+1===r)return!0;if("b"===(e=t[++i])){for(i++;i<r;i++)if("_"!==(e=t[i])){if("0"!==e&&"1"!==e)return!1;o=!0}return o}if("x"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!(48<=(n=t.charCodeAt(i))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;o=!0}return o}for(;i<r;i++)if("_"!==(e=t[i])){if(!ta(t.charCodeAt(i)))return!1;o=!0}return o}for(;i<r;i++)if("_"!==(e=t[i])){if(":"===e)break;if(!ea(t.charCodeAt(i)))return!1;o=!0}return!!o&&(":"!==e||/^(:[0-5]?[0-9])+$/.test(t.slice(i)))},construct:function(t){var e,n,r=t,i=1,o=[];return-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(e=r[0])&&"+"!==e||("-"===e&&(i=-1),e=(r=r.slice(1))[0]),"0"===r?0:"0"===e?"b"===r[1]?i*parseInt(r.slice(2),2):"x"===r[1]?i*parseInt(r,16):i*parseInt(r,8):-1!==r.indexOf(":")?(r.split(":").forEach((function(t){o.unshift(parseInt(t,10))})),r=0,n=1,o.forEach((function(t){r+=t*n,n*=60})),i*r):i*parseInt(r,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!Bs(t)},represent:{binary:function(t){return"0b"+t.toString(2)},octal:function(t){return"0"+t.toString(8)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return"0x"+t.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ra=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),oa=/^[-+]?[0-9]+e/,sa=new $s({include:[Js],implicit:[Ks,Qs,na,new Hs("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!!ra.test(t)},construct:function(t){var e,n,r,i;return n="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,i=[],"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:e.indexOf(":")>=0?(e.split(":").forEach((function(t){i.unshift(parseFloat(t,10))})),e=0,r=1,i.forEach((function(t){e+=t*r,r*=60})),n*e):n*parseFloat(e,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||Bs(t))},represent:function(t,e){var n;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Bs(t))return"-0.0";return n=t.toString(10),oa.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"})]}),aa=new $s({include:[sa]}),la=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$"),ua=new Hs("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&null!==la.exec(t)},construct:function(t){var e,n,r,i,o,s,a,l,u=0,h=null;if(null===(e=la.exec(t)))throw new Error("Date resolve error");if(n=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(n,r,i));if(o=+e[4],s=+e[5],a=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(h=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(h=-h)),l=new Date(Date.UTC(n,r,i,o,s,a,u)),h&&l.setTime(l.getTime()-h),l},instanceOf:Date,represent:function(t){return t.toISOString()}}),ha=new Hs("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),ca={}.Buffer,fa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r",da=new Hs("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,r=0,i=t.length,o=fa;for(n=0;n<i;n++)if(!((e=o.indexOf(t.charAt(n)))>64)){if(e<0)return!1;r+=6}return r%8==0},construct:function(t){var e,n,r=t.replace(/[\r\n=]/g,""),i=r.length,o=fa,s=0,a=[];for(e=0;e<i;e++)e%4==0&&e&&(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)),s=s<<6|o.indexOf(r.charAt(e));return 0==(n=i%4*6)?(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)):18===n?(a.push(s>>10&255),a.push(s>>2&255)):12===n&&a.push(s>>4&255),a},predicate:function(t){return ca&&ca.isBuffer(t)},represent:function(t){var e,n,r="",i=0,o=t.length,s=fa;for(e=0;e<o;e++)e%3==0&&e&&(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]),i=(i<<8)+t[e];return 0==(n=o%3)?(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]):2===n?(r+=s[i>>10&63],r+=s[i>>4&63],r+=s[i<<2&63],r+=s[64]):1===n&&(r+=s[i>>2&63],r+=s[i<<4&63],r+=s[64],r+=s[64]),r}}),pa=Object.prototype.hasOwnProperty,_a=Object.prototype.toString,ma=new Hs("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,r,i,o,s=[],a=t;for(e=0,n=a.length;e<n;e+=1){if(r=a[e],o=!1,"[object Object]"!==_a.call(r))return!1;for(i in r)if(pa.call(r,i)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==s.indexOf(i))return!1;s.push(i)}return!0},construct:function(t){return null!==t?t:[]}}),ga=Object.prototype.toString,va=new Hs("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,r,i,o,s=t;for(o=new Array(s.length),e=0,n=s.length;e<n;e+=1){if(r=s[e],"[object Object]"!==ga.call(r))return!1;if(1!==(i=Object.keys(r)).length)return!1;o[e]=[i[0],r[i[0]]]}return!0},construct:function(t){if(null===t)return[];var e,n,r,i,o,s=t;for(o=new Array(s.length),e=0,n=s.length;e<n;e+=1)r=s[e],i=Object.keys(r),o[e]=[i[0],r[i[0]]];return o}}),ya=Object.prototype.hasOwnProperty,ba=new $s({include:[aa],implicit:[ua,ha],explicit:[da,ma,va,new Hs("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,n=t;for(e in n)if(ya.call(n,e)&&null!==n[e])return!1;return!0},construct:function(t){return null!==t?t:{}}})]}),xa=new Hs("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(t){return void 0===t},represent:function(){return""}}),wa=new Hs("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(t){if(null===t)return!1;if(0===t.length)return!1;var e=t,n=/\/([gim]*)$/.exec(t),r="";if("/"===e[0]){if(n&&(r=n[1]),r.length>3)return!1;if("/"!==e[e.length-r.length-1])return!1}return!0},construct:function(t){var e=t,n=/\/([gim]*)$/.exec(t),r="";return"/"===e[0]&&(n&&(r=n[1]),e=e.slice(1,e.length-r.length-1)),new RegExp(e,r)},predicate:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},represent:function(t){var e="/"+t.source+"/";return t.global&&(e+="g"),t.multiline&&(e+="m"),t.ignoreCase&&(e+="i"),e}});try{var Ta=t.commonjsRequire;ia=Ta("esprima")}catch(t){"undefined"!=typeof window&&(ia=window.esprima)}var Aa=new Hs("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(t){if(null===t)return!1;try{var e="("+t+")",n=ia.parse(e,{range:!0});return"Program"===n.type&&1===n.body.length&&"ExpressionStatement"===n.body[0].type&&"FunctionExpression"===n.body[0].expression.type}catch(t){return!1}},construct:function(t){var e,n="("+t+")",r=ia.parse(n,{range:!0}),i=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach((function(t){i.push(t.name)})),e=r.body[0].expression.body.range,new Function(i,n.slice(e[0]+1,e[1]-1))},predicate:function(t){return"[object Function]"===Object.prototype.toString.call(t)},represent:function(t){return t.toString()}}),Ea=$s.DEFAULT=new $s({include:[ba],explicit:[xa,wa,Aa]}),ka=Object.prototype.hasOwnProperty,Sa=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Pa=/[\x85\u2028\u2029]/,Ma=/[,\[\]\{\}]/,za=/^(?:!|!!|![a-z\-]+!)$/i,Ra=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function La(t){return 10===t||13===t}function Ca(t){return 9===t||32===t}function Oa(t){return 9===t||32===t||10===t||13===t}function Na(t){return 44===t||91===t||93===t||123===t||125===t}function Ia(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function Fa(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?" ":76===t?"\u2028":80===t?"\u2029":""}function Da(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var Ba=new Array(256),ja=new Array(256),Ua=0;Ua<256;Ua++)Ba[Ua]=Fa(Ua)?1:0,ja[Ua]=Fa(Ua);function Ga(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||Ea,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function Za(t,e){return new Gs(e,new Vs(t.filename,t.input,t.position,t.line,t.position-t.lineStart))}function th(t,e){throw Za(t,e)}function Va(t,e){t.onWarning&&t.onWarning.call(null,Za(t,e))}var qa={YAML:function(t,e,n){var r,i,o;null!==t.version&&th(t,"duplication of %YAML directive"),1!==n.length&&th(t,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&th(t,"ill-formed argument of the YAML directive"),i=parseInt(r[1],10),o=parseInt(r[2],10),1!==i&&th(t,"unacceptable YAML version of the document"),t.version=n[0],t.checkLineBreaks=o<2,1!==o&&2!==o&&Va(t,"unsupported YAML version of the document")},TAG:function(t,e,n){var r,i;2!==n.length&&th(t,"TAG directive accepts exactly two arguments"),r=n[0],i=n[1],za.test(r)||th(t,"ill-formed tag handle (first argument) of the TAG directive"),ka.call(t.tagMap,r)&&th(t,'there is a previously declared suffix for "'+r+'" tag handle'),Ra.test(i)||th(t,"ill-formed tag prefix (second argument) of the TAG directive"),t.tagMap[r]=i}};function Wa(t,e,n,r){var i,o,s,a;if(e<n){if(a=t.input.slice(e,n),r)for(i=0,o=a.length;i<o;i+=1)9===(s=a.charCodeAt(i))||32<=s&&s<=1114111||th(t,"expected valid JSON character");else Sa.test(a)&&th(t,"the stream contains non-printable characters");t.result+=a}}function Ha(t,e,n,r){var i,o,s,a;for(Is(n)||th(t,"cannot merge mappings; the provided source object is unacceptable"),s=0,a=(i=Object.keys(n)).length;s<a;s+=1)o=i[s],ka.call(e,o)||(e[o]=n[o],r[o]=!0)}function Ya(t,e,n,r,i,o){var s,a;if(i=String(i),null===e&&(e={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(s=0,a=o.length;s<a;s+=1)Ha(t,e,o[s],n);else Ha(t,e,o,n);else t.json||ka.call(n,i)||!ka.call(e,i)||th(t,"duplicated mapping key"),e[i]=o,delete n[i];return e}function Xa(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):th(t,"a line break is expected"),t.line+=1,t.lineStart=t.position}function $a(t,e,n){for(var r=0,i=t.input.charCodeAt(t.position);0!==i;){for(;Ca(i);)i=t.input.charCodeAt(++t.position);if(e&&35===i)do{i=t.input.charCodeAt(++t.position)}while(10!==i&&13!==i&&0!==i);if(!La(i))break;for(Xa(t),i=t.input.charCodeAt(t.position),r++,t.lineIndent=0;32===i;)t.lineIndent++,i=t.input.charCodeAt(++t.position)}return-1!==n&&0!==r&&t.lineIndent<n&&Va(t,"deficient indentation"),r}function Ja(t){var e,n=t.position;return!(45!==(e=t.input.charCodeAt(n))&&46!==e||e!==t.input.charCodeAt(n+1)||e!==t.input.charCodeAt(n+2)||(n+=3,0!==(e=t.input.charCodeAt(n))&&!Oa(e)))}function Ka(t,e){1===e?t.result+=" ":e>1&&(t.result+=Ds("\n",e-1))}function Qa(t,e){var n,r,i=t.tag,o=t.anchor,s=[],a=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=s),r=t.input.charCodeAt(t.position);0!==r&&45===r&&Oa(t.input.charCodeAt(t.position+1));)if(a=!0,t.position++,$a(t,!0,-1)&&t.lineIndent<=e)s.push(null),r=t.input.charCodeAt(t.position);else if(n=t.line,il(t,e,3,!1,!0),s.push(t.result),$a(t,!0,-1),r=t.input.charCodeAt(t.position),(t.line===n||t.lineIndent>e)&&0!==r)th(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!a&&(t.tag=i,t.anchor=o,t.kind="sequence",t.result=s,!0)}function tl(t){var e,n,r,i,o=!1,s=!1;if(33!==(i=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&th(t,"duplication of a tag property"),60===(i=t.input.charCodeAt(++t.position))?(o=!0,i=t.input.charCodeAt(++t.position)):33===i?(s=!0,n="!!",i=t.input.charCodeAt(++t.position)):n="!",e=t.position,o){do{i=t.input.charCodeAt(++t.position)}while(0!==i&&62!==i);t.position<t.length?(r=t.input.slice(e,t.position),i=t.input.charCodeAt(++t.position)):th(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==i&&!Oa(i);)33===i&&(s?th(t,"tag suffix cannot contain exclamation marks"):(n=t.input.slice(e-1,t.position+1),za.test(n)||th(t,"named tag handle cannot contain such characters"),s=!0,e=t.position+1)),i=t.input.charCodeAt(++t.position);r=t.input.slice(e,t.position),Ma.test(r)&&th(t,"tag suffix cannot contain flow indicator characters")}return r&&!Ra.test(r)&&th(t,"tag name cannot contain such characters: "+r),o?t.tag=r:ka.call(t.tagMap,n)?t.tag=t.tagMap[n]+r:"!"===n?t.tag="!"+r:"!!"===n?t.tag="tag:yaml.org,2002:"+r:th(t,'undeclared tag handle "'+n+'"'),!0}function el(t){var e,n;if(38!==(n=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&th(t,"duplication of an anchor property"),n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!Oa(n)&&!Na(n);)n=t.input.charCodeAt(++t.position);return t.position===e&&th(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function il(t,e,n,r,i){var o,s,a,l,u,h,c,f,d=1,p=!1,g=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=s=a=4===n||3===n,r&&$a(t,!0,-1)&&(p=!0,t.lineIndent>e?d=1:t.lineIndent===e?d=0:t.lineIndent<e&&(d=-1)),1===d)for(;tl(t)||el(t);)$a(t,!0,-1)?(p=!0,a=o,t.lineIndent>e?d=1:t.lineIndent===e?d=0:t.lineIndent<e&&(d=-1)):a=!1;if(a&&(a=p||i),1!==d&&4!==n||(c=1===n||2===n?e:e+1,f=t.position-t.lineStart,1===d?a&&(Qa(t,f)||function(t,e,n){var r,i,o,s,a=t.tag,l=t.anchor,u={},h={},c=null,f=null,d=null,p=!1,g=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=u),s=t.input.charCodeAt(t.position);0!==s;){if(r=t.input.charCodeAt(t.position+1),o=t.line,63!==s&&58!==s||!Oa(r)){if(!il(t,n,2,!1,!0))break;if(t.line===o){for(s=t.input.charCodeAt(t.position);Ca(s);)s=t.input.charCodeAt(++t.position);if(58===s)Oa(s=t.input.charCodeAt(++t.position))||th(t,"a whitespace character is expected after the key-value separator within a block mapping"),p&&(Ya(t,u,h,c,f,null),c=f=d=null),g=!0,p=!1,i=!1,c=t.tag,f=t.result;else{if(!g)return t.tag=a,t.anchor=l,!0;th(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!g)return t.tag=a,t.anchor=l,!0;th(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(p&&(Ya(t,u,h,c,f,null),c=f=d=null),g=!0,p=!0,i=!0):p?(p=!1,i=!0):th(t,"incomplete explicit mapping pair; a key node is missed"),t.position+=1,s=r;if((t.line===o||t.lineIndent>e)&&(il(t,e,4,!0,i)&&(p?f=t.result:d=t.result),p||(Ya(t,u,h,c,f,d),c=f=d=null),$a(t,!0,-1),s=t.input.charCodeAt(t.position)),t.lineIndent>e&&0!==s)th(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return p&&Ya(t,u,h,c,f,null),g&&(t.tag=a,t.anchor=l,t.kind="mapping",t.result=u),g}(t,f,c))||function(t,e){var n,r,i,o,s,a,l,u,h,c,f=!0,d=t.tag,p=t.anchor,g={};if(91===(c=t.input.charCodeAt(t.position)))i=93,a=!1,r=[];else{if(123!==c)return!1;i=125,a=!0,r={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=r),c=t.input.charCodeAt(++t.position);0!==c;){if($a(t,!0,e),(c=t.input.charCodeAt(t.position))===i)return t.position++,t.tag=d,t.anchor=p,t.kind=a?"mapping":"sequence",t.result=r,!0;f||th(t,"missed comma between flow collection entries"),h=null,o=s=!1,63===c&&Oa(t.input.charCodeAt(t.position+1))&&(o=s=!0,t.position++,$a(t,!0,e)),n=t.line,il(t,e,1,!1,!0),u=t.tag,l=t.result,$a(t,!0,e),c=t.input.charCodeAt(t.position),!s&&t.line!==n||58!==c||(o=!0,c=t.input.charCodeAt(++t.position),$a(t,!0,e),il(t,e,1,!1,!0),h=t.result),a?Ya(t,r,g,u,l,h):o?r.push(Ya(t,null,g,u,l,h)):r.push(l),$a(t,!0,e),44===(c=t.input.charCodeAt(t.position))?(f=!0,c=t.input.charCodeAt(++t.position)):f=!1}th(t,"unexpected end of the stream within a flow collection")}(t,c)?g=!0:(s&&function(t,e){var n,r,i,o,s,a=1,l=!1,u=e,h=0,c=!1;if(124===(o=t.input.charCodeAt(t.position)))r=!1;else{if(62!==o)return!1;r=!0}for(t.kind="scalar",t.result="";0!==o;)if(43===(o=t.input.charCodeAt(++t.position))||45===o)1===a?a=43===o?3:2:th(t,"repeat of a chomping mode identifier");else{if(!((i=48<=(s=o)&&s<=57?s-48:-1)>=0))break;0===i?th(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?th(t,"repeat of an indentation width identifier"):(u=e+i-1,l=!0)}if(Ca(o)){do{o=t.input.charCodeAt(++t.position)}while(Ca(o));if(35===o)do{o=t.input.charCodeAt(++t.position)}while(!La(o)&&0!==o)}for(;0!==o;){for(Xa(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!l||t.lineIndent<u)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!l&&t.lineIndent>u&&(u=t.lineIndent),La(o))h++;else{if(t.lineIndent<u){3===a?t.result+=Ds("\n",h):1===a&&l&&(t.result+="\n");break}for(r?Ca(o)?(c=!0,t.result+=Ds("\n",h+1)):c?(c=!1,t.result+=Ds("\n",h+1)):0===h?l&&(t.result+=" "):t.result+=Ds("\n",h):t.result+=Ds("\n",l?h+1:h),l=!0,h=0,n=t.position;!La(o)&&0!==o;)o=t.input.charCodeAt(++t.position);Wa(t,n,t.position,!1)}}return!0}(t,c)||function(t,e){var n,r,i;if(39!==(n=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,r=i=t.position;0!==(n=t.input.charCodeAt(t.position));)if(39===n){if(Wa(t,r,t.position,!0),39!==(n=t.input.charCodeAt(++t.position)))return!0;r=i=t.position,t.position++}else La(n)?(Wa(t,r,i,!0),Ka(t,$a(t,!1,e)),r=i=t.position):t.position===t.lineStart&&Ja(t)?th(t,"unexpected end of the document within a single quoted scalar"):(t.position++,i=t.position);th(t,"unexpected end of the stream within a single quoted scalar")}(t,c)||function(t,e){var n,r,i,o,s,a,l;if(34!==(a=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,n=r=t.position;0!==(a=t.input.charCodeAt(t.position));){if(34===a)return Wa(t,n,t.position,!0),t.position++,!0;if(92===a){if(Wa(t,n,t.position,!0),La(a=t.input.charCodeAt(++t.position)))$a(t,!1,e);else if(a<256&&Ba[a])t.result+=ja[a],t.position++;else if((s=120===(l=a)?2:117===l?4:85===l?8:0)>0){for(i=s,o=0;i>0;i--)(s=Ia(a=t.input.charCodeAt(++t.position)))>=0?o=(o<<4)+s:th(t,"expected hexadecimal character");t.result+=Da(o),t.position++}else th(t,"unknown escape sequence");n=r=t.position}else La(a)?(Wa(t,n,r,!0),Ka(t,$a(t,!1,e)),n=r=t.position):t.position===t.lineStart&&Ja(t)?th(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}th(t,"unexpected end of the stream within a double quoted scalar")}(t,c)?g=!0:function(t){var e,n,r;if(42!==(r=t.input.charCodeAt(t.position)))return!1;for(r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!Oa(r)&&!Na(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&th(t,"name of an alias node must contain at least one character"),n=t.input.slice(e,t.position),t.anchorMap.hasOwnProperty(n)||th(t,'unidentified alias "'+n+'"'),t.result=t.anchorMap[n],$a(t,!0,-1),!0}(t)?(g=!0,null===t.tag&&null===t.anchor||th(t,"alias node should not have any properties")):function(t,e,n){var r,i,o,s,a,l,u,h,c=t.kind,f=t.result;if(Oa(h=t.input.charCodeAt(t.position))||Na(h)||35===h||38===h||42===h||33===h||124===h||62===h||39===h||34===h||37===h||64===h||96===h)return!1;if((63===h||45===h)&&(Oa(r=t.input.charCodeAt(t.position+1))||n&&Na(r)))return!1;for(t.kind="scalar",t.result="",i=o=t.position,s=!1;0!==h;){if(58===h){if(Oa(r=t.input.charCodeAt(t.position+1))||n&&Na(r))break}else if(35===h){if(Oa(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&Ja(t)||n&&Na(h))break;if(La(h)){if(a=t.line,l=t.lineStart,u=t.lineIndent,$a(t,!1,-1),t.lineIndent>=e){s=!0,h=t.input.charCodeAt(t.position);continue}t.position=o,t.line=a,t.lineStart=l,t.lineIndent=u;break}}s&&(Wa(t,i,o,!1),Ka(t,t.line-a),i=o=t.position,s=!1),Ca(h)||(o=t.position+1),h=t.input.charCodeAt(++t.position)}return Wa(t,i,o,!1),!!t.result||(t.kind=c,t.result=f,!1)}(t,c,1===n)&&(g=!0,null===t.tag&&(t.tag="?")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===d&&(g=a&&Qa(t,f))),null!==t.tag&&"!"!==t.tag)if("?"===t.tag){for(l=0,u=t.implicitTypes.length;l<u;l+=1)if((h=t.implicitTypes[l]).resolve(t.result)){t.result=h.construct(t.result),t.tag=h.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else ka.call(t.typeMap,t.tag)?(h=t.typeMap[t.tag],null!==t.result&&h.kind!==t.kind&&th(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+h.kind+'", not "'+t.kind+'"'),h.resolve(t.result)?(t.result=h.construct(t.result),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):th(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")):th(t,"unknown tag !<"+t.tag+">");return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||g}function nl(t){var e,n,r,i,o=t.position,s=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap={},t.anchorMap={};0!==(i=t.input.charCodeAt(t.position))&&($a(t,!0,-1),i=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==i));){for(s=!0,i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!Oa(i);)i=t.input.charCodeAt(++t.position);for(r=[],(n=t.input.slice(e,t.position)).length<1&&th(t,"directive name must not be less than one character in length");0!==i;){for(;Ca(i);)i=t.input.charCodeAt(++t.position);if(35===i){do{i=t.input.charCodeAt(++t.position)}while(0!==i&&!La(i));break}if(La(i))break;for(e=t.position;0!==i&&!Oa(i);)i=t.input.charCodeAt(++t.position);r.push(t.input.slice(e,t.position))}0!==i&&Xa(t),ka.call(qa,n)?qa[n](t,n,r):Va(t,'unknown document directive "'+n+'"')}$a(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,$a(t,!0,-1)):s&&th(t,"directives end mark is expected"),il(t,t.lineIndent-1,4,!1,!0),$a(t,!0,-1),t.checkLineBreaks&&Pa.test(t.input.slice(o,t.position))&&Va(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&Ja(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,$a(t,!0,-1)):t.position<t.length-1&&th(t,"end of the stream or a document separator is expected")}function rl(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var n=new Ga(t,e);for(n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)nl(n);return n.documents}function sl(t,e,n){var r,i,o=rl(t,n);for(r=0,i=o.length;r<i;r+=1)e(o[r])}function al(t,e){var n=rl(t,e);if(0!==n.length){if(1===n.length)return n[0];throw new Gs("expected a single document in the stream, but found more")}}var ll={loadAll:sl,load:al,safeLoadAll:function(t,e,n){sl(t,e,js({schema:ba},n))},safeLoad:function(t,e){return al(t,js({schema:ba},e))}};function hl(t){return function(){throw new Error("Function "+t+" is deprecated and cannot be used.")}}var cl,fl={Type:Hs,Schema:$s,FAILSAFE_SCHEMA:Js,JSON_SCHEMA:sa,CORE_SCHEMA:aa,DEFAULT_SAFE_SCHEMA:ba,DEFAULT_FULL_SCHEMA:Ea,load:ll.load,loadAll:ll.loadAll,safeLoad:ll.safeLoad,safeLoadAll:ll.safeLoadAll,YAMLException:Gs,MINIMAL_SCHEMA:Js,SAFE_SCHEMA:ba,DEFAULT_SCHEMA:Ea,scan:hl("scan"),parse:hl("parse"),compose:hl("compose"),addConstructor:hl("addConstructor")},pl=function(){function e(e,n,r){void 0===r&&(r=null),this.url=e,!n||t.isRelativeURL(n)&&!t.isRelativeURL(this.url)?this.path=t.pathForURL(this.url):this.path=n,this.path_for_parent=n||this.path,this.parent=r,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}var n=e.prototype;return n.load=function(){return gl(this.url)},n.resourceFor=function(t){return{url:this.urlFor(t),path:this.pathFor(t),type:this.typeFor(t)}},n.urlFor=function(e){return ml(e)?e:t.isRelativeURL(e)&&this.container?this.parent.urlFor(this.path_for_parent+e):t.addBaseURL(e,this.path)},n.pathFor=function(e){return t.pathForURL(e)},n.typeFor=function(e){return t.extensionForURL(e)},n.isContainer=function(){return!1},e}(),_l=function(e){function n(t,n,r){var i;return(i=e.call(this,t,n,r)||this).zip=null,i.files={},i.root=null,i.path="",i}t._inheritsLoose(n,e);var r=n.prototype;return r.isContainer=function(){return!0},r.load=function(){return new Promise(function(e,n){var r;return this.zip=new Os,"string"==typeof this.url?Promise.resolve(t.Utils.io(this.url,6e4,"arraybuffer")).then(function(t){try{return r=t.body,Promise.resolve(this.zip.loadAsync(r)).then(function(t){try{return Promise.resolve(this.parseZipFiles()).then(function(t){try{return e(this.loadRoot())}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n):e(this)}.bind(this))},r.urlFor=function(n){return ml(n)?n:t.isRelativeURL(n)?this.urlForZipFile(t.flattenRelativeURL(n)):e.prototype.urlFor.call(this,n)},r.typeFor=function(n){return t.isRelativeURL(n)?this.typeForZipFile(n):e.prototype.typeFor.call(this,n)},r.loadRoot=function(){return this.findRoot(),gl(this.urlForZipFile(this.root))},r.findRoot=function(){var e=this,n=Object.keys(this.files).filter((function(t){return 0===e.files[t].depth})).filter((function(e){return"yaml"===t.extensionForURL(e)}));if(1===n.length&&(this.root=n[0]),!this.root){var r="Could not find root scene for bundle '"+this.url+"': ";throw r+="The zip archive's root level must contain a single scene file with the '.yaml' extension. ",n.length>0?r+="Found multiple YAML files at the root level: "+n.map((function(t){return"'"+t+"'"})).join(", ")+".":r+="Found NO YAML files at the root level.",Error(r)}},r.parseZipFiles=function(){return new Promise(function(e,n){var r,i,o,s,a,l;return r=[],i=[],this.zip.forEach((function(t,e){e.dir||(r.push(t),i.push(e.async("arraybuffer")))})),Promise.resolve(Promise.all(i)).then(function(i){try{for(o=i,s=0;s<o.length;s++)a=r[s],l=a.split("/").length-1,this.files[a]={data:o[s],type:t.extensionForURL(a),depth:l};return e()}catch(t){return n(t)}}.bind(this),n)}.bind(this))},r.urlForZipFile=function(e){if(this.files[e])return this.files[e].url||(this.files[e].url=t.createObjectURL(new Blob([this.files[e].data]))),this.files[e].url},r.typeForZipFile=function(t){return this.files[t]&&this.files[t].type},n}(pl);function ml(t){return!(!t||"global."!==t.slice(0,7))}function gl(e){return new Promise((function(n,r){"string"==typeof e?t.Utils.io(e).then((function(t){var e=t.body;try{n(function(t){var e;try{e=fl.safeLoad(t,{json:!0})}catch(t){throw t}return e}(e))}catch(t){r(t)}}),r):(e=Object.assign({},e),n(e))}))}var vl=cl={loadScene:function(e,n){return new Promise(function(r,i){var o,s,a,l,u,h,c,f,d;return o=this,a=(s=void 0===n?{}:n).path,l=s.type,u=[],Promise.resolve(this.loadSceneRecursive({url:e,path:a,type:l},null,u)).then(function(e){try{return h=e,c=this.finalize(h),f=c.config,d=c.bundle,f?(u.length>0&&u.forEach((function(e){var n="Failed to import scene: "+e.url;t.log("error",n,e),o.trigger("error",{type:"scene_import",message:n,error:e,url:e.url})})),r({config:f,bundle:d})):i(u[0])}catch(t){return i(t)}}.bind(this),i)}.bind(this))},loadSceneRecursive:function(e,n,r){return new Promise(function(i,o){var s,a,l,u,h,c,f,d,p;if(s=this,a=e.url,l=e.path,u=e.type,void 0===r&&(r=[]),!a)return i({});h=function(e,n,r,i){return void 0===i&&(i=null),null!=i&&"zip"===i||"string"==typeof e&&!t.isLocalURL(e)&&"zip"===t.extensionForURL(e)?new _l(e,n,r):new pl(e,n,r)}(a,l,n,u);var g=function(t){try{return t.url=a,r.push(t),i({})}catch(t){return o(t)}};try{return Promise.resolve(h.load()).then(function(e){try{return null==(c=e).import?(this.normalize(c,h),i({config:c,bundle:h})):(Array.isArray(c.import)||(c.import=[c.import]),f=[],c.import.forEach((function(e){"object"==typeof e&&(e=t.createObjectURL(new Blob([JSON.stringify(e)]))),f.push(h.resourceFor(e))})),delete c.import,d=f.map((function(t){return s.loadSceneRecursive(t,h,r)})),Promise.resolve(Promise.all(d)).then(function(e){try{return p=e.map((function(t){return s.normalize(t.config,t.bundle)})).map((function(t){return t.config})),c=t.mergeObjects.apply(void 0,p.concat([c])),this.normalize(c,h),i({config:c,bundle:h})}catch(t){return g(t)}}.bind(this),g))}catch(t){return g(t)}}.bind(this),g)}catch(t){g(t)}}.bind(this))},normalize:function(t,e){return this.normalizeDataSources(t,e),this.normalizeFonts(t,e),this.normalizeTextures(t,e),this.hoistTextures(t,e),{config:t,bundle:e}},normalizeDataSources:function(t,e){for(var n in t.sources=t.sources||{},t.sources)this.normalizeDataSource(t.sources[n],e);return t},normalizeDataSource:function(t,e){if(t.url=e.urlFor(t.url),Array.isArray(t.composite)&&t.composite.forEach((function(t){return t.url=e.urlFor(t.url)})),t.scripts)for(var n in Array.isArray(t.scripts)&&(t.scripts=t.scripts.reduce((function(t,e){return t[e]=e,t}),{})),t.scripts)t.scripts[n]=e.urlFor(t.scripts[n]);return t},normalizeFonts:function(t,e){for(var n in t.fonts=t.fonts||{},t.fonts)if(Array.isArray(t.fonts[n]))t.fonts[n].forEach((function(t){t.url=t.url&&e.urlFor(t.url)}));else{var r=t.fonts[n];r.url=r.url&&e.urlFor(r.url)}return t},normalizeTextures:function(t,e){if(t.textures=t.textures||{},t.textures)for(var n in t.textures){var r=t.textures[n];r.url&&(r.url=e.urlFor(r.url))}},hoistTextures:function(e,n){var r=this;if(e.styles){var i=function(t){var i=e.styles[t],o=i.texture;"string"!=typeof o||e.textures[o]||(i.texture=r.hoistTexture(o,e,n)),i.material&&["emission","ambient","diffuse","specular","normal"].forEach((function(t){var o=null!=i.material[t]&&i.material[t].texture;"string"!=typeof o||e.textures[o]||(i.material[t].texture=r.hoistTexture(o,e,n))}))};for(var o in e.styles)i(o)}if(this.hoistStyleShaderUniformTextures(e,n,{include_globals:!1}),e.layers)for(var s=[e.layers];s.length>0;){var a=s.pop();if("object"==typeof a&&!Array.isArray(a))for(var l in a)if("draw"===l){var u=a[l];for(var h in u){if(u[h].texture){var c=u[h].texture;"string"!=typeof c||e.textures[c]||(u[h].texture=this.hoistTexture(c,e,n))}if(u[h].outline&&u[h].outline.texture){var f=u[h].outline.texture;"string"!=typeof f||e.textures[f]||(u[h].outline.texture=this.hoistTexture(f,e,n))}}}else{if(t.isReserved(l))continue;s.push(a[l])}}},hoistStyleShaderUniformTextures:function(e,n,r){var i=this,o=r.include_globals;if(e.styles)for(var s in e.styles){var a=e.styles[s];a.shaders&&a.shaders.uniforms&&t.GLSL.parseUniforms(a.shaders.uniforms).forEach((function(t){var r=t.type,s=t.value,a=t.key,l=t.uniforms;"sampler2D"!==r||"string"!=typeof s||e.textures[s]||!o&&ml(s)||(l[a]=i.hoistTexture(s,e,n))}))}},hoistTexture:function(t,e,n){var r=ml(t),i=r?t:n.urlFor(t),o=r?"texture-"+i:i;return e.textures[o]={url:i},o},applyGlobalProperties:function(e){if(!e.global||0===Object.keys(e.global).length)return e;var n=function t(e,n,r){for(var i in void 0===n&&(n=null),void 0===r&&(r={}),n=n?n+".":"global.",e){var o=n+i,s=e[i];r[o]=s,"object"!=typeof s||Array.isArray(s)||t(s,o,r)}return r}(e.global);return function e(r,i,o){var s;if(null!=i&&"object"==typeof i&&i._global_prop&&i._global_prop[o]?s=i._global_prop[o]:"string"==typeof r&&"global."===r.slice(0,7)&&(s=r),s){null==i._global_prop&&Object.defineProperty(i,"_global_prop",{value:{}}),i._global_prop[o]=s;for(var a,l=n[s];"string"==typeof l&&"global."===l.slice(0,7);){if((a=a||[s]).indexOf(l)>-1){t.log({level:"warn",once:!0},"Global properties: cyclical reference detected",a),l=null;break}a.push(l),l=n[l]}Object.defineProperty(i,o,{enumerable:!0,get:function(){return l},set:function(t){delete i._global_prop[o],delete i[o],i[o]=t}})}else if(Array.isArray(r))for(var u=0;u<r.length;u++)e(r[u],r,u);else if("object"==typeof r)for(var h in r)e(r[h],r,h);return r}(e)},finalize:function(t){var e=t.config,n=t.bundle;return e?(e.global=e.global||{},e.scene=e.scene||{},e.cameras=e.cameras||{},e.lights=e.lights||{},e.styles=e.styles||{},e.layers=e.layers||{},e.camera&&(e.cameras.default=e.camera),0===Object.keys(e.cameras).length&&(e.cameras.default={}),(0===Object.keys(e.lights).length||Object.keys(e.lights).every((function(t){return!1===e.lights[t].visible})))&&(e.lights.default_light={type:"directional"}),{config:e,bundle:n}):{}}};t.subscribeMixin(cl);var yl=function(){function e(){this.tiles={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=7,this.children_cache={}}var n=e.prototype;return n.addTile=function(e){for(this.tiles[e.key]=this.tiles[e.key]||{descendants:0},this.tiles[e.key].tile=e;e.style_z>=0;){if(!(e=t.TileID.parent(e)))return;this.tiles[e.key]||(this.tiles[e.key]={descendants:0}),this.tiles[e.key].descendants++}},n.removeTile=function(e){for(this.tiles[e.key]&&(delete this.tiles[e.key].tile,0===this.tiles[e.key].descendants&&delete this.tiles[e.key]);e.style_z>=0;){if(!(e=t.TileID.parent(e)))return;this.tiles[e.key]&&this.tiles[e.key].descendants>0&&(this.tiles[e.key].descendants--,0!==this.tiles[e.key].descendants||this.tiles[e.key].tile||delete this.tiles[e.key])}},n.getAncestor=function(e){for(var n=0;n<this.max_proxy_ancestor_depth;){if(!(e=t.TileID.parent(e)))return;if(this.tiles[e.key]&&this.tiles[e.key].tile&&this.tiles[e.key].tile.loaded)return this.tiles[e.key].tile;n++}},n.getDescendants=function(e,n){var r=this;void 0===n&&(n=0);var i=[];if(n<this.max_proxy_descendant_depth){var o=t.TileID.children(e,this.children_cache);if(!o)return;o.forEach((function(t){r.tiles[t.key]&&(r.tiles[t.key].tile&&r.tiles[t.key].tile.loaded?i.push(r.tiles[t.key].tile):r.tiles[t.key].descendants>0&&i.push.apply(i,r.getDescendants(t,n+1)))}))}return i},e}(),bl={},xl={};function wl(e,n){if(void 0===n&&(n=null),this.obb)return t.Label.prototype.occluded.call(this,e,n);if(this.obbs)for(var r=0;r<this.obbs.length;r++){var i={aabb:this.aabbs[r],obb:this.obbs[r]};if(t.Label.prototype.occluded.call(i,e,n))return!0}return!1}var Tl=function(){function e(e){var n=e.scene;this.scene=n,this.tiles={},this.pyramid=new yl,this.visible_coords={},this.queued_coords=[],this.building_tiles=null,this.renderable_tiles=[],this.collision={tile_keys:null,mesh_set:null,zoom:null,zoom_steps:3},this.main_thread_target=["TileManager",this.scene.id].join("_"),t.WorkerBroker.addTarget(this.main_thread_target,this)}var n=e.prototype;return n.destroy=function(){this.forEachTile((function(t){return t.destroy()})),this.tiles={},this.pyramid=null,this.visible_coords={},this.queued_coords=[],this.scene=null,t.WorkerBroker.removeTarget(this.main_thread_target)},n.keepTile=function(t){this.tiles[t.key]=t,this.pyramid.addTile(t)},n.hasTile=function(t){return void 0!==this.tiles[t]},n.forgetTile=function(t){if(this.hasTile(t)){var e=this.tiles[t];this.pyramid.removeTile(e)}delete this.tiles[t],this.tileBuildStop(t)},n.removeTile=function(e){t.log("trace","tile unload for "+e);var n=this.tiles[e];null!=n&&n.destroy(),this.forgetTile(n.key),this.scene.requestRedraw()},n.forEachTile=function(t){for(var e in this.tiles)t(this.tiles[e])},n.removeTiles=function(t){var e=[];for(var n in this.tiles)t(this.tiles[n])&&e.push(n);for(var r=0;r<e.length;r++){var i=e[r];this.removeTile(i)}},n.updateTilesForView=function(){this.visible_coords={};for(var t=this.view.findVisibleTileCoordinates(),e=0;e<t.length;e++){var n=t[e];this.queueCoordinate(n),this.visible_coords[n.key]=n}this.updateTileStates()},n.updateTileStates=function(){var t=this;return this.forEachTile((function(e){t.updateVisibility(e)})),this.loadQueuedCoordinates(),this.updateProxyTiles(),this.view.pruneTilesForView(),this.updateRenderableTiles(),this.style_manager.updateActiveStyles(this.renderable_tiles),this.style_manager.updateActiveBlendOrders(this.renderable_tiles),this.updateLabels()},n.updateLabels=function(){var e=this;if(this.scene.building&&!this.scene.building.initial)return Promise.resolve({});var n=this.renderable_tiles.filter((function(t){return t.valid})).filter((function(t){return t.built}));return 0===n.length?Promise.resolve({}):(n.sort((function(t,e){return t.build_id<e.build_id?-1:t.build_id>e.build_id?1:0})),this.collision.zoom===Al(this.view.zoom,this.collision.zoom_steps)&&this.collision.tile_keys===JSON.stringify(n.map((function(t){return t.key})))&&this.collision.mesh_set===El(n)?Promise.resolve({}):(this.collision.task||(this.collision.zoom=Al(this.view.zoom,this.collision.zoom_steps),this.collision.tile_keys=JSON.stringify(n.map((function(t){return t.key}))),this.collision.mesh_set=El(n),this.collision.task={type:"tileManagerUpdateLabels",run:function(r){return new Promise((function(i,o){var s;return Promise.resolve(function(e,n,r){return new Promise((function(i,o){var s,a,l,u,h;return void 0===r&&(r=!1),xl=bl,bl={},s=function(e,n){var r={},i={};for(var o in e.forEach((function(e){var o=t.Geo.unitsPerMeter(e.coords.z),s=Math.pow(2,n-e.style_z),a=o*s,l=t.Geo.metersPerPixel(n),u=Object.assign({},e.meshes,e.pending_label_meshes);for(var h in u)u[h].forEach((function(n){if(n.labels)for(var s in n.labels)if(!e.isProxy()||xl[s]){var u=n.labels[s].container.label,h=n.labels[s].container.linked,c=n.labels[s].ranges,f=r[s]={};if(f.discard=wl.bind(f),f.build_id=e.build_id,Object.assign(f,u),f.layout=Object.assign({},u.layout),f.layout.repeat_scale=.75,f.layout.repeat_distance=f.layout.repeat_distance||0,f.layout.repeat_distance/=a,f.position=[f.position[0]/o+e.min.x,f.position[1]/o+e.min.y],f.unit_scale=l,"point"===f.type)t.LabelPoint.prototype.updateBBoxes.call(f);else if("straight"===f.type)t.LabelLineStraight.prototype.updateBBoxes.call(f,f.position,f.size,f.angle,f.angle,f.offset);else if(u.obbs){var d=u.obbs.map((function(n){var r=n.x,i=n.y,s=n.a,l=n.w,u=n.h;return r=r/o+e.min.x,i=i/o+e.min.y,l/=a,u/=a,new t.OBB(r,i,s,l,u)}));f.obbs=d,f.aabbs=d.map((function(t){return t.getExtent()}))}i[s]={label:f,linked:h,ranges:c,mesh:n}}}))})),i){var s=i[o];s.linked&&(s.linked=i[s.linked])}return i=Object.keys(i).map((function(t){return i[t]}))}(e,n),t.Collision.startTile("main",{apply_repeat_groups:!0,return_hidden:!0}),t.Collision.addStyle("main","main"),a=Math.max.apply(Math,[0].concat(Object.values(e).map((function(t){return Object.values(t.meshes)})).flat().map((function(t){return Math.max.apply(Math,[0].concat(t.map((function(t){return t.labels?Object.keys(t.labels).length:0}))))})))),(l=Math.floor(a/t.Geo.tile_size))>0?t.Collision.initGrid({anchor:{x:Math.min.apply(Math,e.map((function(t){return t.min.x}))),y:Math.min.apply(Math,e.map((function(t){return t.min.y})))},span:e[0].span.x/l}):t.Collision.initGrid(),Promise.resolve(t.Collision.collide(s,"main","main")).then((function(t){try{return h=[],(u=t).forEach((function(t){var e=0;!0!==t.show||r&&t.label.breach&&!xl[t.label.id]||(e=1),e&&(bl[t.label.id]=!0);var n=!0;t.ranges.forEach((function(r){if(n){var i=t.mesh;if(i.valid){for(var o=i.vertex_layout.offset.a_shape,s=i.vertex_layout.stride,a=0;a<r[1];a++){if(i.vertex_data[r[0]+a*s+o+6]===e)return void(n=!1);i.vertex_data[r[0]+a*s+o+6]=e}-1===h.indexOf(i)&&h.push(i)}}}))})),h.forEach((function(t){return t.upload()})),e.forEach((function(t){return t.swapPendingLabels()})),i({labels:u,containers:s})}catch(t){return o(t)}}),o)}))}(n,e.collision.zoom,e.isLoadingVisibleTiles())).then((function(n){try{return s=n,e.scene.requestRedraw(),e.collision.task=null,t.Task.finish(r,s),e.updateTileStates(),i()}catch(t){return o(t)}}),o)}))},immediate:!0},t.Task.add(this.collision.task)),this.collision.task.promise))},n.updateProxyTiles=function(){var t=this;if(0!==this.view.zoom_direction){this.forEachTile((function(t){return t.setProxyFor(null)}));var e=!1;this.forEachTile((function(n){if(n.visible&&!n.labeled){var r=t.pyramid.getAncestor(n);if(r)r.setProxyFor(n),e=!0;else for(var i=t.pyramid.getDescendants(n),o=0;o<i.length;o++)i[o].setProxyFor(n),e=!0}})),e||(this.view.zoom_direction=0)}},n.updateVisibility=function(e){if(e.visible=!1,e.style_z===this.view.tile_zoom)if(this.visible_coords[e.coords.key])e.visible=!0;else for(var n in this.visible_coords)if(t.TileID.isDescendant(e.coords,this.visible_coords[n])){e.visible=!0;break}},n.pruneToVisibleTiles=function(){this.removeTiles((function(t){return!t.visible}))},n.getRenderableTiles=function(){return this.renderable_tiles},n.updateRenderableTiles=function(){for(var t in this.renderable_tiles=[],this.tiles){var e=this.tiles[t];e.visible&&e.loaded&&this.renderable_tiles.push(e)}return this.renderable_tiles},n.isLoadingVisibleTiles=function(){var t=this;return Object.keys(this.tiles).some((function(e){return t.tiles[e].visible&&!t.tiles[e].built}))},n.allVisibleTilesLabeled=function(){return this.renderable_tiles.every((function(t){return t.labeled}))},n.queueCoordinate=function(t){this.queued_coords[this.queued_coords.length]=t},n.loadQueuedCoordinates=function(){var e=this;0!==this.queued_coords.length&&(this.queued_coords.sort((function(n,r){var i=e.view.center.meters,o=t.Geo.metersPerTile(n.z)/2,s=t.Geo.metersForTile(n);s.x+=o,s.y-=o;var a=t.Geo.metersForTile(r);a.x+=o,a.y-=o;var l=Math.abs(i.x-s.x)+Math.abs(i.y-s.y),u=Math.abs(i.x-a.x)+Math.abs(i.y-a.y);return n.center_dist=l,r.center_dist=u,u>l?-1:u===l?0:1})),this.queued_coords.forEach((function(t){return e.loadCoordinate(t)})),this.queued_coords=[])},n.loadCoordinate=function(e){if(e.z===this.view.center.tile.z)for(var n in this.scene.sources){var r=this.scene.sources[n];if(r.builds_geometry_tiles&&r.includesTile(e,this.view.tile_zoom)){var i=t.TileID.normalizedKey(e,r,this.view.tile_zoom);if(i&&!this.hasTile(i)){t.log("trace","load tile "+i+", distance from view center: "+e.center_dist);var o=new t.Tile({source:r,coords:e,workers:this.scene.workers,style_z:this.view.baseZoom(e.z),view:this.view});this.keepTile(o),this.buildTile(o)}}}},n.buildTile=function(t,e){this.tileBuildStart(t.key),this.updateVisibility(t),t.build(this.scene.generation,e)},n.buildTileStylesCompleted=function(e){var n=e.tile,r=e.progress;if(null==this.tiles[n.key])t.log("trace","discarded tile "+n.key+" in TileManager.buildTileStylesCompleted because previously removed"),t.Tile.abortBuild(n),this.updateTileStates();else if(n.generation!==this.scene.generation)t.log("trace","discarded tile "+n.key+" in TileManager.buildTileStylesCompleted because built with scene config gen "+n.generation+", current "+this.scene.generation),t.Tile.abortBuild(n),this.updateTileStates();else{if(this.tiles[n.key]){if(n.id<this.tiles[n.key].id)return t.log("trace","discarded tile "+n.key+" for id "+n.id+" in TileManager.buildTileStylesCompleted because built for discarded tile id"),void t.Tile.abortBuild(n);n=this.tiles[n.key].merge(n)}r.done&&(n.built=!0),n.buildMeshes(this.scene.styles,r),this.updateTileStates(),this.scene.requestRedraw()}r.done&&this.tileBuildStop(n.key)},n.buildTileError=function(e){t.log("error","Error building tile "+e.key+":",e.error),this.forgetTile(e.key),t.Tile.abortBuild(e)},n.tileBuildStart=function(e){this.building_tiles=this.building_tiles||{},this.building_tiles[e]=!0,t.log("trace","tileBuildStart for "+e+": "+Object.keys(this.building_tiles).length)},n.tileBuildStop=function(e){this.building_tiles&&(t.log("trace","tileBuildStop for "+e+": "+Object.keys(this.building_tiles).length),delete this.building_tiles[e],this.checkBuildQueue())},n.checkBuildQueue=function(){this.building_tiles&&0!==Object.keys(this.building_tiles).length||(this.building_tiles=null,this.scene.tileManagerBuildDone())},n.getDebugProp=function(t,e){var n=[];for(var r in this.tiles)null==this.tiles[r].debug[t]||"function"==typeof e&&!0!==e(this.tiles[r])||n.push(this.tiles[r].debug[t]);return n},n.getDebugSum=function(t,e){var n=0;for(var r in this.tiles)null==this.tiles[r].debug[t]||"function"==typeof e&&!0!==e(this.tiles[r])||(n+=this.tiles[r].debug[t]);return n},n.getDebugAverage=function(t,e){return this.getDebugSum(t,e)/Object.keys(this.tiles).length},t._createClass(e,[{key:"view",get:function(){return this.scene.view}},{key:"style_manager",get:function(){return this.scene.style_manager}}]),e}();function Al(t,e,n){return void 0===n&&(n=2),(Math.floor(t*e)/e).toFixed(n)}function El(t){return JSON.stringify(Object.entries(t).map((function(t){var e=t[1];return Object.entries(e.meshes).map((function(t){return t[1].map((function(t){return t.created_at}))}))})))}var kl=function(){function t(t,e){e(t),this.value=t,this.setup=e}return t.prototype.set=function(t){JSON.stringify(this.value)!==JSON.stringify(t)&&(this.setup(t),this.value=t)},t}(),Sl=function(t){this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=t.BACK,this.defaults.blending=!1,this.defaults.blending_src=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=t.ONE,this.defaults.blending_dst_alpha=t.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,t.depthFunc(t.LESS),this.culling=new kl({cull:this.defaults.culling,face:this.defaults.culling_face},(function(e){e.cull?(t.enable(t.CULL_FACE),t.cullFace(e.face)):t.disable(t.CULL_FACE)})),this.blending=new kl({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},(function(e){e.blend?(t.enable(t.BLEND),e.src_alpha&&e.dst_alpha?t.blendFuncSeparate(e.src,e.dst,e.src_alpha,e.dst_alpha):t.blendFunc(e.src,e.dst)):t.disable(t.BLEND)})),this.depth_write=new kl({depth_write:this.defaults.depth_write},(function(e){t.depthMask(e.depth_write)})),this.depth_test=new kl({depth_test:this.defaults.depth_test},(function(e){e.depth_test?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)}))};t.require$$0$4("Uint8",1,(function(t){return function(e,n,r){return t(this,e,n,r)}}),!0);var Pl,Ml=function(){function e(){this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}var n=e.prototype;return n.setCanvas=function(t,e){this.canvas=t,this.gl=e},n.screenshot=function(t){var e=this,n=(void 0===t?{}:t).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:n},this.queue_screenshot.promise=new Promise((function(t,n){e.queue_screenshot.resolve=t,e.queue_screenshot.reject=n}))),this.queue_screenshot.promise},n.completeScreenshot=function(){if(null!=this.queue_screenshot){var e=this.canvas.width,n=this.canvas.height,r=new Uint8Array(e*n*4);this.gl.readPixels(0,0,e,n,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r);var i=this.queue_screenshot.background;i=i&&"transparent"!==i?t.StyleParser.parseColor(i).slice(0,3).map((function(t){return 255*t})):null;for(var o=new Uint8ClampedArray(e*n*4),s=0;s<n;s++)for(var a=0;a<e;a++){var l=4*((n-s-1)*e+a),u=4*(s*e+a),h=r[l+3];o[u+0]=255*r[l+0]/h,o[u+1]=255*r[l+1]/h,o[u+2]=255*r[l+2]/h,o[u+3]=h,i&&(h/=255,o[u+0]=o[u+0]*h+i[0]*(1-h),o[u+1]=o[u+1]*h+i[1]*(1-h),o[u+2]=o[u+2]*h+i[2]*(1-h),o[u+3]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var c=this.screenshot_canvas;c.width=e,c.height=n,this.screenshot_context=this.screenshot_context||c.getContext("2d");var f=this.screenshot_context,d=new ImageData(o,e,n);f.putImageData(d,0,0);for(var p=c.toDataURL("image/png"),g=atob(p.slice(22)),_=new Uint8Array(g.length),m=0;m<g.length;++m)_[m]=g.charCodeAt(m);var v=new Blob([_],{type:"image/png"});this.queue_screenshot.resolve({url:p,blob:v,type:"png"}),this.queue_screenshot=null}},n.startVideoCapture=function(){var e=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return t.log("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return t.log("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var n=this.video_capture={};n.chunks=[],n.stream=this.canvas.captureStream(),n.options={mimeType:"video/webm"},n.media_recorder=new MediaRecorder(n.stream,n.options),n.media_recorder.ondataavailable=function(r){if(r.data.size>0&&n.chunks.push(r.data),n.resolve){var i=new Blob(n.chunks,{type:n.options.mimeType}),o=t.createObjectURL(i);n.stream&&(n.stream.getTracks()||[]).forEach((function(t){t.stop(),n.stream.removeTrack(t)})),n.stream=null,n.media_recorder=null,e.video_capture=null,n.resolve({url:o,blob:i,type:"webm"})}},n.media_recorder.start()}catch(e){return this.video_capture=null,t.log("error","Scene video capture failed",e),!1}return!0},n.stopVideoCapture=function(){var e=this;return this.video_capture?(this.video_capture.promise=new Promise((function(t,n){e.video_capture.resolve=t,e.video_capture.reject=n})),this.video_capture.media_recorder.stop(),this.video_capture.promise):(t.log("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))},e}(),zl=function(){function e(n,r){var i;r=r||{},t.subscribeMixin(this),this.id=e.id++,this.initialized=!1,this.initializing=null,this.sources={},this.view=new t.View(this,r),this.tile_manager=new Tl({scene:this}),this.num_workers=r.numWorkers||2,!0===r.disableVertexArrayObjects&&(t.VertexArrayObject.disabled=!0),t.Utils.use_high_density_display=void 0===r.highDensityDisplay||r.highDensityDisplay,t.Utils.updateDevicePixelRatio(),this.config=null,this.config_source=n,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new t.StyleManager,this.building=null,this.dirty=!0,r.preUpdate&&this.subscribe({pre_update:r.preUpdate}),r.postUpdate&&this.subscribe({post_update:r.postUpdate}),this.render_loop=!r.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new Ml,this.selection=null,this.selection_feature_count=0,this.fetching_selection_map=null,this.prev_textures=null,this.introspection=!0===r.introspection,this.times={},this.resetTime(),this.container=r.container,this.canvas=null,this.contextOptions=r.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=e.generation,this.last_complete_generation=e.generation,(i=this).debug={profile:function(e){console.profile("main thread: "+e),t.WorkerBroker.postMessage(i.workers,"self.profile",e)},profileEnd:function(e){console.profileEnd("main thread: "+e),t.WorkerBroker.postMessage(i.workers,"self.profileEnd",e)},timeRebuild:function(e,n){void 0===e&&(e=1),void 0===n&&(n={});var r=[];!function o(){var s=+new Date;i.rebuild(n).then((function(){if(r.push(+new Date-s),r.length<e)o();else{var n=~~(r.reduce((function(t,e){return t+e}))/r.length);t.log("info","Profiled rebuild "+e+" times: "+n+" avg ("+Math.min.apply(Math,r)+" min, "+Math.max.apply(Math,r)+" max)")}}))}()},geometryCountByStyle:function(){var t={};return i.tile_manager.getRenderableTiles().forEach((function(e){var n=function(n){t[n]=t[n]||0,e.meshes[n].forEach((function(e){t[n]+=e.geometry_count}))};for(var r in e.meshes)n(r)})),t},geometryCountByBaseStyle:function(){var t=i.debug.geometryCountByStyle(),e={};for(var n in t){var r=i.styles[n].baseStyle();e[r]=e[r]||0,e[r]+=t[n]}return e},geometryCountTotal:function(){var t=i.debug.geometryCountByStyle();return Object.keys(t).reduce((function(e,n){return t[n]+e}),0)},geometrySizeByStyle:function(){var t={};return i.tile_manager.getRenderableTiles().forEach((function(e){var n=function(n){t[n]=t[n]||0,e.meshes[n].forEach((function(e){t[n]+=e.buffer_size}))};for(var r in e.meshes)n(r)})),t},geometrySizeByBaseStyle:function(){var t=i.debug.geometrySizeByStyle(),e={};for(var n in t){var r=i.styles[n].baseStyle();e[r]=e[r]||0,e[r]+=t[n]}return e},geometrySizeTotal:function(){var t=i.debug.geometrySizeByStyle();return Object.keys(t).reduce((function(e,n){return t[n]+e}),0)},textureSizeTotal:function(){return Object.values(t.Texture.textures).map((function(t){return t.byteSize()})).reduce((function(t,e){return t+e}))},layerStats:function(){return t.debugSettings.layer_stats?t.debugSumLayerStats(i.tile_manager.getRenderableTiles()):(t.log("warn","Enable the 'layer_stats' debug setting to collect layer stats"),{})},renderableTilesCount:function(){return i.tile_manager.getRenderableTiles().length}},this.log_level=r.logLevel||"warn",t.log.setLevel(this.log_level),t.log.reset()}e.create=function(t,n){return void 0===n&&(n={}),new e(t,n)};var n=e.prototype;return n.load=function(e,n){var r=this;return void 0===e&&(e=null),void 0===n&&(n={}),this.initializing||(t.log.reset(),this.updating++,this.initialized=!1,this.view_complete=!1,this.times.frame=null,this.times.build=null,(n="string"==typeof n?{base_path:n}:n).blocking=void 0===n.blocking||n.blocking,!1!==this.render_loop&&this.setupRenderLoop(),this.createCanvas(),this.prev_textures=this.config&&Object.keys(this.config.textures),this.initializing=this.loadScene(e,n).then((function(){return r.createWorkers()})).then((function(){r.destroyFeatureSelection(),t.WorkerBroker.postMessage(r.workers,"self.clearFunctionStringCache");var e="object"==typeof r.config_source||r.hasSubscribersFor("load"),i=r.updateConfig({serialize_funcs:e,normalize:!1,loading:!0,fade_in:!0});if(!0===n.blocking)return i})).then((function(){r.freePreviousTextures(),r.updating--,r.initializing=null,r.initialized=!0,r.last_valid_config_source=r.config_source,r.last_valid_options={base_path:n.base_path,file_type:n.file_type},r.requestRedraw()})).catch((function(e){var n,i;if(r.initializing=null,r.updating=0,"YAMLException"===e.name?(n="yaml",i="Error parsing scene YAML"):i="Error initializing scene",r.trigger("error",{type:n,message:i,error:e,url:r.config_source}),i="Scene.load() failed to load "+JSON.stringify(r.config_source)+": "+e.message,r.last_valid_config_source)return t.log("warn",i,e),t.log("info","Scene.load() reverting to last valid configuration"),r.load(r.last_valid_config_source,r.last_valid_base_path);throw t.log("error",i,e),e}))),this.initializing},n.destroy=function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.destroyFeatureSelection(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.gl){t.Texture.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},t.ShaderProgram.reset();var e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.gl=null}this.sources={},this.destroyWorkers(),this.tile_manager.destroy(),this.tile_manager=null,t.log.reset()},n.createCanvas=function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=U.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!0,stencil:!0,device_pixel_ratio:t.Utils.device_pixel_ratio,powerPreference:"high-performance"},this.contextOptions))}catch(t){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.resizeMap(this.container.clientWidth,this.container.clientHeight),t.VertexArrayObject.init(this.gl),this.render_states=new Sl(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}},n.updateExternalScripts=function(){var t=[].concat(this.external_scripts||[]),e=[];if(this.config.scene.scripts)for(var n in this.config.scene.scripts)-1===e.indexOf(this.config.scene.scripts[n])&&e.push(this.config.scene.scripts[n]);for(var r in this.config.sources){var i=this.config.sources[r];if(i.scripts)for(var o in i.scripts)-1===e.indexOf(i.scripts[o])&&e.push(i.scripts[o])}return this.external_scripts=e,!(this.external_scripts.length===t.length&&this.external_scripts.every((function(e,n){return e===t[n]})))},n.createWorkers=function(){return this.updateExternalScripts()&&this.destroyWorkers(),this.workers?Promise.resolve():this.makeWorkers()},n.makeWorkers=function(){var e=this,n=!!this.gl.getExtension("OES_element_index_uint"),o=[];this.workers=[];for(var i=function(i){var l=new Worker(r.workerURL);e.workers[i]=l,t.WorkerBroker.addWorker(l),t.log("debug","Scene.makeWorkers: initializing worker "+i);var s=i;o.push(t.WorkerBroker.postMessage(l,"self.init",e.id,i,e.num_workers,e.log_level,t.Utils.device_pixel_ratio,n,e.external_scripts).then((function(e){return t.log("debug","Scene.makeWorkers: initialized worker "+e),e}),(function(e){return t.log("error","Scene.makeWorkers: failed to initialize worker "+s+":",e),Promise.reject(e)})))},l=0;l<this.num_workers;l++)i(l);return this.next_worker=0,Promise.all(o).then((function(){t.log.setWorkers(e.workers)}))},n.destroyWorkers=function(){this.selection=null,Array.isArray(this.workers)&&(t.log.setWorkers(null),this.workers.forEach((function(t){t.terminate()})),this.workers=null)},n.ready=function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)},n.updateDevicePixelRatio=function(){var e=this;t.Utils.updateDevicePixelRatio()&&t.WorkerBroker.postMessage(this.workers,"self.updateDevicePixelRatio",t.Utils.device_pixel_ratio).then((function(){return e.rebuild()})).then((function(){return e.resizeMap(e.view.size.css.width,e.view.size.css.height)}))},n.resizeMap=function(e,n){0===e&&0===n||(this.dirty=!0,this.view.setViewportSize(e,n),this.gl&&U.resize(this.gl,e,n,t.Utils.device_pixel_ratio))},n.requestRedraw=function(){this.dirty=!0},n.immediateRedraw=function(){this.dirty=!0,this.update()},n.renderLoop=function(){this.render_loop_active=!0,this.update(),t.Task.setState({user_moving_view:this.view.user_input_active}),t.Task.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))},n.setupRenderLoop=function(){var t=this;this.render_loop_active||setTimeout((function(){t.renderLoop()}),0)},n.update=function(){var e=this.dirty,n=!!this.selection&&this.selection.hasPendingRequests(),r=!(!1===e&&!1===n||!1===this.initialized||this.updating>0||!1===this.ready());return this.trigger("pre_update",r),this.view.update(),!!r&&(this.dirty=!1,this.updateDevicePixelRatio(),this.render({main:e,selection:n}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",r),(!0===this.animated||this.view.isAnimating())&&(this.dirty=!0),this.frame++,t.log("trace","Scene.render()"),!0)},n.render=function(e){var n=this,r=e.main,i=e.selection,o=this.gl;if(this.updateBackground(),Object.keys(this.lights).forEach((function(t){return n.lights[t].update()})),this.render_count_changed=!1,r&&(this.render_count=this.renderPass(),this.last_main_render=this.frame,this.render_count!==this.last_render_count&&(this.render_count_changed=!0,this.logFirstFrame(),this.getFeatureSelectionMapSize().then((function(e){n.selection_feature_count=e,t.log("info","Scene: rendered "+n.render_count+" primitives ("+e+" features in selection map)")}))),this.last_render_count=this.render_count),i){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();!this.selection.locked&&this.last_selection_render<this.last_main_render&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),o.bindFramebuffer(o.FRAMEBUFFER,null),o.viewport(0,0,this.canvas.width,this.canvas.height),o.clearColor.apply(o,this.background.computed_color),this.last_selection_render=this.frame),this.selection.read()}return!0},n.renderPass=function(e,n){var r=this;void 0===e&&(e="program");var i=(void 0===n?{}:n).allow_blend;i=null==i||i,this.clearFrame();var o,s=0,a=this.style_manager.getActiveBlendOrders(),l=Array.isArray(a),u=0;for(a=l?a:a[Symbol.iterator]();;){var h;if(l){if(u>=a.length)break;h=a[u++]}else{if((u=a.next()).done)break;h=u.value}for(var c=h,f=c.blend_order,d=c.styles,p=function(n){var a=r.styles[d[n]];if(null==a)return"continue";if(a.blend!==o){var l=Object.assign({},t.Style.render_states[a.blend],{blend:i&&a.blend});r.setRenderState(l)}var u=i&&a.blend;if("translucent"===u)r.gl.colorMask(!1,!1,!1,!1),r.renderStyle(a.name,e,f),r.gl.colorMask(!0,!0,!0,!0),r.gl.depthFunc(r.gl.EQUAL),r.gl.enable(r.gl.STENCIL_TEST),r.gl.clearStencil(0),r.gl.clear(r.gl.STENCIL_BUFFER_BIT),r.gl.stencilFunc(r.gl.EQUAL,r.gl.ZERO,255),r.gl.stencilOp(r.gl.KEEP,r.gl.KEEP,r.gl.INCR),s+=r.renderStyle(a.name,e,f),r.gl.disable(r.gl.STENCIL_TEST),r.gl.depthFunc(r.gl.LESS);else if("opaque"!==u&&!0===a.stencil_proxy_tiles){var h=r.tile_manager.getRenderableTiles().filter((function(t){return t.meshes[a.name]})).map((function(t){return t.proxy_level})).reduce((function(t,e){return t.indexOf(e)>-1||t.push(e),t}),[]).sort();if(h.length>1){r.gl.enable(r.gl.STENCIL_TEST),r.gl.clearStencil(0),r.gl.clear(r.gl.STENCIL_BUFFER_BIT),r.gl.stencilOp(r.gl.KEEP,r.gl.KEEP,r.gl.REPLACE);for(var c=0;c<h.length;c++)r.gl.stencilFunc(r.gl.GEQUAL,h.length-c,255),s+=r.renderStyle(a.name,e,f,h[c]);r.gl.disable(r.gl.STENCIL_TEST)}else s+=r.renderStyle(a.name,e,f)}else s+=r.renderStyle(a.name,e,f);o=a.blend},g=0;g<d.length;g++)p(g)}return s},n.renderStyle=function(t,e,n,r){var i=this;void 0===r&&(r=null);for(var o,s=this.styles[t],a=!0,l=0,u=this.tile_manager.getRenderableTiles().filter((function(t){return"number"!=typeof r||t.proxy_level===r})).map((function(e){if(e.meshes[t])return[e,e.meshes[t].filter((function(t){return t.variant.blend_order===n}))]})).filter((function(t){return t})),h=Math.max.apply(Math,u.map((function(t){var e=t[1];return Math.max.apply(Math,e.map((function(t){return t.variant.mesh_order})))}))),c=function(n){var r=function(){if(c){if(f>=h.length)return"break";d=h[f++]}else{if((f=h.next()).done)return"break";d=f.value}var r=d,u=r[0],p=r[1],g=!0;if(!u.shouldProxyForStyle(t))return"continue";var _=p.filter((function(t){return t.variant.mesh_order===n}));return 0===_.length?"continue":!0!==a||(a=!1,o=i.setupStyle(s,e))?void _.forEach((function(t){!0===g&&(g=!1,i.view.setupTile(u,o)),s.render(t)&&i.requestRedraw(),l+=t.geometry_count})):{v:{v:0}}},h=u,c=Array.isArray(h),f=0;t:for(h=c?h:h[Symbol.iterator]();;){var d,p=r();switch(p){case"break":break t;case"continue":continue;default:if("object"==typeof p)return p.v}}},f=0;f<h+1;f++){var d=c(f);if("object"==typeof d)return d.v}return l},n.setupStyle=function(t,e){var n;try{if(!(n=t.getProgram(e)))return}catch(e){return void this.trigger("warning",{type:"styles",message:"Error compiling style "+t.name,style:t,shader_errors:t.program&&t.program.shader_errors})}for(var r in n.use(),t.setup(),n.uniform("1f","u_time",this.animated?(+new Date-this.start_time)/1e3:0),this.view.setupProgram(n),this.lights)this.lights[r].setupProgram(n);return n},n.clearFrame=function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))},n.setRenderState=function(t){var e=void 0===t?{}:t,n=e.depth_test,r=e.depth_write,i=e.cull_face,o=e.blend;if(this.initialized){var s=this.render_states;n=!1!==n&&s.defaults.depth_test,r=!1!==r&&s.defaults.depth_write,i=!1!==i&&s.defaults.culling,o=null!=o?o:s.defaults.blending;var a=this.gl;s.depth_test.set({depth_test:n}),s.depth_write.set({depth_write:r}),s.culling.set({cull:i,face:s.defaults.culling_face}),o?"opaque"===o?s.blending.set({blend:!1}):"overlay"===o||"inlay"===o||"translucent"===o?s.blending.set({blend:!0,src:a.SRC_ALPHA,dst:a.ONE_MINUS_SRC_ALPHA,src_alpha:a.ONE,dst_alpha:a.ONE_MINUS_SRC_ALPHA}):"add"===o?s.blending.set({blend:!0,src:a.ONE,dst:a.ONE}):"multiply"===o&&s.blending.set({blend:!0,src:a.ZERO,dst:a.SRC_COLOR}):s.blending.set({blend:!1})}},n.getFeatureAt=function(e,n){var r=(void 0===n?{}:n).radius;if(!this.initialized)return t.log("debug","Scene.getFeatureAt() called before scene was initialized"),Promise.resolve();if(0===this.selection_feature_count)return Promise.resolve();this.selection||this.resetFeatureSelection();var i={x:e.x/this.view.size.css.width,y:e.y/this.view.size.css.height};return r=r>0?{x:r/this.view.size.css.width,y:r/this.view.size.css.height}:null,this.selection.getFeatureAt(i,{radius:r}).then((function(t){return Object.assign(t,{pixel:e})})).catch((function(t){return Promise.resolve({error:t})}))},n.queryFeatures=function(e){return new Promise(function(n,r){var i,o,s,a,l,u,h,c,f,d,p,g,_,m,v,y,b;return o=(i=void 0===e?{}:e).filter,s=i.unique,a=void 0===s||s,l=i.group_by,u=void 0===l?null:l,c=void 0===(h=i.visible)?null:h,f=i.geometry,d=void 0!==f&&f,this.initialized?(o=t.Utils.serializeWithFunctions(o),p=!0===(a="string"==typeof a?[a]:a)||Array.isArray(a)&&a.indexOf("$id")>-1,g=a&&function(e){var n=Array.isArray(a)?t.sliceObject(e.properties,a):e.properties,r=p?e.id:null;return d?JSON.stringify({geometry:e.geometry,properties:n,id:r}):JSON.stringify({properties:n,id:r})},u=("string"==typeof u||Array.isArray(u))&&u,_=u&&function(e){return Array.isArray(u)?JSON.stringify(t.sliceObject(e,u)):e[u]},m=this.tile_manager.getRenderableTiles().map((function(t){return t.key})),Promise.resolve(t.WorkerBroker.postMessage(this.workers,"self.queryFeatures",{filter:o,visible:c,geometry:d,tile_keys:m})).then((function(t){try{return v=[],y={},b={},t.forEach((function(t){return t.forEach((function(t){if(g){var e=g(t);if(y[e])return;y[e]=!0}if(_){var n=_(t.properties);b[n]=b[n]||[],b[n].push(t)}else v.push(t)}))})),n(_?b:v)}catch(t){return r(t)}}),r)):n([])}.bind(this))},n.rebuild=function(n){var r=this,i=void 0===n?{}:n,o=i.initial,s=void 0!==o&&o,a=i.new_generation,l=void 0===a||a,u=i.sources,h=void 0===u?null:u,c=i.serialize_funcs,f=i.profile,d=void 0!==f&&f,p=i.fade_in,g=void 0!==p&&p;return new Promise((function(n,i){if(r.building){r.building.queued&&r.building.queued.reject&&(t.log("debug","Scene.rebuild: request superceded by a newer call"),r.building.queued.resolve(!1));var o={initial:s,new_generation:l,sources:h,serialize_funcs:c,profile:d,fade_in:g};return r.building.queued={resolve:n,reject:i,options:o},void t.log("trace","Scene.rebuild(): queuing request")}if(r.building={resolve:n,reject:i,initial:s},d&&r.debug.profile("Scene.rebuild"),l)for(var a in r.generation=++e.generation,r.styles)r.styles[a].setGeneration(r.generation);r.syncConfigToWorker({serialize_funcs:c}),r.resetWorkerFeatureSelection(h),r.resetTime(),r.tile_manager.pruneToVisibleTiles(),r.tile_manager.forEachTile((function(t){(!h||h.indexOf(t.source.name)>-1)&&r.tile_manager.buildTile(t,{fade_in:g})})),r.tile_manager.updateTilesForView(),r.tile_manager.checkBuildQueue()})).then((function(){d&&r.debug.profileEnd("Scene.rebuild")}))},n.tileManagerBuildDone=function(){if(t.TextCanvas.pruneTextCache(),this.building){t.log("info","Scene: build geometry finished"),this.building.resolve&&(this.logFirstBuild(),this.building.resolve(!0));var e=this.building.queued;this.building=null,e?(t.log("debug","Scene: starting queued rebuild() request"),this.rebuild(e.options).then(e.resolve,e.reject)):this.tile_manager.updateLabels()}},n.loadScene=function(e,n){var r=this;void 0===e&&(e=null);var i=void 0===n?{}:n,o=i.base_path,s=i.file_type;return this.config_source=e||this.config_source,"string"==typeof this.config_source?this.base_path=t.pathForURL(o||this.config_source):this.base_path=t.pathForURL(o),this.config_path=this.base_path,vl.loadScene(this.config_source,{path:this.base_path,type:s}).then((function(t){var e=t.config,n=t.bundle;return r.config=e,r.config_bundle=n,r.config}))},n.setDataSource=function(e,n){if(e&&n&&n.type&&(n.url||n.data)){var r=null==this.config.sources[e],i=this.config.sources[e]=Object.assign({},n);return i.data&&"object"==typeof i.data&&(i.url=t.createObjectURL(new Blob([JSON.stringify(i.data)])),delete i.data),r?this.updateConfig({rebuild:{sources:[e]}}):this.rebuild({sources:[e]})}t.log("error","No name provided or not a valid config:",e,n)},n.createDataSources=function(e){var n=this;void 0===e&&(e=!1);var r=[],i=Object.keys(this.sources),o=0;for(var s in this.config.sources){var a=this.config.sources[s],l=this.sources[s];try{var u=Object.assign({},a,{name:s,id:o++});if(this.sources[s]=t.DataSource.create(u,this.sources),!this.sources[s])throw{}}catch(e){delete this.sources[s];var h="Could not create data source: "+e.message;t.log("warn","Scene: "+h,a),this.trigger("warning",{type:"sources",source:a,message:h})}(e||t.DataSource.tileLayoutChanged(this.sources[s],l))&&r.push(s)}for(var c in i.forEach((function(t){n.config.sources[t]||(delete n.sources[t],r.push(t))})),r.length>0&&this.tile_manager.removeTiles((function(t){return r.indexOf(t.source.name)>-1})),this.config.layers){var f=this.config.layers[c];!1!==f.enabled&&f.data&&this.sources[f.data.source]&&(this.sources[f.data.source].builds_geometry_tiles=!0)}},n.loadTextures=function(){var e=this;return t.Texture.createFromObject(this.gl,this.config.textures).then((function(){return t.Texture.createDefault(e.gl)}))},n.freePreviousTextures=function(){var e=this;this.prev_textures&&(this.prev_textures.forEach((function(n){!e.config.textures[n]&&t.Texture.textures[n]&&t.Texture.textures[n].destroy()})),this.prev_textures=null)},n.updateStyles=function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var t in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[t].setGL(this.gl);this.dirty=!0},n.getActiveCamera=function(){return this.view.getActiveCamera()},n.setActiveCamera=function(t){return this.view.setActiveCamera(t)},n.createLights=function(){for(var e in this.lights={},t.debugSettings.wireframe&&(t.Light.enabled=!1),this.config.lights)if(this.config.lights[e]&&"object"==typeof this.config.lights[e]){var n=this.config.lights[e];n.name=e.replace("-","_"),n.visible=!1!==n.visible,n.visible&&(this.lights[n.name]=t.Light.create(this.view,n))}t.Light.inject(this.lights)},n.setBackground=function(){var e=this.config.scene.background;this.background={},e&&e.color&&(this.background.color=t.StyleParser.createColorPropertyCache(e.color)),this.background.color||(this.background.color=t.StyleParser.createColorPropertyCache([0,0,0,0]))},n.updateBackground=function(){var e,n=this.background.computed_color,r=this.background.computed_color=t.StyleParser.evalCachedColorProperty(this.background.color,{zoom:this.view.tile_zoom});n&&!r.some((function(t,e){return n[e]!==t}))||(1===r[3]?this.canvas.style.backgroundColor="rgba("+r.map((function(t){return Math.floor(255*t)})).join(", ")+")":this.canvas.style.backgroundColor="transparent",(e=this.gl).clearColor.apply(e,r))},n.setIntrospection=function(t){var e=this;return t!==this.introspection?(this.introspection=null!=t&&t,this.updating++,this.updateConfig({normalize:!1}).then((function(){return e.updating--}))):Promise.resolve()},n.updateConfig=function(n){var r=this,i=void 0===n?{}:n,o=i.loading,s=void 0!==o&&o,a=i.rebuild,l=void 0===a||a,u=i.serialize_funcs,h=i.normalize,c=void 0===h||h,f=i.fade_in,d=void 0!==f&&f;this.generation=++e.generation,this.updating++,this.config=vl.applyGlobalProperties(this.config),c?vl.normalize(this.config,this.config_bundle):(vl.hoistStyleShaderUniformTextures(this.config,this.config_bundle,{include_globals:!0}),vl.normalizeTextures(this.config,this.config_bundle)),this.trigger(s?"load":"update",{config:this.config}),this.style_manager.init(),this.view.reset(),this.createLights(),this.createDataSources(s),this.loadTextures(),this.setBackground(),t.FontManager.loadFonts(this.config.fonts),this.updateStyles();var p=l?this.rebuild(Object.assign({initial:s,new_generation:!1,serialize_funcs:u,fade_in:d},"object"==typeof l&&l)):this.syncConfigToWorker({serialize_funcs:u});return this.updating--,this.view.updateBounds(),this.requestRedraw(),p.then((function(){r.last_render_count=0,r.requestRedraw()}))},n.syncConfigToWorker=function(e){var n=(void 0===e?{}:e).serialize_funcs,r=void 0===n||n?t.Utils.serializeWithFunctions(this.config):JSON.stringify(this.config);return t.WorkerBroker.postMessage(this.workers,"self.updateConfig",{config:r,generation:this.generation,introspection:this.introspection},t.debugSettings)},n.createListeners=function(){var e=this;this.listeners={},this.listeners.view={move:function(){return e.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return e.dirty=!0},warning:function(t){return e.trigger("warning",Object.assign({type:"textures"},t))}},t.Texture.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(t){return e.trigger("error",Object.assign({type:"scene"},t))}},vl.subscribe(this.listeners.scene_loader)},n.destroyListeners=function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),t.Texture.unsubscribe(this.listeners.texture),vl.unsubscribe(this.listeners.scene_loader),this.listeners=null},n.destroyFeatureSelection=function(){this.selection&&(this.selection.destroy(),this.selection=null)},n.resetFeatureSelection=function(){var e=this;this.selection=new t.FeatureSelection(this.gl,this.workers,(function(){return e.building})),this.last_render_count=0},n.resetWorkerFeatureSelection=function(e){void 0===e&&(e=null),this.workers&&t.WorkerBroker.postMessage(this.workers,"self.resetFeatureSelection",e)},n.getFeatureSelectionMapSize=function(){var e=this;return null==this.fetching_selection_map&&(this.fetching_selection_map=t.WorkerBroker.postMessage(this.workers,"self.getFeatureSelectionMapSize").then((function(t){return e.fetching_selection_map=null,t.reduce((function(t,e){return t+e}))}))),this.fetching_selection_map},n.resetTime=function(){this.start_time=+new Date},n.updateViewComplete=function(){!this.render_count_changed&&this.generation===this.last_complete_generation||this.building||this.tile_manager.isLoadingVisibleTiles()||!this.tile_manager.allVisibleTilesLabeled()||(this.tile_manager.updateLabels(),this.last_complete_generation=this.generation,this.trigger("view_complete",{first:!0!==this.view_complete}),this.view_complete=!0)},n.resetViewComplete=function(){this.last_complete_generation=null},n.screenshot=function(t){var e=(void 0===t?{}:t).background,n=void 0===e?"white":e;return this.requestRedraw(),this.media_capture.screenshot({background:n})},n.startVideoCapture=function(){return this.requestRedraw(),this.media_capture.startVideoCapture()},n.stopVideoCapture=function(){return this.media_capture.stopVideoCapture()},n.logFirstFrame=function(){0!==this.last_render_count||this.times.first_frame||(this.times.first_frame=+new Date-this.start_time,t.log("debug","Scene: initial frame time: "+this.times.first_frame))},n.logFirstBuild=function(){null==this.times.first_build&&(this.times.first_build=+new Date-this.start_time,t.log("debug","Scene: initial build time: "+this.times.first_build))},t._createClass(e,[{key:"animated",get:function(){var t=this;return!1!==this.config.scene.animated&&this.style_manager.getActiveStyles().some((function(e){return t.styles[e].animated}))}}]),e}();zl.id=0,zl.generation=0;var Rl={map:{},scrollWheelZoom:{},doubleClickZoom:{}};return{leafletLayer:function(e){return function(e){if(void 0!==Pl)return new Pl(e);if(t.Thread.is_main){var n,r=e.leaflet||window.L,i=r.GridLayer?r.GridLayer:r.TileLayer,o=i===r.GridLayer?"1.x":"0.7.x",s={};return i===r.TileLayer&&(s._addTile=function(){},s._removeTile=function(){},s._reset=function(){i.prototype._reset.apply(this,arguments),this.scene&&this.scene.container&&this.scene.canvas&&this.scene.container.appendChild(this.scene.canvas)}),Object.assign(s,{initialize:function(t){t.showDebug=!!t.showDebug,r.setOptions(this,t),this.updateTangramDebugSettings(),this.createScene(),this.hooks={},this._updating_tangram=!1},createScene:function(){this.scene=zl.create(this.options.scene,{numWorkers:this.options.numWorkers,preUpdate:this.options.preUpdate,postUpdate:this.options.postUpdate,continuousZoom:"1.x"===Pl.leafletVersion,wrapView:!0!==this.options.noWrap,highDensityDisplay:this.options.highDensityDisplay,logLevel:this.options.logLevel,introspection:this.options.introspection,webGLContextOptions:this.options.webGLContextOptions,disableRenderLoop:this.options.disableRenderLoop})},onAdd:function(e){var n=this;this.scene||this.createScene(),i.prototype.onAdd.apply(this,arguments),this.hooks.resize=function(){n._updating_tangram=!0,n.updateSize(),n._updating_tangram=!1},e.on("resize",this.hooks.resize),this.hooks.move=function(){if(!n._updating_tangram){n._updating_tangram=!0,n.scene.view.setPanning(!0);var r=e.getCenter();r.zoom=Math.max(Math.min(e.getZoom(),e.getMaxZoom()||t.Geo.default_view_max_zoom),e.getMinZoom()),n.scene.view.setView(r),n._mapLayerCount>1&&n.scene.immediateRedraw(),n._updating_tangram=!1}},e.on("move",this.hooks.move),this.hooks.moveend=function(){n.scene.view.setPanning(!1),n.scene.requestRedraw()},e.on("moveend",this.hooks.moveend),this.hooks.drag=function(){n.scene.view.markUserInput()},e.on("drag",this.hooks.drag),this._map_pane_observer=new MutationObserver((function(t){t.forEach((function(){return n.reverseTransform()}))})),this._map_pane_observer.observe(e.getPanes().mapPane,{attributes:!0}),this.modifyScrollWheelBehavior(e),this.modifyZoomBehavior(e),this.trackMapLayerCounts(e),this.setupSelectionEventHandlers(e),this.setSelectionEvents(this.options.events,{radius:this.options.selectionRadius}),this.scene.container=this.getContainer(),this.updateSize(),this.updateView(),this.resizeOnFirstVisible(),this.scene.subscribe({move:this.onTangramViewUpdate.bind(this)}),this.scene.load(this.options.scene,{base_path:this.options.sceneBasePath,file_type:this.options.sceneFileType,blocking:!1}).then((function(){if(!n.options.attribution)for(var t=Object.entries(n.scene.config.sources),r=0;r<t.length;r++){var o=t[r][1];o.attribution&&e.attributionControl.addAttribution(o.attribution)}n._updating_tangram=!0,n.updateSize(),n.updateView(),n.reverseTransform(),n._updating_tangram=!1,n.fire("init")})).catch((function(t){n.fire("error",t)}))},onRemove:function(t){i.prototype.onRemove.apply(this,arguments),t.off("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),t.off("resize",this.hooks.resize),t.off("move",this.hooks.move),t.off("moveend",this.hooks.moveend),t.off("drag",this.hooks.drag),t.off("click",this.hooks.click),t.off("mousemove",this.hooks.mousemove),t.off("mouseout",this.hooks.mouseout),document.removeEventListener("visibilitychange",this.hooks.visibilitychange),this.hooks={},this._map_pane_observer.disconnect(),this.scene&&(this.scene.destroy(),this.scene=null)},createTile:function(t){var e=t.x+"/"+t.y+"/"+t.z,n=document.createElement("div");if(n.setAttribute("data-tile-key",e),n.style.width="256px",n.style.height="256px",this.options.showDebug){var r=document.createElement("div");r.textContent=e,r.style.position="absolute",r.style.left=0,r.style.top=0,r.style.color="white",r.style.fontSize="16px",r.style.textOutline="1px #000000",r.style.padding="8px",n.appendChild(r),n.style.borderStyle="solid",n.style.borderColor="white",n.style.borderWidth="1px"}return n},modifyScrollWheelBehavior:function(t){if(this.scene.view.continuous_zoom&&t.scrollWheelZoom&&!1!==this.options.modifyScrollWheel){t.options.zoomSnap=0;var e=t.scrollWheelZoom.enabled();t.scrollWheelZoom.disable(),r.Browser.chrome||r.Browser.safari?t.scrollWheelZoom._onWheelScroll=function(t){var e=r.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._performZoom(),r.DomEvent.stop(t)}:t.options.wheelDebounceTime=20;var i=(s=function(t){t._moveEnd(!0),t.fire("viewreset")},a=2*t.options.wheelDebounceTime,function(){var t=this,e=arguments;clearTimeout(l),l=setTimeout((function(){l=null,s.apply(t,e)}),a)});Rl.scrollWheelZoom._performZoom||(Rl.scrollWheelZoom._performZoom=t.scrollWheelZoom._performZoom);var o=this;t.scrollWheelZoom._performZoom=function(){if(this._map===o._map){var t=this._map,e=t.getZoom();t._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel);this._delta=0,e+r>=this._map.getMaxZoom()?r=this._map.getMaxZoom()-e:e+r<=this._map.getMinZoom()&&(r=this._map.getMinZoom()-e),r&&("center"===t.options.scrollWheelZoom?n(o,t.getCenter(),e+r):n(o,this._lastMousePos,e+r),i(t))}else Rl.scrollWheelZoom._performZoom.call(this)},e&&t.scrollWheelZoom.enable()}var s,a,l},modifyZoomBehavior:function(t){if(this.scene.view.continuous_zoom&&!1!==this.options.modifyZoomBehavior){var e=this,i=function(e,i,o){t._stop();var s=t._zoom;i=r.latLng(i),o=void 0===o?s:o,o=Math.min(o,t.getMaxZoom());var a=Date.now();return t._moveStart(!0),function u(){var l=(Date.now()-a)/75;l<=1?(t._flyToFrame=r.Util.requestAnimFrame(u,t),n(e,i,s+(o-s)*l)):n(e,i,o)._moveEnd(!0)}.call(t),t};if(t.doubleClickZoom){var o=t.doubleClickZoom.enabled();t.doubleClickZoom.disable(),Rl.doubleClickZoom._onDoubleClick||(Rl.doubleClickZoom._onDoubleClick=t.doubleClickZoom._onDoubleClick),t.doubleClickZoom._onDoubleClick=function(t){if(this._map===e._map){var n=this._map,r=n.getZoom(),o=n.options.zoomDelta,s=t.originalEvent.shiftKey?r-o:r+o;"center"===n.options.doubleClickZoom?i(e,n.getCenter(),s):i(e,n.containerPointToLatLng(t.containerPoint),s)}else Rl.doubleClickZoom._onDoubleClick.call(this,t)},o&&t.doubleClickZoom.enable()}t._zoomAnimated&&(Rl.map._animateZoom||(Rl.map._animateZoom=t._animateZoom),t._animateZoom=function(t,n,o,s){this===e._map?(o&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=n,i(e,t,n)),setTimeout(r.Util.bind(this._onZoomTransitionEnd,this),250)):Rl.map._animateZoom.call(this,t,n,o,s)})}},updateView:function(){var e=this._map.getCenter();e.zoom=Math.max(Math.min(this._map.getZoom(),this._map.getMaxZoom()||t.Geo.default_view_max_zoom),this._map.getMinZoom()),this.scene.view.setView(e)},updateSize:function(){var t=this._map.getSize();this.scene.resizeMap(t.x,t.y)},resizeOnFirstVisible:function(){var t=this,e=!0;this.hooks.visibilitychange=function(){e&&(e=!1,t.updateSize())},document.addEventListener("visibilitychange",this.hooks.visibilitychange)},onTangramViewUpdate:function(){if(this._map&&!this._updating_tangram){var t=this._map.getCenter(),e=this.scene.view.center;t.lng===e.lng&&t.lat===e.lat&&this._map.getZoom()===this.scene.view.zoom||(this._updating_tangram=!0,this._map.setView([this.scene.view.center.lat,this.scene.view.center.lng],this.scene.view.zoom,{animate:!1}),this._updating_tangram=!1)}},render:function(){this.scene&&this.scene.update()},reverseTransform:function(){if(this._map&&this.scene&&this.scene.container){var t=this._map.containerPointToLayerPoint([0,0]);r.DomUtil.setPosition(this.scene.container,t)}},setupSelectionEventHandlers:function(t){var e=this;this._selection_events={},this._selection_radius=null,this.hooks.click=function(t){"function"==typeof e._selection_events.click&&e.scene.getFeatureAt(t.containerPoint,{radius:e._selection_radius}).then((function(n){var r=Object.assign({},n,{leaflet_event:t});e._selection_events.click(r)}))},t.on("click",this.hooks.click),this.hooks.mousemove=function(t){"function"==typeof e._selection_events.hover&&e.scene.getFeatureAt(t.containerPoint,{radius:e._selection_radius}).then((function(n){var r=Object.assign({},n,{leaflet_event:t});e._selection_events.hover(r)}))},t.on("mousemove",this.hooks.mousemove),this.hooks.mouseout=function(t){"function"==typeof e._selection_events.hover&&e._selection_events.hover({changed:!0,leaflet_event:t})},t.on("mouseout",this.hooks.mouseout)},setSelectionEvents:function(t,e){var n=(void 0===e?{}:e).radius;this._selection_events=Object.assign(this._selection_events,t),this._selection_radius=void 0!==n?n:this._selection_radius},trackMapLayerCounts:function(t){var e=this;this._updateMapLayerCount=function(){var n=t.getPanes().mapPane.childNodes;e._mapLayerCount=0;for(var r=0;r<n.length;r++)e._mapLayerCount+=n[r].childNodes.length},t.on("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),this._updateMapLayerCount()},updateTangramDebugSettings:function(){t.mergeDebugSettings(this.options.debug||{})}}),n=function(t,e,n){var i=t._map,o=t.scene,s=i.getZoomScale(n),a=i.getSize().divideBy(2),u=(e instanceof r.Point?e:i.latLngToContainerPoint(e)).subtract(a).multiplyBy(1-1/s),l=i.containerPointToLatLng(a.add(u));return o&&o.view.markUserInput(),i._move(l,n,{flyTo:!0})},"function"!=typeof(Pl=i.extend(s)).remove&&(Pl.prototype.remove=function(){this._map&&this._map.removeLayer(this),this.fire("remove")}),Pl.layerBaseClass=i,Pl.leafletVersion=o,new Pl(e)}}(e)},debug:{log:t.log,yaml:fl,Utils:t.Utils,Geo:t.Geo,Vector:t.Vector,DataSource:t.DataSource,GLSL:t.GLSL,ShaderProgram:t.ShaderProgram,VertexData:t.VertexData,Texture:t.Texture,Material:t.Material,Light:t.Light,Scene:zl,WorkerBroker:t.WorkerBroker,Task:t.Task,StyleManager:t.StyleManager,StyleParser:t.StyleParser,TileID:t.TileID,Collision:t.Collision,FeatureSelection:t.FeatureSelection,TextCanvas:t.TextCanvas,debugSettings:t.debugSettings},version:t.version}}));try{r.debug.ESM=!1,r.debug.SHA="7baed5ea035938bc9de4116ff9a1ce039ddebb47"}catch(t){}return r},t.exports=n()}).call(this,n(27))}}]);